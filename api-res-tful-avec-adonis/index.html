<!DOCTYPE html>
<html data-html-server-rendered="true" lang="fr" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22fr%22%7D%7D">
  <head>
    <title>API RESTful avec Adonis - https://etienner.github.io</title><meta name="gridsome:hash" content="0ba4ad5794b1fee6a14887e1842cf6ed8c3bb27a"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="description" content="Adonis est un framework Node.js orient√© MVC. Contrairement √† Express, il n&#x27;est pas monolitique. Il offre une solution assez compl√®te allant de l&#x27;ORM aux tests unitaires en passant par la gestion des logs"><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="API RESTful avec Adonis"><meta data-vue-tag="ssr" property="og:description" content="Adonis est un framework Node.js orient√© MVC. Contrairement √† Express, il n&#x27;est pas monolitique. Il offre une solution assez compl√®te allant de l&#x27;ORM aux tests unitaires en passant par la gestion des logs"><meta data-vue-tag="ssr" property="og:url" content="https://etienner.github.io/api-res-tful-avec-adonis/"><meta data-vue-tag="ssr" name="twitter:domain" content="https://etienner.github.io"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="API RESTful avec Adonis"><meta data-vue-tag="ssr" name="twitter:description" content="Adonis est un framework Node.js orient√© MVC. Contrairement √† Express, il n&#x27;est pas monolitique. Il offre une solution assez compl√®te allant de l&#x27;ORM aux tests unitaires en passant par la gestion des logs"><meta data-vue-tag="ssr" name="twitter:site" content="@etiennerouzeaud"><meta data-vue-tag="ssr" name="twitter:creator" content="@etiennerouzeaud"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.c2df4604.css" as="style"><link rel="preload" href="/assets/js/app.22d1f777.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.1a806e4f.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.77a6618c.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.dfbaccb8.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.37769e18.js"><link rel="stylesheet" href="/assets/css/0.styles.c2df4604.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app"><header class="py-2 text-center"><strong><a href="/" title="Accueil" class="active">Etienne ROUZEAUD - D√©veloppeur Web</a></strong></header><main><div class="title py-2 text-center" data-v-2084d89c><h1 class="display-5 pt-2" data-v-2084d89c>API RESTful avec Adonis</h1><!----></div><div class="container"><div class="row sidebar"><div class="mt-4 col-lg-2"><p><em><span>30 juin 2018</span></em></p><ul class="list-unstyled"><li>
            üè∑Ô∏è <a href="/tag/JavaScript/">JavaScript</a></li><li>
            üè∑Ô∏è <a href="/tag/API/">API</a></li></ul><p>‚åö 13 mins de lecture</p><!----></div><div class="col-lg-10 mt-4"><!----><article><p>Adonis est un framework Node.js orient√© MVC. Contrairement √† Express, il n'est pas monolitique. Il offre une solution assez compl√®te allant de l'ORM aux tests unitaires en passant par la gestion des logs et d'autres choses...</p>
<p>Dans ce tutoriel, nous allons cr√©er une API RESTful avec une base de donn√©es Postgres (vous pouvez utiliser SQLite, MySQL, MariaDB et d'autres SGBDR SQL avec Adonis).</p>
<p>A noter : ce tutoriel a √©t√© r√©dig√© avec Adonis en version 4.1.</p>
<h2>Pr√©paratifs</h2>
<p>Dans cette premi√®re partie, nous allons installer Adonis et pr√©parer (rapidement) le serveur Postgres.</p>
<h3>Installation d'Adonis</h3>
<p>Pour installer Adonis vous aurez besoin d'avoir une version sup√©rieure √† √©gale √† Node.js 8.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> i -g @adonisjs/cli</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 678 629' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-06ab97972a973a7c0e94f1921bfbe36d'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-06ab97972a973a7c0e94f1921bfbe36d)' width='678' height='629' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAA7CAYAAADLjIzcAAAACXBIWXMAAAsSAAALEgHS3X78AAATtElEQVRo3tVbZ1cbW7JlfK9x9jU2xiYLBAilVs455wgiGGxsrzUzH%2bb/f663d3W3EMnP7y2D537o1UEHqU%2bdqr131SnmsuFNMT7sibtwIP7WmRixhhjpgQTP/yOB5qkEqkdi7KQl0LsQX34g2bWo/LP9Rb41TuQo1ZPyRlQ88w7xP9ueHr6nW1fu/5uPueZ%2bVoqrMSl5apLaL4p3YV98H4Piw8R8KyG99jvi4t/Live9T8J/uSS3FpHkh4AkcB/DeM/jTfE92xLfE8d08jz/HQwx13ZWZORpynloIPXVuPjmNyX43CkhfBjABAxMyv94Q4w/NySE58FXe5js5UrzPvJmX%2b%2bDr3Yl%2bHL37%2bUBe49WpbSdki/ViZyXJnJRP5PzwkBqezk5iLflJH8g32rH8rX2Sb7UTmSS6Eg3UIXXhOSicS5fSgfSCzXlS3Ekpwij0iZCAgb72xjAM7%2bhq0jXDrzckciCW8/Gix19FnnrkaS6/r4eXO0oxnClE%2b8NieI%2bZHlB7K1XQq/37sUD7sur5lLvQxJf8EjsjReHBxNz4d4ryXd%2bTMwloZd7YmCgF6Ewe/CFvAiXG8%2bf/B9f9PlPTu6%2bDNB3t%2bTI6Mh5ZChdZ0EySxH5HD2QsbcpA3w2MbpSWolisPPmqliTNp5vXzGMGse6Zjjomcaad0yv94EpHLP/x5p%2bF6/dGMsx7j/X8RwHzm5r3H0B65y%2b6PMd8b3xi38lLf63hvifbOrqzv6Y75ob8u%2banpIcJ9sSgxd9By3%2bu/tZihsxGUXbwIwTXEflKDOUk0xfBsGaVJ1JSS2HpWdU5SjZkVEMxk918SwiF6Dbrjcvhc2ETDJjYMsYY7rypTKRljuvRrkXDzDdEKu7YIjxMWka4C%2bfeaZhaPVbYpAGGEZachhvSdmZVRDt%2b0sKnkeZASZclYozLcfZkdR3UtLylmUYrksNmmIQqksBxkmBYlvugmJKDvoiuxyUxJIhBUdCigDTEs7lraRklgPqGfdmAOPFrhhvAxBEMTEWwxJYy4qxnBQD8W8OdN4KSM39PBihhlXsY9J9abkykl6JyDDakoFRlq6/IgeJrhTXseqBhoxjbTnP99UILrg4Q8H1aG3q/m7oCT7TELAPa9y9hYD5Q2v6Ajzv/7GKF8BLzW9cvoR9PF6/8gIeCwTNl964jPt5cyKMf3uMdzrWxg2nep6efycLNJ1FqW6kpbKWkOYWVnS3DI6PS2oxIHXcNxw5qW2mpcFrHKEZoTOL/ApU1grNrpTnFqbQv7UM5L2mHh9eCm8XpcVJb2aktd%2bQ9m5JKjBI6p0hDXzWBjN0dkrSwZg2jBV57Zq%2bKGOXBzVAfNGrq0kNQb1APUAtkYJkjqpG8KjG4JnjYu%2b8%2blmY4657wfNrZ4bp7Bj7%2bie95y76NUPg0Yq430Lzb5bFswa0BRu4EQZKUXB7F8PCChM7BHjwhap7eRkB2M4LYyD9QEGrCBTvhxvyHaBY2IjLt9Zn%2bQ4leRhtSgfoPwQAcuKfqyfyLyRYXwojCSCPYKzbv8lrhpTG/2OTkYgVtjeROhlKPJNObdq18cI941lKpcSWxya2KN7ob5jYM0e3NRZDYICEGKDBAA7jA5Kfp45bud888INPt6W%2bX5Ah6G2ACU9Aa9WthFRdBbkABR6BHTreonT8ZUVy0htZow9wHEA6k/bya2EwRQp/35S2ryK5laCMIk3I7ba0wRpjGK3hyklmNaxA2/EU8D0mzeYgxXuhBhagpt9R3ErLOIJ3CdZlGOtIx51BwhbU3xxFGniPCr6zBAqu4FlDDgDIZJc5ihmlwOUUqC9g0aDnxzGpXrAtDXdRDcDc4AATziF7zGPVJ0iTD/Dypa2UfC5P1BCkPjJGHy9AemQq3QS/F9ajqicmmGDDlcXku3qu7malvpuW9MeAxCG5m6BL0iRDh1SbWvLrAlBbxPEsvmhIDeML0CFl5DacXBjhWsZvVbYTklmBsfE8i3csw2B1ZLcJhK1pgPdRMTaLOnGfurlDJ3iXEcwQ2JbyTk76gYq6PwVNfj2mbt/0FOUzXJvczmTqS/lQBhjXwCS68AhO6qyA5AvPO%2b6cetAYoqiH1RvAmIEXTnV5uu%2bVEHhsqsnrIWCzjIYO6fRPMxSmIYAxnpnnttLUEFADIO6NtZzqgMsJ/4hzGQJbsDhWLNmHW5Ulh5UsrEfU1c%2bQFRY3eJ3EJI%2bwSglJLgXlU24IPVCF0apynO5JAEbcw8TseJ9lhLtA65ezwDQEAICqBGfz%2bR8YgGPqrjwM0FXVl8Pqc1KN/SImPZEeVGHFmdHY7ngL0ufqYhxdm7HNtJrGaiOua3DH4mYcK7/z4JRoGuBd2PQA4sBPFjS4Wh2jJl8BZmSCGsDqc%2bkQWNCVY6hCgiLdvQgcGBglyOAWgKepJTXmBsSIDGKazEHXJ1AFX/4GA/ipyhYjcH%2bwwMe4GQZPHP9rakqMILofJHqK7BmASxcANwi3cV/UOCc2UC6f5MYSeeUU59yyxp/GN11%2b/pKe3FbW%2bNCCaM7LH4YBmAmSCv0vdu8EvushcAjkJmXlEPuksmMAYcdfV2piNek43YdRqpoVjpAf0CNopPDr3QeXvHcaIPLKJbGliISWrUzw2dZPvRhDoLyT0VQ18d4vY7g%2bQyGzHALFZPQgHRH5I5hwE7zOsaRAGuCuxEbZ5yE9IPMhImfhkbTW4%2bKB2mMtgIVR3xOTRm6r9Nr3rn%2bsyA7c2vWPVdmbW5FdHHTnPdzzmq7Oa47fmfuoYz2WKrO/w1ZnpDSygW2EB8MAD3jf8z4m3pWM%2bN5BEa5mp4BIRWisF8T/el%2b1wW31gE/5MTRAR5UWQbCyndRrLZ7ifIhQKG6nVS63wPkUT6cAQeYEh8meUiOlMelyECjfW95/pwFY9ytu5qS0W5XwYhBGCJuh8MaHiXuUIm/DBS8ywLSF4pSnnETREddwyK5F8DyuQJiFjGVyVKIcBlYwSSJgMmniWP5N5I1bZWrJEZtmiw9mgAQme%2bDvysTXljQkpVvDwGGqwSeOm4wwEwJ2LdBt5f3m2TFVZHZdgN9huv7GjbKa/UzVHcbYdYKfEUG/IkzmSEXuhaB41vPip9svWmEA1zfWcGwU1Bt8j9dueMA43pF/db9ovY8anGLmOHeApKQhZazmWfFAGaDupjQ%2bkK/1U1DiUCaQvcSNqQKcv8zceO%2by1KGNDbZx3DNVol9FmVY2GJEAcgGlQZbGoAhVFC3FzfMiwuJ9RFfmshiypQLmonosHV9Rt8vyOMgGlMZUf8fpoQqiChIW3ue3MvK1diRHoE5qiBbcvg91yISI9UFK5DoSnTbosrmf0zoC1WYfBia21KEy%2b/6iPou%2b2fsl4TKnE6IStA3wLmh6AESRJklMjTF5lckc%2b/TSA/pIR1n97fpKqgXyUHkqjJD41HZSyBXymvFVkaU1keHF3iMfQJJE7TABAFI6M4mqghqZoVFWEyypLwiYCYQkM0im1CXgDI3TgnRmqhyGsPL%2bihBQAyxaBoAa1EmzKApW0PNqTo3CEPBdCwEa4Bvcugvdn8cq8jhAckQDcAWZc0/gBaeZrmaGXGEKopPsUPP7cRR5OdiihDA5LRxi8iM5xWcMKa6%2bWadct7I/SzFaYfPLQuCKAegBvGYIkALVCDnTMDTCDBVeGuDkhgF6TH2x4gfACLovqZDKsBdsaJZoWMVQU1OY8R9ADmJvyYVe7T4cCF4JAU56KaaVIZ081eFfXrNQwlrBFQS/FgJrlyHQA58zZkfcN8AKn8DNG/sFNU7XV4Bre5Q2WaTII3SMZ1s3iqOX1/dbKb49BNZzpgB6uWcWSG7J03/kAYNgRSc5YmnKV1COZ9nqrHwiF%2bVDaQATGp6SfK4cIZucqFRm%2bc1nldgfMi%2b4GQJwdTXCEo7ltNYJ/KBGWxr/jAGI7OWtBFa/K6fIBBu7KS2O1HeSEnnnA9gNFACLG2FJLhnwmJqWzI7SAwXBMsQRae9h6gF2CIDvpxjAXaFZSYyw0DB4sXuFBqcGQAhQ8U0xwKbBzAioP4bCiyIEcpJBvtGmHEaKfJwd67baGAkUd5JYDxhFm1oHfMi6wE0P4OqvYNIfUyYYbhRNTGB4vLrMCVQHYOUu4MacMF08t2rqgFGkjomkMPEUaDCncpeVn9xmSj5le9pvMIz35Bs0AYuqxA3qBVJcCp%2bxzvfT2%2ba/3gARc8LUAQTE1YypAcgCTzZniqJOKXCCWFlWeE%2byA7N3CC7dAm9zcswFiP6H9AqWq4NlrHZb6wIEQE56FG5K4PmWZo2m%2bnvoktgNGoyYk3ZUTNcHPdH1uVN8HQRZBCELsNbOEKAcHmM1WQancGFW2IV3HIIOWRmiTD7LjxQE3Zbu584Sa4G/qyhyEwOYEjMEVrLwhvC0%2bnNbRajtKyMdHmmllzGexapys%2bKQUnczivg/UFHEzY0iDKKuTj0AD2B9nwaw84DZiT%2b8Aa54gF0TAPov%2bK5kg1deEDFacmZAcyVtZKCMpQ7IAge4UXIMI5xkR1ohZhGUHtFwl%2bR78xThcaKgd9t3P/jm6K0GIAZohXhvCnpXukWsaxqADMDJk9YyiPluoK5ufpLuAtSKCoDc9RmCGhn3RPoBwJM0eVkB%2bn1tdTMhYAkhGoDUp1tlQcvdb1dhrPmz8qudH7sZpcFBtKMav4cMkUkLt6uIAQQ%2bFkm4a8TtMTZZPnTx46fSYYPZIJmAWSBF0R10NJsMtQF6BMEcNzHB/VSCTGbOikdaIWZekLP2AJkblJAP2O21v7upcloQ8cIDPMj/PVh1nr1Qgf4F/517BGZBpCv/7l9oNZjFEK0CeyqI8Ql4Py%2b1feJDW7fEvXbXyLXmq99zXHr1XPSNV5o7JcRkXipbRWk681LfLgDQkma%2bPa0MO6aZ22ybLNE8YjVLaqsszqz18Z6TDr52KdVdb5%2b7LJNdttlM%2bw%2bt%2b9nPZp9PW%2bpmxl//Do/Vcmd3sMy28/hmmGyOzZGN3Yp0XHWpbGalCkM0cc02GQ%2btxEYpZoQ8v3RZwGgagdvSFD5xJD7hN2490wicMIufsUWfqr4QjKBGwjn21m2mvPicDdcp/D2LokkYjWP4GTtJaMTUB0O/i7/D79W/x3cyvFiQNbtbd82OVjzj30T%2b4nc4IcKCWnlmQVYXBX8XWfBoJ4u9s3UZAm9D4gHyeyCDPQBCN0OB5TACIrfMVBonTKZgaeypQ0OAPYDM5tgC96l4KENwPtGdPcfcI2QjwyTWkNP8ATR/TfIbSflcGqlgYg7RZwLEwkikqYrxAnjCylHRmZPDmNnE8LX%2bCXJ7ogDLLTb2G%2bSXA/K1cS7fGqeKPR1kmyzNHeeHcpYZKgaRgdincBhr6YYsd6l4XwdYU3lODaAgiElpaxzrAVY9UEHwrWHWB3iQFdgpPr9hbo/DAJzgAX6gjlg/Kwy0GMod3y4mdgoapPobY2KcaA%2biKbcW1l4A9giel45grLjmEEM8Y4LE9jkCJZsox5DP7f3stPHalt/T/US7A222%2b/SPdR1D73I9Wp32F/DvqTbZd%2bC7RuVz2ttL%2bbuWsQyQMLNBNUDAKpHl9NC9AnaU8kVoAKyQUpxRhyIcqMorbaeV6s6yfYikshpgEDYNkIUByALs0uhBL7Apggqx6S6qquT/LtBY3DmmIarbCW3ITi56pyHEPYX0R0NLbKRYunR80a8ewgZLdpGEdZzZEcKulQhCZLaNdxbHZgyQvWmAdwGVw7YHqFbAOP8rl64Ey%2bJUdHVXASs61h0fekDNlZfz/EBrez0c2hyFM%2bO2ryX0qOqCcayjNUC219b2i/Ip09PEinqhspvTjZSiM6u7zSyy5pFOMyQ%2bF4YadpTUGjKOpFwgNA5TA%2bQlJQ2xU4Tht%2bqRhg9bYa5rjls8IHurBxj0ADyj6%2bvx1OwHtGlwhBVLIybHia6U%2bcLwgGOIoy%2blQ/WOQaQlFUdMt8Ho6lxpujgV4zEyyOQ7NzLBFXM/wOoSudp9frVD3a4a%2bSwmsFfUbbXS2MjvsQqqNpPcpTnMBglujyMD1PR3eRYDZvYIAIgaAjO7Or1wC7HeM7tAWPpCPj8EoLHTi4VQntkr3HSlpbiV1InTAKz%2bsDpc3Ulq5sh6P3eT6b4/0gh23/JdnP7/6TSdY50/gAwwtJ4zt8hpDCpBrLxZHsM9y2NkA6bHzy7jh7kAQ2CItLi8FcOEMhrXbWAADyIx1WLNmdCYZeLEPcKOv6r7Bcn3XsWLbqCh3SMsotyXPL7TADEg/dBVkYm7JhNvU0KkOCL9/Lrp8k/sPcJNSxBdfiHr9Ltzy1rM2LeutW7/aE2ccx%2bn2%2bQ829es8XObnGPtThFzy2vjXpuif5ALOMRYMCQIHRAmDnDFWRPgamPlNRe4tU3OqcjLPiFWhVj9OQaA8Ux3Z7WH/MyyGQ/WBYahmu4ckx36IXB/tK79fvb3/Y5ukTnt230fkvBKUnx0eVLfa7fp/sgFbnsR%2b550xqZFdm1StbEoQuWWWg5pRZjNiOR5s%2bkxowelM7e4%2bIy1xKRmhVu3boA8iAGiCz4ZuuvS3kiI9/G62SFiH/MzjUtaFndMdbR2dwBpieBua%2bvb7gahCDF3eNe1c0Trffjc7vflvcsKC/v/BWwhM6vpH6YqzInxP0RWs1oX0B1hmwqXLGW4FJ02UtqTVykMhKf40b5d/ceJLkRRTRuhRqGqbo2xINrYS%2bvO0AkYIw3v0J1eeAd3jSiFVQXi8%2b/IIsexvhxBRRbWgmq0%2b/aA/wGcpHkqXOjjdwAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="678" alt="Terminal" data-srcset="/assets/static/adonis_terminal.522af89.9f8aad72d14d12a263e6f58a67d4f2da.png 678w" data-sizes="(max-width: 678px) 100vw, 678px" data-src="/assets/static/adonis_terminal.522af89.9f8aad72d14d12a263e6f58a67d4f2da.png"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/adonis_terminal.522af89.9f8aad72d14d12a263e6f58a67d4f2da.png" width="678" alt="Terminal"></noscript></p>
<h3>G√©n√©ration du projet</h3>
<p>Ensuite, lancez la commande ci-dessous.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># adonis-api est le nom du projet</span>
$ adonis new adonis-api --api-only</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>D√®s que l'installation est termin√©e, vous pouvez d√©marrer le serveur.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token builtin class-name">cd</span> adonis-api
adonis serve --dev</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Pour vous connecter √† votre application sur <a href="http://localhost:3333" target="_blank" rel="nofollow noopener noreferrer">http://localhost:3333</a> qui renvoit un message en JSON <code class="language-text">{&quot;greeting&quot;:&quot;Hello world in JSON&quot;}</code>.</p>
<h3>Configuration de la base de donn√©es</h3>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker run --name adonis-postgres -p <span class="token number">5432</span>:5432 -e <span class="token assign-left variable">POSTGRES_USER</span><span class="token operator">=</span>admin -e <span class="token assign-left variable">POSTGRES_PASSWORD</span><span class="token operator">=</span>mysecretpassword -e -d postgres</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Apr√®s cr√©ation du container.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker run -it --rm --link adonis-postgres:postgres postgres psql -h postgres -U admin</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Dans votre SGBDR, cr√©ez 2 bases de donn√©es. La premi√®re pour l'API et la seconde pour faire les tests unitaires.</p>
<div class="gridsome-highlight" data-language="sql"><pre style="counter-reset: linenumber NaN" class="language-sql line-numbers"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> adonis_api<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> adonis_api_test<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Dans le fichier de configuration ".env", modifiez les lignes ci-dessous en fonction de la configuration de votre SGBD (ci-dessous avec la configuration du container Docker).</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token assign-left variable">DB_CONNECTION</span><span class="token operator">=</span>pg
<span class="token assign-left variable">DB_HOST</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">DB_PORT</span><span class="token operator">=</span><span class="token number">5432</span>
<span class="token assign-left variable">DB_USER</span><span class="token operator">=</span>admin
<span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span>mysecretpassword
<span class="token assign-left variable">DB_DATABASE</span><span class="token operator">=</span>adonis_api</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Remarque : si vous utilisez Git, ajoutez le fichier ".env" dans le fichier ".gitignore" (en plus du dossier "node_modules").</p>
<h2>Mod√®le et migration</h2>
<p>Dans cette seconde partie, nous allons g√©n√©rer un mod√®le et configurer la migration des donn√©es. Adonis utilise le g√©n√©rateur de requ√™te Knex.js.</p>
<p>Tout d'abord le mod√®le que nous g√©n√©rons en ligne de commande.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">adonis make:model Post --migration</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Afin d'√©crire les instructions de migration pour cr√©er ou pour d√©truire le sch√©ma de la table dans le fichier "database/migrations/_post_schema.js".</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">//database/migrations/\&lt;timestamp>\_post_schema.js</span>

<span class="token string">'use strict'</span>

<span class="token keyword">const</span> Schema <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'Schema'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">PostSchema</span> <span class="token keyword">extends</span> <span class="token class-name">Schema</span> <span class="token punctuation">{</span>
  <span class="token function">up</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">table</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      table<span class="token punctuation">.</span><span class="token function">increments</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      table<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
      table<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">)</span>
      table<span class="token punctuation">.</span><span class="token function">timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">down</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> PostSchema</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>La ligne table.increments() correspond au champ "id" incr√©ment√© et la ligne table.timestamps() √† 2 champs g√©n√©r√©s de type "datetime" nomm√©s "created_at" et "updated_at".</p>
<p>Pour communiquer avec le SGBD, il faut installer le module concern√©. Avec Postgres.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> pg --save</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>On peut d√©sormais lancer la migration.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">adonis migration:run</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>A la suite de cette commande, vous pouvez v√©rifier l'√©tat de la table "posts" dans votre SGBD.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token assign-left variable">adonis_api</span><span class="token operator">=</span><span class="token comment"># \d+ posts</span>
                                                           Table <span class="token string">"public.posts"</span>
   Column   <span class="token operator">|</span>           Type           <span class="token operator">|</span> Collation <span class="token operator">|</span> Nullable <span class="token operator">|</span>              Default              <span class="token operator">|</span> Storage  <span class="token operator">|</span> Stats target <span class="token operator">|</span> Description
------------+--------------------------+-----------+----------+-----------------------------------+----------+--------------+-------------
 <span class="token function">id</span>         <span class="token operator">|</span> integer                  <span class="token operator">|</span>           <span class="token operator">|</span> not null <span class="token operator">|</span> nextval<span class="token punctuation">(</span><span class="token string">'posts_id_seq'</span>::regclass<span class="token punctuation">)</span> <span class="token operator">|</span> plain    <span class="token operator">|</span>              <span class="token operator">|</span>
 title      <span class="token operator">|</span> character varying<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>   <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>                                   <span class="token operator">|</span> extended <span class="token operator">|</span>              <span class="token operator">|</span>
 content    <span class="token operator">|</span> text                     <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>                                   <span class="token operator">|</span> extended <span class="token operator">|</span>              <span class="token operator">|</span>
 created_at <span class="token operator">|</span> timestamp with <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>                                   <span class="token operator">|</span> plain    <span class="token operator">|</span>              <span class="token operator">|</span>
 updated_at <span class="token operator">|</span> timestamp with <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>                                   <span class="token operator">|</span> plain    <span class="token operator">|</span>              <span class="token operator">|</span>
Indexes:
    <span class="token string">"posts_pkey"</span> PRIMARY KEY, btree <span class="token punctuation">(</span>id<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Remarque : si vous avez fait une erreur dans l'√©criture de votre migration, tapez la commande <code class="language-text">adonis migration:reset</code> pour annuler et revenir √† 0.</p>
<h2>Cr√©ation des routes</h2>
<p>Dans cette troisi√®me partie, nous allons cr√©er nos routes. On part sur une base CRUD (Create Read Update Delete) classique.</p>
<h3>Sch√©ma des routes</h3>
<table>
<thead>
<tr>
<th>Verb</th>
<th>URL</th>
<th>Action</th>
<th>V√©rifier ID</th>
<th>V√©rifier champs</th>
</tr>
</thead>
<tbody>
<tr>
<td>POST</td>
<td>/api/v1/posts</td>
<td>Ajouter une ligne</td>
<td>Non</td>
<td>Oui</td>
</tr>
<tr>
<td>GET</td>
<td>/api/v1/posts</td>
<td>Lister les lignes</td>
<td>Non</td>
<td>Non</td>
</tr>
<tr>
<td>GET</td>
<td>/api/v1/posts/:id</td>
<td>Obtenir une ligne</td>
<td>Oui</td>
<td>Non</td>
</tr>
<tr>
<td>PUT</td>
<td>/api/v1/posts/:id</td>
<td>Modifier une ligne</td>
<td>Oui</td>
<td>Oui</td>
</tr>
<tr>
<td>DELETE</td>
<td>/api/v1/posts/:id</td>
<td>Supprimer une ligne</td>
<td>Oui</td>
<td>Non</td>
</tr>
</tbody>
</table>
<p>Pour les requ√™tes de type GET (la seconde), PUT et DELETE, nous aurons besoin de r√©cup√©rer l'id de la ligne concern√©. Et verifier les champs des requ√™tes de type POST et PUT.</p>
<h3>Stockage des messages g√©n√©riques</h3>
<p>On va cr√©er un fichier avec nos messages g√©n√©riques que l'on affiche en JSON. Cela va nous permettre de ne pas nous r√©p√©ter lors de la cr√©ation des tests automatis√©s dans la prochaine partie. Dans le dossier "app", cr√©ez un nouveau dossier "app/helpers" dans lequel vous cr√©ez un nouveau fichier "Messages.js".</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// app/Helpers/Messages.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  post<span class="token operator">:</span> <span class="token punctuation">{</span>
    errorNotFound<span class="token operator">:</span> <span class="token string">'Post not found'</span><span class="token punctuation">,</span>
    errorBadRequest<span class="token operator">:</span> <span class="token string">'Fields error'</span><span class="token punctuation">,</span>
    okNothing<span class="token operator">:</span> <span class="token string">'No posts available'</span><span class="token punctuation">,</span>
    okDeleted<span class="token operator">:</span> <span class="token string">'Post deleted'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Cr√©ation d'un contr√¥leur</h3>
<p>Avec une ligne de commande, on g√©n√®re notre contr√¥leur "postController".</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">adonis make:controller postController
<span class="token operator">></span> Select controller <span class="token builtin class-name">type</span>
‚Ä£ For HTTP requests
  For Websocket channel</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Dans ce contr√¥leur, on charger le mod√®le, la database, le fichier contenant les messages g√©n√©riques et l'outil de log int√©gr√© "logger". Chaque fonction repr√©sente une route.</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// app/Controllers/Http/postControllers.js</span>

<span class="token string">'use strict'</span>

<span class="token keyword">const</span> Post <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'App/Models/Post'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Database <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'Database'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Messages <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'App/Helpers/Message'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Logger <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'Logger'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">PostController</span> <span class="token punctuation">{</span>
  <span class="token comment">// Ajouter une ligne</span>
  <span class="token keyword">async</span> <span class="token function">create</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Lister les lignes</span>
  <span class="token keyword">async</span> <span class="token function">index</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Obtenir une ligne</span>
  <span class="token keyword">async</span> <span class="token function">fetchOne</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Modifier une ligne</span>
  <span class="token keyword">async</span> <span class="token function">update</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Supprimer une ligne</span>
  <span class="token keyword">async</span> <span class="token keyword">delete</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> params<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> postController</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Dans le fichier <code class="language-text">start/routes.js</code>, on d√©clare nos routes group√©es avec le pr√©fixe "api/v1".</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// start/routes.js</span>

<span class="token string">'use strict'</span>

<span class="token keyword">const</span> Route <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'Route'</span><span class="token punctuation">)</span>

Route<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> greeting<span class="token operator">:</span> <span class="token string">'Hello world in JSON'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Route<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  Route<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">,</span> <span class="token string">'PostController.create'</span><span class="token punctuation">)</span>
  Route<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">,</span> <span class="token string">'PostController.index'</span><span class="token punctuation">)</span>
  Route<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'posts/:id'</span><span class="token punctuation">,</span> <span class="token string">'PostController.fetchOne'</span><span class="token punctuation">)</span>
  Route<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'posts/:id'</span><span class="token punctuation">,</span> <span class="token string">'PostController.update'</span><span class="token punctuation">)</span>
  Route<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'posts/:id'</span><span class="token punctuation">,</span> <span class="token string">'PostController.delete'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prefix</span><span class="token punctuation">(</span><span class="token string">'api/v1'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Chaque route √† son contr√¥leur et sa fonction attribu√©e s√©par√©e par un point.</p>
<p><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 651 235' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-cd0b5ed1b3451db45075e017f377d4b1'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-cd0b5ed1b3451db45075e017f377d4b1)' width='651' height='235' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAXCAYAAAC74kmRAAAACXBIWXMAAAsSAAALEgHS3X78AAAJ1klEQVRYw81YV1sbSRblmx0ncjROgFCWutVBOSEymBxswB8IbI9352F3/v/r3XNuVUvChhnv7ss%2b3K9b1VW3bt065wYNrTeSUnydkcL6lfiHd%2bK1DqUQ7orf/UO8w1vx9m%2bkkOuIVzsS/%2bKbuItluSgdyO%2bYe7t1Kaf%2bprTfhLLvbcunxoHcbl7JXrYjF40jOSvuymm4Lfkni1J4ERf3%2bfL/nQwV5xLijybEe1sUP9kUb74gHg7kJxvixWvivSvp08%2bvip9uSWEiI52FsqwuVaX5JsDhA6lM56QyV8B4UdoLJWm88qQy68jKu6LU5lzxhuPijST%2bexmOJP6/6fhurICxoXAqK/5kRoKRZQmGIWMJCeAQfceGwShkJG5/Q8aT4k%2bkxIMUMF7AfG8iLR7G3bGkjgVTaQkm0/pO5/rTWaxL6Vgw8fNSmstBV0Z8SAAbqSfEHhQzJ2XmTJp32qbPAR0h1nKO35tj7Rg3a4fC0aQk43WJOx1JZFqSilXEfRYzEHk2IBYyztOYeFjjj2BdCvOTdUlk25ICSjK4fWc4oY5zgKR4YV2/UTfnZnEA98mSOKoz9qfCObyIDJAZpw533diI/fg7AYRmgLQQl5J5U5JYwO%2brkp3K9fagre4Lc4Hp16Esg66JdEMSqaakXgcSTqZAgemMuONpcV664gK27kxeD%2biRFj9IUqFDD4YQZzIrDuDvAEUOoO7wgNiQXieq8tDlzkHnbF51F8bN%2bsf139%2bnOJNVdBV4KOh3uRfsVFuhu4B9aX8hsh9zCkTjSF%2bHj5vWM4K6qkNtgcC%2b4mwWDpjNSUioED5jVr6D0aCoQhhWnMlJEUrKOHQF74RlFYesQDm/lzBWnTbjpEH4F3p/EEL0Zb4P7bEHxM6h/UVCm9QdT93TYSiQf3A91w4VsGh1oQIFuLGnS/dhr3AcfI8prHxAKj%2bSke76pfzr%2bFZu1z7KfmFLvu1%2bkh0E0vyzJWkheJ4iC3xqn0NO5QpZYQewzf5tQQrP7%2bvsS3%2bc%2b/AA/O1YStwXS1PQrf0GwXbWldyvi5a6fVv5m5em73atPp/EFMVDIeBRmjJBikGrFyEHYKTjClvzmwsDvf28NF/7Up5xNCPwPbRep5QB0/orXxoYrwJ%2bZSCCBhd6OgdgP7CvbylCJPljyf7e3wm/hUBgEVQkCnp6B2gWIbY/1j8H0T9EHoQ4DBUQtiUYyWcZUObikqY4pwf/HgWwcRW847fqS0c3I5poFL%2bXAbsSoz90c47qgkPK2LQ852ia1H3hzCKcRX1FXITZN2nmE7p23%2bA78S3UTRYw9lMfbaK%2byFbGK80COt%2bux9MfS0UUiIMCVfm625Wb9onsO5vyoXokH4pb8nXnWm5Wz%2bVD5UBa8x7gC4hpFkiI8yIJaJ/J7/tdOS/uoNhZArTjBl7PY7Iaq8uXrSs5r57Ip/q%2bdEGTu7Vz2Xe35FPrWM6DbbnduJQ2ovFOdl2u6odKpdv1C6kBWYQzD%2bjaaP6QKNxx481XgXyBrdedD/KxeiiH%2bRXJ/rLQy15KgScDtOAT9loKGAQ0UbTUkboY1EowgO%2bENW%2bKUCZNIvhEEOc70eJr/k8ovJkFeJs0njfK9XxWXxZUB%2bGqwZNBErfFm6N%2b/q5hjt4gDFMKzBrdj4tFI%2b1/G%2bp6ReysQSSpFEQUGL2/lt9LSgF8DG0MIGSLlgJ89xgpp80hItgpxBE3QqwjtGvzLnju6SGbbwMYgUPhe4X0YEaAPn7nQTmfB63MuUYnITxt6KTUs3uqkbZQUbiOPyxRIcQLjKK/OnUy/SMFrE5/4Byk2BCDBinw296tdFdAARcUQN3/sbQtv%2b3eSHcVsAIF2q8sBQArkwXSmgX%2bOLlT6B6gF/g7ssB2oiG5p4v3KVDbw9wLS4HtHgXu0De0QIGjYFc%2br13KP0%2b/yOZyTTOF7hNlgZ%2bgwFfYerP6USlwhIIp0sEe5DEK0DkGAfBcDdFab0wDU1ajNm%2bzZINTOJnuwZylLm85sEEyGE/b4JNFfR030dvenH6fMBnhXi3BgGfpE9GFc31bTiu9ZnO923pQqGfWIKCGGMU9%2bE49WqZTDxGLOYYCqR51VL%2bWwuQQKi1GTjqgzGJmzhQ0oY3g5FYRcaGKd8K5gqgfwGBu2nzja6zg3JaNI3RQFU%2bNKdDXAjXoSK6NdBjnmqxD/nIund5GQ1XDuxY3PQc8QAE7pllsylwShbpLUyZD6T6gaJROf6RAzlCgoxS4MxRwNjQLkALf3oMCax/kvLwnx/62bMSq0kWkbSGvZ54lEbGvtBDi2KG/I992rmQLfQUp0InV5PPmpVLgqmopsHomewNZQCkA5H2sH%2bPbuZyE%2b/KPgy4KqmvZy7T1BqP%2b42co0F29kPPSHjLKgWwsVeSqdSrvsyvIWMuavR6lAKHMwMRbChW6ac3HCqkJU/cTrp71umYBzCUlIljT4xGkWSYzl7MuIKWiNZ69BUZg00%2bYb16vu0ub9VMmsvco8CcSlfJEKtf5ehant5fWGbO5xxGglSBTBw5L6NERfNYA8ygdsppjEVOD4gaCllIABrL3X0X3WLIVXj9NwiGAX4tpFPRZAawZ9TVVMb3i2VA6uHrQoqVT%2b12oVWNU/f1UDJjJ2nRr6Es6suIkxahL6UQKPBYDWAh10AsoBdqGAueIpBEFbpAFCCtSYH2pKjedc6VA7umyXKK%2b73ZOpQJHmULIQI2F0MpiVe42AMnqsVxW3isFbjuggLMlV80jOfO3lAINGH2NDPANhczX7UstmOoY%2b08LoSgLnBXfo%2b84lPVFUKAJCoBKj1FAC6Eo0DBfa43PllVzvSmQep62ECbsecP0fA5NjztsGhJu4lnvmptL6pj2GKNGh6tR2WSS3s3ajBDY3xEd%2bqXwX9cBURbhb71ZZgFbmkdzfNs9RmV1rw4gBdjMKDQVMp40AKPGq4JWb4RUC5AlNerzrsK%2biqePTTeQ8wlbft9MNTQG8G8mZoEadHUWS6BPIGuxskbkzmJZYdnGOOnBdzqW61d0rq90CSwFetwdfQD%2bFtKENw9cn/cMjWgfMw3O00ZWarz2NGU/WgnSS513FfmKQugG0Xkvvy5n5QP0AqYQugZs2dYee1uyBlhdo7VtQWn2WVwLoRtkjhPfFDcrOEj2l3eKijZoxQLprMKMsiM3eGev8T6/IReI0qfepvYCdbSxn7ev5ZYFV/VAC6/azM/3AswUzfnA9C3IRifhjlxC/9pCGfscy266Jc7wIxSA8xUBCqHpnCl4FH6mM9QS03ZZzBC%2bhabJAoYSnEe6mIib6XWD%2br/haNQ6mwjv2T9F%2bBwsXyNohpPf/fEym%2bt3cA/JhAmCkX1h9F/iTD97aBaYyf7YDdoA%2bm/sjGOEOr4lmAAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="651" alt="Routes" data-srcset="/assets/static/adonis_route_list.28c6e99.979815de244221e938e2a28cfe3498da.png 651w" data-sizes="(max-width: 651px) 100vw, 651px" data-src="/assets/static/adonis_route_list.28c6e99.979815de244221e938e2a28cfe3498da.png"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/adonis_route_list.28c6e99.979815de244221e938e2a28cfe3498da.png" width="651" alt="Routes"></noscript></p>
<h3>Ajouter une ligne</h3>
<p>Pour ajouter une ligne, on doit r√©cup√©rer son contenu.</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// app/Controllers/Http/postControllers.js (extrait)</span>

<span class="token comment">// Ajouter une ligne</span>
<span class="token keyword">async</span> <span class="token function">create</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> body <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>body<span class="token punctuation">.</span>title <span class="token operator">&amp;&amp;</span> body<span class="token punctuation">.</span>content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    newPost<span class="token punctuation">.</span>title <span class="token operator">=</span> body<span class="token punctuation">.</span>title
    newPost<span class="token punctuation">.</span>content <span class="token operator">=</span> body<span class="token punctuation">.</span>content
    <span class="token keyword">await</span> newPost<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    Logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>newPost<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  Logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>errorBadRequest <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On r√©cup√®re les valeurs rentr√©es par l'utilisateur dans la constante <code class="language-text">body</code>. Puis on v√©rifie que les champs "title" et "content" ont √©t√© saisi. Puis on instancie une autre constante en se basant sur le sch√©ma d'un nouveau "Post". Et pour finir, on enregistre dans la base et on retourne le r√©sultat avec la valeur de la nouvelle ligne.</p>
<h3>Lister les lignes</h3>
<p>On veut retouner la liste des lignes pr√©sentes dans la table.</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// app/Controllers/Http/postControllers.js (extrait)</span>

<span class="token comment">// Lister les lignes</span>
<span class="token keyword">async</span> <span class="token function">index</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token keyword">await</span> Database
  <span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'desc'</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>posts<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>okNothing <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  Logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> posts
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Pour cela, on utilise la fonction <code class="language-text">all()</code>.</p>
<h3>Afficher une ligne</h3>
<p>Pour afficher une ligne, on doit r√©cup√©rer son id en param√™tre.</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// app/Controllers/Http/postControllers.js (extrait)</span>

<span class="token comment">/* Obtenir une ligne */</span>
<span class="token keyword">async</span> <span class="token function">fetchOne</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> Post<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>post<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>errorNotFound <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  Logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> post
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>La fonction <code class="language-text">find</code> retourne toujours une seule ligne.</p>
<h3>Modifier une ligne</h3>
<p>Pour modifier une ligne, on doit r√©cup√©rer son contenu dans le body et son id en param√™tre.</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// app/Controllers/Http/postControllers.js (extrait)</span>

<span class="token comment">/* Modifier une ligne */</span>
<span class="token keyword">async</span> <span class="token function">update</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> params<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> body <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> Post<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>post<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>errorNotFound <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>body<span class="token punctuation">.</span>title <span class="token operator">&amp;&amp;</span> body<span class="token punctuation">.</span>content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    post<span class="token punctuation">.</span>title <span class="token operator">=</span> body<span class="token punctuation">.</span>title
    post<span class="token punctuation">.</span>content <span class="token operator">=</span> body<span class="token punctuation">.</span>content
    <span class="token keyword">await</span> post<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    Logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> post
  <span class="token punctuation">}</span>

  Logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>errorBadRequest <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Supprimer une ligne</h3>
<p>Pour supprimer une ligne, on doit r√©cup√©rer son id.</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// app/Controllers/Http/postControllers.js (extrait)</span>

<span class="token comment">/* Supprimer une ligne */</span>
<span class="token keyword">async</span> <span class="token keyword">delete</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> params<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> Post<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>post<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>errorNotFound <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> post<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  Logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'%s - %s'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>okDeleted <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On supprime le post concern√© (s'il existe) et on affiche un message personnalis√©.</p>
<h3>Activation du CORS</h3>
<p>L'activation du CORS permet d'√©couter l'API sur un autre port ou domaine que celui du serveur (3333 par d√©faut) depuis un navigateur Web.</p>
<p>Ouvrez le fichier "config/cors.js" et modifiez les 3 lignes ci-dessous.</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript">origin<span class="token operator">:</span> <span class="token string">'*'</span><span class="token punctuation">,</span>
methods<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'PUT'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'DELETE'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
headers<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h2>Tests automatis√©s</h2>
<p>Dans cette troisi√®me et derni√®re partie, nous allons automatiser nos tests. Il existe 2 mani√®res de tester son API. La premi√®re, de fa√ßon manuelle avec un logiciel comme Postman. Quant √† la seconde, elle consiste √† √©crire soit m√™me les tests qui se r√©veleront indispensables dans le cas d'un d√©veloppement en int√©gration continue, les tests automatis√©s.</p>
<h3>Installation du package Vow</h3>
<p>Tapez la commande ci-dessous.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">adonis <span class="token function">install</span> @adonisjs/vow
create: vowfile.js
create: test/unit/example.spec.js
create: .env.testing</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Vous pouvez supprimez le fichier "test/unit/example.spec.js".</p>
<p>Dans le fichier "start/app.js", ajoutez la d√©pendance de Vow.</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// start/app.js (extrait)</span>

<span class="token keyword">const</span> aceProviders <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'@adonisjs/lucid/providers/MigrationsProvider'</span><span class="token punctuation">,</span>
  <span class="token string">'@adonisjs/vow/providers/VowProvider'</span>
<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On peut d√©sormais g√©n√©r√©r le fichier de test ("test/unit/post.spec.js") avec la commande ci-dessous.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">adonis make:test post</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3>Isolation des tests</h3>
<p>Avant de continuer, on va demander √† Adonis de travailler sur une autre base. Cette derni√®re sera utilis√©e uniquement dans le cadre des tests. Par d√©faut, elle sera tout le temps vide sauf au moment des tests. On appel cette derni√®re dans le fichier ".env.testing" (ci-dessous avec la configuration du container Docker).</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token assign-left variable">HOST</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">4000</span>
<span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>testing
<span class="token assign-left variable">DB_CONNECTION</span><span class="token operator">=</span>pg
<span class="token assign-left variable">DB_HOST</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1
<span class="token assign-left variable">DB_PORT</span><span class="token operator">=</span><span class="token number">5432</span>
<span class="token assign-left variable">DB_USER</span><span class="token operator">=</span>admin
<span class="token assign-left variable">DB_PASSWORD</span><span class="token operator">=</span>mysecretpassword
<span class="token assign-left variable">DB_DATABASE</span><span class="token operator">=</span>adonis_api_test</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Remarque : si vous utilisez Git, ajoutez le fichier ".env.testing" dans le fichier ".gitignore".</p>
<h3>Configuration de Vow</h3>
<p>Il faut indiquer que l'on souhaite faire la migration des donn√©es dans le fichier "vowfile.js". D√©commentez les lignes 14, 37 et 60 pour ex√©cuter la migration au d√©but des tests et r√©initialiser la migration en fin des tests ("up" et "rollback"). De cette fa√ßon, on a toujours une base de donn√©es vide en d√©but et √† la fin des tests.</p>
<h3>Ecriture des tests</h3>
<p>On va donc travailler dans le fichier pr√©c√©dement g√©n√©r√© "test/unit/post.spec.js".</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js</span>
<span class="token string">'use strict'</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> test<span class="token punctuation">,</span> trait <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'Test/Suite'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'posts API'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">API_URL</span> <span class="token operator">=</span> <span class="token string">'api/v1/posts'</span>
<span class="token keyword">const</span> Messages <span class="token operator">=</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'App/Helpers/Messages'</span><span class="token punctuation">)</span>

<span class="token function">trait</span><span class="token punctuation">(</span><span class="token string">'Test/ApiClient'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h4>V√©rification d'un message d'erreur</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'No posts'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">API_URL</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  response<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>okNothing
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>URL concern√©e : api/v1/posts (GET) ;</li>
<li>Code HTTP attendu : 200 ;</li>
<li>Message attendu : oui (object).</li>
</ul>
<h4>Ajout d'une ligne incompl√®te</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Post a post with missing field'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token constant">API_URL</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'test'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  a<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  a<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span>
  a<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>errorBadRequest
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>URL concern√©e : api/v1/posts (POST) ;</li>
<li>Code HTTP attendu : 400 ;</li>
<li>Message attendu : oui (object).</li>
</ul>
<h4>Ajout de 2 lignes</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Post 2 posts'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token constant">API_URL</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'My First Post'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'Lorem Ipsum'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  a<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  a<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
  a<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'My First Post'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'Lorem Ipsum'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token constant">API_URL</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'My Second Post'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'Rosa Rosae'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  b<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  b<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
  b<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'My Second Post'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'Rosa Rosae'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">API_URL</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  response<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'My First Post'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'Lorem Ipsum'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'My Second Post'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'Rosa Rosae'</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Ajout de 2 lignes :</p>
<ul>
<li>URL concern√©e : api/v1/posts (POST) ;</li>
<li>Code HTTP attendu : 201 ;</li>
<li>Message attendu : oui.</li>
</ul>
<p>V√©rification de l'ajout</p>
<ul>
<li>URL concern√©e : api/v1/posts (GET) ;</li>
<li>Code HTTP attendu : 200 ;</li>
<li>Message attendu : oui (array object).</li>
</ul>
<h4>V√©rification de l'existence d'un post</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Get a post'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">API_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  response<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'My First Post'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'Lorem Ipsum'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>URL concern√©e : api/v1/posts/1 (GET) ;</li>
<li>Code HTTP attendu : 200 ;</li>
<li>Message attendu : Oui (object).</li>
</ul>
<h4>Modification d'un post avec un champ manquant</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Update a post with a missing field'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">API_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'test2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  response<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>errorBadRequest
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>URL concern√©e : api/v1/posts/1 (PUT) ;</li>
<li>Code HTTP attendu : 400 ;</li>
<li>Message attendu : Oui (object).</li>
</ul>
<h4>Modification d'un post avec un mauvais id</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Update a post with bad id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">API_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/42</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'test2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token string">'adonis'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  response<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>errorNotFound
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>URL concern√©e : api/v1/posts/42 (PUT) ;</li>
<li>Code HTTP attendu : 404 ;</li>
<li>Message attendu : Oui (object).</li>
</ul>
<h4>Modification d'un post</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Update a post'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">API_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'My First Post'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token string">'Updated'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  response<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'My First Post'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'Updated'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>URL concern√©e : api/v1/posts/1 (PUT) ;</li>
<li>Code HTTP attendu : 200 ;</li>
<li>Message attendu : Oui (object).</li>
</ul>
<h4>Suppression d'un post avec un mauvais id</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Delete a post with bad id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">API_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/42</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  response<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>errorNotFound
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>URL concern√©e : api/v1/posts/42 (DELETE) ;</li>
<li>Code HTTP attendu : 404 ;</li>
<li>Message attendu : Oui (object).</li>
</ul>
<h4>Suppression d'un post</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Delete a post'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">API_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  response<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>okDeleted
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>URL concern√©e : api/v1/posts/1 (DELETE) ;</li>
<li>Code HTTP attendu : 200 ;</li>
<li>Message attendu : Oui (object).</li>
</ul>
<h4>V√©rification de l'existence d'une 404</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Post 404'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">API_URL</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  response<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    message<span class="token operator">:</span> Messages<span class="token punctuation">.</span>post<span class="token punctuation">.</span>errorNotFound
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>URL concern√©e : api/v1/posts/1 (GET) ;</li>
<li>Code HTTP attendu : 404 ;</li>
<li>Message attendu : Oui (object).</li>
</ul>
<h4>V√©rification de la ligne restante</h4>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// test/unit/post.spec.js (extrait)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'All posts'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> client <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">API_URL</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  response<span class="token punctuation">.</span><span class="token function">assertHeader</span><span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">,</span> <span class="token string">'application/json; charset=utf-8'</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
  response<span class="token punctuation">.</span><span class="token function">assertJSONSubset</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'My Second Post'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'Rosa Rosae'</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ul>
<li>URL concern√©e : api/v1/posts (GET) ;</li>
<li>Code HTTP attendu : 200 ;</li>
<li>Message attendu : Oui (object).</li>
</ul>
<p>Lancez les tests avec la commande <code class="language-text">adonis test</code>.</p>
<p><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 486 627' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-7c18e8a4f05eebe697e52b2485a9dd8b'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-7c18e8a4f05eebe697e52b2485a9dd8b)' width='486' height='627' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAABTCAYAAAAvKwHrAAAACXBIWXMAAAsSAAALEgHS3X78AAAgAElEQVR42tV8Z3cjR5ItR9007S1JOIIALWzBG5IAQYIA6B3oveludffK70g7Wr3d92n/x/sTu%2bed8/7cfTciq0CQ4oy6WzPS6EOeKlQVCsisiBs3bkZWR3FkFBPBYcQeRZAITyPuTiAxWoI1mEX80SgSkVkkojOw/FlY4Qost4V41yCsPgvWyCSsQI6fAyh501iOVzHpTqE%2bMoHJ/gTi94YwM5jXY1O87wyvjXYH9Hj8XvCfonVMZYZQTvowencM0cMvYV18hdD%2be0QnlhGfWEX0x/9C5OhrxC6%2bQGTtErHmBUKRMiKvf0Tiu58wnp1D5kkc/3b6Nb4/%2bRKXC6c4nVnHef0AJZeFrcIqvt79Em8XT3BSaiJyN4BoD3%2b8Zwixrr/S5Fy3vd9tf%2b6097vt/c6289233KO77Ts37hm9M4zo3SFtHXPDM1iNNbAUmcZiqITsyzj2ptZQ4hPLPo9hhU91PdlAfXQKy9EKSoMFrFW2sJKdR7Y3jrXUPJ/8LHIvYmjmFrlfw3piDjP%2bTOtpp91s/cPIDA8g9ZL7j8cRfxBA4hnbc9OSfYNIvGR7EdAnYz0J6GfrKT8/CCLRy/3HZpt0%2b5Hy%2bHmtOSbXyrGki43HUz6/Hkt5uX3O611ynf1b/E5mzIf0kA%2bZER86TuqneLt0hrcr53izcIz6cBn/%2beYv2M4uo8FOv9%2b4wP7ECuY5SM3kLOaGJ3n9MT5f2MdsoIDDmR3s0VomXUmspedxuXiG77YvUXgRRupJCPHuIJJDHqQjfUiyTSQDmPUXEXvmQ3HCjbzlRWbci2zIi1zMi8l6HxLsdD7lwWSjV8/LQBQm%2bpHxs3MDA8gnPXptYcKlg5oOsg0N8D4%2bZMNeXmOuy8W9PCfHfDpAeg07X5zpRyHnRnHKhY7c4LCOXLpv2DyRlxy1/gFY3LceDaNIX66HZnAwtYqNzALmQ9NY4xNuFlexk19Ck5awGJ3FIvHhpLqDuUCeLhHCbLCICQ7KtC%2bD%2bP1hTPsLKPFeYootDLgfNKbpmCibPCk5Ls16FNSn75xrNdst4o9sX35orpdr5TvmN25sH9i/133ddTqylktHrVju09GS0c2nOcJRH8L3vKgMFrE3vYP3q8c4ntvD/uQajiub%2bHKf/j63jbP6Hl7TejZTNWzmlrBJK9hI1fFu8xXer53jcHIFyScRHM0d4HVtE5HOQfOH2jrk/Mn2zl3raFtnnPaza9u%2b07q%2b5%2bfnW/fosUEw2T%2bIlJvNY/xNfNH4F8Hq3iARPK1%2bvp1fxGZ2EauJOrb41LeKa9jKLag1LMbmtOOHlSbmhgrqGrWxMvFgDtOeBGaHJpB%2bMo4aXarkTvKP8EnRKowlDLX2Y79HFMgl3ep/E2WXAkM%2bwadP/8tFfIjcH0CFprsz1cSXG2c4mt3BTmEZh%2bV1fM3I8Lq2g4v5A1wsnOCovIF/u/iWg7OAVYLiq9VLvFu/xDfNc7wjjhSfh3E4u6fWM9bhwvidAQVJGYzxOz4%2buaAZhJ5ga2B%2bi0YLMIgq6Cl%2bLxaRbFmAHxO0gPV0QyPEztS6DsBWllGD0WFF24xagHR6LdVQDlDojaE6PEEMsNAYm0KEvEHwYJE8YylWJR7kGFUmkH0aUqCc572TD0faOt9u8v/gAXAsoFiiBQSInLQAQeBceACRez5awASf%2bB7O%2bfTP5g41OryqHxP8VrBPNzgjLpw3TvFu4QivaQkzvgLOed2fT74lRvBYjdEiWMJp9RBv5vfxZuMtvtl6i%2b8Pv8DJ9CYq3hy%2b3f%2bK4JlD6E9%2bkqrhG37/Dx4ACSFJxta0f0CjgRNfE30mdiYZt7OBANIuRokXfkQf%2b5DwMkpwPxdgiHs%2bjFQvn9RTmvRThjPPGJllGPEnAzqgCYafqVAY2cGAYkz0Pu/v8iH6iOeeB5EfDSI3bM5JuJOY/ZtaQD7nQiHjRs7yoFCUfXtboEUwniYHGEfjbhQm%2b/WabITxN0sr4flsxMOBGEQ24SJ2eDVmZ%2bM8zsgiOJIZY2yPe5AaciM9YvYthiy5R3Z0gOEroMezMTcHgwRl1IdC3q3kxkHzf/gAXIUHtvttW%2bdYDxG6e1j/VPxmeOppu%2b7ejf177WFsqBXbW%2bGpu%2b16O447fOA3tQAzAEGEicra7voRshE6yiRn/E9ePRbrakfpoNneEmdvi7mxW2L%2b3zr3m2KAicMjqBCEykTnCjl8bWwSKWaCBTK3ndIqVpNVZJ%2bFTKfvm7jtxG6z3xbP719ZUjuqXycgjsVcj8mxm9d9RIu17veRAxBiDA7T9C6W97BVWsfe5ALWcw2mrlnMMpSd1Jo6ILnnIYz9idyg08%2btF2Of%2bdRKxj/zsvlMPOc2fHcAobtXMV6tiz901YYR5jG1sLbj0XtXg%2bYcD7FF7OZcE76lOZ2PfYoFLCfnsT%2b1QZ4/zyyuihyzwUuSmyo5vWR468k6tsn7Fxm/N0h3K8zvd5gmb5MF5l/GsFdukgXWkXkaUSa4YtWwW1xGmQxQOinWMdnjR6lnkI3b7gFMMeann4WR6/ZjudvHxiSI56N2Zwrcr/DaCq%2bd5rbMNst9%2bf6MHOs2x2bs84lfYwGH5OgX9X28Wjzidg%2b1oRJ%2bOPkKG5ICj0zh85VT7DDNXbIW0ExINljCGx57u3yMWQ7GxfwxTme3leKuZxbRZMIkA1rWdDqKNF1pu7MfK%2bzoAtv23V4skgBN%2bNIodnpx1O3GEgcg18OIwJZkJ6RjZ139uOzq4/e8WGTb6Pbo/k6XC8c8t9/lxibbDtsEvxf51AFIPBixn9Swyd9f%2bMgImbv3RpB8PMqwNcIIMIKMpLdsSe5HCI6xh0PIvAwj0xdG%2bmUI6RchJJ%2bOIfFoRG/s3Ncx6ahtyrpvA688NavNh2MObrSbs/1ZviuDY9n3i7WZ/q/BgQ5BfsePQ11Ccjz00QAKwSRST0cZn8eR88WQdUeQ6osg2x9GuFsEhxHteKovhIwnirzPImka558LKFY4YsgvYcA4Pzu%2bHmtrN3EgegMTQn8nHOhYTS/ioLSpak4z00DhZRJvaN7VwRzyvXH6%2bwp26fOL0aqmvDPM9PaYE%2bwWl8j54ziY3kaTuUL6cQiXdKNmfgV7PDftTbKTJusrqR8Pqt9O0w3KtKrU8wgmub9rm7a4QZED7wzApOLAAKq2n0/bmDDTbXx/1sYC2VbkgXyqBRxU98ndd3G5cEhev8N0dgp/PvqCGFBHbXgSr8jxt20M2CQGVHlejr3h9TP%2bPM7nj3A6s4UpVwL7pSYul87wbvEAE0yIMs9oNezs1p0%2bLNHfG2xbxID5x2MoelIo3PFgvdODrU6XDkCKVpEWwZWtymuPO3txTp8XkBT8WOVgrXK/Sb8/4/E9tjUeExzIfSIOdKjvdw3qByE%2b8ZdegwE099Szcfp9iE9ykFnbGKwHzAeIAQm6RuzBkPq9mLj4fqY3rN%2bJ8o9Y7GDeFdNrk0/H6Rph5hEhWHSnKLEh67V47zGkeDzJ7yR5PE68kd/KeeJ0M/Pbcjx63yZFtulbNk%2bItLmGwY5PdAGJ2%2br/nzF%2bdzFB8ZD5cUBS7FDeG0eKPi%2bdSveyA09GkXFFbTwQUBznnwgg447q%2bWQvO/JQpLUxXhNFzh1DwccO9cWQ77cwFcgorU4RO/JuCzm6UJ4ps4TEBAct2x/V6wscoDyjSIZu0pKwOvmHu%2bUhGTW3pQx33mCOH2sB67llnMzsqK/v5BdR7E2rEDoXLNDHLYa0dRyUN5nHz6kOUA0yPZ5u4mByVTFAZDIRQWQe4P3ma%2bUM2/w87TEYID%2bS9AwgxQwyG/Ui4wsg9yQGq9enyZUos5lRLy3BBk3Bjee83jegGapkp9qcbFWODdjHB83W0Q1/xjQ/ZAB2yltG56Mf70%2btMXcv4N36uYodtZFJFTrXrCrmozWsRsskQgUcM%2b6fzG6hMpDDQWUbOyQ%2bdV77vvmaoNhknr/OAeGT5xNMPRg1GaVK0cwYQwFyBlrCs4GWSitps/UkaARRJkai4IomkWeWKuckZc8M%2b/R6ySQ1Kw179bvZcZ%2bKuZ%2baPXZsELUPyea2i8uq9RV6E4wCJ2SCORT7Etjlk97hU12x6holnCggTLDQZ6ksLkyw5M1wAFexwGghg1nxpZQvCBNM2k8xE/Ii7WH%2b/1QsYEClbWMB7ERvoJU9ihYhmr7I26r3y/e9/qun7vWrbqCW4B68bgEfOwA7RG6xgCPHAgJtFiC5AJ%2b2CJ9iASu2Bci1YgHTA1lawJbKZI3REs5qu1iKzmA9vYAp%2bvytFjB%2bZQGi6ZtJijYLYGdElsuJOp0zFiCdloFSS5D5g0SbBXArEx6CE7/CAjaxXbAtoC9heABzgWJ/smUBy7dYQLHNAqbcaZzWdrAUr6loWhlI/3ULeBZD/KlfO6Um/DLQ0ull5keftvi821iAzPSo/9MiZEBUyR4wlqFPv/vT0%2beOvcoOjvkU5ekdM5mpBibx9c7n9Ps5coIizmv72sGFWB1rsQoHoKg64EVtj53M4ri6hwMOyPxYmXnDCZZjNfKKHUwQ%2bSUXUAsYJOCF%2bQTHvChEAyRJOcSeGf1RrEAmM1r%2bz07lYh6dtUnbfu%2b4iQxWoehWMJXZHtmKeHv19D/BAkTUiHT5FbFl0iLe66F5kudLLH5ueEBEeAD3LfL8BENh8tmoyQUYw%2bMPhzRMyvksY3iBlFj2hReILiCoHrs5Edrz1yc29El23zjndLDnxoToLcLLxw5Ch%2bT3ogmIChTuFhHT5gESq4UHMN6LUJFkbI%2bT1QkPyLjJARj3M0piRjlAAeUEaXIGif9Zl2kWOYEOQNdVzI52DqlMfm12%2bOa0lxPru27MEt/GAbpvm0H6iAHYtKXt/dI6wXCF4SuDr3beoDEyoVHgiGHtSGaDEw3sFhZ0cvRklm4zvUHOYOGsccRcYRnTvqzS6Q3mFnvEE4kCOgNE9mhiuh/ZOE3eH0ThhUUr8yuASVgTVdqxCo0APhMixfcFD%2bS7ckxQPz1sooAAooMNsi9i6ydZwC6TmcPShsb7w/IGc/wivmi%2bwiqjwFywSGDbbfGAlXBJZ4okMogGMOPPKQhqFBiZ4rV7BNNV5gbN6zzAT38N%2bVQBLoQDKHuyBgPiRPIh8%2bfbOUAuSgyYNDNVDgdwAFNUYx043i8jkUBwYtBEkRYX%2bAgy1CEjL24g6amIn/E%2bD2IyHyA%2bTWoaU97NPyb%2bT16fpqlbzAXij4z%2bJxghZi%2bpcUL0AHJ6Rzt09AChsPFO02Kd8kcD15XhdgxwfN6mvnG70CFu30f3b5yP91zpix9LhzvEH0XDC9/xGwxwGQzIegyPF4BLspOpp/R/d5z8PqIagCZEMjAckIwroj6feDGGCNNYwRNHD5QWsnN%2bze/v23pA1%2bC1HD/WltTE7OOiFbTn/46oMt52v/CNpOhjE6KOrckNXDQOye836QprTGuz%2bO7gPcPaFENZAqcMaWLyK8l5YsCipstnDI1n1S2d77tYPMEe84iyJ6ME6mh2V/FBeEBMlaFh5vQ%2bzDGfr7LVujyoPmJSxTyi1OXFQbcbTaa0ohk6f0o0REl/RQqbE02ATT6LDjDPrbS67ntRs/WCJR77FG3wZ0xwhj7%2bbu0cyxHm/sQABUCyu3qoimXFgLweO2Inp0l/90okUfkl1Q9fEQQPyCvOiAGqBzwN66Tn2p0%2bNDp9qHYxp%2bf%2bnKTLJFHZu6L3saMclJREHobbBLdlduqAuf5RVz/mO9nJux4sdnqMNsjcf5fnmvzOMgduvdujwqoMRMaWy1oy2YcMgPo%2bMUBcQTGg34MoMUBydcnL033Gt2VfTF58XHhBTHRC%2br24gFSSSIi06CaCDeI%2bSfIF4Q3Skn3ECH5fNIHky4jqA3K/hGgMzxhOyR0EQzR8MoVWLfJ5SK/LkFvkeD9LNEmG4mjPlRbQ0hgd8293gQ8egK6AavnS%2bUiPlMf4iAVMWQcsFCWX549LvBc8EIFU8v4Y6Wda431E/V8GwHo8qvtJYkOa3EEIk4oqoiuSFaYIqGl2JsUmA1EYTKj4EeU9k%2bxcnveX63PkHjpwPGb18gG4YsgJuSL%2bJJ%2bNK36EbsGA8CfiQMf21CZezR/RBZrquyV3TiWxxfESJpgLnM7tMuTtkAfMq9ZXGylpvL%2bY2%2bb5BC4XT4kd5P7kAe83L9HMr2npjGiCGtcFA2i%2bczR/afW7blSFUL2IEQM8OKRJNzvdmCIbVdLENtltfFpkMvnOrLgK8UL0vwVbJp9Xmd2rWCCa4FaXkddT7W7wQQMwuYnd4oqC4C7BbGagoOnwUrjCvKCgidJSeBr18VkshaaYAeZUIDkgXpSJAbsE0WZ2QTFAcGQ9s4zz2SZJUlQxIEHUX73Tj4YImezMimDAk3EUXAlk7hidcIGdS/MP67wA3UzE0336%2bSHbPL9X7/HZoOjT%2bQHRADe5lQ6vsS3bgyHaYeLjXcD4vuQBsrVcxIBHxIDeiI0BYSNxcT8qGPDEYED8yYjy/RYG8EmLeySIA2n6coq4kXbmDXwJxQzBAjHlGK8Vfy8MJvVYkr8l2CL5iBMOw/evhzhH%2bhaNMHT/uvm3h8mrOYYPHICYA4IcAMWAPh87yJRVtDnFgOgVBjwycwGKAQJY/dcxQOYF1Pf7IyqUpghkRfp6wWNp5UfmBb/DFuOTzvbTt10EONkST2RCReuEnKrQOzbh6b7SAzUnuMP84u71atHbiFDsYySxN0snpMLbOCEOlD15LXsVs5fix/M6Yz5xYDW5gANy/vpoGa95/avGHuluEq%2bXz4kdm5oaf7P/nrnBMd4u7BMDUq2ageSAobxSSJENDmLiZZKW5kUu6SKddUPqlJzpdsn1hf5K2Y5QXOH/8l0RRUQLEBosxyU9Vm1AdAbS4fZc4KNcoDmxrrq/JEMSzyu%2bnILcQmha1SERRRcIiLWxGSyOTaJMsNslb9grCvlJK/ffTDdIkCZ0YkQw4bSygTzzgMwzuojkAj7J6aUTPuTHAiRbJElPmMQM%2bttyAVPwKMmNdF4qObXTdsed0lapYRQlSO6nalLQDNK1qpKbU2V/YzA6jO8PqBvI1nIbDEjLNBjNW1LcxPMx3b%2bGAU9HDQbQJQwG0BwfDelnkcmztp4g2WBciituywXaTPhaSizH29Jhh/dr2ttm/uoiXU4%2bELy1879kDSYZIhDKQERJR0WujvBY1iv6vIMBRq9PkMIKBkhnBQMEG0QfcAZAJkoyfSYvyDPGCwhaDwxAtVpbLhC7QWZa5nvvCsic%2bUNp0baYH7O35tzP6wliH8gJOnYr23i7cqaS2FlV4ncBP158SypcIQakcDnPmE/uv5Za1LLX%2btg0Pl89w5uFA5pyivuXih3VQBHvmUafynS78gDBgGGlwsLZJQw2yOkXGfPrBMxcv6W5wFm3S%2blsjaFMwtsem8TyhP0kZW5wTcMduUS3yQkk3JnjHt2XcLjCfeEEDZlv1PDpu6pS%2bVsWsEkfbmbmVfyUeD7tzWr97/xYSTFAJkYbI5OYG61gfqSIEpOe7cKK4kbJncZmdhlriZrOI66nGmiEKjgub6DwksxPeAB/ZOmuS5OhShcH4G4/Zh%2bP60xRngRnlcRIcgH5wzO8RjrQ4gRskgAdsUMbdgerbQnRBhMpOb6mA%2bzTecOGTZYkN/hADPCbdPiu2VpuNwEqSD%2bOqd8LB5BY38KApybltXhcYrxiwGPDA0QmE71QMEDCYJoYkRO67E8aHkA6LFQ49pAhkft5fwIpUl2Zdrc0xzA8P37PqQEwW4n7t5bL3L9%2bLvxXOcEvFEk5FWFSHG299OmXVdvjH0vrpKfBgOTjMYMBDx0MCBvtz8kFZL5Q6glsIiTcvTAg83xxAhmJkkQGme9THiD3j9IVzFYmUp2iqlYs77FB704bCNriiALkZ9c5QfyaItQmjvT8LVl8ZhfvVs9x3tin7%2b5g2lfET6//VVNg0fpfLx7jsnGAtfQSDqdW0Bif1nT57dIRz6fwdv2VYofIYz%2bcfYuT2T3lCDMDacUAS2K736txO5dyITc8iMk%2bnuv1Ip/rZxj0mmLJca%2bW6jsrROTPKwcQKSzm1XlClcf4OWXzAJHFlTPY3EDDJsNqeznfL/GBjo3citYC7DCuS8m7CBtCimS1iGCATJjUhouojpTRGC7ooJhiinkdABFBV60qquQBu8wPGuMVcoRl8oDwFQ/w8A9LSS75QG6YyU5/yswMSTy3O6Vl%2bqrtBcxCiUf2HEHUq9qhCqQ%2bv%2bEFg%2ba7MjCqCQbNgOhKEa//qiDzA%2bhwh1PW5jTLYzAg62AAOUBSc/WI5uJJBwOEGwgG9BoMiEn9IPODlM0D1A2kJuCXeIA95e3I3ldaoa0B3jUtfmOaPO7Q5fYFVK1FVm2u9CEFEqrdSSJyn6P/gujJY6r/M0kRsiP%2bWpQaIGZxggGi96f7o%2bacy/ivJkMieBAc08zlC5L7ywDcH9I4fZsmKIMmQGfZ7apGyOT8Tuy/SoaCLU1wvC1huskhrrnAL5bI0Gffr1%2bS/h7gsi7TXRP4j7c/YDU2qzO%2bb5ZP6dMHWE8v46i0inmauOT971aONQy%2b23yD89qOps5/efVn/As/f7l2ovUBUoGafDCiYW7RDl3LnS4tkZF0eKLTaIKSy0sNkVMxViZfkHRXSmEW7O%2btaRg0ZTIbXaZUZk01ACOHyefkNUnsA5OhtcySzgM2c0saz6VTB0xuJL%2bvENiEG8gcoWBALZhTcrRBrNgkBpSYC6wmGlgmYIp%2buFVYUqIkHEH0gLStCcoAzNoFj/MkQtMcgFxfHJku88elKFL%2bfIrRQQjQFD%2bL5icDU7ULooQE1W0S5BCguq0RCAeQAqr0R4ohVxhwx24OBjwNqhRmyuDCjM9%2bnScoDKWQ88aUMkssF/kq4zJ6QYL%2br4XVnf6WLO7MC4g5t6QrukCkvVS2x64bbJPFr2L/8M9if6Qt9v9dZHHrwchVlbaDASJnM9nJkaRowsMnJoWSBV9CJ0a0YNopanJFlfMnn4wpuAmxkvDXXijpgJkC3N1gqyhLF0i2LWeLO%2bls51Xsb02UOPex9YB41y2x/1Nk8cO5fXyx8UpLZV/N7zOeT%2bB/v/8L1ukWYuKfM094zXMb2RUckQfMh2bwxdZrfLF%2bpunw%2b83PyRPMVPl/vv938gKeWz1WHpB4OKoDkRoy01r5rMsUSLgyiJNw6dIcy6shUNcTSD2R268hTgokNMSJBtC20lOPj5rFkLJQUsLmr1lc0bGSWlAflmJpqQqRBEfygrnhCfKAvB6f8WdRCUyi6s%2boULoSn9OqkSkOwLJVw2JoWoukzDJacgopn3lBFvmUUYFAmHCZCU7pXDYQxESvSGR%2boxF4TNzWRZAPgzo5Kh2XgdFCCaf5bUHEJj9yP9n%2bmvqg6zzAwQCvW%2bcFNA2meUvtgNTw5b1R1QhE7kqQ78uyN6HJcl1a%2bL4tl4/9yaPn2jGgNT3eZabHzfG26e2b0%2bNyzZ222N4W5/X4jenxX7O4osNZIiN5u/V4SKeqU0/HtSY4/XKcvj2iOX5eRY6oxnqd1JA5At03XD6rcwBj1xZCXrWbCxb/vsvnf83ymg7nBlEmFpEOImqHbIMIs0W0yVLzoEmWpEq82zA5Z%2bLz2vGe32fx469eMxTXlVwEpbjwaw%2b3A7pfiPu1Jk9AypjaL7c/UufNADBNtdxe7P6fF/jx/83jx/8p4V//O4/v/ruM//U/Fbz7v4PIzz5DtGPErMD%2bWawNXuv0H28ACCzWSz8aX73Axr8HsPdTWNvuT1Ec/RTHxn%2b4Vc4WF3FC1c1O/tE6/TMMELIhxUeRu1Lc4Ef4zqApmOA2cseu4XPIUvssbM91v/8jDkSHEz6cjNBJJK4jeVty4XT8Ngv4Yw5AUN/wIEtetJHf5wcSpL7jJm%2b/N/SzKSehvZLmZoUqi0T2iUvW/jlcwH6i0imJ/7JQIa15/PCtT1gXOj005yTvFw3wD40BVxYQb63WkCyv4E%2bqouu82KB9AGQmVywgYxOjP3YUsAcgZ1eCiAU4KpCUudzWIakUEfYoy%2bZkAFTGtsnQzYH4pXD5ew9eh0pSMl/fHzPS12BSabBEhPY/qfm73bQE9p6pFS4Gk5gYSqn8LYOhU2z2OsT2dcWxFkUOtq05Nud/z0HocBKK1IsxJjtjqt2nHoWv8niZppKU9jGx4UlIW04KnXTlVwJFN0GzP6ZNLCb5SK4bs9cimvWITlIka46jSp/9GO3wmMTpMzOF5cxP/taD0CEvMdKVG2NefSFCLuE2TXL1MSmcGlAdUGqFzhqH%2bHzlHO/XTvQFKVImf9HYx9HsPl7V9/Ht7hu8XbvQtLk5uYl3KydaXyCt8DyEw8oWThon%2bJfVE3y1/Vr1xM1ERd8y84b3LTOqhDsHf1sLsOT1Un3m1RWO9q6LEWRZSm9AJfCSL4vl2Ky%2bFkdekjITyOsLlSr%2brL5ESfZlpchasqbaoLwkRRZVyCqSxUhFV5bIHIPcoz5W5jUFvXYxOoelcEnPi5ZQpGXJIovfdADSo2bZScbeymswZCJCFyYNGwuQqhBZB/TN4Vc4q%2b7gfG4b54un%2bOHoK3x/9Ban86d43djF52vn%2bPHye6zHptGI1XFR3cN3e2/weu0Sp5Umsk9HcVTdx1p8hi7gUvMX7UDMX/adzv%2bmLuC8yEyXpNy0gD7HAnL69OQVOPPj01jn01uIzGCJT1fXFsmTDk%2bjmV/S9UKL4bIus5c1R9WhApasmsrmZW%2bK1lJBjVZkXqU13PbajuHfBwRlWYq%2b1CTkNamwZV52ItpbdoQWcE8sYBqnfPLfHn%2bDi/ouLmo7eEWf/Z4W8MPxO5zRAt4tHWFvco1W8Bqb1jTm4zUclLeIA0f6vjEJk1JHLNNmYx1uFU7j/wT5Q4fodM5r62Tr1ORIsZKsx5H3/03yydWHJ/VJz/iKWAiV9e0S9dFJ1IemUKFPL9CXZ4dzKLiiqPHYYrjK6yq63kievKwjNso2hlsAAABlSURBVHhRZscD/zxEaGK2TxcfyESjLGKSV%2beI0ipRIZ92o1BwIz3uRircj1SsF%2blQPzKpXkQf%2bZAY6kci6ELkvg/J8V5kU/2IPx9AYtCDTKJXX8Y22uFVH5e8wpl/aE%2bqfu8B%2bP8xT/qqVTAKZwAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="486" alt="Test unitaires" data-srcset="/assets/static/adonis_unit_tests.3d9f188.9799ea8413bb35b9615b0ded0a3ced63.png 486w" data-sizes="(max-width: 486px) 100vw, 486px" data-src="/assets/static/adonis_unit_tests.3d9f188.9799ea8413bb35b9615b0ded0a3ced63.png"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/adonis_unit_tests.3d9f188.9799ea8413bb35b9615b0ded0a3ced63.png" width="486" alt="Test unitaires"></noscript></p>
<p>Remarque : les tests √©tant ex√©cut√©s sur un autre port (4000 par d√©faut), il n'est pas n√©cessaire de faire tourner le serveur de l'API (3333 par d√©faut).</p>
<h2>Conclusion</h2>
<p>La mise en place d'une API RESTful avec Adonis se r√©v√®le assez rapide en gagnant du temps avec la migration. Le seul b√©mol √† l'heure de l'√©criture de ce tutoriel est l'absence d'un watcher sur les tests unitaires contrairement √† Jest. Un point qui n'a pas √©t√© abord√© ici, est l'authentification et d'autre choses √† voir sur la documentation officielle.</p>
<h3>Sources</h3>
<ul>
<li>Site officiel d'AdonisJS : <a href="https://www.adonisjs.com" target="_blank" rel="nofollow noopener noreferrer">https://www.adonisjs.com</a></li>
<li>DockerHub Postgres : <a href="https://hub.docker.com/_/postgres" target="_blank" rel="nofollow noopener noreferrer">https://hub.docker.com/_/postgres</a></li>
<li>Site officiel de Knex : <a href="https://knexjs.org" target="_blank" rel="nofollow noopener noreferrer">https://knexjs.org</a></li>
</ul>
</article></div></div></div></main><footer class="text-white mt-4"><ul class="nav nav-pills justify-content-center"><li><a href="https://github.com/etienner" target="_blank" rel="noopener" class="nav-link">Github</a></li><li><a href="https://medium.com/@etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Medium</a></li><li><a href="https://twitter.com/etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Twitter</a></li></ul></footer></div>
    <script src="/assets/js/app.22d1f777.js" defer></script><script src="/assets/js/page--src--templates--post-vue.1a806e4f.js" defer></script>
  </body>
</html>
