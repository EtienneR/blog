<!DOCTYPE html>
<html data-html-server-rendered="true" lang="fr" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22fr%22%7D%7D">
  <head>
    <title>Connexion / d√©connexion avec Gin - https://etienner.github.io</title><meta name="gridsome:hash" content="8bc8dc5f3fb99fbb091a59684da69f95805ad993"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="description" content="Lorsqu&#x27;un utilisateur s&#x27;authentifie sur une page de connexion, cela cr√©√© un cookie de session. De ce fait, si l&#x27;utilisateur tente de se rendre sur une page prot√©g√©e sans s&#x27;√™tre authentifi√©, ne poss√©dant"><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="Connexion / d√©connexion avec Gin"><meta data-vue-tag="ssr" property="og:description" content="Lorsqu&#x27;un utilisateur s&#x27;authentifie sur une page de connexion, cela cr√©√© un cookie de session. De ce fait, si l&#x27;utilisateur tente de se rendre sur une page prot√©g√©e sans s&#x27;√™tre authentifi√©, ne poss√©dant"><meta data-vue-tag="ssr" property="og:url" content="https://etienner.github.io/connexion-deconnexion-avec-gin/"><meta data-vue-tag="ssr" name="twitter:domain" content="https://etienner.github.io"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="Connexion / d√©connexion avec Gin"><meta data-vue-tag="ssr" name="twitter:description" content="Lorsqu&#x27;un utilisateur s&#x27;authentifie sur une page de connexion, cela cr√©√© un cookie de session. De ce fait, si l&#x27;utilisateur tente de se rendre sur une page prot√©g√©e sans s&#x27;√™tre authentifi√©, ne poss√©dant"><meta data-vue-tag="ssr" name="twitter:site" content="@etiennerouzeaud"><meta data-vue-tag="ssr" name="twitter:creator" content="@etiennerouzeaud"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.c2df4604.css" as="style"><link rel="preload" href="/assets/js/app.dc35239c.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.a4881b12.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.77a6618c.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.119912ba.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.a039a5cf.js"><link rel="stylesheet" href="/assets/css/0.styles.c2df4604.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app"><header class="py-2 text-center"><strong><a href="/" title="Accueil" class="active">Etienne ROUZEAUD - D√©veloppeur Web</a></strong></header><main><div class="title py-2 text-center" data-v-2084d89c><h1 class="display-5 pt-2" data-v-2084d89c>Connexion / d√©connexion avec Gin</h1><!----></div><div class="container"><div class="row sidebar"><div class="mt-4 col-lg-2"><p><em><span>14 ao√ªt 2017</span></em></p><ul class="list-unstyled"><li>
            üè∑Ô∏è <a href="/tag/Golang/">Golang</a></li><li>
            üè∑Ô∏è <a href="/tag/Gin/">Gin</a></li><li>
            üè∑Ô∏è <a href="/tag/SQLite/">SQLite</a></li></ul><p>‚åö 19 mins de lecture</p><p><a href="https://github.com/EtienneR/gin_session" target="_blank" rel="noopener">
            üíæ T√©l√©chargement
          </a></p></div><div class="col-lg-10 mt-4"><!----><article><p>Lorsqu'un utilisateur s'authentifie sur une page de connexion, cela cr√©√© un cookie de session. De ce fait, si l'utilisateur tente de se rendre sur une page prot√©g√©e sans s'√™tre authentifi√©, ne poss√©dant pas le cookie de session sur son navigateur Web, il ne pourra pas y acc√©der. Quant √† la d√©connexion, cela aura pour effet de supprimer le cookie de session.</p>
<p>Dans un premier temps on va mettre en place un syst√®me simpliste, puis on introduira la notion de hachage de mot de passe avec Bcrypt, l'apport d'un token CSRF et on finira en cr√©ant une liste d'utilisateurs sur une base de donn√©e de type SQL via SQLite.</p>
<p><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 816 555' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-1e8ba12b0d12ac44eb46eb2abd3b968d'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-1e8ba12b0d12ac44eb46eb2abd3b968d)' width='816' height='555' xlink:href='data:image/gif%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAsCAIAAABaPSmoAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAE4ElEQVRo3u1W609bZRzuPyH4YSZcS9HSK20H3RYhXFoEYkLmEpMlxsSQfVl0F0QmytjUT34wajT7YFCXaZYsEJY5E78ZBsTQG6WUQUtbeqEXenpK6b2n%2bJxzKLYbm1PIYMl58ut73vc5v/c9v%2be9/N7yJv6YCm8mAv71rSjpX/e53Wu2ZZvH7V73edb9vmwuS1G5o2w83Yp/M7cdTWbTWcq/senybTjdIV%2bIJGIpIpbMbx918C4PX/9g8NMPP/ns8sfXUA6OfDE48vmlK6OXrly7OHT1wkcjKFlDHT4ozw8M05Whq%2biICkqWuTg0uuPJWKHj6G6FJTEyDP4Dw9f3bzyBoP54U3NtLb%2buTiCRSBsaRCKxtFl9SqlUNalPKhSqBpFYJJbAGhuV1dXVMpm8paW1srJSKpM1NasrKirkcsXrLa1VVVX82lpBHYbBj18vENDPOn4dHySfrTMUH4PU1NS8cuxYedlLL5eX/S8rL1gZT6FS9Z0%2bI5XKZXKF%2bsTJ401N6lMtZ9/p7%2bs7ffbd/u6eN5UqVbP6BES2tnVARnun5r3%2bc4L6V9/o7j3//gUIf%2bvM2wODQ68JGzo6tb29ve1tbZ2aru6enq6uLo1G29Gp0Wq1Gm0XKiDb2tsVSiW%2bIhQKobl63%2bBhxjGpmHuYVCqjK1KpCMsgFjOlhH1Fm1gipiHBKuEBb3ljo5ghGXcJC8ZHLBLvoNDrH7Bu%2bK6wCA0FCEvxCMk2RQWA4Y2PjwcCATsDh8PhWluDud1uFwMkJRAA%2b3Cs0oDbahEcjzH/Cni7nE5XEegRHA7nLsl8Dk0HDSficXvoUBgvBxsDmjMzM7zZ2Vmc5VwuhzKdTpNkJBbbjEQiCQYEQYAho1GCCG/Gtg4qdeTz%2bWQqhfGTyWSCthQYJoAMmul0KhaLbcUTWSYqeEcIIhgIkiSZL02LXq%2bXNzX1gA0dGkiS0Ot1ZrNpTj9nMulsNvuCxWLU64xo6P5asC6hezaLYfcFiqKSiTi%2b7fF4MNX0bHs8CACBhsNhTLzP51u12bD8YSICYYn41uKixWw0WBatiVQ6T1GZTAZh4BXWgTc9Pc2uAJAvEpjLZnFRPD5zB4UnjfwU3u3xGgxm1NlZAAO1JQIAaMswyDJTnSlCtgDWc/9L8ezAtxEx9vOKzY5IoIFiJJUKoHLYgvlS9dtPaFL5wwFk7FZKBADYZffu/45dRZLRUCiIc0/iLBMECp/PGwiG4vF4hAjjQDOnx71BELQSijosJY8KmH3w5w8/3vz11s/ffPvdTzdvTU5O3P/t3tjY2I0b30/evfvL7Tsov/7qy9t3JrASSK8G4zy7dEdCAJjwRshuXw34/ci%2bXu96lPlzGgqFVu12zHowGFxeWUFe9nh99Hlac/qDoSO0AmxWKt7re%2baEXT5XCHz3nDHn6jBXII%2bNrtfp7Da70WgwGHS47JaXlnA7Ly5Y5s1mnV5vtS49tC6aTOblJav14TJ7Kerm5lxrTpPJNG%2b2IFccaKb9LwLYtIhjmsQNmUolmUcykcD9AnKL5nFB4orceYUnfiBwm6JjkvZNPs/t9LQt9Cx/BPZsHuYWYpMJRe9jigVbKbSo4gTMvsgzTIGnnvNp3lvACwROACeAE8AJ4ARwAjgBnABOACeAE8AJ4ARwAjgBnIDDFzDzQgv4G1KHFUAL5WejAAAAAElFTkSuQmCC' /%3e%3c/svg%3e" width="816" data-srcset="/assets/static/gin_session.82a2fbd.816a885f908c54ba4ffc9e6b39f0d880.gif 480w, /assets/static/gin_session.6dd9030.816a885f908c54ba4ffc9e6b39f0d880.gif 816w" data-sizes="(max-width: 816px) 100vw, 816px" data-src="/assets/static/gin_session.6dd9030.816a885f908c54ba4ffc9e6b39f0d880.gif"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/gin_session.6dd9030.816a885f908c54ba4ffc9e6b39f0d880.gif" width="816"></noscript></p>
<h2>Pr√©paration</h2>
<h3>Packages externes</h3>
<p><code class="language-text">go get github.com/gin-gonic/gin &amp;&amp; go get github.com/gorilla/securecookie &amp;&amp; go get github.com/gorilla/csrf &amp;&amp; github.com/mattn/go-sqlite3 &amp;&amp; github.com/jinzhu/gorm</code></p>
<ul>
<li><strong>Gin</strong> : le micro framework ;</li>
<li><strong>securecookie</strong> : cookie de session ;</li>
<li><strong>csrf</strong> : gestion du token du m√™me nom ;</li>
<li><strong>go-sqlite3</strong> : le driver pour SQlite ;</li>
<li><strong>gorm</strong> : l'ORM pour les requ√™tes SQL.</li>
</ul>
<h3>Vue d'ensemble des fichiers</h3>
<p>Ci-dessous l'architecture de notre application de connexion / d√©connexion.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">‚îÇ   main.go
‚îÇ
‚îú‚îÄ‚îÄ‚îÄcontrollers
‚îÇ       back.go
‚îÇ       front.go
‚îÇ       session.go
‚îÇ
‚îú‚îÄ‚îÄ‚îÄdb
‚îÇ       db.go
<span class="token operator">|</span>
‚îú‚îÄ‚îÄ‚îÄhelpers
‚îÇ       cookies.go
‚îÇ       password.go
‚îÇ
‚îî‚îÄ‚îÄ‚îÄviews
        view_admin.html
        view_footer.html
        view_form.html
        view_header.html
        view_index.html</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Structure de donn√©es</h3>
<p>Dans le dossier "db/db.go", on cr√©e la structure de donn√©es "Users".</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">package</span> db

<span class="token comment">// La structure de donn√©es</span>
<span class="token keyword">type</span> Users <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id             <span class="token builtin">int</span>
    Name<span class="token punctuation">,</span> Password <span class="token builtin">string</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Un utilisateur poss√®de un nom ("Name") et un mot de passe ("Password").</p>
<h3>Template</h3>
<p>Il serait dommage de se priver des templates avec Go.</p>
<h4>Le header</h4>
<p>On d√©finit un template "header" contenant la majorit√© de notre code HTML dans le fichier "views/view_header.html".</p>
<div class="gridsome-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html">{{ define "header" }}

<span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Bienvenue sur mon site<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>navbar navbar-default<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container-fluid<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>navbar-header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>navbar-toggle collapsed<span class="token punctuation">"</span></span> <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>collapse<span class="token punctuation">"</span></span> <span class="token attr-name">data-target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#bs-example-navbar-collapse-1<span class="token punctuation">"</span></span> <span class="token attr-name">aria-expanded</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sr-only<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Toggle navigation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon-bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon-bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>icon-bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>navbar-brand<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Golang Website<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>collapse navbar-collapse<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bs-example-navbar-collapse-1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nav navbar-nav navbar-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">{{</span> <span class="token attr-name">if</span> <span class="token attr-name">eq</span> <span class="token attr-name">.currentPage</span> <span class="token attr-name">"login"</span> <span class="token attr-name">}}</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>active<span class="token punctuation">"</span></span> <span class="token attr-name">{{</span> <span class="token attr-name">end</span> <span class="token attr-name">}}</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Connexion<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">{{</span> <span class="token attr-name">if</span> <span class="token attr-name">eq</span> <span class="token attr-name">.currentPage</span> <span class="token attr-name">"signUp"</span> <span class="token attr-name">}}</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>active<span class="token punctuation">"</span></span> <span class="token attr-name">{{</span> <span class="token attr-name">end</span> <span class="token attr-name">}}</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/signup<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Inscription<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">{{</span> <span class="token attr-name">if</span> <span class="token attr-name">eq</span> <span class="token attr-name">.currentPage</span> <span class="token attr-name">"admin"</span> <span class="token attr-name">}}</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>active<span class="token punctuation">"</span></span> <span class="token attr-name">{{</span> <span class="token attr-name">end</span> <span class="token attr-name">}}</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/admin<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        {{ if .userName }}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropdown<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropdown-toggle<span class="token punctuation">"</span></span> <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropdown<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">aria-haspopup</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">aria-expanded</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ .userName }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>caret<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dropdown-menu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/logout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Logout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        {{ end }}
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">></span></span>

{{ if .success }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>alert alert-success<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  {{ .success }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span> <span class="token attr-name">data-dismiss</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Close<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">aria-hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token entity" title="&times;">&amp;times;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
{{ end }}

{{ if .warning }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>alert alert-warning<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  {{ .warning }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span> <span class="token attr-name">data-dismiss</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>alert<span class="token punctuation">"</span></span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Close<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">aria-hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token entity" title="&times;">&amp;times;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
{{ end }}

{{ end }}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h4>Le footer</h4>
<p>Puis un second template nomm√© "footer" dans le fichier "views/view_footer.html".</p>
<div class="gridsome-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html">{{ define "footer" }}

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>

{{ end }}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Le routeur</h2>
<p>Dans le fichier "main.go", on configure notre routeur dans la fonction principale.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"[chemin_du_projet]/controllers"</span>

    <span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Initialisation du routeur</span>
    r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Dossier des vues HTML</span>
    r<span class="token punctuation">.</span><span class="token function">LoadHTMLGlob</span><span class="token punctuation">(</span><span class="token string">"views/*"</span><span class="token punctuation">)</span>

    <span class="token comment">// Page d'accueil</span>
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> controllers<span class="token punctuation">.</span>IndexHandler<span class="token punctuation">)</span>

    <span class="token operator">/</span><span class="token operator">/</span> Page admin <span class="token punctuation">(</span>priv√©e<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">,</span> controllers<span class="token punctuation">.</span>AdminHandler<span class="token punctuation">)</span>

    <span class="token operator">/</span><span class="token operator">/</span> Page de connexion
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> controllers<span class="token punctuation">.</span>LoginHandlerForm<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> controllers<span class="token punctuation">.</span>LoginHandler<span class="token punctuation">)</span>

    <span class="token operator">/</span><span class="token operator">/</span> Page de d√©connexion
    r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">,</span> controllers<span class="token punctuation">.</span>LogoutHandler<span class="token punctuation">)</span>

    <span class="token operator">/</span><span class="token operator">/</span> Port du serveur
    r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":3000"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On a donc 5 routes distinctes dont une pour notre futur formulaire de connexion. Le port utilis√© est le "3000".</p>
<h2>Middleware</h2>
<p>On va avoir besoin de r√©cup√©rer la valeur du cookie contenu dans le fichier "helpers/cookies.go".</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"[chemin_du_projet]/controllers"</span>
    <span class="token string">"[chemin_du_projet]/helpers"</span>

    <span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>La route "admin" n'√©tant pas si priv√©e que √ßa... on va donc cr√©er un middleware qui va v√©rifier si le cookie de session n'existe pas alors on redirige l'utilisateur vers la page de connexion.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">Private</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">Cookie</span><span class="token punctuation">(</span>helpers<span class="token punctuation">.</span>CookieSessionName<span class="token punctuation">)</span>

        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/login"</span><span class="token punctuation">)</span>
            c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Tr√®s important (sinon pas prot√©g√©e avec curl -i http://localhost:3000/admin)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Remarque : la variable <code class="language-text">CookieSessionName</code> sera d√©clar√©e prochainement dans le helper "session.go" (vous pouvez commenter l'int√©rieur de la fonction <code class="language-text">Private()</code> pour le moment...).</p>
<p>Puis remplacez la route concern√©e en ajoutant le middleware.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token comment">// Page admin (priv√©e)</span>
r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">,</span> <span class="token function">Private</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> controllers<span class="token punctuation">.</span>AdminHandler<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Il est √©galement possible de cr√©er un groupe de routes et d'attribuer ce middleware √† tout ce groupe (vive le DRY :D).</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go">admin <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">)</span> <span class="token comment">// Nom du groupe "admin" dont l'URI est "/admin"</span>
admin<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token function">Private</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment">// Utilisation du middleware Private()</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Page admin (priv√©e)</span>
    admin<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> controllers<span class="token punctuation">.</span>AdminHandler<span class="token punctuation">)</span>
    <span class="token comment">// Autres routes dans "/admin"</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Helper</h2>
<h3>Les cookies</h3>
<p>Ce helper va nous servir √† cr√©er un cookie de session, r√©cup√©rer les infos de ce cookie, supprimer ce cookie mais √©galement cr√©er un cookie "flash" (sans dur√©e), le supprimer sans oublier l'encodage et le d√©codage de sa valeur (pour les caract√®res sp√©ciaux).</p>
<h4>Initialisation de la session</h4>
<p>Dans le fichier "helpers/cookies.go".</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">package</span> helpers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"net/http"</span>
    <span class="token string">"net/url"</span>

    <span class="token string">"github.com/gin-gonic/gin"</span>
    <span class="token string">"github.com/gorilla/securecookie"</span>
<span class="token punctuation">)</span>

<span class="token comment">// Cr√©ation du cookie s√©curis√©</span>
<span class="token keyword">var</span> cookieHandler <span class="token operator">=</span> securecookie<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>securecookie<span class="token punctuation">.</span><span class="token function">GenerateRandomKey</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> securecookie<span class="token punctuation">.</span><span class="token function">GenerateRandomKey</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Nom du cookies de session</span>
<span class="token keyword">var</span> CookieSessionName <span class="token operator">=</span> <span class="token string">"session"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On importe le package "net/http" pour travailler sur les cookies ainsi que "gorilla/securecookie" pour cr√©er un cookie s√©curis√© que l'on d√©clare dans une variable nomm√©e "cookieHandler" via la fonction <code class="language-text">securecookie.New()</code>. Le premier argument sert √† d√©finir une clef de hachage et le second √† d√©finir une clef de blocage. Quant aux packages "net/http" et "net/url", ils nous serviront pour les cookies flash.</p>
<h4>Cr√©ation de la session</h4>
<p>Puis on cr√©e la fonction <code class="language-text">SetSession</code> pour d√©finir un cookie √† partir du nom de l'utilisateur.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">SetSession</span><span class="token punctuation">(</span>userName <span class="token builtin">string</span><span class="token punctuation">,</span> c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>
        <span class="token string">"name"</span><span class="token punctuation">:</span> userName<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> encoded<span class="token punctuation">,</span> err <span class="token operator">:=</span> cookieHandler<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>CookieSessionName<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        cookie <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Cookie<span class="token punctuation">{</span>
            Name<span class="token punctuation">:</span>  CookieSessionName<span class="token punctuation">,</span>
            Value<span class="token punctuation">:</span> encoded<span class="token punctuation">,</span>
            Path<span class="token punctuation">:</span>  <span class="token string">"/"</span><span class="token punctuation">,</span>
            HttpOnly<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">//Secure: true, SEULEMENT DISPONIBLE AVEC HTTPS ACTIVE</span>
        <span class="token punctuation">}</span>
        http<span class="token punctuation">.</span><span class="token function">SetCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> cookie<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ol>
<li>On stocke la valeur de l'utilisateur dans une variable (<code class="language-text">value</code>) ;</li>
<li>On encode notre cookie √† partir du super cookie <code class="language-text">cookieHandler</code> dans la variable <code class="language-text">encoded</code> ;</li>
<li>Le cookie poss√®de √©galement un nom ("session" dans notre cas via la variable <code class="language-text">cookieSessionName</code>) ainsi qu'un chemin.</li>
</ol>
<p>Je vous conseille d'activer le flag "HttpOnly" pour des raisons de s√©curit√© (cela emp√®che notamment l'ex√©cution de la fonction JavaScript <code class="language-text">document.cookie</code>). Vous pouvez ajouter plus de s√©curit√© si votre application est en HTTPS en d√©finissant le cookie de session comme √©tant de type "secure" (<code class="language-text">Secure: true</code>).</p>
<h4>R√©cup√©rer la valeur de l'utilisateur</h4>
<p>Puis on cr√©e une autre fonction <code class="language-text">getUserName</code> pour r√©cup√©rer le nom d'utilisateur stock√© dans le cookie.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">GetUserName</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span>userName <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> cookie<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">Cookie</span><span class="token punctuation">(</span>CookieSessionName<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        cookieValue <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">=</span> cookieHandler<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>CookieSessionName<span class="token punctuation">,</span> cookie<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cookieValue<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            userName <span class="token operator">=</span> cookieValue<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> userName
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Si le cookie existe, alors on r√©cup√®re la valeur "name" du cookie que l'on retourne comme chaine de caract√®res.</p>
<h4>Supprimer la session</h4>
<p>Et une autre fonction <code class="language-text">ClearSession</code> pour d√©truire le cookie lors de la d√©connexion.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">ClearSession</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cookie <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Cookie<span class="token punctuation">{</span>
        Name<span class="token punctuation">:</span>   CookieSessionName<span class="token punctuation">,</span>
        Value<span class="token punctuation">:</span>  <span class="token string">""</span><span class="token punctuation">,</span>
        Path<span class="token punctuation">:</span>   <span class="token string">"/"</span><span class="token punctuation">,</span>
        MaxAge<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    http<span class="token punctuation">.</span><span class="token function">SetCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> cookie<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h4>Encodage / d√©codage de valeurs</h4>
<p>On a besoin d'encoder et de d√©coder les cookies pour accepter les caract√®res sp√©ciaux.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token comment">// Encodage de la valeur du cookie</span>
<span class="token keyword">func</span> <span class="token function">encode</span><span class="token punctuation">(</span>value <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    encode <span class="token operator">:=</span> <span class="token operator">&amp;</span>url<span class="token punctuation">.</span>URL<span class="token punctuation">{</span>Path<span class="token punctuation">:</span> value<span class="token punctuation">}</span>
    <span class="token keyword">return</span> encode<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// D√©codage de la valeur du cookie</span>
<span class="token keyword">func</span> <span class="token function">decode</span><span class="token punctuation">(</span>value <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    decode<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> url<span class="token punctuation">.</span><span class="token function">QueryUnescape</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token keyword">return</span> decode
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h4>Cr√©ation du cookie "flash"</h4>
<p>On aura besoin de stocker des donn√©es dans un cookie provisoire.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cookie <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Cookie<span class="token punctuation">{</span>
        Name<span class="token punctuation">:</span>   name<span class="token punctuation">,</span>
        Value<span class="token punctuation">:</span>  <span class="token function">encode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>
        Path<span class="token punctuation">:</span>   <span class="token string">"/"</span><span class="token punctuation">,</span>
        MaxAge<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    http<span class="token punctuation">.</span><span class="token function">SetCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> cookie<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On prend soin d'encoder la valeur du cookie. Avec un age tr√®s limit√© puisqu'il s'agit de donn√©es provisoires (message de succ√®s, d'avertissement, d'erreur...).</p>
<h4>R√©cup√©ration de la valeur du cookie "flash"</h4>
<p>On aura besoin de r√©cup√©rer un cookie provisoire pour informer l'utilisateur.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">GetFlashCookie</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>value <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cookie<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">Cookie</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>

    <span class="token keyword">var</span> cookieValue <span class="token builtin">string</span>
    <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        cookieValue <span class="token operator">=</span> cookie<span class="token punctuation">.</span>Value
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        cookieValue <span class="token operator">=</span> cookieValue
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">decode</span><span class="token punctuation">(</span>cookieValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On retourne la valeur... d√©cod√©e.</p>
<h2>Cont√¥leurs</h2>
<p>On va traiter nos 3 contr√¥leurs en commencant par le front puis la session et pour finir, le back.</p>
<h3>Front</h3>
<p>Dans le fichier "controllers/front.go".</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">package</span> controllers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"[chemin_du_projet]/helpers"</span>

    <span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">IndexHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    userName <span class="token operator">:=</span> helpers<span class="token punctuation">.</span><span class="token function">GetUserName</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

    c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"view_index.html"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"userName"</span><span class="token punctuation">:</span>    userName<span class="token punctuation">,</span>
        <span class="token string">"currentPage"</span><span class="token punctuation">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span>
        <span class="token string">"success"</span><span class="token punctuation">:</span>     helpers<span class="token punctuation">.</span><span class="token function">GetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On r√©cup√®re (si elle existe), la valeur du cookie de session via la fonction <code class="language-text">GetUserName(c)</code>.</p>
<p>On affiche la page web dans "views/view_index.html".</p>
<div class="gridsome-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html">{{ template "header" . }}

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Bienvenue :)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Vous √™tes sur la partie front de ce site Web.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

{{ template "footer" }}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Session</h3>
<p>On s'occupe de cr√©er le formulaire "views/view_form.html" qui servira √† la fois pour se connecter et pour s'inscrire.</p>
<div class="gridsome-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html">{{ template "header" . }}

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>col-sm-6 col-sm-offset-3 form-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-top<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-top-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span>{{ if eq .currentPage "login" }}Connexion{{ else }}Inscription{{ end }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-bottom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>login-form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Nom d'utilisateur<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Username...<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-username form-control<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-username<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">required</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Mot de passe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Password...<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-password form-control<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form-password<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">required</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>btn btn-primary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ if eq .currentPage "login" }}Se connecter{{ else }}Valider mon inscription{{ end }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

{{ template "footer" }}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Le plus important √©tant la pr√©sence des 2 champs obligatoire.</p>
<p>Dans le fichier "controllers/session.go".</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">package</span> controllers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"[chemin_du_projet]/db"</span>
    <span class="token string">"[chemin_du_projet]/helpers"</span>

    <span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Puis dans notre contr√¥leur, on affiche notre formulaire dans la route <code class="language-text">LoginHandlerForm</code>.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">LoginHandlerForm</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// R√©cup√©ration du nom d'utilisateur pour le templating</span>
    userName <span class="token operator">:=</span> helpers<span class="token punctuation">.</span><span class="token function">GetUserName</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

    c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"view_form.html"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"userName"</span><span class="token punctuation">:</span>    userName<span class="token punctuation">,</span>
        <span class="token string">"currentPage"</span><span class="token punctuation">:</span> <span class="token string">"login"</span><span class="token punctuation">,</span>
        <span class="token string">"warning"</span><span class="token punctuation">:</span>     helpers<span class="token punctuation">.</span><span class="token function">GetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"warning"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On r√©cup√®re les donn√©es rentr√©es dans le formulaire (nom d'utilisateur et mot de passe) dans la route de type POST <code class="language-text">LoginHandlerForm</code>.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">LoginHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Utilisateur concern√©</span>
    user <span class="token operator">:=</span> db<span class="token punctuation">.</span>Users<span class="token punctuation">{</span>
        <span class="token string">"toto"</span><span class="token punctuation">,</span>
        <span class="token string">"password"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// R√©cup√©ration des champs</span>
    name <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
    pass <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> name <span class="token operator">!=</span> <span class="token string">""</span> <span class="token operator">&amp;&amp;</span> pass <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> name <span class="token operator">==</span> user<span class="token punctuation">.</span>Name <span class="token operator">&amp;&amp;</span> pass <span class="token operator">==</span> user<span class="token punctuation">.</span>Password <span class="token punctuation">{</span>
            helpers<span class="token punctuation">.</span><span class="token function">SetSession</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
            helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"success"</span><span class="token punctuation">,</span> <span class="token string">"Bienvenue "</span><span class="token operator">+</span>user<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
            <span class="token comment">// Redirection vers la page prot√©g√©e</span>
            c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/admin"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Pas bon :(</span>
            helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"warning"</span><span class="token punctuation">,</span> <span class="token string">"Identifiants incorrects"</span><span class="token punctuation">)</span>
            c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/login"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Si la correspondance est correcte alors on instancie le cookie de session et on redirige vers la page priv√©e. Sinon on stocke un message d'avertissement dans un cookie de type "warning".</p>
<p>Dans ce contr√¥leur, il ne nous manque plus que la d√©connexion avec la route <code class="language-text">LogoutHandler</code>.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">LogoutHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    helpers<span class="token punctuation">.</span><span class="token function">ClearSession</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"success"</span><span class="token punctuation">,</span> <span class="token string">"Vous √™tes d√©sormais d√©connect√©(e)"</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On supprime le cookie de session avec <code class="language-text">ClearSession</code> et on redirige vers la page d'accueil avec le message contenu dans le cookie flash.</p>
<h3>Back</h3>
<p>On cr√©e notre magnifique page admin dans "views/views_admin.html".</p>
<div class="gridsome-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html">{{ template "header" . }}

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Admin (page prot√©g√©e)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>

{{ template "footer"}}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Dans la fonction de la route <code class="language-text">AdminHandler</code> on appel la variable userName √† partir de la fonction <code class="language-text">getUserName</code>.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">package</span> controllers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"[chemin_du_projet]/helpers"</span>

    <span class="token string">"github.com/gin-gonic/gin"</span>
<span class="token punctuation">)</span>

<span class="token comment">// Admin</span>
<span class="token keyword">func</span> <span class="token function">AdminHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// R√©cup√©ration du nom d'utilisateur pour le templating</span>
    userName <span class="token operator">:=</span> helpers<span class="token punctuation">.</span><span class="token function">GetUserName</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

    c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"view_admin.html"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"userName"</span><span class="token punctuation">:</span>    userName<span class="token punctuation">,</span>
        <span class="token string">"currentPage"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span>
        <span class="token string">"success"</span><span class="token punctuation">:</span>     helpers<span class="token punctuation">.</span><span class="token function">GetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"success"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Bcrypt</h2>
<p>Pr√©sent dans de nombreux langage de programmation, Bcrypt est une fonction de hash. Contrairement √† MD5, SHA-1, SHA-256, etc..., le mot de passe est hach√© diff√©rement et de ce fait est bien plus r√©sistant aux attaques par force brute. Bcrypt utilise 3 crit√®res :</p>
<ul>
<li><strong>cost</strong> : le co√ªt souhait√© de l'algorithme (suivant la puissance de la machine h√©bergeant le serveur) ;</li>
<li><strong>salt</strong> : sel de l'algorithme ;</li>
<li><strong>key</strong> : le mot de passe que l'on souhaite encoder.</li>
</ul>
<p>On aura donc besoin de hacher et de comparer.</p>
<h3>Pr√©paration du fichier</h3>
<p>Dans le fichier "helpers/password.go", on importe la librairie <code class="language-text">golang.org/x/crypto/bcrypt</code>.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">package</span> helpers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"golang.org/x/crypto/bcrypt"</span>
<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3>Hachage</h3>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">HashPassword</span><span class="token punctuation">(</span>password <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> bcrypt<span class="token punctuation">.</span><span class="token function">GenerateFromPassword</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">,</span> bcrypt<span class="token punctuation">.</span>DefaultCost<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">,</span> err
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Dans la fonction <code class="language-text">hashPassword</code>, on passe en param√®tre le mot de passe en clair. On retourne une chaine de caract√®res via la fonction <code class="language-text">GenerateFromPassword</code>. Le co√ªt ("cost") est definit √† 10 (le minimum √©tant 4 <code class="language-text">bcrypt.MinCost</code>, le maximum 31 <code class="language-text">bcrypt.MaxCost</code> et par d√©faut 10 <code class="language-text">bcrypt.DefaultCost</code>).</p>
<h3>V√©rification par comparaison</h3>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">CheckPasswordHash</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> hash <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    err <span class="token operator">:=</span> bcrypt<span class="token punctuation">.</span><span class="token function">CompareHashAndPassword</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> err <span class="token operator">==</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>On passe en param√®tre le mot de passe et le mot de passe hach√©. On retourne un bool√©en via la fonction <code class="language-text">CompareHashAndPassword</code>.</p>
<h3>Testons</h3>
<p>Dans la fonction <code class="language-text">LoginHandler</code>, on modifie les lignes concern√©es.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">LoginHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Utilisateur concern√©</span>
    user <span class="token operator">:=</span> db<span class="token punctuation">.</span>Users<span class="token punctuation">{</span>
        <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"toto"</span><span class="token punctuation">,</span>
        <span class="token string">"password"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Mot de passe hach√© ("password")</span>
    hash<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> helpers<span class="token punctuation">.</span><span class="token function">HashPassword</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Password<span class="token punctuation">)</span>

    <span class="token comment">// R√©cup√©ration des champs</span>
    name <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
    pass <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> name <span class="token operator">!=</span> <span class="token string">""</span> <span class="token operator">&amp;&amp;</span> pass <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> name <span class="token operator">==</span> user<span class="token punctuation">.</span>Name <span class="token operator">&amp;&amp;</span> helpers<span class="token punctuation">.</span><span class="token function">CheckPasswordHash</span><span class="token punctuation">(</span>pass<span class="token punctuation">,</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            helpers<span class="token punctuation">.</span><span class="token function">SetSession</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
            helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"success"</span><span class="token punctuation">,</span> <span class="token string">"Bienvenue "</span><span class="token operator">+</span>user<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
            <span class="token comment">// Redirection vers la page prot√©g√©e</span>
            c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/admin"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Pas bon :(</span>
            helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"warning"</span><span class="token punctuation">,</span> <span class="token string">"Identifiants incorrects"</span><span class="token punctuation">)</span>
            c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/login"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Token CSRF</h2>
<p>Le token CSRF (Cross-Site Request Forgery) permet de se prot√©ger contre une faille bien connue, l'attaque XSS. Avec la g√©n√©ration de ce token aussi bien cot√© utilisateur que cot√© serveur, cela permet de renforcer la s√©curit√© √† moindres frais.</p>
<h3>Cot√© serveur</h3>
<p>Dans le fichier "main.go", importez le package officiel "net/http" et le package pour notre token "github.com/gorilla/csrf". Puis remplacez la ligne <code class="language-text">r.Run(&quot;:3000&quot;)</code> par la ligne ci-dessous.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go">http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">":3000"</span><span class="token punctuation">,</span>
    csrf<span class="token punctuation">.</span><span class="token function">Protect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">"32-byte-long-auth-key"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> csrf<span class="token punctuation">.</span><span class="token function">Secure</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Il est important de sp√©cifier le cookie de type Secure √† false si HTTPS n'est pas activ√© (sinon le cookie ne fonctionnera pas).</p>
<p>Remarque : vous pouvez remplacez <code class="language-text">[]byte(&quot;32-byte-long-auth-key&quot;)</code> par securecookie.GenerateRandomKey(32) (apr√®s avoir import√© le package "github.com/gorilla/securecookie").</p>
<p>Dans le fichier "controller/session.go", dans la fonction <code class="language-text">LoginHandlerForm</code>, ajoutez la propri√©t√© <code class="language-text">csrf.TemplateTag</code> avec pour valeur <code class="language-text">csrf.TemplateField(c.Request)</code>.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go">c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"view_form.html"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
    <span class="token string">"userName"</span><span class="token punctuation">:</span>       userName<span class="token punctuation">,</span>
    <span class="token string">"currentPage"</span><span class="token punctuation">:</span>    <span class="token string">"login"</span><span class="token punctuation">,</span>
    <span class="token string">"warning"</span><span class="token punctuation">:</span>        helpers<span class="token punctuation">.</span><span class="token function">GetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"warning"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    csrf<span class="token punctuation">.</span>TemplateTag<span class="token punctuation">:</span> csrf<span class="token punctuation">.</span><span class="token function">TemplateField</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>N'oubliez pas d'importer le package "github.com/gorilla/csrf" dans ce fichier.</p>
<h3>Cot√© client</h3>
<p>Dans le formulaire ("views/view_form"), ajoutez la valeur <code class="language-text">{{ .csrfField }}</code> avant la fermeture de la balise <code class="language-text">&lt;/form&gt;</code>. Cela aura pour effet d'ajouter un champ de type "hidden" dans le formulaire contenant le token comme valeur. En effet, la valeur <code class="language-text">csrf.TemplateField(c.Request)</code> produit le code ci-dessous.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go">fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">`&lt;input type="hidden" name="%s" value="%s">`</span><span class="token punctuation">,</span>
        <span class="token string">"myFieldName"</span><span class="token punctuation">,</span> <span class="token function">Token</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Un exemple de rendu en HTML.</p>
<div class="gridsome-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>gorilla.csrf.Token<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>JZ6ZacxKVbWWReZh90RgOtYgjzptXRL8NnpbCtI7a7P/R/oAtIWrgcUY5DgEDIiUmnMX3HfupUm3r4C3xci/IQ==<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Si vous supprimez ou modifiez la valeur du champ, vous aurez le message suivant "Forbidden - CSRF token invalid" avec une erreur HTTP 403.</p>
<h2>Base de donn√©es</h2>
<p>Jusqu'√† pr√©sent on a test√© avec un seul compte utilisateur. On va s'assurer que les futurs utilisateurs puissent s'inscrire tout en ayant leur mot de passe hach√© dans la base de donn√©es et en prenant en compte l'unicit√© des comptes.</p>
<h3>Connexion √† SQLite</h3>
<p>Dans le fichier "db.go" pr√©sent dans le dossier "db", on importe l'ORM et le driver pour SQLite.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">package</span> db

<span class="token comment">// Les imports de librairies</span>
<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"github.com/jinzhu/gorm"</span>
    <span class="token boolean">_</span> <span class="token string">"github.com/mattn/go-sqlite3"</span>
<span class="token punctuation">)</span>

<span class="token comment">// La structure de donn√©es</span>
<span class="token keyword">type</span> Users <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id       <span class="token builtin">int</span>    <span class="token string">`gorm:"AUTO_INCREMENT" form:"id"`</span>
    Name     <span class="token builtin">string</span> <span class="token string">`gorm:"not null;unique" form:"username"`</span> <span class="token comment">// Utilisateur unique!</span>
    Password <span class="token builtin">string</span> <span class="token string">`gorm:"not null" form:"password"`</span>
<span class="token punctuation">}</span>

<span class="token comment">// Connexion √† la BDD SQLite</span>
<span class="token keyword">func</span> <span class="token function">InitDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
    <span class="token comment">// Ouverture de la connexion vers la BDD SQLite</span>
    db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"sqlite3"</span><span class="token punctuation">,</span> <span class="token string">"./data.db"</span><span class="token punctuation">)</span>
    <span class="token comment">// Afficher les requ√™tes SQL (facultatif)</span>
    db<span class="token punctuation">.</span><span class="token function">LogMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

    <span class="token comment">// Cr√©ation de la table "users"</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>db<span class="token punctuation">.</span><span class="token function">HasTable</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Users<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        db<span class="token punctuation">.</span><span class="token function">CreateTable</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Users<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        db<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"gorm:table_options"</span><span class="token punctuation">,</span> <span class="token string">"ENGINE=InnoDB"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CreateTable</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Users<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> db
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On modifie la structure de donn√©es pour l'accorder avec l'ORM Gorm. Et on initialise la connexion au fichier SQLite "data.db".</p>
<h3>Formulaire d'inscription</h3>
<p>Dans le fichier "main.go", ajoutez les 2 routes ci-dessous.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token comment">// Page d'inscription</span>
r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/signup"</span><span class="token punctuation">,</span> controllers<span class="token punctuation">.</span>SignUpHandlerForm<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/signup"</span><span class="token punctuation">,</span> controllers<span class="token punctuation">.</span>SignUpHandler<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Puis dans le contr√¥leur "session.go".</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">SignUpHandlerForm</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// R√©cup√©ration du nom d'utilisateur pour le templating</span>
    userName <span class="token operator">:=</span> helpers<span class="token punctuation">.</span><span class="token function">GetUserName</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

    c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"view_form.html"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"userName"</span><span class="token punctuation">:</span>       userName<span class="token punctuation">,</span>
        <span class="token string">"currentPage"</span><span class="token punctuation">:</span>    <span class="token string">"signUp"</span><span class="token punctuation">,</span>
        <span class="token string">"warning"</span><span class="token punctuation">:</span>        helpers<span class="token punctuation">.</span><span class="token function">GetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"warning"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        csrf<span class="token punctuation">.</span>TemplateTag<span class="token punctuation">:</span> csrf<span class="token punctuation">.</span><span class="token function">TemplateField</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Request<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On utilise le m√™me formulaire que pour la connexion sans oublier de g√©n√©rer le token CSRF.</p>
<p>Et la route de v√©rification de type "POST" <code class="language-text">SignUpHandler</code>.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">SignUpHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> user db<span class="token punctuation">.</span>Users

    <span class="token keyword">if</span> c<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token comment">// Mot de passe hach√©</span>
        hash<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> helpers<span class="token punctuation">.</span><span class="token function">HashPassword</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Password<span class="token punctuation">)</span>
        user<span class="token punctuation">.</span>Password <span class="token operator">=</span> hash

        <span class="token comment">// Connexion √† SQLite</span>
        dbmap <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">InitDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">defer</span> dbmap<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> err <span class="token operator">:=</span> dbmap<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"name = ?"</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"warning"</span><span class="token punctuation">,</span> <span class="token string">"Inscription refus√©e, le nom d'utitlisateur "</span><span class="token operator">+</span>user<span class="token punctuation">.</span>Name<span class="token operator">+</span><span class="token string">" existe d√©j√†"</span><span class="token punctuation">)</span>
            c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/signup"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Cr√©ation de l'utilisateur</span>
            dbmap<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
            <span class="token comment">// Cr√©ation du cookie de session</span>
            helpers<span class="token punctuation">.</span><span class="token function">SetSession</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
            c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/admin"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"warning"</span><span class="token punctuation">,</span> <span class="token string">"Champs non remplis"</span><span class="token punctuation">)</span>
        c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/signup"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ol>
<li>On r√©cup√®re les donn√©es post√©es dans le formulaire d'inscription avec la fonction <code class="language-text">c.Bind</code> ;</li>
<li>On hash le mot de passe via la fonction <code class="language-text">hashPassword</code> ;</li>
<li>On s'assure que le nom d'utilisateur n'existe pas dans la BDD.</li>
<li>On se connecte √† SQLite afin d'ins√©rer les donn√©es avec la fonction <code class="language-text">Create</code> ;</li>
</ol>
<h3>Connexion</h3>
<p>Une fois le ou les utilisateurs cr√©√©s, il faut modifier la route <code class="language-text">LoginHandler</code>.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">LoginHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> user db<span class="token punctuation">.</span>Users

    <span class="token comment">// Binding du formulaire</span>
    <span class="token keyword">if</span> c<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token comment">// R√©cup√©ration du mdp en clair</span>
        clearPassword <span class="token operator">:=</span> user<span class="token punctuation">.</span>Password

        <span class="token comment">// Connexion au fichier SQLite</span>
        dbmap <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">InitDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">defer</span> dbmap<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> err <span class="token operator">:=</span> dbmap<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"name = ?"</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>

            <span class="token comment">// V√©rification du mdp</span>
            <span class="token keyword">if</span> helpers<span class="token punctuation">.</span><span class="token function">CheckPasswordHash</span><span class="token punctuation">(</span>clearPassword<span class="token punctuation">,</span> user<span class="token punctuation">.</span>Password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Cr√©ation du cookie de session</span>
                helpers<span class="token punctuation">.</span><span class="token function">SetSession</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
                helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"success"</span><span class="token punctuation">,</span> <span class="token string">"Bienvenue "</span><span class="token operator">+</span>user<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
                c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/admin"</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// MDP incorrect</span>
                helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"warning"</span><span class="token punctuation">,</span> <span class="token string">"Mot de passe incorrect"</span><span class="token punctuation">)</span>
                c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/login"</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Nom d'utilisateur incorrect</span>
            helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"warning"</span><span class="token punctuation">,</span> <span class="token string">"Nom d'utilisateur incorrect"</span><span class="token punctuation">)</span>
            c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/login"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Champs non remplis</span>
        helpers<span class="token punctuation">.</span><span class="token function">SetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"warning"</span><span class="token punctuation">,</span> <span class="token string">"Champs non remplis"</span><span class="token punctuation">)</span>
        c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">"/login"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ol>
<li>On r√©cup√®re les donn√©es post√©es dans le formulaire de connexion avec la fonction <code class="language-text">c.Bind</code> ;</li>
<li>On r√©cup√®re le mot de passe en clair saisi par l'utilisateur ;</li>
<li>On se connecte √† SQLite afin de trouver le nom d'utilisateur saisie ;</li>
<li>Avec la fonction <code class="language-text">checkPasswordHash</code> qui renvoie un bool√©en, on s'assure que le mot de passe en clair et le mot de passe hach√© corresponde bien ;</li>
<li>On instancie le cookie de session via la fonction <code class="language-text">SetSession</code> et on redirige l'utilisateur vers la page "admin".</li>
</ol>
<h3>Afficher tous les utilisateurs</h3>
<p>Dans la page admin, on va afficher la liste des utilisateurs dans un tableau.</p>
<div class="gridsome-highlight" data-language="go"><pre style="counter-reset: linenumber NaN" class="language-go line-numbers"><code class="language-go"><span class="token keyword">func</span> <span class="token function">AdminHandler</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>db<span class="token punctuation">.</span>Users

    dbmap <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">InitDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">defer</span> dbmap<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    dbmap<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>

    <span class="token comment">// R√©cup√©ration du nom d'utilisateur pour le templating</span>
    userName <span class="token operator">:=</span> helpers<span class="token punctuation">.</span><span class="token function">GetUserName</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

    c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"view_admin.html"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span>
        <span class="token string">"userName"</span><span class="token punctuation">:</span>    userName<span class="token punctuation">,</span>
        <span class="token string">"currentPage"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span>
        <span class="token string">"users"</span><span class="token punctuation">:</span>       users<span class="token punctuation">,</span>
        <span class="token string">"success"</span><span class="token punctuation">:</span>     helpers<span class="token punctuation">.</span><span class="token function">GetFlashCookie</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Pour que ce code fonctionne, importez le package interne "[chemin_du_projet]/db".</p>
<p>Puis dans la vue associ√©e ("view_admin.html"), on boucle le tableau de donn√©es contenu dans la variable <code class="language-text">users</code> avec <code class="language-text">range</code>.</p>
<div class="gridsome-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html">{{ template "header" . }}

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Liste des utilisateurs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>table-responsive<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>table table-bordered<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Password (Bcrypt)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
      {{ range $user := .users }}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{ $user.Id }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{ $user.Name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span>{{ $user.Password }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
      {{ end }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

{{ template "footer" }}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Conclusion</h2>
<p>La connexion et la d√©connexion fonctionnent. Maintenant il faudrait offrir la possibilit√© √† l'utilisateur de modifier son mot de passe et mettre en place un syst√®me de r√©cup√©ration du mot de passe par email.</p>
<h2>Sources</h2>
<ul>
<li><a href="https://github.com/gin-gonic/gin" target="_blank" rel="nofollow noopener noreferrer">https://github.com/gin-gonic/gin</a> ;</li>
<li><a href="https://github.com/gorilla/securecookie" target="_blank" rel="nofollow noopener noreferrer">https://github.com/gorilla/securecookie</a> ;</li>
<li><a href="https://github.com/gorilla/csrf" target="_blank" rel="nofollow noopener noreferrer">https://github.com/gorilla/csrf</a> ;</li>
<li><a href="https://github.com/jinzhu/gorm" target="_blank" rel="nofollow noopener noreferrer">https://github.com/jinzhu/gorm</a> ;</li>
<li><a href="https://gowebexamples.github.io/sessions" target="_blank" rel="nofollow noopener noreferrer">https://gowebexamples.github.io/sessions</a> ;</li>
<li><a href="https://gowebexamples.github.io/password-hashing" target="_blank" rel="nofollow noopener noreferrer">https://gowebexamples.github.io/password-hashing</a> ;</li>
<li><a href="http://www.alexedwards.net/blog/simple-flash-messages-in-golang" target="_blank" rel="nofollow noopener noreferrer">http://www.alexedwards.net/blog/simple-flash-messages-in-golang</a> ;</li>
<li><a href="https://golang.org/pkg/html/template" target="_blank" rel="nofollow noopener noreferrer">https://golang.org/pkg/html/template</a> ;</li>
<li><a href="https://fr.wikipedia.org/wiki/Bcrypt" target="_blank" rel="nofollow noopener noreferrer">https://fr.wikipedia.org/wiki/Bcrypt</a>.</li>
</ul>
</article></div></div></div></main><footer class="text-white mt-4"><ul class="nav nav-pills justify-content-center"><li><a href="https://github.com/etienner" target="_blank" rel="noopener" class="nav-link">Github</a></li><li><a href="https://medium.com/@etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Medium</a></li><li><a href="https://twitter.com/etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Twitter</a></li></ul></footer></div>
    <script src="/assets/js/app.dc35239c.js" defer></script><script src="/assets/js/page--src--templates--post-vue.a4881b12.js" defer></script>
  </body>
</html>
