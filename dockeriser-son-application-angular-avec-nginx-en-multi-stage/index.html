<!DOCTYPE html>
<html data-html-server-rendered="true" lang="fr" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22fr%22%7D%7D">
  <head>
    <title>Dockeriser son application Angular avec Nginx en multi-stage - https://etienner.github.io</title><meta name="gridsome:hash" content="b89929ffb278454bd1f8bb0277abaa50df9b43f7"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="description" content="Introduction
Arrive le moment o√π vous devez d√©ployer votre application Angular sur Docker. Pour ce faire, on va d√©composer notre Dockerfile en 2 parties. La premi√®re partie va comprendre la g√©n√©ration"><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="Dockeriser son application Angular avec Nginx en multi-stage"><meta data-vue-tag="ssr" property="og:description" content="Introduction
Arrive le moment o√π vous devez d√©ployer votre application Angular sur Docker. Pour ce faire, on va d√©composer notre Dockerfile en 2 parties. La premi√®re partie va comprendre la g√©n√©ration"><meta data-vue-tag="ssr" property="og:url" content="https://etienner.github.io/dockeriser-son-application-angular-avec-nginx-en-multi-stage/"><meta data-vue-tag="ssr" name="twitter:domain" content="https://etienner.github.io"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="Dockeriser son application Angular avec Nginx en multi-stage"><meta data-vue-tag="ssr" name="twitter:description" content="Introduction
Arrive le moment o√π vous devez d√©ployer votre application Angular sur Docker. Pour ce faire, on va d√©composer notre Dockerfile en 2 parties. La premi√®re partie va comprendre la g√©n√©ration"><meta data-vue-tag="ssr" name="twitter:site" content="@etiennerouzeaud"><meta data-vue-tag="ssr" name="twitter:creator" content="@etiennerouzeaud"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.a80f6262.css" as="style"><link rel="preload" href="/assets/js/app.50d8a5ce.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.56e5bc07.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules-gridsome-app-pages-404-vue.5bf39404.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.027f19cb.js"><link rel="prefetch" href="/assets/js/page--src-templates-tag-vue.aae09759.js"><link rel="stylesheet" href="/assets/css/0.styles.a80f6262.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app"><header class="py-2 text-center"><strong><a href="/" title="Accueil" class="active">Etienne ROUZEAUD - D√©veloppeur Web</a></strong></header><main><div class="title py-2 text-center" data-v-4b217994><h1 class="display-5 pt-2" data-v-4b217994>Dockeriser son application Angular avec Nginx en multi-stage</h1><!----></div><div class="container"><div class="row sidebar"><div class="mt-4 col-lg-2"><p><em><span>31 ao√ªt 2023</span></em></p><ul class="list-unstyled"><li>
            üè∑Ô∏è <a href="/tag/Docker/">Docker</a></li><li>
            üè∑Ô∏è <a href="/tag/Angular/">Angular</a></li><li>
            üè∑Ô∏è <a href="/tag/Nginx/">Nginx</a></li></ul><p>‚åö 7 mins de lecture</p><!----></div><div class="col-lg-10 mt-4"><!----><article><h2>Introduction</h2>
<p>Arrive le moment o√π vous devez d√©ployer votre application Angular sur Docker. Pour ce faire, on va d√©composer notre Dockerfile en 2 parties. La premi√®re partie va comprendre la g√©n√©ration de l'application et la seconde partie, un serveur Nginx avec un fichier de configuration associ√© et le dossier de build de l'application.</p>
<blockquote>
<p>Cette notion de d√©coupage sur Docker se nomme le <strong>multi-stage</strong>.</p>
</blockquote>
<p>NB : il ne s'agit pas d'un environnement de d√©veloppement mais bien d'un environnement de production.</p>
<h2>Pr√©requis</h2>
<p>Pour concevoir une image Docker, il faut comprendre comment fonctionne le build d'une application sur Angular et r√©diger un fichier de configuration Nginx Concernant Angular, l'application est g√©n√©r√©e √† la racine du projet dans un r√©pertoire "dist".</p>
<h3>Script d'ex√©cution</h3>
<p>Dans le fichier "package.json", assurez-vous d'avoir la pr√©sence d'une commande dans la partie "scripts". Par exemple sur Angular CLI <code class="language-text">npm run build</code> ou sur Nx <code class="language-text">&quot;myapp:ci-build&quot;: &quot;nx build myapp&quot;</code>.</p>
<h3>Script de configuration Nginx</h3>
<p>On a besoin de mettre en place un fichier de configuration Nginx. AÃÄ la racine de votre projet Angular ou Nx, cr√©ez un nouveau dossier que vous nommez "docker" avec un fichier "nginx.conf" basique avec le contenu ci-dessous.</p>
<div class="gridsome-highlight" data-language="nginxconf"><pre style="counter-reset: linenumber NaN" class="language-nginxconf line-numbers"><code class="language-nginxconf">events { }
http {
  include /etc/nginx/mime.types;
  server {
    client_max_body_size 50M;
    listen 80 default_server;
    listen [::]:80 default_server;
    root /usr/share/nginx/html;
    server_name _;
    index index.html;

    location / {
      try_files $uri $uri/ /index.html;
    }
  }
}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Cr√©ation du Dockerfile</h2>
<p>Toujours dans le dossier "docker" cr√©ez un fichier "myapp_build".</p>
<h3>Build de l'application</h3>
<p>Pour la premi√®re partie de ce Dockerfile, on a besoin d'une image de NodeJS. On va donc partir sur une image l√©g√®re de la distribution Linux Alpine. De pr√©f√©rence une version LTS (Long Term Support) de NodeJS, c'est-√†-dire une version paire (exemple: 16, 18, 20, etc...). Ci-dessous, on utilise la version de NodeJS 20.5.1 de Alpine 3.18.</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> node<span class="token punctuation">:</span>20.5.1<span class="token punctuation">-</span>alpine3.18 as builder</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Ensuite, on souhaite copier le contenu des fichiers "package.json" et "package-lock.json" √† la racine du container.</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">COPY</span> package.json package<span class="token punctuation">-</span>lock.json ./</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Ainsi, on peut √©xecuter la commande d'installation des paquets d√©di√©es (et non <code class="language-text">npm install</code>).</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> npm ci &amp;&amp; mkdir /ng<span class="token punctuation">-</span>app &amp;&amp; mv ./node_modules ./ng<span class="token punctuation">-</span>app</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Et d√©placer le dossier "node_modules" dans un nouveau dossier "ng-app" que l'on d√©finit comme le dossier d'entr√©e.</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">WORKDIR</span> /ng<span class="token punctuation">-</span>app</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Puis on copie le contenu du dossier d'entr√©e ("ng-app") √† la racine du container.</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">COPY</span> . .</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Et on construit l'application avec la commande sp√©cifi√©e dans le fichier "package.json".</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> npm run myapp<span class="token punctuation">:</span>ci<span class="token punctuation">-</span>build</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3>Serveur de l'application</h3>
<p>AÃÄ la suite du Dockerfile, on passe √† l'√©tape du serveur avec Nginx. On part donc sur image Nginx officielle sous Alpine. Ci-dessous, la version 1.25.2 de Nginx sur Alpine 3.18.</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> nginx<span class="token punctuation">:</span>1.25.2<span class="token punctuation">-</span>alpine3.18</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Puis on ajoute le bon fuseau horaire (utile pour l'horodatage des logs).</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">ENV</span> TZ=Europe/Paris</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>On copie le fichier de configuration de Nginx ("nginx.conf" pr√©sent dans le dossier "docker").</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">COPY</span> docker/nginx.conf /etc/nginx/nginx.conf</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>On check la syntaxe du fichier "nginx.conf" et on supprime le contenu r√©pertoire par d√©faut de Nginx.</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> nginx <span class="token punctuation">-</span>c /etc/nginx/nginx.conf <span class="token punctuation">-</span>t &amp;&amp; rm <span class="token punctuation">-</span>rf /usr/share/nginx/html/*</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Afin de le remplacer par le dossier de build que l'on va chercher dans le "builder". V√©rifier bien le chemin (sur Angular CLI, il n'y a pas de r√©pertoire "apps").</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=builder /ng<span class="token punctuation">-</span>app/dist/apps/myapp /usr/share/nginx/html</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Il nous manque la gestion de la s√©curit√©. Par d√©faut, l'utilisateur utilis√© est "root". Hors, si Docker est compromis, il faut donner moins de privil√®ges sur l'utilisateur courant du container.</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">RUN</span> chown <span class="token punctuation">-</span>R nginx<span class="token punctuation">:</span>nginx /usr/share/nginx/html &amp;&amp; chmod <span class="token punctuation">-</span>R 755 /usr/share/nginx/html &amp;&amp; \
    chown <span class="token punctuation">-</span>R nginx<span class="token punctuation">:</span>nginx /var/cache/nginx &amp;&amp; \
    chown <span class="token punctuation">-</span>R nginx<span class="token punctuation">:</span>nginx /var/log/nginx &amp;&amp; \
    chown <span class="token punctuation">-</span>R nginx<span class="token punctuation">:</span>nginx /etc/nginx/conf.d &amp;&amp; \
    touch /var/run/nginx.pid &amp;&amp; \
    chown <span class="token punctuation">-</span>R nginx<span class="token punctuation">:</span>nginx /var/run/nginx.pid
<span class="token keyword">USER</span> nginx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Dans notre cas, on utilise l'utilisateur "nginx".</p>
<h3>Dockerfile complet</h3>
<p>Ci-dessous le Dockerfile complet.</p>
<div class="gridsome-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> node<span class="token punctuation">:</span>20.5.1<span class="token punctuation">-</span>alpine3.18 as builder
<span class="token keyword">COPY</span> package.json package<span class="token punctuation">-</span>lock.json ./
<span class="token keyword">RUN</span> npm ci &amp;&amp; mkdir /ng<span class="token punctuation">-</span>app &amp;&amp; mv ./node_modules ./ng<span class="token punctuation">-</span>app
<span class="token keyword">WORKDIR</span> /ng<span class="token punctuation">-</span>app
<span class="token keyword">COPY</span> . .
<span class="token keyword">RUN</span> npm run myapp<span class="token punctuation">:</span>ci<span class="token punctuation">-</span>build

<span class="token keyword">FROM</span> nginx<span class="token punctuation">:</span>1.25.2<span class="token punctuation">-</span>alpine3.18
<span class="token keyword">ENV</span> TZ=Europe/Paris
<span class="token keyword">ENV</span> nginx_folder=/usr/share/nginx/html
<span class="token keyword">COPY</span> docker/nginx.conf /etc/nginx/nginx.conf
<span class="token keyword">RUN</span> nginx <span class="token punctuation">-</span>c /etc/nginx/nginx.conf <span class="token punctuation">-</span>t &amp;&amp; rm <span class="token punctuation">-</span>rf $nginx_folder/*
<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=builder /ng<span class="token punctuation">-</span>app/dist/apps/myapp $nginx_folder
<span class="token keyword">RUN</span> chown <span class="token punctuation">-</span>R nginx<span class="token punctuation">:</span>nginx $nginx_folder &amp;&amp; chmod <span class="token punctuation">-</span>R 755 $nginx_folder &amp;&amp; \
  chown <span class="token punctuation">-</span>R nginx<span class="token punctuation">:</span>nginx /var/cache/nginx &amp;&amp; \
  chown <span class="token punctuation">-</span>R nginx<span class="token punctuation">:</span>nginx /var/log/nginx &amp;&amp; \
  chown <span class="token punctuation">-</span>R nginx<span class="token punctuation">:</span>nginx /etc/nginx/conf.d &amp;&amp; \
  touch /var/run/nginx.pid &amp;&amp; \
  chown <span class="token punctuation">-</span>R nginx<span class="token punctuation">:</span>nginx /var/run/nginx.pid
<span class="token keyword">USER</span> nginx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Tester localement</h2>
<p>Avant d'envoyer directement en production, il est fortement recommand√© de v√©rifier que le container tourne bien en local.</p>
<h3>Cr√©ation de l'image</h3>
<p>On cr√©√© une image Docker que l'on nomme "mynodeimage" via le param√®tre <code class="language-text">-t</code> et qui va chercher le bon fichier via le param√®tre <code class="language-text">-f</code> dans le dossier "docker".</p>
<p><code class="language-text">docker build -t mynodeimage -f docker/myapp_build .</code></p>
<p>AÃÄ la premi√®re ex√©cution de cette commande, Docker va r√©cup√©rer les 2 images Alpine, cela peut prendre un certains temps.</p>
<h3>Cr√©ation du conteneur</h3>
<p>Par d√©faut, le port entrant de Nginx est le 80 (cot√© Docker). En sortie, on veut le port 1234.</p>
<p><code class="language-text">docker run -d -p 1234:80 --name my_container mynodeimage</code></p>
<p>On v√©rifie que le container s'est bien lanc√© (statut "up") et tourne sur le port 80 vers le port 1234.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker <span class="token function">ps</span>
372136f252e1   mynodeimage            <span class="token string">"/docker-entrypoint.‚Ä¶"</span>   <span class="token number">9</span> minutes ago   Up <span class="token number">9</span> minutes    <span class="token number">0.0</span>.0.0:1234-<span class="token operator">></span><span class="token number">80</span>/tcp, :::1234-<span class="token operator">></span><span class="token number">80</span>/tcp            my_container</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Et normalement, l'application est accessible sur <a href="http://localhost:1234" target="_blank" rel="nofollow noopener noreferrer">http://localhost:1234</a>.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">curl</span> -i http://localhost:1234
HTTP/1.1 <span class="token number">200</span> OK
Server: nginx/1.25.2
<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>On peut √©galement v√©rifier la pr√©sence des logs (avec le bon timezone).</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker logs -f my_container
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking <span class="token keyword">for</span> shell scripts <span class="token keyword">in</span> /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
<span class="token number">10</span>-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
<span class="token number">10</span>-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class="token keyword">in</span> /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete<span class="token punctuation">;</span> ready <span class="token keyword">for</span> start up
<span class="token number">172.17</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">24</span>/Aug/2023:15:24:37 +0200<span class="token punctuation">]</span> <span class="token string">"GET / HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">579</span> <span class="token string">"-"</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0"</span>
<span class="token number">172.17</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">24</span>/Aug/2023:15:24:37 +0200<span class="token punctuation">]</span> <span class="token string">"GET /styles.ef46db3751d8e999.css HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">0</span> <span class="token string">"http://localhost:1234/"</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0"</span>
<span class="token number">172.17</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">24</span>/Aug/2023:15:24:37 +0200<span class="token punctuation">]</span> <span class="token string">"GET /polyfills.f0c7e92599cba58e.js HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">33827</span> <span class="token string">"http://localhost:1234/"</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0"</span>
<span class="token number">172.17</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">24</span>/Aug/2023:15:24:37 +0200<span class="token punctuation">]</span> <span class="token string">"GET /main.c8da166aa81518c1.js HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">128722</span> <span class="token string">"http://localhost:1234/"</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0"</span>
<span class="token number">172.17</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">24</span>/Aug/2023:15:24:37 +0200<span class="token punctuation">]</span> <span class="token string">"GET /runtime.4a60012eff6e45d5.js HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">916</span> <span class="token string">"http://localhost:1234/"</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0"</span>
<span class="token number">172.17</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">24</span>/Aug/2023:15:24:37 +0200<span class="token punctuation">]</span> <span class="token string">"GET /favicon.ico HTTP/1.1"</span> <span class="token number">200</span> <span class="token number">948</span> <span class="token string">"http://localhost:1234/"</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Ainsi que de la taille de l'image.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker images
REPOSITORY                      TAG                    IMAGE ID       CREATED         SIZE
mynodeimage                     latest                 db844b2a8abb   <span class="token number">5</span> minutes ago   <span class="token number">42</span>.9MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Sans oublier l'utilisateur courant du container.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker <span class="token builtin class-name">exec</span> -it my_container ash
/ $ <span class="token function">whoami</span>
nginx
/ $ <span class="token function">id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">101</span><span class="token punctuation">(</span>nginx<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">101</span><span class="token punctuation">(</span>nginx<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">101</span><span class="token punctuation">(</span>nginx<span class="token punctuation">)</span>
/ $ <span class="token builtin class-name">exit</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Conclusion</h2>
<p>Avec un Dockerfile clair (versions sp√©cifiques des images utilis√©es), images l√©g√®res (Alpine), on arrive √† un container l√©ger et s√©curis√© (utilisateur non root). Bien entendu, selon vos pr√©f√©rences, vous pouvez utiliser un autre proxy que Nginx comme Apache ou Caddy.</p>
<h2>Sources</h2>
<ul>
<li>Calendrier des LTS de NodeJS : <a href="https://nodejs.org/en/about/releases" target="_blank" rel="nofollow noopener noreferrer">https://nodejs.org/en/about/releases</a> ;</li>
<li>Image NodeJS officielle : <a href="https://hub.docker.com/_/node" target="_blank" rel="nofollow noopener noreferrer">https://hub.docker.com/_/node</a> ;</li>
<li>Image Nginx officielle: <a href="https://hub.docker.com/_/nginx" target="_blank" rel="nofollow noopener noreferrer">https://hub.docker.com/_/nginx</a>.</li>
</ul>
</article></div></div></div></main><footer class="text-white mt-4"><ul class="nav nav-pills justify-content-center"><li><a href="https://github.com/etienner" target="_blank" rel="noopener" class="nav-link">Github</a></li><li><a href="https://medium.com/@etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Medium</a></li><li><a href="https://twitter.com/etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Twitter</a></li></ul></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"Dockeriser son application Angular avec Nginx en multi-stage","date":"31 August 2023","content":"\u003Ch2\u003EIntroduction\u003C\u002Fh2\u003E\n\u003Cp\u003EArrive le moment o√π vous devez d√©ployer votre application Angular sur Docker. Pour ce faire, on va d√©composer notre Dockerfile en 2 parties. La premi√®re partie va comprendre la g√©n√©ration de l'application et la seconde partie, un serveur Nginx avec un fichier de configuration associ√© et le dossier de build de l'application.\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003ECette notion de d√©coupage sur Docker se nomme le \u003Cstrong\u003Emulti-stage\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003ENB : il ne s'agit pas d'un environnement de d√©veloppement mais bien d'un environnement de production.\u003C\u002Fp\u003E\n\u003Ch2\u003EPr√©requis\u003C\u002Fh2\u003E\n\u003Cp\u003EPour concevoir une image Docker, il faut comprendre comment fonctionne le build d'une application sur Angular et r√©diger un fichier de configuration Nginx Concernant Angular, l'application est g√©n√©r√©e √† la racine du projet dans un r√©pertoire \"dist\".\u003C\u002Fp\u003E\n\u003Ch3\u003EScript d'ex√©cution\u003C\u002Fh3\u003E\n\u003Cp\u003EDans le fichier \"package.json\", assurez-vous d'avoir la pr√©sence d'une commande dans la partie \"scripts\". Par exemple sur Angular CLI \u003Ccode class=\"language-text\"\u003Enpm run build\u003C\u002Fcode\u003E ou sur Nx \u003Ccode class=\"language-text\"\u003E&quot;myapp:ci-build&quot;: &quot;nx build myapp&quot;\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Ch3\u003EScript de configuration Nginx\u003C\u002Fh3\u003E\n\u003Cp\u003EOn a besoin de mettre en place un fichier de configuration Nginx. AÃÄ la racine de votre projet Angular ou Nx, cr√©ez un nouveau dossier que vous nommez \"docker\" avec un fichier \"nginx.conf\" basique avec le contenu ci-dessous.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"nginxconf\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-nginxconf line-numbers\"\u003E\u003Ccode class=\"language-nginxconf\"\u003Eevents { }\nhttp {\n  include \u002Fetc\u002Fnginx\u002Fmime.types;\n  server {\n    client_max_body_size 50M;\n    listen 80 default_server;\n    listen [::]:80 default_server;\n    root \u002Fusr\u002Fshare\u002Fnginx\u002Fhtml;\n    server_name _;\n    index index.html;\n\n    location \u002F {\n      try_files $uri $uri\u002F \u002Findex.html;\n    }\n  }\n}\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Ch2\u003ECr√©ation du Dockerfile\u003C\u002Fh2\u003E\n\u003Cp\u003EToujours dans le dossier \"docker\" cr√©ez un fichier \"myapp_build\".\u003C\u002Fp\u003E\n\u003Ch3\u003EBuild de l'application\u003C\u002Fh3\u003E\n\u003Cp\u003EPour la premi√®re partie de ce Dockerfile, on a besoin d'une image de NodeJS. On va donc partir sur une image l√©g√®re de la distribution Linux Alpine. De pr√©f√©rence une version LTS (Long Term Support) de NodeJS, c'est-√†-dire une version paire (exemple: 16, 18, 20, etc...). Ci-dessous, on utilise la version de NodeJS 20.5.1 de Alpine 3.18.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003EFROM\u003C\u002Fspan\u003E node\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E20.5.1\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Ealpine3.18 as builder\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EEnsuite, on souhaite copier le contenu des fichiers \"package.json\" et \"package-lock.json\" √† la racine du container.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003ECOPY\u003C\u002Fspan\u003E package.json package\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Elock.json .\u002F\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EAinsi, on peut √©xecuter la commande d'installation des paquets d√©di√©es (et non \u003Ccode class=\"language-text\"\u003Enpm install\u003C\u002Fcode\u003E).\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003ERUN\u003C\u002Fspan\u003E npm ci &amp;&amp; mkdir \u002Fng\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Eapp &amp;&amp; mv .\u002Fnode_modules .\u002Fng\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Eapp\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EEt d√©placer le dossier \"node_modules\" dans un nouveau dossier \"ng-app\" que l'on d√©finit comme le dossier d'entr√©e.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003EWORKDIR\u003C\u002Fspan\u003E \u002Fng\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Eapp\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EPuis on copie le contenu du dossier d'entr√©e (\"ng-app\") √† la racine du container.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003ECOPY\u003C\u002Fspan\u003E . .\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EEt on construit l'application avec la commande sp√©cifi√©e dans le fichier \"package.json\".\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003ERUN\u003C\u002Fspan\u003E npm run myapp\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Eci\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Ebuild\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Ch3\u003EServeur de l'application\u003C\u002Fh3\u003E\n\u003Cp\u003EAÃÄ la suite du Dockerfile, on passe √† l'√©tape du serveur avec Nginx. On part donc sur image Nginx officielle sous Alpine. Ci-dessous, la version 1.25.2 de Nginx sur Alpine 3.18.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003EFROM\u003C\u002Fspan\u003E nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E1.25.2\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Ealpine3.18\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EPuis on ajoute le bon fuseau horaire (utile pour l'horodatage des logs).\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003EENV\u003C\u002Fspan\u003E TZ=Europe\u002FParis\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EOn copie le fichier de configuration de Nginx (\"nginx.conf\" pr√©sent dans le dossier \"docker\").\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003ECOPY\u003C\u002Fspan\u003E docker\u002Fnginx.conf \u002Fetc\u002Fnginx\u002Fnginx.conf\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EOn check la syntaxe du fichier \"nginx.conf\" et on supprime le contenu r√©pertoire par d√©faut de Nginx.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003ERUN\u003C\u002Fspan\u003E nginx \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Ec \u002Fetc\u002Fnginx\u002Fnginx.conf \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Et &amp;&amp; rm \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Erf \u002Fusr\u002Fshare\u002Fnginx\u002Fhtml\u002F*\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EAfin de le remplacer par le dossier de build que l'on va chercher dans le \"builder\". V√©rifier bien le chemin (sur Angular CLI, il n'y a pas de r√©pertoire \"apps\").\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003ECOPY\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Efrom=builder \u002Fng\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Eapp\u002Fdist\u002Fapps\u002Fmyapp \u002Fusr\u002Fshare\u002Fnginx\u002Fhtml\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EIl nous manque la gestion de la s√©curit√©. Par d√©faut, l'utilisateur utilis√© est \"root\". Hors, si Docker est compromis, il faut donner moins de privil√®ges sur l'utilisateur courant du container.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003ERUN\u003C\u002Fspan\u003E chown \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Enginx \u002Fusr\u002Fshare\u002Fnginx\u002Fhtml &amp;&amp; chmod \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER 755 \u002Fusr\u002Fshare\u002Fnginx\u002Fhtml &amp;&amp; \\\n    chown \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Enginx \u002Fvar\u002Fcache\u002Fnginx &amp;&amp; \\\n    chown \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Enginx \u002Fvar\u002Flog\u002Fnginx &amp;&amp; \\\n    chown \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Enginx \u002Fetc\u002Fnginx\u002Fconf.d &amp;&amp; \\\n    touch \u002Fvar\u002Frun\u002Fnginx.pid &amp;&amp; \\\n    chown \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Enginx \u002Fvar\u002Frun\u002Fnginx.pid\n\u003Cspan class=\"token keyword\"\u003EUSER\u003C\u002Fspan\u003E nginx\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EDans notre cas, on utilise l'utilisateur \"nginx\".\u003C\u002Fp\u003E\n\u003Ch3\u003EDockerfile complet\u003C\u002Fh3\u003E\n\u003Cp\u003ECi-dessous le Dockerfile complet.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"dockerfile\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"\u003E\u003Ccode class=\"language-dockerfile\"\u003E\u003Cspan class=\"token keyword\"\u003EFROM\u003C\u002Fspan\u003E node\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E20.5.1\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Ealpine3.18 as builder\n\u003Cspan class=\"token keyword\"\u003ECOPY\u003C\u002Fspan\u003E package.json package\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Elock.json .\u002F\n\u003Cspan class=\"token keyword\"\u003ERUN\u003C\u002Fspan\u003E npm ci &amp;&amp; mkdir \u002Fng\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Eapp &amp;&amp; mv .\u002Fnode_modules .\u002Fng\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Eapp\n\u003Cspan class=\"token keyword\"\u003EWORKDIR\u003C\u002Fspan\u003E \u002Fng\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Eapp\n\u003Cspan class=\"token keyword\"\u003ECOPY\u003C\u002Fspan\u003E . .\n\u003Cspan class=\"token keyword\"\u003ERUN\u003C\u002Fspan\u003E npm run myapp\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Eci\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Ebuild\n\n\u003Cspan class=\"token keyword\"\u003EFROM\u003C\u002Fspan\u003E nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E1.25.2\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Ealpine3.18\n\u003Cspan class=\"token keyword\"\u003EENV\u003C\u002Fspan\u003E TZ=Europe\u002FParis\n\u003Cspan class=\"token keyword\"\u003EENV\u003C\u002Fspan\u003E nginx_folder=\u002Fusr\u002Fshare\u002Fnginx\u002Fhtml\n\u003Cspan class=\"token keyword\"\u003ECOPY\u003C\u002Fspan\u003E docker\u002Fnginx.conf \u002Fetc\u002Fnginx\u002Fnginx.conf\n\u003Cspan class=\"token keyword\"\u003ERUN\u003C\u002Fspan\u003E nginx \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Ec \u002Fetc\u002Fnginx\u002Fnginx.conf \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Et &amp;&amp; rm \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Erf $nginx_folder\u002F*\n\u003Cspan class=\"token keyword\"\u003ECOPY\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Efrom=builder \u002Fng\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Eapp\u002Fdist\u002Fapps\u002Fmyapp $nginx_folder\n\u003Cspan class=\"token keyword\"\u003ERUN\u003C\u002Fspan\u003E chown \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Enginx $nginx_folder &amp;&amp; chmod \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER 755 $nginx_folder &amp;&amp; \\\n  chown \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Enginx \u002Fvar\u002Fcache\u002Fnginx &amp;&amp; \\\n  chown \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Enginx \u002Fvar\u002Flog\u002Fnginx &amp;&amp; \\\n  chown \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Enginx \u002Fetc\u002Fnginx\u002Fconf.d &amp;&amp; \\\n  touch \u002Fvar\u002Frun\u002Fnginx.pid &amp;&amp; \\\n  chown \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003ER nginx\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Enginx \u002Fvar\u002Frun\u002Fnginx.pid\n\u003Cspan class=\"token keyword\"\u003EUSER\u003C\u002Fspan\u003E nginx\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Ch2\u003ETester localement\u003C\u002Fh2\u003E\n\u003Cp\u003EAvant d'envoyer directement en production, il est fortement recommand√© de v√©rifier que le container tourne bien en local.\u003C\u002Fp\u003E\n\u003Ch3\u003ECr√©ation de l'image\u003C\u002Fh3\u003E\n\u003Cp\u003EOn cr√©√© une image Docker que l'on nomme \"mynodeimage\" via le param√®tre \u003Ccode class=\"language-text\"\u003E-t\u003C\u002Fcode\u003E et qui va chercher le bon fichier via le param√®tre \u003Ccode class=\"language-text\"\u003E-f\u003C\u002Fcode\u003E dans le dossier \"docker\".\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode class=\"language-text\"\u003Edocker build -t mynodeimage -f docker\u002Fmyapp_build .\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EAÃÄ la premi√®re ex√©cution de cette commande, Docker va r√©cup√©rer les 2 images Alpine, cela peut prendre un certains temps.\u003C\u002Fp\u003E\n\u003Ch3\u003ECr√©ation du conteneur\u003C\u002Fh3\u003E\n\u003Cp\u003EPar d√©faut, le port entrant de Nginx est le 80 (cot√© Docker). En sortie, on veut le port 1234.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode class=\"language-text\"\u003Edocker run -d -p 1234:80 --name my_container mynodeimage\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EOn v√©rifie que le container s'est bien lanc√© (statut \"up\") et tourne sur le port 80 vers le port 1234.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"bash\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"\u003E\u003Ccode class=\"language-bash\"\u003Edocker \u003Cspan class=\"token function\"\u003Eps\u003C\u002Fspan\u003E\n372136f252e1   mynodeimage            \u003Cspan class=\"token string\"\u003E\"\u002Fdocker-entrypoint.‚Ä¶\"\u003C\u002Fspan\u003E   \u003Cspan class=\"token number\"\u003E9\u003C\u002Fspan\u003E minutes ago   Up \u003Cspan class=\"token number\"\u003E9\u003C\u002Fspan\u003E minutes    \u003Cspan class=\"token number\"\u003E0.0\u003C\u002Fspan\u003E.0.0:1234-\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E80\u003C\u002Fspan\u003E\u002Ftcp, :::1234-\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E80\u003C\u002Fspan\u003E\u002Ftcp            my_container\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EEt normalement, l'application est accessible sur \u003Ca href=\"http:\u002F\u002Flocalhost:1234\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttp:\u002F\u002Flocalhost:1234\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"bash\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"\u003E\u003Ccode class=\"language-bash\"\u003E\u003Cspan class=\"token function\"\u003Ecurl\u003C\u002Fspan\u003E -i http:\u002F\u002Flocalhost:1234\nHTTP\u002F1.1 \u003Cspan class=\"token number\"\u003E200\u003C\u002Fspan\u003E OK\nServer: nginx\u002F1.25.2\n\u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E..\u003C\u002Fspan\u003E.\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EOn peut √©galement v√©rifier la pr√©sence des logs (avec le bon timezone).\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"bash\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"\u003E\u003Ccode class=\"language-bash\"\u003Edocker logs -f my_container\n\u002Fdocker-entrypoint.sh: \u002Fdocker-entrypoint.d\u002F is not empty, will attempt to perform configuration\n\u002Fdocker-entrypoint.sh: Looking \u003Cspan class=\"token keyword\"\u003Efor\u003C\u002Fspan\u003E shell scripts \u003Cspan class=\"token keyword\"\u003Ein\u003C\u002Fspan\u003E \u002Fdocker-entrypoint.d\u002F\n\u002Fdocker-entrypoint.sh: Launching \u002Fdocker-entrypoint.d\u002F10-listen-on-ipv6-by-default.sh\n\u003Cspan class=\"token number\"\u003E10\u003C\u002Fspan\u003E-listen-on-ipv6-by-default.sh: info: Getting the checksum of \u002Fetc\u002Fnginx\u002Fconf.d\u002Fdefault.conf\n\u003Cspan class=\"token number\"\u003E10\u003C\u002Fspan\u003E-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 \u003Cspan class=\"token keyword\"\u003Ein\u003C\u002Fspan\u003E \u002Fetc\u002Fnginx\u002Fconf.d\u002Fdefault.conf\n\u002Fdocker-entrypoint.sh: Sourcing \u002Fdocker-entrypoint.d\u002F15-local-resolvers.envsh\n\u002Fdocker-entrypoint.sh: Launching \u002Fdocker-entrypoint.d\u002F20-envsubst-on-templates.sh\n\u002Fdocker-entrypoint.sh: Launching \u002Fdocker-entrypoint.d\u002F30-tune-worker-processes.sh\n\u002Fdocker-entrypoint.sh: Configuration complete\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E ready \u003Cspan class=\"token keyword\"\u003Efor\u003C\u002Fspan\u003E start up\n\u003Cspan class=\"token number\"\u003E172.17\u003C\u002Fspan\u003E.0.1 - - \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E24\u003C\u002Fspan\u003E\u002FAug\u002F2023:15:24:37 +0200\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"GET \u002F HTTP\u002F1.1\"\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E200\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E579\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"-\"\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko\u002F20100101 Firefox\u002F116.0\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"token number\"\u003E172.17\u003C\u002Fspan\u003E.0.1 - - \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E24\u003C\u002Fspan\u003E\u002FAug\u002F2023:15:24:37 +0200\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"GET \u002Fstyles.ef46db3751d8e999.css HTTP\u002F1.1\"\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E200\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"http:\u002F\u002Flocalhost:1234\u002F\"\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko\u002F20100101 Firefox\u002F116.0\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"token number\"\u003E172.17\u003C\u002Fspan\u003E.0.1 - - \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E24\u003C\u002Fspan\u003E\u002FAug\u002F2023:15:24:37 +0200\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"GET \u002Fpolyfills.f0c7e92599cba58e.js HTTP\u002F1.1\"\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E200\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E33827\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"http:\u002F\u002Flocalhost:1234\u002F\"\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko\u002F20100101 Firefox\u002F116.0\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"token number\"\u003E172.17\u003C\u002Fspan\u003E.0.1 - - \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E24\u003C\u002Fspan\u003E\u002FAug\u002F2023:15:24:37 +0200\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"GET \u002Fmain.c8da166aa81518c1.js HTTP\u002F1.1\"\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E200\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E128722\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"http:\u002F\u002Flocalhost:1234\u002F\"\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko\u002F20100101 Firefox\u002F116.0\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"token number\"\u003E172.17\u003C\u002Fspan\u003E.0.1 - - \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E24\u003C\u002Fspan\u003E\u002FAug\u002F2023:15:24:37 +0200\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"GET \u002Fruntime.4a60012eff6e45d5.js HTTP\u002F1.1\"\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E200\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E916\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"http:\u002F\u002Flocalhost:1234\u002F\"\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko\u002F20100101 Firefox\u002F116.0\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"token number\"\u003E172.17\u003C\u002Fspan\u003E.0.1 - - \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E24\u003C\u002Fspan\u003E\u002FAug\u002F2023:15:24:37 +0200\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"GET \u002Ffavicon.ico HTTP\u002F1.1\"\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E200\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E948\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"http:\u002F\u002Flocalhost:1234\u002F\"\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko\u002F20100101 Firefox\u002F116.0\"\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EAinsi que de la taille de l'image.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"bash\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"\u003E\u003Ccode class=\"language-bash\"\u003Edocker images\nREPOSITORY                      TAG                    IMAGE ID       CREATED         SIZE\nmynodeimage                     latest                 db844b2a8abb   \u003Cspan class=\"token number\"\u003E5\u003C\u002Fspan\u003E minutes ago   \u003Cspan class=\"token number\"\u003E42\u003C\u002Fspan\u003E.9MB\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003ESans oublier l'utilisateur courant du container.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"bash\"\u003E\u003Cpre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"\u003E\u003Ccode class=\"language-bash\"\u003Edocker \u003Cspan class=\"token builtin class-name\"\u003Eexec\u003C\u002Fspan\u003E -it my_container ash\n\u002F $ \u003Cspan class=\"token function\"\u003Ewhoami\u003C\u002Fspan\u003E\nnginx\n\u002F $ \u003Cspan class=\"token function\"\u003Eid\u003C\u002Fspan\u003E\n\u003Cspan class=\"token assign-left variable\"\u003Euid\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E101\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Enginx\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token assign-left variable\"\u003Egid\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E101\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Enginx\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token assign-left variable\"\u003Egroups\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E101\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Enginx\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n\u002F $ \u003Cspan class=\"token builtin class-name\"\u003Eexit\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003Cspan aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003Cspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Ch2\u003EConclusion\u003C\u002Fh2\u003E\n\u003Cp\u003EAvec un Dockerfile clair (versions sp√©cifiques des images utilis√©es), images l√©g√®res (Alpine), on arrive √† un container l√©ger et s√©curis√© (utilisateur non root). Bien entendu, selon vos pr√©f√©rences, vous pouvez utiliser un autre proxy que Nginx comme Apache ou Caddy.\u003C\u002Fp\u003E\n\u003Ch2\u003ESources\u003C\u002Fh2\u003E\n\u003Cul\u003E\n\u003Cli\u003ECalendrier des LTS de NodeJS : \u003Ca href=\"https:\u002F\u002Fnodejs.org\u002Fen\u002Fabout\u002Freleases\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fnodejs.org\u002Fen\u002Fabout\u002Freleases\u003C\u002Fa\u003E ;\u003C\u002Fli\u003E\n\u003Cli\u003EImage NodeJS officielle : \u003Ca href=\"https:\u002F\u002Fhub.docker.com\u002F_\u002Fnode\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fhub.docker.com\u002F_\u002Fnode\u003C\u002Fa\u003E ;\u003C\u002Fli\u003E\n\u003Cli\u003EImage Nginx officielle: \u003Ca href=\"https:\u002F\u002Fhub.docker.com\u002F_\u002Fnginx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fhub.docker.com\u002F_\u002Fnginx\u003C\u002Fa\u003E.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n","download":"","tags":[{"title":"Docker","path":"\u002Ftag\u002FDocker\u002F"},{"title":"Angular","path":"\u002Ftag\u002FAngular\u002F"},{"title":"Nginx","path":"\u002Ftag\u002FNginx\u002F"}],"timeToRead":7,"parts":[]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.50d8a5ce.js" defer></script><script src="/assets/js/page--src-templates-post-vue.56e5bc07.js" defer></script>
  </body>
</html>
