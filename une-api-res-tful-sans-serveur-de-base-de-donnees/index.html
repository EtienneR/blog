<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Une API RESTful sans serveur de base de données - https://etienner.github.io</title><meta name="gridsome:hash" content="f62c6c6cc572da4535ce1c5d24fae4305ad17d6a"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.11"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="description" content="Créer une API RESTful en PHP c&#x27;est tout à fait possible. Pour cela on utilise traditionnellement une base de donnée en SQL comme MySQL ou MariaDB ou en NoSQL avec MongoDB, Redis... Mais utiliser les données"><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="Une API RESTful sans serveur de base de données"><meta data-vue-tag="ssr" property="og:description" content="Créer une API RESTful en PHP c&#x27;est tout à fait possible. Pour cela on utilise traditionnellement une base de donnée en SQL comme MySQL ou MariaDB ou en NoSQL avec MongoDB, Redis... Mais utiliser les données"><meta data-vue-tag="ssr" property="og:url" content="https://etienner.github.io/une-api-res-tful-sans-serveur-de-base-de-donnees/"><meta data-vue-tag="ssr" name="twitter:domain" content="https://etienner.github.io"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="Une API RESTful sans serveur de base de données"><meta data-vue-tag="ssr" name="twitter:description" content="Créer une API RESTful en PHP c&#x27;est tout à fait possible. Pour cela on utilise traditionnellement une base de donnée en SQL comme MySQL ou MariaDB ou en NoSQL avec MongoDB, Redis... Mais utiliser les données"><meta data-vue-tag="ssr" name="twitter:site" content="@etiennerouzeaud"><meta data-vue-tag="ssr" name="twitter:creator" content="@etiennerouzeaud"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.dd5ac703.css" as="style"><link rel="preload" href="/assets/js/app.8edfcdd1.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.5669e3ec.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules-gridsome-app-pages-404-vue.0043f220.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.bb47b8d4.js"><link rel="stylesheet" href="/assets/css/0.styles.dd5ac703.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app"><header><div class="container text-center"><strong><a href="/" title="Accueil" class="active">Etienne ROUZEAUD - Développeur Web</a></strong></div></header><div class="title"><h1 class="display-4 text-center">Une API RESTful sans serveur de base de données</h1></div><div class="container"><div class="row"><div class="mt-4 col-lg-2"><p><em><span>14 mars 2016</span></em></p></div><article class="mt-4 col-lg-10"><p>Créer une API RESTful en PHP c'est tout à fait possible. Pour cela on utilise traditionnellement une base de donnée en SQL comme MySQL ou MariaDB ou en NoSQL avec MongoDB, Redis... Mais utiliser les données directement dans un fichier JSON est également possible. En partant du principe que les données sont stockées dans un tableau, il est tout à fait possible de manipuler ce dernier par la suite.</p>
<p><img src="https://media.giphy.com/media/8FNlmNPDTo2wE/giphy.gif"></p>
<p>Ci-dessous, le contenu du fichier "db.json".</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Interstellar"</span><span class="token punctuation">,</span>
        <span class="token string">"releaseYear"</span> <span class="token punctuation">:</span> <span class="token number">2014</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"The Revenant"</span><span class="token punctuation">,</span>
        <span class="token string">"releaseYear"</span><span class="token punctuation">:</span> <span class="token number">2016</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Snowpiercer"</span><span class="token punctuation">,</span>
        <span class="token string">"releaseYear"</span><span class="token punctuation">:</span> <span class="token number">2013</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"The Host"</span><span class="token punctuation">,</span>
        <span class="token string">"releaseYear"</span><span class="token punctuation">:</span> <span class="token number">2006</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Sicario"</span><span class="token punctuation">,</span>
        <span class="token string">"releaseYear"</span><span class="token punctuation">:</span> <span class="token number">2015</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>Coté serveur, on va mettre en place un design pattern ("patron de conception") de type singleton. Concrètement, on instancie l'ouverture du fichier JSON dans le constructeur de notre classe. On évite ainsi de l'appeler dans les 4 fonctions destinées au CRUD (Create Read, Update, Delete) :</p>
<ul>
<li><code class="language-text">FetchAll</code> : récupère toutes les lignes sous forme d'un tableau ;</li>
<li><code class="language-text">FetchOne</code> : récupère une ligne en particulier ;</li>
<li><code class="language-text">Create</code> : créé une nouvelle ligne ;</li>
<li><code class="language-text">Update</code> : modifie une ligne en fonction de l'id ;</li>
<li><code class="language-text">Delete</code> : supprime une ligne en fonction de l'id.</li>
</ul>
<h2 id="préparation-de-la-classe"><a href="#pr%C3%A9paration-de-la-classe" aria-hidden="true"><span class="icon icon-link"></span></a>Préparation de la classe</h2>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name">Api</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$file_json</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'db.json'</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Ouverture du fichier</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">json</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file_json</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tableau des données en PHP</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span>  <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">json</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Affichage des messages / données JSON</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">Display</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
       <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token constant">JSON_UNESCAPED_UNICODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Modification du fichier JSON</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file_json</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Id du tableau PHP</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$id</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Nos futures fonctions destinées au CRUD</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Dans le constructeur, on instancie 2 variables :</p>
<ul>
<li><code class="language-text">$this-&gt;json</code> : ouverture du fichier JSON avec <code class="language-text">file_get_contents()</code> ;</li>
<li><code class="language-text">$this-&gt;get</code> : décode le JSON avec <code class="language-text">json_decode()</code> sous la forme d'un tableau.</li>
</ul>
<p>Puis on prépare 2 fonctions privées :</p>
<ul>
<li><code class="language-text">Display()</code> afficher des messages / données au format JSON avec <code class="language-text">json_encode()</code> ;</li>
<li><code class="language-text">Set()</code> modifier le fichier JSON avec <code class="language-text">file_put_contents()</code> ;</li>
<li><code class="language-text">CurrentRow()</code> l'id du tableau PHP (et non JSON) qui commence à partir de 0 (et non 1).</li>
</ul>
<h3 id="toutes-les-données"><a href="#toutes-les-donn%C3%A9es" aria-hidden="true"><span class="icon icon-link"></span></a>Toutes les données</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Lecture de tous le tableau JSON</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">FetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Récupération du tableau de données</span>
        <span class="token variable">$rows</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token variable">$rows</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Dans la première fonction publique <code class="language-text">FetchAll()</code>, on récupère toutes les données présentes dans le fichier JSON que l'on affiche sous la forme d'un tableau.</p>
<h3 id="une-seule-ligne"><a href="#une-seule-ligne" aria-hidden="true"><span class="icon icon-link"></span></a>Une seule ligne</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Lecture d'une ligne à partir de son "id"</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">FetchOne</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Récupération du tableau de données</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>

    <span class="token comment">// Vérification de l'existence de la ligne</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"the row #<span class="token interpolation"><span class="token variable">$id</span></span> doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 404 Not Found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Avec comme paramètre dans la fonction <code class="language-text">FetchOne()</code>, l'id d'une ligne, on récupère la ligne correspondante. Si elle n'existe pas, on affiche un message d'erreur.</p>
<h3 id="création-dune-ligne"><a href="#cr%C3%A9ation-dune-ligne" aria-hidden="true"><span class="icon icon-link"></span></a>Création d'une ligne</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Création d'une nouvelle ligne </span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token variable">$data_input</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Récupération du tableau de données</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>
        <span class="token comment">// Ajout d'un nouveau champ id</span>
        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Fusion des données dans cette nouvelle ligne</span>
        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$datas_input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Ajout de la nouvelle ligne dans le tableau général</span>
        <span class="token variable">$all_data</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Modification du fichier JSON</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$all_data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Message de succès</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span><span class="token double-quoted-string string">"posted new row "</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"data"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 201 Created"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Dans la fonction <code class="language-text">Create()</code>, on passe en paramètre les données à ajouter sous forme d'un tableau. Dans un premier temps, on récupère toutes les données présentes dans le fichier JSON. On adjoint dans ce tableau une nouvelle ligne dans laquelle on fusionne les données ajoutées en paramètre avec un nouvel id. Puis on sauvegarde ce nouveau tableau avec <code class="language-text">$this-&gt;Set()</code>.</p>
<h3 id="modification-dune-ligne"><a href="#modification-dune-ligne" aria-hidden="true"><span class="icon icon-link"></span></a>Modification d'une ligne</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Modification d'une ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$data_input</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Récupération du tableau de données</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>

    <span class="token comment">// Vérification de l'existence de la ligne</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// MAJ de la ligne concernée</span>
        <span class="token variable">$update</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Vérification de modification</span>
        <span class="token variable">$diff</span>   <span class="token operator">=</span> <span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token variable">$update</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$diff</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"warning"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"no change"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Remplacement de la ligne</span>
            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$update</span><span class="token punctuation">;</span>
            <span class="token comment">// Modification du fichier JSON</span>
            <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"row updated"</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"data"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$update</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"the row #<span class="token interpolation"><span class="token variable">$id</span></span> doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 404 Not Found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Pour modifier une ligne, dans la fonction <code class="language-text">Update()</code> on récupère toutes les données du fichier JSON. On vérifie que la ligne concernée existe. Puis comme pour créer une nouvelle ligne, on fusionne avec l'id, les données à modifier spécifiées en paramètre. On en profite également pour vérifier que ces dernières sont bien différentes que celles déja existantes. Si c'est le cas, alors on met à jour le fichier JSON avec la ligne modifiée.</p>
<h3 id="suppression-dune-ligne"><a href="#suppression-dune-ligne" aria-hidden="true"><span class="icon icon-link"></span></a>Suppression d'une ligne</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Suppression d'une ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Récupération du tableau de données</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>

    <span class="token comment">// Vérification de l'existence de la ligne</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Suppression de la ligne concernée dans le tableau</span>
        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Modification du fichier JSON</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"row #<span class="token interpolation"><span class="token variable">$id</span></span> deleted"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"the row #<span class="token interpolation"><span class="token variable">$id</span></span> doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 404 Not Found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Pour supprimer une ligne, dans la fonction <code class="language-text">Delete()</code> on récupère toutes les données du tableau. On vérifie que la ligne existe bien pour la supprimer et modifier le fichier JSON avec le tableau modifié.</p>
<h2 id="test"><a href="#test" aria-hidden="true"><span class="icon icon-link"></span></a>Test</h2>
<p>Dans le même fichier, après la fermeture de la classe, on appel cette dernière dans une variable.</p>
<pre class="language-php"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Content-Type: application/json; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Appel de la classe "Api"</span>
<span class="token variable">$api</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Api</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Puis, on peut afficher toutes les données.</p>
<pre class="language-php"><code class="language-php"><span class="token variable">$api</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">FetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Afficher uniquement la ligne ayant l'id 4.</p>
<pre class="language-php"><code class="language-php"><span class="token variable">$api</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">FetchOne</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Créer une nouvelle ligne.</p>
<pre class="language-php"><code class="language-php"><span class="token variable">$api</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'Prisonners'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'releaseYear'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2012</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Modifier la ligne ayant l'id 6.</p>
<pre class="language-php"><code class="language-php"><span class="token variable">$api</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'Prisoners'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'releaseYear'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2013</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Supprimer la ligne ayant l'id 6.</p>
<pre class="language-php"><code class="language-php"><span class="token variable">$api</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="refactoring"><a href="#refactoring" aria-hidden="true"><span class="icon icon-link"></span></a>Refactoring</h2>
<p>Dans notre classe, on met en place 2 fonctions privées pour alléger nos 3 dernières fonctions publiques :</p>
<ul>
<li><code class="language-text">CheckFound()</code> : vérifier que la ligne existe ;</li>
<li><code class="language-text">CheckData()</code> : verifier qu'il y a bien des données fournies en paramètre.</li>
</ul>
<h3 id="gestion-des-erreurs-404"><a href="#gestion-des-erreurs-404" aria-hidden="true"><span class="icon icon-link"></span></a>Gestion des erreurs 404</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Vérification de l'existence de la ligne</span>
<span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">CheckFound</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Récupération du tableau de données</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"the row #<span class="token interpolation"><span class="token variable">$id</span></span> doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 404 Not Found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Si la ligne n'existe pas, on affiche une erreur de type 404.</p>
<h3 id="gestion-des-données-manquantes"><a href="#gestion-des-donn%C3%A9es-manquantes" aria-hidden="true"><span class="icon icon-link"></span></a>Gestion des données manquantes</h3>
<pre class="language-php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">CheckData</span><span class="token punctuation">(</span><span class="token variable">$data_input</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"missing data"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 400 Bad Request"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Si le paramètre <code class="language-text">$data_input</code> est vide, on affiche une erreur de type 400.</p>
<h3 id="réécritures-des-fonctions-crud-concernées"><a href="#r%C3%A9%C3%A9critures-des-fonctions-crud-concern%C3%A9es" aria-hidden="true"><span class="icon icon-link"></span></a>Réécritures des fonctions CRUD concernées</h3>
<p>On peut ainsi réécrire les fonctions <code class="language-text">FetchOne()</code>, <code class="language-text">Create()</code>, <code class="language-text">Update()</code> et <code class="language-text">Delete()</code>.</p>
<pre class="language-php"><code class="language-php"><span class="token comment">// Lecture d'une ligne à partir de son "id"</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">FetchOne</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CheckFound</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Récupération du tableau de données</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Création d'une nouvelle ligne </span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token variable">$data_input</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CheckData</span><span class="token punctuation">(</span><span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Récupération du tableau de données</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>
        <span class="token comment">// Ajout d'un nouveau champ id</span>
        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Fusion des données dans cette nouvelle ligne</span>
        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Ajout de la nouvelle ligne dans le tableau général</span>
        <span class="token variable">$all_data</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Modification du fichier JSON</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$all_data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Message de succès</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"posted new row "</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"data"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 201 Created"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Modification d'une ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$data_input</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Vérification de l'existence de la ligne</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CheckFound</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CheckData</span><span class="token punctuation">(</span><span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Récupération du tableau de données</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>
        <span class="token comment">// MAJ de la ligne concernée</span>
        <span class="token variable">$update</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Vérification de modification</span>
        <span class="token variable">$diff</span>   <span class="token operator">=</span> <span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token variable">$update</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$diff</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"warning"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"no change"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Remplacement de la ligne</span>
            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$update</span><span class="token punctuation">;</span>
            <span class="token comment">// Modification du fichier JSON</span>
            <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"row updated"</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"data"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$update</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Suppression d'une ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Vérification de l'existence de la ligne</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CheckFound</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Récupération du tableau de données</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>
        <span class="token comment">// Suppression de la ligne concernée dans le tableau</span>
        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Modification du fichier JSON</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"row #<span class="token interpolation"><span class="token variable">$id</span></span> deleted"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="conclusion"><a href="#conclusion" aria-hidden="true"><span class="icon icon-link"></span></a>Conclusion</h2>
<p>Avec des conditions, des boucles et des fonctions natives de manipulation de tableau, il est finalement simple de mettre en place une classe pour manipuler une API en JSON sans serveur de base de données derière. D'autant plus qu'il est possible par la suite, d'imaginer la mise en place dans cette même classe d'un contrôle sur la structure de l'API (type de champ, champ obligatoire, unicité d'un champ, etc...).</p>
</article></div></div><footer class="text-white mt-4"><ul class="nav nav-pills justify-content-center"><li><a href="https://github.com/etienner" target="_blank" class="nav-link">Github</a></li><li><a href="https://medium.com/@etiennerouzeaud" target="_blank" class="nav-link">Medium</a></li><li><a href="https://twitter.com/etiennerouzeaud" target="_blank" class="nav-link">Twitter</a></li></ul></footer></div>
    <script src="/assets/js/app.8edfcdd1.js" defer></script><script src="/assets/js/page--src-templates-post-vue.5669e3ec.js" defer></script>
  </body>
</html>
