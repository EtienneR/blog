<!DOCTYPE html>
<html data-html-server-rendered="true" lang="fr" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22fr%22%7D%7D">
  <head>
    <title>Une API RESTful sans serveur de base de donn√©es - https://etienner.github.io</title><meta name="gridsome:hash" content="e9e710b63b02d049a9f8a5359c5c22618737fe2f"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="description" content="Cr√©er une API RESTful en PHP c&#x27;est tout √† fait possible. Pour cela on utilise traditionnellement une base de donn√©e en SQL comme MySQL ou MariaDB ou en NoSQL avec MongoDB, Redis... Mais utiliser les donn√©es"><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="Une API RESTful sans serveur de base de donn√©es"><meta data-vue-tag="ssr" property="og:description" content="Cr√©er une API RESTful en PHP c&#x27;est tout √† fait possible. Pour cela on utilise traditionnellement une base de donn√©e en SQL comme MySQL ou MariaDB ou en NoSQL avec MongoDB, Redis... Mais utiliser les donn√©es"><meta data-vue-tag="ssr" property="og:url" content="https://etienner.github.io/une-api-res-tful-sans-serveur-de-base-de-donnees/"><meta data-vue-tag="ssr" name="twitter:domain" content="https://etienner.github.io"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="Une API RESTful sans serveur de base de donn√©es"><meta data-vue-tag="ssr" name="twitter:description" content="Cr√©er une API RESTful en PHP c&#x27;est tout √† fait possible. Pour cela on utilise traditionnellement une base de donn√©e en SQL comme MySQL ou MariaDB ou en NoSQL avec MongoDB, Redis... Mais utiliser les donn√©es"><meta data-vue-tag="ssr" name="twitter:site" content="@etiennerouzeaud"><meta data-vue-tag="ssr" name="twitter:creator" content="@etiennerouzeaud"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.a80f6262.css" as="style"><link rel="preload" href="/assets/js/app.8917d561.js" as="script"><link rel="preload" href="/assets/js/page--src-templates-post-vue.93f54eeb.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules-gridsome-app-pages-404-vue.5bf39404.js"><link rel="prefetch" href="/assets/js/page--src-pages-index-vue.1fdd30a3.js"><link rel="prefetch" href="/assets/js/page--src-templates-tag-vue.8311241e.js"><link rel="stylesheet" href="/assets/css/0.styles.a80f6262.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app"><header class="py-2 text-center"><strong><a href="/" title="Accueil" class="active">Etienne ROUZEAUD - D√©veloppeur Web</a></strong></header><main><div class="title py-2 text-center" data-v-4b217994><h1 class="display-5 pt-2" data-v-4b217994>Une API RESTful sans serveur de base de donn√©es</h1><!----></div><div class="container"><div class="row sidebar"><div class="mt-4 col-lg-2"><p><em><span>14 mars 2016</span></em></p><ul class="list-unstyled"><li>
            üè∑Ô∏è <a href="/tag/PHP/">PHP</a></li><li>
            üè∑Ô∏è <a href="/tag/API/">API</a></li></ul><p>‚åö 7 mins de lecture</p><!----></div><div class="col-lg-10 mt-4"><!----><article><p>Cr√©er une API RESTful en PHP c'est tout √† fait possible. Pour cela on utilise traditionnellement une base de donn√©e en SQL comme MySQL ou MariaDB ou en NoSQL avec MongoDB, Redis... Mais utiliser les donn√©es directement dans un fichier JSON est √©galement possible. En partant du principe que les donn√©es sont stock√©es dans un tableau, il est tout √† fait possible de manipuler ce dernier par la suite.</p>
<p><img src="https://media.giphy.com/media/8FNlmNPDTo2wE/giphy.gif"></p>
<p>Ci-dessous, le contenu du fichier "db.json".</p>
<div class="gridsome-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"Interstellar"</span><span class="token punctuation">,</span>
        <span class="token string">"releaseYear"</span> <span class="token operator">:</span> <span class="token number">2014</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"The Revenant"</span><span class="token punctuation">,</span>
        <span class="token string">"releaseYear"</span><span class="token operator">:</span> <span class="token number">2016</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"Snowpiercer"</span><span class="token punctuation">,</span>
        <span class="token string">"releaseYear"</span><span class="token operator">:</span> <span class="token number">2013</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"The Host"</span><span class="token punctuation">,</span>
        <span class="token string">"releaseYear"</span><span class="token operator">:</span> <span class="token number">2006</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token operator">:</span> <span class="token string">"Sicario"</span><span class="token punctuation">,</span>
        <span class="token string">"releaseYear"</span><span class="token operator">:</span> <span class="token number">2015</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Cot√© serveur, on va mettre en place un design pattern ("patron de conception") de type singleton. Concr√®tement, on instancie l'ouverture du fichier JSON dans le constructeur de notre classe. On √©vite ainsi de l'appeler dans les 4 fonctions destin√©es au CRUD (Create Read, Update, Delete) :</p>
<ul>
<li><code class="language-text">FetchAll</code> : r√©cup√®re toutes les lignes sous forme d'un tableau ;</li>
<li><code class="language-text">FetchOne</code> : r√©cup√®re une ligne en particulier ;</li>
<li><code class="language-text">Create</code> : cr√©√© une nouvelle ligne ;</li>
<li><code class="language-text">Update</code> : modifie une ligne en fonction de l'id ;</li>
<li><code class="language-text">Delete</code> : supprime une ligne en fonction de l'id.</li>
</ul>
<h2>Pr√©paration de la classe</h2>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name">Api</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$file_json</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'db.json'</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Ouverture du fichier</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">json</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file_json</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Tableau des donn√©es en PHP</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span>  <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">json</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Affichage des messages / donn√©es JSON</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">Display</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
       <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token constant">JSON_UNESCAPED_UNICODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Modification du fichier JSON</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file_json</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Id du tableau PHP</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$id</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Nos futures fonctions destin√©es au CRUD</span>
<span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Dans le constructeur, on instancie 2 variables :</p>
<ul>
<li><code class="language-text">$this-&gt;json</code> : ouverture du fichier JSON avec <code class="language-text">file_get_contents()</code> ;</li>
<li><code class="language-text">$this-&gt;get</code> : d√©code le JSON avec <code class="language-text">json_decode()</code> sous la forme d'un tableau.</li>
</ul>
<p>Puis on pr√©pare 2 fonctions priv√©es :</p>
<ul>
<li><code class="language-text">Display()</code> afficher des messages / donn√©es au format JSON avec <code class="language-text">json_encode()</code> ;</li>
<li><code class="language-text">Set()</code> modifier le fichier JSON avec <code class="language-text">file_put_contents()</code> ;</li>
<li><code class="language-text">CurrentRow()</code> l'id du tableau PHP (et non JSON) qui commence √† partir de 0 (et non 1).</li>
</ul>
<h3>Toutes les donn√©es</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Lecture de tous le tableau JSON</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">FetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// R√©cup√©ration du tableau de donn√©es</span>
        <span class="token variable">$rows</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token variable">$rows</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Dans la premi√®re fonction publique <code class="language-text">FetchAll()</code>, on r√©cup√®re toutes les donn√©es pr√©sentes dans le fichier JSON que l'on affiche sous la forme d'un tableau.</p>
<h3>Une seule ligne</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Lecture d'une ligne √† partir de son "id"</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">FetchOne</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// R√©cup√©ration du tableau de donn√©es</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>

    <span class="token comment">// V√©rification de l'existence de la ligne</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"the row #<span class="token interpolation"><span class="token variable">$id</span></span> doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 404 Not Found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Avec comme param√®tre dans la fonction <code class="language-text">FetchOne()</code>, l'id d'une ligne, on r√©cup√®re la ligne correspondante. Si elle n'existe pas, on affiche un message d'erreur.</p>
<h3>Cr√©ation d'une ligne</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Cr√©ation d'une nouvelle ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token variable">$data_input</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// R√©cup√©ration du tableau de donn√©es</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>
        <span class="token comment">// Ajout d'un nouveau champ id</span>
        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Fusion des donn√©es dans cette nouvelle ligne</span>
        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$datas_input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Ajout de la nouvelle ligne dans le tableau g√©n√©ral</span>
        <span class="token variable">$all_data</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Modification du fichier JSON</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$all_data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Message de succ√®s</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span><span class="token double-quoted-string string">"posted new row "</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"data"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 201 Created"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Dans la fonction <code class="language-text">Create()</code>, on passe en param√®tre les donn√©es √† ajouter sous forme d'un tableau. Dans un premier temps, on r√©cup√®re toutes les donn√©es pr√©sentes dans le fichier JSON. On adjoint dans ce tableau une nouvelle ligne dans laquelle on fusionne les donn√©es ajout√©es en param√®tre avec un nouvel id. Puis on sauvegarde ce nouveau tableau avec <code class="language-text">$this-&gt;Set()</code>.</p>
<h3>Modification d'une ligne</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Modification d'une ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$data_input</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// R√©cup√©ration du tableau de donn√©es</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>

    <span class="token comment">// V√©rification de l'existence de la ligne</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// MAJ de la ligne concern√©e</span>
        <span class="token variable">$update</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// V√©rification de modification</span>
        <span class="token variable">$diff</span>   <span class="token operator">=</span> <span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token variable">$update</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$diff</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"warning"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"no change"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Remplacement de la ligne</span>
            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$update</span><span class="token punctuation">;</span>
            <span class="token comment">// Modification du fichier JSON</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"row updated"</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"data"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$update</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"the row #<span class="token interpolation"><span class="token variable">$id</span></span> doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 404 Not Found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Pour modifier une ligne, dans la fonction <code class="language-text">Update()</code> on r√©cup√®re toutes les donn√©es du fichier JSON. On v√©rifie que la ligne concern√©e existe. Puis comme pour cr√©er une nouvelle ligne, on fusionne avec l'id, les donn√©es √† modifier sp√©cifi√©es en param√®tre. On en profite √©galement pour v√©rifier que ces derni√®res sont bien diff√©rentes que celles d√©ja existantes. Si c'est le cas, alors on met √† jour le fichier JSON avec la ligne modifi√©e.</p>
<h3>Suppression d'une ligne</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Suppression d'une ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// R√©cup√©ration du tableau de donn√©es</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>

    <span class="token comment">// V√©rification de l'existence de la ligne</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Suppression de la ligne concern√©e dans le tableau</span>
        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Modification du fichier JSON</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"row #<span class="token interpolation"><span class="token variable">$id</span></span> deleted"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"the row #<span class="token interpolation"><span class="token variable">$id</span></span> doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 404 Not Found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Pour supprimer une ligne, dans la fonction <code class="language-text">Delete()</code> on r√©cup√®re toutes les donn√©es du tableau. On v√©rifie que la ligne existe bien pour la supprimer et modifier le fichier JSON avec le tableau modifi√©.</p>
<h2>Test</h2>
<p>Dans le m√™me fichier, apr√®s la fermeture de la classe, on appel cette derni√®re dans une variable.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Content-Type: application/json; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Appel de la classe "Api"</span>
<span class="token variable">$api</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Api</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Puis, on peut afficher toutes les donn√©es.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token variable">$api</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">FetchAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Afficher uniquement la ligne ayant l'id 4.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token variable">$api</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">FetchOne</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Cr√©er une nouvelle ligne.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token variable">$api</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'Prisonners'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'releaseYear'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2012</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Modifier la ligne ayant l'id 6.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token variable">$api</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token single-quoted-string string">'Prisoners'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'releaseYear'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2013</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Supprimer la ligne ayant l'id 6.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token variable">$api</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Refactoring</h2>
<p>Dans notre classe, on met en place 2 fonctions priv√©es pour all√©ger nos 3 derni√®res fonctions publiques :</p>
<ul>
<li><code class="language-text">CheckFound()</code> : v√©rifier que la ligne existe ;</li>
<li><code class="language-text">CheckData()</code> : verifier qu'il y a bien des donn√©es fournies en param√®tre.</li>
</ul>
<h3>Gestion des erreurs 404</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// V√©rification de l'existence de la ligne</span>
<span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">CheckFound</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// R√©cup√©ration du tableau de donn√©es</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"the row #<span class="token interpolation"><span class="token variable">$id</span></span> doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 404 Not Found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Si la ligne n'existe pas, on affiche une erreur de type 404.</p>
<h3>Gestion des donn√©es manquantes</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">CheckData</span><span class="token punctuation">(</span><span class="token variable">$data_input</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"error"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"missing data"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 400 Bad Request"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Si le param√®tre <code class="language-text">$data_input</code> est vide, on affiche une erreur de type 400.</p>
<h3>R√©√©critures des fonctions CRUD concern√©es</h3>
<p>On peut ainsi r√©√©crire les fonctions <code class="language-text">FetchOne()</code>, <code class="language-text">Create()</code>, <code class="language-text">Update()</code> et <code class="language-text">Delete()</code>.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Lecture d'une ligne √† partir de son "id"</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">FetchOne</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CheckFound</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// R√©cup√©ration du tableau de donn√©es</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Cr√©ation d'une nouvelle ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token variable">$data_input</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CheckData</span><span class="token punctuation">(</span><span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// R√©cup√©ration du tableau de donn√©es</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>
        <span class="token comment">// Ajout d'un nouveau champ id</span>
        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Fusion des donn√©es dans cette nouvelle ligne</span>
        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Ajout de la nouvelle ligne dans le tableau g√©n√©ral</span>
        <span class="token variable">$all_data</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Modification du fichier JSON</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$all_data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Message de succ√®s</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"posted new row "</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"data"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"HTTP/1.0 201 Created"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Modification d'une ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">,</span> <span class="token variable">$data_input</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// V√©rification de l'existence de la ligne</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CheckFound</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CheckData</span><span class="token punctuation">(</span><span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// R√©cup√©ration du tableau de donn√©es</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>
        <span class="token comment">// MAJ de la ligne concern√©e</span>
        <span class="token variable">$update</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$data_input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// V√©rification de modification</span>
        <span class="token variable">$diff</span>   <span class="token operator">=</span> <span class="token function">array_diff</span><span class="token punctuation">(</span><span class="token variable">$update</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$diff</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"warning"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"no change"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Remplacement de la ligne</span>
            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$update</span><span class="token punctuation">;</span>
            <span class="token comment">// Modification du fichier JSON</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"row updated"</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"data"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$update</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Suppression d'une ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">Delete</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// V√©rification de l'existence de la ligne</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CheckFound</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// R√©cup√©ration du tableau de donn√©es</span>
        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">get</span><span class="token punctuation">;</span>
        <span class="token comment">// Suppression de la ligne concern√©e dans le tableau</span>
        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">CurrentRow</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Modification du fichier JSON</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Display</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"success"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token double-quoted-string string">"row #<span class="token interpolation"><span class="token variable">$id</span></span> deleted"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Conclusion</h2>
<p>Avec des conditions, des boucles et des fonctions natives de manipulation de tableau, il est finalement simple de mettre en place une classe pour manipuler une API en JSON sans serveur de base de donn√©es deri√®re. D'autant plus qu'il est possible par la suite, d'imaginer la mise en place dans cette m√™me classe d'un contr√¥le sur la structure de l'API (type de champ, champ obligatoire, unicit√© d'un champ, etc...).</p>
</article></div></div></div></main><footer class="text-white mt-4"><ul class="nav nav-pills justify-content-center"><li><a href="https://github.com/etienner" target="_blank" rel="noopener" class="nav-link">Github</a></li><li><a href="https://medium.com/@etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Medium</a></li><li><a href="https://twitter.com/etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Twitter</a></li></ul></footer></div>
    <script src="/assets/js/app.8917d561.js" defer></script><script src="/assets/js/page--src-templates-post-vue.93f54eeb.js" defer></script>
  </body>
</html>
