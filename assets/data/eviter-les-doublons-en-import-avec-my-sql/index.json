{"hash":"b89929ffb278454bd1f8bb0277abaa50df9b43f7","data":{"post":{"title":"Eviter les doublons en import avec MySQL","date":"25 March 2013","content":"<p>Vous souhaitez importer des nouvelles données dans votre base de données MySQL via PHP My Admin par le biais d'un fichier CSV. Pour autant vous ne souhaitez pas importer des doublons.\nIl est possible de remédier facilement à ce problème en mettant en place une déclaration d'unicité.</p>\n<div class=\"gridsome-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> client<span class=\"token punctuation\">(</span>\nid_client <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\nemail_client <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n<span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>id_client<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> client <span class=\"token punctuation\">(</span>email_client<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">VALUES</span>\n<span class=\"token punctuation\">(</span><span class=\"token string\">'toto@toto.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">(</span><span class=\"token string\">'lorem@ipsum.net'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Création du fichier CSV</h2>\n<p>Dans un tableau Excel, copiez les adresses email dans la colonne B et mettez 0 (les id des clients étant en auto_increment...) à A1.<br>\nEnregistrez votre fichier sous le format : CSV (séparteur point virgule) (*.csv).</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 254 127' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-e04d0c9a5b41081ff379e98545609860'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-e04d0c9a5b41081ff379e98545609860)' width='254' height='127' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAgAEADASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAABAYCBQcDAf/EADUQAAIBAgUBBgMFCQAAAAAAAAECAwQRAAUSITEGExQiQYGhFRaRIyQyUVIzNFNVYXFz0fD/xAAXAQEBAQEAAAAAAAAAAAAAAAADAgQA/8QAKhEAAQMCBAILAAAAAAAAAAAAAQACAwQREhMhcULBBRQVI0GRoaLR4fD/2gAMAwEAAhEDEQA/ANxyvLpY6qM9lHJKr2Ya1IHhO1vW%2bLuakrGhkWKlp0kKkKxCkKfI2xxy4r8TktdftF8ZP4/Bzx5cbYYLj%2bJ7jDyvJOqKNgAVJFS1aQIJqanZ1Ua3AUAkDc/0xT1ETySPMnceybxhu2QDSfP%2b2xw5OEdSrOCpFiDbcYTs8gy2CtjjagnlMSARGNyFUbg%2bRsbE77k3wJpW1nduJHjp9po5Mo3AvuodznvbTR3/AMyYHno6tKmKVpaCOmAKujSx%2bJj%2bHf0OBk%2bGyTdkuU1QSJlJJmII1A32tuMdmjylxc5dXhY3VoxrN2ubbgjyG9j5DHdgxA6vf7flKa1x4QjEo6h2si0bG17CVDtzf2OJR0NS0iqsdKx5ssqE2GD8uyLKqqliqESpi1qbK8pDAG4sfTBtLkdBQzdvT6hKoNiz6ueecZndF07DpI%2b42VdbceEIbLX1ZpMFmEhWVQ0er9kdHHrzhhu36R9cKeUNUfFftUZYzJ4WAILjQefXDT4fzf3wkU4nGIAjdC%2bLKNibqd2/SPrhYzyaZczYLnEVHHpUdgWsbknxXt/1sMh025f3xltbFk1Vn2dN1JmOeQ1KVjJEkU1SiCHQmnSEGm1y3vjTDI1jru5c1BF1cyVNU9YkfzLBeM63AYrtp4uFtbzsb4JikrFCT/MNM8ZDIut9iSBzsNxcYWly7olSxXNeoQWIJ%2b9Vu5GwPGPe49FfzbqHm/7zW/6xrNVGdAPRqnCU7ZElbLMlS2axVlMNSlUN1J%2bnIxfSE6G2Xj88ZtTv0tTx6IM%2b6jRb3t3isO/quBM%2br8pgyiplynP%2boWrowrRBpqogkMOQVsdr84xyyY3XH7yVAWX/2Q==' /%3e%3c/svg%3e\" width=\"254\" data-srcset=\"/assets/static/sql_csv-1.00fa06d.3e1f31855e575fe26987fc614ac5c47c.jpg 254w\" data-sizes=\"(max-width: 254px) 100vw, 254px\" data-src=\"/assets/static/sql_csv-1.00fa06d.3e1f31855e575fe26987fc614ac5c47c.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/sql_csv-1.00fa06d.3e1f31855e575fe26987fc614ac5c47c.jpg\" width=\"254\"></noscript></p>\n<h2>Déclaration d'unicité</h2>\n<p>Allez dans la table concernée (dans cet exemple, le nom de la table sera \"client\" contenu dans la table \"ma_table\").<br>\nLa clef primaire est \"id_client\".<br>\nLe champ auquel nous nous intéressons est le champ \"email_client\". On veut importer les nouvelles adresses des clients en évitant les doublons.<br>\nSur PMA, allez dans la structure et survolez \"Plus\" au bout de la ligne \"email_client\" et cliquez sur \"Ajouter un index unique\".</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 249 116' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-8df330992311faa575dd47026b912f0f'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-8df330992311faa575dd47026b912f0f)' width='249' height='116' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAeAEADASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAAAwUABAYCB//EAC8QAAIBAwMCBAUDBQAAAAAAAAECAwQFEQASIRMxBiJBcRVRYYGRFHLBIzLh8PH/xAAYAQEAAwEAAAAAAAAAAAAAAAADAQIEBf/EACQRAAEEAQMDBQAAAAAAAAAAAAEAAgMRIQQU0RIioTFygZKx/9oADAMBAAIRAxEAPwD26t/UN4lhkhukUdOFIeBpjknBwQnvz9caHTU1QskmzxLJLkpndtYrjt%2bR%2bdDraG2S%2bKVjlr5Er0Vz0RCQGGwk%2bb1wuT9NUUtnhOI5W4UsYcb/AO9gOPv3HHtxq8IYAQT4B/UDoAU/jgrElgdr0WXyh0KKOoR39s/TQxRXUvI634kcrjoKQv8Akc6qXRfgktqoqen6sG4AN5iV8w44U8dzyR20vloqBqiYtabgxZicKX28%2bp/d3PfWSScxuPpXtHCPaPdli0E9BcpBFsu8kbIHBIiXzZPBPsONcGhuagKb24bjbmJc/I%2b/fSlaS3mkii%2bE14TqO2zL5GcZLfjj21DFRx1FMVs9cwptoiYbzjafKf8Av00e7IFY%2bo4UDSTHFeRytBVU1dNZpKWC6PBXlcLWLErFTng7D5T8saq1FBdpaiR4L00URRVReirY4GWPpknSKa3WuNHjFpr5Rsw0nnycjnH84088NwUsK1BpKKopdxUN1t2XwOCM6IyAlQ%2bCRjOsjHwmfw1/iJrulQGrK7OoVkzjtjvrs0MjHLU9qJ%2bZgOmWprorast4gtUtfcbc80oRo3GehwGG4EDk5Hbn8eukctRTCpqFMt9XLsemitg5J59m7j5Z9NbS4QPJVQukjIq4yAcbvppKbVeDLLsvWyNmJH9AE89xnPGPTQOlMZ7CsU1E0qEc1OaODEt92tKwGQ%2b9iNvf5KPT76r1c1KK87m8QKdzcoG2jn0x6H%2bB93yW66iGNWvGXDlnf9OvmXjCgZ4xg8%2budDmtV3affFfGRMnCGnBAB9O/t/p1QaiQGwUFBCkvjU0nQjt1fULHGp6irkkELj75Pbv30SjvwqKqKCShq4TIQA7IdgyMgE4740WS1VzTLJHdZQd6uysuVOAvlAyMA4Of3aEtlr%2brva7zkFVDKN2MjGSPNxnHPudDgqKFL//Z' /%3e%3c/svg%3e\" width=\"249\" data-srcset=\"/assets/static/sql_csv-2.493588c.ded2e83a96a7ab24a3becaa230dffb6b.jpg 249w\" data-sizes=\"(max-width: 249px) 100vw, 249px\" data-src=\"/assets/static/sql_csv-2.493588c.ded2e83a96a7ab24a3becaa230dffb6b.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/sql_csv-2.493588c.ded2e83a96a7ab24a3becaa230dffb6b.jpg\" width=\"249\"></noscript></p>\n<p>ou bien en SQL :</p>\n<div class=\"gridsome-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> <span class=\"token keyword\">TABLE</span> <span class=\"token punctuation\">`</span>client<span class=\"token punctuation\">`</span> <span class=\"token keyword\">ADD</span> <span class=\"token keyword\">UNIQUE</span> <span class=\"token punctuation\">(</span>\n<span class=\"token punctuation\">`</span>email_client<span class=\"token punctuation\">`</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>Testons</h2>\n<p>On fait le test avec le client ayant pour adresse : toto@toto.com</p>\n<div class=\"gridsome-highlight\" data-language=\"sql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-sql line-numbers\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> client <span class=\"token punctuation\">(</span>email_client<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'toto@toto.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Une erreur SQL vous est retournée : <strong>#1062 - Duplicate entry 'toto@toto.com' for key 'email_client'</strong></p>\n","download":"","tags":[{"title":"MySQL","path":"/tag/MySQL/"}],"timeToRead":1,"parts":[]}},"context":{}}