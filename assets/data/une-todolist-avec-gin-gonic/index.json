{"hash":"41452752fefa88bad284d1f2761f45ec58a3a74c","data":{"post":{"title":"Une todolist avec Gin Gonic","date":"20 April 2015","content":"<p>A l'aide d'un micro framework, Gin, on va créer une application \"todolist\" en Go.\nOn va mettre en place sur une page, un formulaire pour poster des messages. Ces derniers seront listés sur cette même page.\nIl sera également possible de les supprimer.\nAprès un cours aperçu de Gin, ces messages seront stockés dans une base de données MySQL avec l'aide d'un ORM, Gorp.</p>\n<h2 id=\"préparation-et-installation\"><a href=\"#pr%C3%A9paration-et-installation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Préparation et installation</h2>\n<p>Structure de notre dossier \"todolist\".</p>\n<pre class=\"language-text\"><code class=\"language-text\">│   main.go\n│\n├───db\n│       db.go\n│\n└───views\n        index.html</code></pre>\n<p>Sur votre serveur MySQL, créez uniquement une nouvelle table \"todolist\".</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> todolist<span class=\"token punctuation\">;</span></code></pre>\n<p>Installez les librairies suivantes.</p>\n<p><code class=\"language-text\">go get github.com/gin-gonic/gin</code>\n<code class=\"language-text\">go get gopkg.in/gorp.v1</code>\n<code class=\"language-text\">go get github.com/go-sql-driver/mysql</code></p>\n<h2 id=\"aperçu-de-gin\"><a href=\"#aper%C3%A7u-de-gin\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Aperçu de Gin</h2>\n<p>Dans le fichier \"main.go\".</p>\n<pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"github.com/gin-gonic/gin\"</span>\n    <span class=\"token string\">\"net/http\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    r <span class=\"token operator\">:=</span> gin<span class=\"token punctuation\">.</span><span class=\"token function\">Default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">LoadHTMLGlob</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"views/*\"</span><span class=\"token punctuation\">)</span>\n\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">GET</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        obj <span class=\"token operator\">:=</span> gin<span class=\"token punctuation\">.</span>H<span class=\"token punctuation\">{</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"My Title\"</span><span class=\"token punctuation\">}</span>\n        c<span class=\"token punctuation\">.</span><span class=\"token function\">HTML</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>StatusOK<span class=\"token punctuation\">,</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">POST</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/submit\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        c<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span><span class=\"token function\">ParseForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n        title <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span>Form<span class=\"token punctuation\">.</span><span class=\"token function\">Get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">)</span>\n\n        obj <span class=\"token operator\">:=</span> gin<span class=\"token punctuation\">.</span>H<span class=\"token punctuation\">{</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">}</span>\n        c<span class=\"token punctuation\">.</span><span class=\"token function\">HTML</span><span class=\"token punctuation\">(</span>http<span class=\"token punctuation\">.</span>StatusOK<span class=\"token punctuation\">,</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":3000\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">}</span></code></pre>\n<p>On déclare Gin ainsi que la librairie native de Golang \"net/http\".<br>\nDans l'unique fonction \"main()\", on effectue les étapes ci-dessous.</p>\n<ol>\n<li>Initialise la fonction \"gin.default()\" ;</li>\n<li>Définit le répertoire de templating \"views\" ;</li>\n<li>Déclare une première route. Celle ci est la racine (\"/\"). Sa fonction a pour but d'afficher le contenu de la valeur \"title\" présente dans le fichier de templating \"index.html\". Cette route renvoit un code HTTP 200 ;</li>\n<li>Déclare une seconde route de type POST. Celle ci pointe sur \"/submit\" (destination de notre futur formulaire). Dans un premier temps, on demande à Gin de parser le fomulaire afin de récupérer la valeur contenue dans le champ \"title\" renseigné par l'utilisateur. Puis, on stocke cette valeur dans la variable \"title\" pour le fichier de templating \"index.html\". Cette route renvoit également un code HTTP 200 ;</li>\n<li>Exécute notre serveur sur le port 3000.</li>\n</ol>\n<p>Dans notre vue \"index.html\", on met en place le formulaire ci-dessous.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>\n    {{ .title }}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>title<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Enter a title<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>On affiche la valeur \"title\" dans notre fichier de templating.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1280 1024' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-111'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-111)' width='1280' height='1024' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAzAEADASIAAhEBAxEB/8QAGwAAAQUBAQAAAAAAAAAAAAAAAAECAwQGBQj/xAA2EAABAwICBwMLBQEAAAAAAAABAAIDBBEFIQYSFDFSkdETUZIHFhciMkFhcYGU4TNWZHSTwf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/EABsRAQEAAgMBAAAAAAAAAAAAAAABAhESMVEh/9oADAMBAAIRAxEAPwD0DFQNp2uZTYXkGG2rPGRkbBue7LPuS1GB4ZjsctBi2G001PG4P7KbUkF87GwzH171p7DuCQNaHEhoBO82V3SzbHjyZaGjdo3hX246pT5NNDjv0cwr/D8rYIV55es8MfGO9GWhtrebeFW/rjqmei7Qq5PmxhFz/HHVbRCc8vTjj4xfot0J/bGEfbjqr0Og%2bAU0DYaTDKWniBvqRx2HJaZClyt7WSTpUdiNK0XMot8j0S7fTW/VHIpkNLNGzV7VhtutHZVKuV9PUBvt5XNsgM0s0bdDbafjPhPRP2iLiPIqCAymxA93sl5uFbG7O6io9oj4jyKNoj4jyKl5o5oItoj4jyKY%2btgY8Nc83O71T0Vjmk5oFXGxbKqbcF3q5D6rsri4s61YzWhne3V3sic8b7%2b4FWS35Etk%2b1NTiV1nNjeWA5DXNgrzXTO3taPmqVCJXQsf2bzGRYNeCxwN/eCrsYka0ARsA%2bLyf%2bKdL2e3tLjW1Pja6emXk4GeL8JLy8DPEeiCRCjvLwM8R6KTPuQcB2IVQeQJcr8I6LsUL3SUzHvN3HeUIQToQhAIQhAIQhB//9k=' /%3e%3c/svg%3e\" width=\"1280\" data-srcset=\"/assets/static/todolist_static_submit.82a2fbd.428911b.jpg 480w, /assets/static/todolist_static_submit.cbab2cf.428911b.jpg 1024w\" data-sizes=\"(max-width: 1280px) 100vw, 1280px\" data-src=\"/assets/static/todolist_static_submit.cbab2cf.428911b.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/todolist_static_submit.cbab2cf.428911b.jpg\" width=\"1280\"></noscript></p>\n<p>On réédite notre fichier \"main.go\" plus propremement en déclarant une fonction pour chaque route (et par la même occasion, mieux s'y retrouver...).</p>\n<pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"github.com/gin-gonic/gin\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    r <span class=\"token operator\">:=</span> gin<span class=\"token punctuation\">.</span><span class=\"token function\">Default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">LoadHTMLGlob</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"views/*\"</span><span class=\"token punctuation\">)</span>\n\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">GET</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> indexHandler<span class=\"token punctuation\">)</span>\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">POST</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/submit\"</span><span class=\"token punctuation\">,</span> postHandler<span class=\"token punctuation\">)</span>\n\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":3000\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">indexHandler</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    obj <span class=\"token operator\">:=</span> gin<span class=\"token punctuation\">.</span>H<span class=\"token punctuation\">{</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Main website\"</span><span class=\"token punctuation\">}</span>\n    c<span class=\"token punctuation\">.</span><span class=\"token function\">HTML</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">postHandler</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    c<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span><span class=\"token function\">ParseForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    title <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span>Form<span class=\"token punctuation\">.</span><span class=\"token function\">Get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">)</span>\n\n    obj <span class=\"token operator\">:=</span> gin<span class=\"token punctuation\">.</span>H<span class=\"token punctuation\">{</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">}</span>\n    c<span class=\"token punctuation\">.</span><span class=\"token function\">HTML</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Remarque : on en a également profité pour se débarrasser de la librairie native \"net/http\".</p>\n<h2 id=\"configuration-de-connexion-à-mysql\"><a href=\"#configuration-de-connexion-%C3%A0-mysql\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Configuration de connexion à MySQL</h2>\n<p>Dans notre fichier \"db.go\".</p>\n<pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> db\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"database/sql\"</span>\n    <span class=\"token boolean\">_</span> <span class=\"token string\">\"github.com/go-sql-driver/mysql\"</span>\n    <span class=\"token string\">\"gopkg.in/gorp.v1\"</span>\n    <span class=\"token string\">\"log\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">type</span> Messages <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n    Id    <span class=\"token builtin\">int64</span>  <span class=\"token string\">`db:\"id\"`</span>\n    Title <span class=\"token builtin\">string</span> <span class=\"token string\">`db:\"title\"`</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">InitDb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span>gorp<span class=\"token punctuation\">.</span>DbMap <span class=\"token punctuation\">{</span>\n    db<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> sql<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mysql\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"root:@/todolist\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">checkErr</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> <span class=\"token string\">\"sql.Open failed\"</span><span class=\"token punctuation\">)</span>\n \n    dbmap <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>gorp<span class=\"token punctuation\">.</span>DbMap<span class=\"token punctuation\">{</span>Db<span class=\"token punctuation\">:</span> db<span class=\"token punctuation\">,</span> Dialect<span class=\"token punctuation\">:</span> gorp<span class=\"token punctuation\">.</span>MySQLDialect<span class=\"token punctuation\">{</span><span class=\"token string\">\"InnoDB\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"UTF8\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    dbmap<span class=\"token punctuation\">.</span><span class=\"token function\">AddTableWithName</span><span class=\"token punctuation\">(</span>Messages<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"messages\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">SetKeys</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Id\"</span><span class=\"token punctuation\">)</span>\n    err <span class=\"token operator\">=</span> dbmap<span class=\"token punctuation\">.</span><span class=\"token function\">CreateTablesIfNotExists</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">checkErr</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Create table failed\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> dbmap\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">checkErr</span><span class=\"token punctuation\">(</span>err <span class=\"token builtin\">error</span><span class=\"token punctuation\">,</span> msg <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">{</span>\n        log<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>On déclare une structure \"Messages\".<br>\nEnsuite, dans le fonction \"InitDb()\" (qu'on a prit soin de nomme avec une majuscule), on initialise la connexion à notre serveur MySQL.\nEnsuite, on initialise la connexion à notre serveur MySQL dans la fonction \"InitDb()\" (dont on\na prit soin de la nommer avec une majuscule afin de pouvoir l'exporter par la suite).<br>\nAvec Gorp, on définit la future table comme étant de type InnoDB au format UFT-8. On lui demande également de créer une nouvelle table \"messages\" basée sur la structure \"Messages\" si la table n'existe pas.<br>\nOn lui demande aussi d'afficher une erreur si le serveur MySQL n'est pas accessible ou qu'il n'est pas possible de créer une nouvelle table via la foncton \"checkErr\".</p>\n<p>Remarque : si vous avez un mot de passe pour vous connecter à votre BDD, ajoutez-le dans le DSN :<br>\n<code class=\"language-text\">sql.Open(&quot;mysql&quot;, &quot;root:my_password@/todolist&quot;)</code></p>\n<p>Cela marche également avec MariaDB (testé depuis un container Docker) :<br>\n<code class=\"language-text\">db, err := sql.Open(&quot;mysql&quot;, &quot;root:@tcp(192.168.59.103:3306)/todolist&quot;)</code></p>\n<h2 id=\"communiquons-avec-la-base-de-données\"><a href=\"#communiquons-avec-la-base-de-donn%C3%A9es\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Communiquons avec la base de données</h2>\n<p>On va pouvoir se connecter à la BDD dans notre fichier \"main.go\".</p>\n<pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"github.com/gin-gonic/gin\"</span>\n    <span class=\"token string\">\"todolist/db\"</span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">var</span> dbmap <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">InitDb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    r <span class=\"token operator\">:=</span> gin<span class=\"token punctuation\">.</span><span class=\"token function\">Default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">LoadHTMLGlob</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"views/*\"</span><span class=\"token punctuation\">)</span>\n\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">GET</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> indexHandler<span class=\"token punctuation\">)</span>\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">POST</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/submit\"</span><span class=\"token punctuation\">,</span> postHandler<span class=\"token punctuation\">)</span>\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">GET</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/delete/:id\"</span><span class=\"token punctuation\">,</span> deleteHandler<span class=\"token punctuation\">)</span>\n\n    r<span class=\"token punctuation\">.</span><span class=\"token function\">Run</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":3000\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">indexHandler</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    messages <span class=\"token operator\">:=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>db<span class=\"token punctuation\">.</span>Messages<span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> dbmap<span class=\"token punctuation\">.</span><span class=\"token function\">Select</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>messages<span class=\"token punctuation\">,</span> <span class=\"token string\">\"SELECT * FROM messages\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token operator\">||</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>messages<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span>\n        obj <span class=\"token operator\">:=</span> gin<span class=\"token punctuation\">.</span>H<span class=\"token punctuation\">{</span><span class=\"token string\">\"error\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"No message in the database\"</span><span class=\"token punctuation\">}</span>\n        c<span class=\"token punctuation\">.</span><span class=\"token function\">HTML</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        obj <span class=\"token operator\">:=</span> gin<span class=\"token punctuation\">.</span>H<span class=\"token punctuation\">{</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> messages<span class=\"token punctuation\">}</span>\n        c<span class=\"token punctuation\">.</span><span class=\"token function\">HTML</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">postHandler</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    c<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span><span class=\"token function\">ParseForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    title <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span>Request<span class=\"token punctuation\">.</span>Form<span class=\"token punctuation\">.</span><span class=\"token function\">Get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">if</span> title <span class=\"token operator\">!=</span> <span class=\"token string\">\"\"</span> <span class=\"token punctuation\">{</span>\n        data <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>db<span class=\"token punctuation\">.</span>Messages<span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">}</span>\n        dbmap<span class=\"token punctuation\">.</span><span class=\"token function\">Insert</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    c<span class=\"token punctuation\">.</span><span class=\"token function\">Redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">301</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">deleteHandler</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>gin<span class=\"token punctuation\">.</span>Context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    id <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span>Params<span class=\"token punctuation\">.</span><span class=\"token function\">ByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span>\n    dbmap<span class=\"token punctuation\">.</span><span class=\"token function\">Exec</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DELETE FROM messages WHERE id=?\"</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">)</span>\n\n    c<span class=\"token punctuation\">.</span><span class=\"token function\">Redirect</span><span class=\"token punctuation\">(</span><span class=\"token number\">301</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>On appelle notre fichier \"db.go\" via \"package db\" dans l'import des bibiliothèques. On déclare la variable globale \"dbmap\" qui pointe vers la fonction \"InitDb\" présente dans le fichier \"db.go\". De ce fait, on peut désormais exécuter des requêtes SQL dans les fonctions concernées.</p>\n<p>Il ne nous reste plus qu'à modifier notre vue \"index.html\" avec le templating adéquatet ya d (et un peu de CSS par la même occasion...).</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>ToDoList<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text-center<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>ToDoList<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n\n    {{if .error}}\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>alert alert-warning<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">role</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>alert<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{.error}}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    {{end}}\n\n    {{range $message := .title}}\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>list-unstyled<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>delete/{{$message.Id}}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>glyphicon glyphicon-remove<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n            {{$message.Title}}\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n    {{end}}\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-group<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>form-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>title<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>Enter a title<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>submit<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>btn btn-primary<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1280 1024' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-112'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-112)' width='1280' height='1024' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAzAEADASIAAhEBAxEB/8QAHAAAAgIDAQEAAAAAAAAAAAAAAAMEBQECBgcI/8QANhAAAQMCAwUFBgUFAAAAAAAAAQACAwQRBRIhBhQxkdEHE0FRUiJTYXGS0hYXIzOBQ0aCocH/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/xAAbEQEBAAIDAQAAAAAAAAAAAAAAARESAiFRMf/aAAwDAQACEQMRAD8A%2bj6bZ7D6Fp7hjYm6DXX5cb2Scb2YwXH6PcsZpaatps4eIpGi2YcDoQfFWmL1LaPDpp3wzzNYAe7gYXvOo4AcUnCJI8Qo46oQVEGZxsydhjeLG2rST5clrFk2ZtluK5QdkGwgNxs1h/0v%2b5IrOyvYiBoI2TpZ7%2bEbXG3Ny9D180WKb8vTTj486peyrYWozNOyVNEAAf1WOF7%2bXtp35ObA3J/DGHXPH2X/AHLv7FGvmm3L1dZ48%2bPY1sAf7Xw76X/crCm7Ndl6OERUWFQ08Y1yxl9uHkXLsdfNZHxUtt%2brOviI7EaVouZRb5Hos7/TW/dHIqFSzty5d4iZ4BuUGy1qJjHM3KRI0jW2g4pZhMrHfYPWfpPRb7xF6jyKjQySF4s11/SXO0/1ZTRw1uope8R%2bo8ijeI/UeRTeaOaBW8R%2bo8itH1sDHhrnm54eyeikc1jmgSaSI8QeZVdiWWOpYHNzMDdAPmrhUeMzwR1rGzyNZdumY28VZLeolsndSYX5jcRzFoOlnkj%2bVNbK93CM/wAm3/FAw6fvoQ6JzpYRcZoz4qex7wAO7kPxcR1Usx1Vlz8btc82zMA/yut1pnd7p3MdVjvH%2b6dzHVAxCX3j/dO5jqmA/BBQuxCpH9Xx9I6K3oXukpWPebuN7lCED0IQgEIQgEIQg//Z' /%3e%3c/svg%3e\" width=\"1280\" data-srcset=\"/assets/static/todolist_post.82a2fbd.87c5045.jpg 480w, /assets/static/todolist_post.cbab2cf.87c5045.jpg 1024w\" data-sizes=\"(max-width: 1280px) 100vw, 1280px\" data-src=\"/assets/static/todolist_post.cbab2cf.87c5045.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/todolist_post.cbab2cf.87c5045.jpg\" width=\"1280\"></noscript></p>\n<p>Lorsque vous lancez votre serveur pour la première fois, la table \"messages\" est créée automatiquement.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 534 130' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-113'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-113)' width='534' height='130' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAQAEADASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAQIDBAAH/8QALhAAAgEDAgMFCAMAAAAAAAAAAQIDABESBCEiMUETMlGBkSMzYWNxcqKx0fDx/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAL/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDxqSUsgkLRZgbIIbc%2bndtSZGdWLGJCF7rRAE7dLJQIQ8URk0s7bBVZTiG/Dep6fOJMTpy4dclJQcgBe10JqBlXUSKFAiXhFgeyS/rjvWpXxI2iJ7T3Z06lufjhTqgzxSI2lkUIb5WtibdSFFZnmjZY04OCQtl0sT9t6BljWVg7FbkC4jTHDccwFA69KDpYgRjKJNwLKGufVaik54O0ZGWMDEBbX3Hw35da6eZJtUsgxRQRt/ij9UEWgQR5B7ta%2bFmv9O7aqsflv/fKrROwVVvBZeXsh/G/nSdS5QpfT2PhAoPrjeg//9k=' /%3e%3c/svg%3e\" width=\"534\" data-srcset=\"/assets/static/totolist_create_table.82a2fbd.de38108.jpg 480w, /assets/static/totolist_create_table.2191117.de38108.jpg 534w\" data-sizes=\"(max-width: 534px) 100vw, 534px\" data-src=\"/assets/static/totolist_create_table.2191117.de38108.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/totolist_create_table.2191117.de38108.jpg\" width=\"534\"></noscript></p>\n<h2 id=\"sources\"><a href=\"#sources\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sources</h2>\n<ul>\n<li>Gin : <a href=\"https://github.com/gin-gonic/gin\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/gin-gonic/gin</a></li>\n<li>Gorp : <a href=\"https://github.com/go-gorp/gorp\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/go-gorp/gorp</a></li>\n<li>Driver SQL : <a href=\"https://github.com/go-sql-driver/mysql\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/go-sql-driver/mysql</a></li>\n</ul>\n"}},"context":{}}