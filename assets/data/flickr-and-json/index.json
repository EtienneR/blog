{"hash":"8bc8dc5f3fb99fbb091a59684da69f95805ad993","data":{"post":{"title":"Flickr & JSON","date":"18 May 2012","content":"<p>Vous souhaitez afficher un album de votre galerie Flickr sur votre site Web. La méthode de \"callback\" sert à récupérer des données stockées sur un serveur distant. L'API Flickr permet d'effectuer ce genre de requête combiné avec du jQuery (utilisation de <code class=\"language-text\">$.getJSON</code>) et du JSON (JavaScript Object Notation).</p>\n<h2>photosets.getPhotos</h2>\n<p>Pour récupérer l'id correspondant à l'un de vos albums, copiez le lien url pointant vers l'un de vos albums.<br>\nEn copiant le lien, par défaut, l'url se présente sous la forme suivante :<br>\n<a href=\"http://www.flickr.com/photos/nom_de_votre_compte/sets/photoset_id/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://www.flickr.com/photos/nom_de_votre_compte/sets/photoset_id/</a><br>\nExemple :<br>\n<a href=\"http://www.flickr.com/photos/etienne-r/sets/72157629339061530\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://www.flickr.com/photos/etienne-r/sets/72157629339061530</a><br>\nle \"photoset_id\" est 72157629339061530<br>\nPour générer le JSON, allez à l'adresse suivante après vous êtes connecté sur le site :<br>\n<a href=\"http://www.flickr.com/services/api/explore/flickr.photosets.getPhotos\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://www.flickr.com/services/api/explore/flickr.photosets.getPhotos</a> :</p>\n<ul>\n<li>\"photoset_id\", rentrez l'id de votre album</li>\n<li>\"Sortie\", sélectionnez JSON</li>\n</ul>\n<p>Cliquez sur \"Call method\" afin de générer le JSON.<br>\nNous allons nous intéresser à l'URL de callback qui se situe en dessous du cadre où le JSON vient d'être généré car il vous faut copier ce lien dans le code suivant :</p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>div id<span class=\"token operator\">=</span><span class=\"token string\">\"container\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>ul id<span class=\"token operator\">=</span><span class=\"token string\">\"images\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"http://code.jquery.com/jquery-1.7.2.min.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n    $<span class=\"token punctuation\">.</span><span class=\"token function\">getJSON</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&amp;api_key=clef-API&amp;photoset_id=le_photoset&amp;extras=original_format&amp;format=json&amp;jsoncallback=?\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Debut de la boucle</span>\n        $<span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>photoset<span class=\"token punctuation\">.</span>photo<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i<span class=\"token punctuation\">,</span>item</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Sockage de l'image dans une variable</span>\n            <span class=\"token keyword\">var</span> photo <span class=\"token operator\">=</span> <span class=\"token string\">'http://farm'</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>farm <span class=\"token operator\">+</span> <span class=\"token string\">'.static.flickr.com/'</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>server <span class=\"token operator\">+</span> <span class=\"token string\">'/'</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>id <span class=\"token operator\">+</span> <span class=\"token string\">'_'</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>secret <span class=\"token operator\">+</span> <span class=\"token string\">'_s.jpg'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Sockage de l'url dans une variable</span>\n            <span class=\"token keyword\">var</span> url<span class=\"token operator\">=</span> <span class=\"token string\">'http://farm'</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>farm <span class=\"token operator\">+</span> <span class=\"token string\">'.static.flickr.com/'</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>server <span class=\"token operator\">+</span> <span class=\"token string\">'/'</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>id <span class=\"token operator\">+</span> <span class=\"token string\">'_'</span> <span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>secret <span class=\"token operator\">+</span> <span class=\"token string\">'_c.jpg'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Affichage des images dans la balise ul#images avec le l'url dans la balise li</span>\n            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;img/>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>src<span class=\"token operator\">:</span> photo<span class=\"token punctuation\">,</span> alt<span class=\"token operator\">:</span> item<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendTo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#images\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;li>&lt;a href=' \"</span><span class=\"token operator\">+</span> url <span class=\"token operator\">+</span><span class=\"token string\">\"' title=' \"</span><span class=\"token operator\">+</span> item<span class=\"token punctuation\">.</span>title <span class=\"token operator\">+</span><span class=\"token string\">\" ' >&lt;/a>&lt;/li>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//Fin de la boucle</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Fin appel JSON</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Petites explications :</p>\n<ul>\n<li>pour charger une image sur Flickr, il faut qu'elle soit de la forme :\n<a href=\"http://farm#.static.flickr.com/serveur/id-photo/id-secret.jpg\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://farm#.static.flickr.com/serveur/id-photo/id-secret.jpg</a></li>\n<li><code class=\"language-text\">farm#</code> : numéro du sous domaine (notion de \"ferme de sous domaines\")</li>\n<li><code class=\"language-text\">server</code> : id du serveur</li>\n<li><code class=\"language-text\">id-photo</code> : identifiant de la photo</li>\n<li><code class=\"language-text\">secret</code> : identifiant secret de la photo</li>\n</ul>\n<p>Le script ci-dessus va chercher le JSON par le biais de <code class=\"language-text\">$.getJSON</code> et va récupérer les données dans une boucle <code class=\"language-text\">$.each</code>. La variable <code class=\"language-text\">photo</code> va stocker le lien de chaque photo au format vignette tandis que la variable <code class=\"language-text\">url</code> va enregistrer l'adresse de chaque photo au format 800px. La troisième et dernière ligne de la boucle permet d'afficher le résultat au format HTML dans la balise dont l'id est image. Cette dernière comportera l'affichage de la variable photo dans une balise image englobée dans les puces avec l'url de la photo au format 800px.<br>\nPour la taille de l'image, devant l'extension jpg, on peut mettre les options suivantes :</p>\n<ul>\n<li><code class=\"language-text\">_s</code> : carré (75*75px)</li>\n<li><code class=\"language-text\">_m</code> : medium (paysage : 240 <em> 160px - portrait : 160 </em> 240px)</li>\n<li><code class=\"language-text\">_z</code> : 640px</li>\n<li><code class=\"language-text\">_c</code> : 800px</li>\n</ul>\n<h2>photo_public.gne</h2>\n<p>Si vous souhaitez afficher les 20 dernières images d'un compte Flickr, vous pouvez passer par <code class=\"language-text\">photo_public.gne</code> qui est aussi disponible pour les non abonnés.</p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>div id<span class=\"token operator\">=</span><span class=\"token string\">\"container\"</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>ul id<span class=\"token operator\">=</span><span class=\"token string\">\"images\"</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"js/http://code.jquery.com/jquery-1.7.2.min.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n    <span class=\"token comment\">// Debut appel JSON</span>\n    $<span class=\"token punctuation\">.</span><span class=\"token function\">getJSON</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://api.flickr.com/services/feeds/photos_public.gne?id=idGettr-du-compte&amp;format=json&amp;jsoncallback=?\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Debut de la boucle</span>\n        $<span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i<span class=\"token punctuation\">,</span>item</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Sockage de l'image dans une variable et remplacement de la taille \"m\" par la taille \"s\"</span>\n            <span class=\"token keyword\">var</span> min <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>media<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"_m.jpg\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"_s.jpg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Affichage des images dans la balise ul#images avec le l'url dans la balise li</span>\n            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;img/>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"src\"</span><span class=\"token punctuation\">,</span> min<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendTo</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#photos\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;li>&lt;a href='\"</span> <span class=\"token operator\">+</span> url <span class=\"token operator\">+</span> <span class=\"token string\">\"' '>&lt;/a>&lt;li>\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Fin de la boucle</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Fin appel JSON</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Pour obtenir le idGettr allez sur <a href=\"http://idgettr.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://idgettr.com</a><br>\nSi vous souhaitez limiter l'affichage des images à 10 par exemple, il faudra imposer une limite en fin de la boucle <code class=\"language-text\">$.each</code> :</p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">==</span> <span class=\"token number\">9</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// \"9\" car la variable i commence à 0</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2>Débogage</h2>\n<p>Vous pouvez afficher le JSON sous Firebug en allant dans Script (il faut rafraichir la page) puis à droite de \"Tous\", il y a le nom de la page sur laquelle vous êtes, cliquez sur la flèche pointant vers le bas et sélectionnez le lien en dessous de \"api.flickr.com/services/rest/\".<br>\nSous Chrome, allez dans \"Scripts\" cliquez sur le premier icone à gauche (Scripts navigator) puis allez dans \"api.flickr.com\" > \"Services\".<br>\n<img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 662 262' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-85178525186e76a604a93ad447e30060'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-85178525186e76a604a93ad447e30060)' width='662' height='262' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAZAEADASIAAhEBAxEB/8QAGwAAAgMBAQEAAAAAAAAAAAAAAwUAAgYBBAj/xAAvEAACAgECAggFBQEAAAAAAAABAgMRAAQhBRIGExQxMkFRYRYiccHhIyRykaGi/8QAGAEBAQEBAQAAAAAAAAAAAAAAAAECAwT/xAAeEQABBAIDAQAAAAAAAAAAAAAAAQIDERIUBDFRQf/aAAwDAQACEQMRAD8A%2bl%2bKwQw6CV0iQEb7Cr3xXEFmI%2bUqsQ5nIvmYf3j/AFzImklkkjaREUsUUWWod1ZkYul0cZmjTTGIICFUgLvmVcidnRkL5EtqDBUg6tCXkpvMKaob34tsPo1QzqsepeO%2b61Iv28WKvi2ZWp9O98gO61Rzo6YttekkNj0qj55M2m9WXw1PV6rf9wntcX5w8QcLUjBm9QKzLR9L%2bdRy8O1DNdEA/jLfFcm1cK1O/v3f5lzaXVl8NTkzLxdLSSes4Xq19OUc32GEfpZEqkjh%2bualLUsd3Xl9cZtCcWVfhpCQKs9%2bZ5dHM%2bqmJSag1ghit2fr3Y%2bk8Uf8vscvmjziSfRa8vsY2A8PKxAG3ucvFwuRo/1HMbXdBifLzN44yYFHh7G58RgN7t8jC/8ArDnSQs3MyWfWzh8mBQHssNklLv1JzvZoqA5Nh3bnC5MCj//Z' /%3e%3c/svg%3e\" width=\"662\" data-srcset=\"/assets/static/flickr_capture_json.29f3330.dbf8cff80f31c78b5af11b0dd63c2847.jpg 662w\" data-sizes=\"(max-width: 662px) 100vw, 662px\" data-src=\"/assets/static/flickr_capture_json.29f3330.dbf8cff80f31c78b5af11b0dd63c2847.jpg\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/flickr_capture_json.29f3330.dbf8cff80f31c78b5af11b0dd63c2847.jpg\" width=\"662\"></noscript></p>\n<p>En effet, dans le mode <code class=\"language-text\">photo_public.gne</code>, vous pouvez observer que l'adresse url de chaque photos est données dans \"items\" > \"media\" > \"m\" ce qui n'est pas le cas dans le mode <code class=\"language-text\">photosets.getPhotos</code>.</p>\n","download":"","tags":[{"title":"api","path":"/tag/api/"},{"title":"jquery","path":"/tag/jquery/"}],"timeToRead":4,"parts":[]}},"context":{}}