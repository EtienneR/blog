<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="lang">
  <head>
    <title>Créer une librairie &quot;Database&quot; - https://etienner.github.io</title><meta name="gridsome:hash" content="a6a83eeab333c7bbcf47fff9751f8c5dda4260fc"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.2"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="description" content="On va concevoir une librairie en POO (Programmation Orienté Objet) pour pouvoir se connecter à la base de données avec PDO (PHP Data Objects). En plus de concevoir cette librairie, on va également créer"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffa.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffa.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffa.png"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript><link rel="preload" href="/assets/css/0.styles.2ee79837.css" as="style"><link rel="preload" href="/assets/js/app.b659722c.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.6a9fe53b.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.14b4f713.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.2907f5d3.js"><link rel="stylesheet" href="/assets/css/0.styles.2ee79837.css">
  </head>
  <body >
    <div data-server-rendered="true" id="app"><header><div class="container text-center"><strong><a href="/" title="Accueil" class="active">Etienne ROUZEAUD - Développeur Web</a></strong></div></header><div class="text-center title"><h1 class="display-5">Créer une librairie &quot;Database&quot;</h1><p><em>Posté le <span>23 novembre 2015</span></em></p></div><div class="container"><article class="mt-4"><p>On va concevoir une librairie en POO (Programmation Orienté Objet) pour pouvoir se connecter à la base de données avec PDO (PHP Data Objects). En plus de concevoir cette librairie, on va également créer un modèle contenant des requêtes SQL de type CRUD (Create Read Update Delete). Vous pourrez par la suite, réutiliser cette librairie dans un "microframework" PHP tel que Slim, Silex ou Lumen et ainsi profiter du modèle MVC.</p>
<h2 id="préparation"><a href="#pr%C3%A9paration" aria-hidden="true"><span class="icon icon-link"></span></a>Préparation</h2>
<p>Pour faire ce tutoriel, il nous faut pour commencer, une base de donnée MySQL / MariaDB.</p>
<pre class="language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> test<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_unicode_ci<span class="token punctuation">;</span>


<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Macon'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Kalia'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Damian'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Nash'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'Keefe'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'Octavius'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'Wendy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'Maggy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'Walter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'Cherokee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="classe-database"><a href="#classe-database" aria-hidden="true"><span class="icon icon-link"></span></a>Classe "Database"</h2>
<p>Créez un fichier "Database.php" dans le dossier "config".</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">// config/Database.php</span>

<span class="token keyword">class</span> <span class="token class-name">Database</span> 
<span class="token punctuation">{</span>
	<span class="token comment">// Code à venir</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Cette classe va contenir la connexion à PDO puis différents types de requêtes SQL possibles en PDO.</p>
<h3 id="connexion-à-pdo"><a href="#connexion-%C3%A0-pdo" aria-hidden="true"><span class="icon icon-link"></span></a>Connexion à PDO</h3>
<p>Pour se connecter à notre serveur via PDO, on a besoin des 5 informations obligatoires ci-dessous.</p>
<ul>
<li>Le nom de la base ;</li>
<li>Le nom utilisateur ("root" par défaut) ;</li>
<li>Le mot de passe ;</li>
<li>L'adresse du serveur ;</li>
<li>Le port du serveur ("3306" par défaut).</li>
</ul>
<p>On créé donc ces 5 variables instanciées dans le constructeur de notre classe.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">// config/Database.php</span>

<span class="token keyword">class</span> <span class="token class-name">Database</span> 
<span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_name</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"test"</span><span class="token punctuation">;</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_user</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"root"</span><span class="token punctuation">;</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_pass</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">;</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_host</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"localhost"</span><span class="token punctuation">;</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_port</span> <span class="token operator">=</span> <span class="token number">3306</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Autres fonctions à venir</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Maintenant que l'on a ces données, on va pouvoir créer notre fonction de connexion PDO, que l'on nomme <code class="language-text">getPDO()</code>.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">// config/Database.php</span>

<span class="token keyword">class</span> <span class="token class-name">Database</span> 
<span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_name</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"test"</span><span class="token punctuation">;</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_user</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"root"</span><span class="token punctuation">;</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_pass</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">;</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_host</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"localhost"</span><span class="token punctuation">;</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_port</span> <span class="token operator">=</span> <span class="token number">3306</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Connexion à la BDD</span>
	<span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">getPDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">pdo</span> <span class="token operator">===</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token comment">// DSN</span>
				<span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"mysql:dbname="</span> <span class="token punctuation">.</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_name</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">";host="</span> <span class="token punctuation">.</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_host</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">";port="</span><span class="token punctuation">.</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_port</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_user</span><span class="token punctuation">,</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_pass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token variable">$pdo</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token scope">PDO<span class="token punctuation">::</span></span><span class="token constant">ATTR_ERRMODE</span><span class="token punctuation">,</span> <span class="token scope">PDO<span class="token punctuation">::</span></span><span class="token constant">ERRMODE_EXCEPTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token variable">$pdo</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"SET CHARACTER SET utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">pdo</span> <span class="token operator">=</span> <span class="token variable">$pdo</span><span class="token punctuation">;</span>

			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>PDOException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">echo</span> <span class="token single-quoted-string string">'Pas de connexion avec la BDD : '</span> <span class="token punctuation">.</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">pdo</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code></pre>
<p>Avec <code class="language-text">PDO::setAttribute</code>, on configure 2 attributs PDO :</p>
<ul>
<li><code class="language-text">PDO::ATTR_ERRMODE</code> : affiche les rapports d'erreur ;</li>
<li><code class="language-text">PDO::ERRMODE_EXCEPTION</code> : émet une exception pour les erreurs.</li>
</ul>
<p>Désormais, la connexion établie, on va pouvoir gérer 3 types de requêtes SQL dans 3 fonctions distinctes :</p>
<ul>
<li>Simple ("query") ;</li>
<li>Préparéé ("prepare") ;</li>
<li>Une seule ligne ("row").</li>
</ul>
<h3 id="requête-simple"><a href="#requ%C3%AAte-simple" aria-hidden="true"><span class="icon icon-link"></span></a>Requête simple</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Requête simple</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token variable">$req</span>  <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getPDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token scope">PDO<span class="token punctuation">::</span></span><span class="token constant">FETCH_OBJ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Avec <code class="language-text">PDOStatement::fetchAll</code>, on renvoi tous les résultat sous la forme d'un tableau d'objet de type "stdClass" avec les noms de propriétés qui correspondent aux noms des colonnes retournés dans le jeu de résultats via <code class="language-text">PDO::FETCH_OBJ</code>. Exemple avec notre table :</p>
<pre class="language-php"><code class="language-php"><span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Macon <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Kalia <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">3</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Damian <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">4</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Nash <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Keefe <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">6</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Octavius <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">7</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Wendy <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">8</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Maggy <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">9</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Walter <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">10</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Cherokee <span class="token punctuation">)</span> <span class="token punctuation">)</span> </code></pre>
<p>Si vous voulez un tableau de type "array", remplacez <code class="language-text">PDO::FETCH_OBJ</code> par <code class="language-text">PDO::FETCH_ASSOC</code>. Ce qui donne avec nos données :</p>
<pre class="language-php"><code class="language-php"><span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Macon <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Kalia <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">3</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Damian <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">4</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Nash <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Keefe <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">6</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Octavius <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">7</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Wendy <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">8</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Maggy <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">9</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Walter <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">10</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Cherokee <span class="token punctuation">)</span> <span class="token punctuation">)</span> </code></pre>
<h3 id="requête-préparée"><a href="#requ%C3%AAte-pr%C3%A9par%C3%A9e" aria-hidden="true"><span class="icon icon-link"></span></a>Requête préparée</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Requête préparée</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token variable">$query</span>  <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token double-quoted-string string">" "</span><span class="token punctuation">,</span> <span class="token variable">$statement</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Récupération du 1èr mot</span>
	<span class="token variable">$option</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">array_shift</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token variable">$req</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getPDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"select"</span> <span class="token operator">||</span> <span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"show"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token scope">PDO<span class="token punctuation">::</span></span><span class="token constant">FETCH_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"insert"</span> <span class="token operator">||</span> <span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"update"</span> <span class="token operator">||</span> <span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"delete"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"insert"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Valeur id inséré</span>
			<span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getPDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">lastInsertId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Si c'est une requête de type <code class="language-text">SELECT</code> ou <code class="language-text">SHOW</code>, on affiche tous les objets. Si elle est du type <code class="language-text">INSERT</code>, on retourne l'id retourné via <code class="language-text">lastInsertId()</code>. Sinon pour celles du type <code class="language-text">UPDATE</code> ou <code class="language-text">DELETE</code>, on affiche le résultat sous formes d'un entier via <code class="language-text">PDOStatement::rowCount</code> (0 = contenu non modifié, X = nombre de contenu modifié(s)).</p>
<h3 id="une-seule-ligne"><a href="#une-seule-ligne" aria-hidden="true"><span class="icon icon-link"></span></a>Une seule ligne</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Une seule ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">row</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token variable">$req</span> <span class="token operator">=</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getPDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token scope">PDO<span class="token punctuation">::</span></span><span class="token constant">FETCH_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Avec <code class="language-text">fetch</code>, on retourne une seule ligne sous la forme d'un tableau indexé par le nom de la colonne comme retourné dans le jeu de résultats. Dans notre cas pour la 1ère ligne de notre table.</p>
<pre class="language-php"><code class="language-php"><span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Macon <span class="token punctuation">)</span></code></pre>
<h2 id="le-modèle"><a href="#le-mod%C3%A8le" aria-hidden="true"><span class="icon icon-link"></span></a>Le modèle</h2>
<p>Créez une nouveau fichier "Users.php" dans le dossier "models" dont la classe "Users" est héritée de la classe "Database".</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">// models/Users.php</span>

<span class="token keyword">require_once</span> <span class="token double-quoted-string string">"./config/Database.php"</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token keyword">extends</span> <span class="token class-name">Database</span>
<span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token variable">$table</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token variable">$db</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"users"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span> <span class="token operator">=</span> <span class="token variable">$table</span><span class="token punctuation">;</span>
		<span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Ici la suite du code</span>
<span class="token punctuation">}</span></span></code></pre>
<p>On ajoute à la suite, les 4 requètes CRUD (Create Read Update Delete) génériques.</p>
<h3 id="sélectionner-tous-les-éléments"><a href="#s%C3%A9lectionner-tous-les-%C3%A9l%C3%A9ments" aria-hidden="true"><span class="icon icon-link"></span></a>Sélectionner tous les éléments</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Sélectionner tous les éléments</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"SELECT id, name 
							 FROM <span class="token interpolation"><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>On utilise "query" car ce n'est pas une requète spécifique.</p>
<h3 id="sélectionner-un-élément-par-son-id"><a href="#s%C3%A9lectionner-un-%C3%A9l%C3%A9ment-par-son-id" aria-hidden="true"><span class="icon icon-link"></span></a>Sélectionner un élément par son id</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Sélectionner un élément par son id</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">row</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"SELECT id, name 
							   FROM <span class="token interpolation"><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span></span> 
							   WHERE id = :id 
							   LIMIT 1"</span><span class="token punctuation">,</span>
							   <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"id"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>On utilise "row" car on attend une seule ligne.</p>
<h3 id="ajouter-un-élément"><a href="#ajouter-un-%C3%A9l%C3%A9ment" aria-hidden="true"><span class="icon icon-link"></span></a>Ajouter un élément</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Ajouter un élément</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"INSERT INTO <span class="token interpolation"><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span></span> (name) 
								   VALUES (:name)"</span><span class="token punctuation">,</span>
								   <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"name"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>On utilise "prepare" car on spécifie la valeur du champ "name".</p>
<h3 id="modifier-un-élément"><a href="#modifier-un-%C3%A9l%C3%A9ment" aria-hidden="true"><span class="icon icon-link"></span></a>Modifier un élément</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Modifier un élément</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">edit</span><span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"UPDATE <span class="token interpolation"><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span></span> 
								   SET name = :name 
								   WHERE id = :id"</span><span class="token punctuation">,</span>
								   <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"name"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"id"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>On utilise "prepare" car on spécifie la valeur du champ "name" et de l'id.</p>
<h3 id="supprimer-un-élément"><a href="#supprimer-un-%C3%A9l%C3%A9ment" aria-hidden="true"><span class="icon icon-link"></span></a>Supprimer un élément</h3>
<pre class="language-php"><code class="language-php"><span class="token comment">// Supprimer un élément</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"DELETE FROM <span class="token interpolation"><span class="token this">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span></span> 
								   WHERE id=:id"</span><span class="token punctuation">,</span>
								   <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"id"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>On utilise "prepare" car on spécifie la valeur du champ "id".</p>
<h2 id="tester"><a href="#tester" aria-hidden="true"><span class="icon icon-link"></span></a>Tester</h2>
<p>Depuis un fichier "index.php", on charge le fichier du modèle "Users" avec <code class="language-text">require_once</code> pour pouvoir l'instancier dans une variable avec <code class="language-text">new Nom_de_ma_classe()</code>.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Content-Type: text/html; charset=UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">require_once</span> <span class="token double-quoted-string string">"models/Users.php"</span><span class="token punctuation">;</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p>De cette façon, on peut exécuter nos requêtes écrites dans notre modèle "Users".</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Content-Type: text/html; charset=UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">require_once</span> <span class="token double-quoted-string string">"models/Users.php"</span><span class="token punctuation">;</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$users</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Tous les utilisateurs</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$users</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Un seul utilisateur, celui avec l'id 1</span>
<span class="token comment">//print_r($users->add("toto"));	  // Ajoute l'utilisateur "toto" et affiche l'id correspondant à cette nouvelle entrée</span>
<span class="token comment">//print_r($users->edit("aa", 1)); // Modifie l'utilisateur avec l'id 1 (et affiche 1 pour signaler une vraie modification)</span>
<span class="token comment">//print_r($users->delete(1));	  // Supprime l'utilsateur avec l'id 1 (et affiche 1)</span></span></code></pre>
<p>Pour afficher les "stdClass Object" proprement.</p>
<pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Content-Type: text/html; charset=UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">require_once</span> <span class="token double-quoted-string string">"models/Users.php"</span><span class="token punctuation">;</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$rows</span> <span class="token operator">=</span> <span class="token variable">$users</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$rows</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token delimiter important">?></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
	<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$rows</span> <span class="token keyword">as</span> <span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
	<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endforeach</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Pas d'utilisateurs dans la BDD :(<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endif</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span></code></pre>
<h2 id="conclusion"><a href="#conclusion" aria-hidden="true"><span class="icon icon-link"></span></a>Conclusion</h2>
<p>En mettant en place une classe Database, on gagne du temps dans le développement et sur la lisibilité du code. En effet, on instancie seulement une fois la connexion à PDO puis on écrit les requêtes dans le modèle concerné.</p>
</article></div><footer class="text-white mt-4"><ul class="nav nav-pills justify-content-center"><li><a href="https://github.com/etienner" target="_blank" class="nav-link">Github</a></li><li><a href="https://medium.com/@etiennerouzeaud" target="_blank" class="nav-link">Medium</a></li><li><a href="https://twitter.com/etiennerouzeaud" target="_blank" class="nav-link">Twitter</a></li></ul></footer></div>
    <script src="/assets/js/app.b659722c.js" defer></script><script src="/assets/js/page--src--templates--post-vue.6a9fe53b.js" defer></script>
  </body>
</html>
