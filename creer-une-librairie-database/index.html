<!DOCTYPE html>
<html data-html-server-rendered="true" lang="fr" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22fr%22%7D%7D">
  <head>
    <title>Cr√©er une librairie &quot;Database&quot; - https://etienner.github.io</title><meta name="gridsome:hash" content="499d0acdb60fd13e5c28c9817b15999f21ae23a4"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.14"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="description" content="On va concevoir une librairie en POO (Programmation Orient√© Objet) pour pouvoir se connecter √† la base de donn√©es avec PDO (PHP Data Objects). En plus de concevoir cette librairie, on va √©galement cr√©er"><meta data-vue-tag="ssr" property="og:type" content="article"><meta data-vue-tag="ssr" property="og:title" content="Cr√©er une librairie &quot;Database&quot;"><meta data-vue-tag="ssr" property="og:description" content="On va concevoir une librairie en POO (Programmation Orient√© Objet) pour pouvoir se connecter √† la base de donn√©es avec PDO (PHP Data Objects). En plus de concevoir cette librairie, on va √©galement cr√©er"><meta data-vue-tag="ssr" property="og:url" content="https://etienner.github.io/creer-une-librairie-database/"><meta data-vue-tag="ssr" name="twitter:domain" content="https://etienner.github.io"><meta data-vue-tag="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-tag="ssr" name="twitter:title" content="Cr√©er une librairie &quot;Database&quot;"><meta data-vue-tag="ssr" name="twitter:description" content="On va concevoir une librairie en POO (Programmation Orient√© Objet) pour pouvoir se connecter √† la base de donn√©es avec PDO (PHP Data Objects). En plus de concevoir cette librairie, on va √©galement cr√©er"><meta data-vue-tag="ssr" name="twitter:site" content="@etiennerouzeaud"><meta data-vue-tag="ssr" name="twitter:creator" content="@etiennerouzeaud"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffafafc09ac851d81afb65b8ef59.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffafafc09ac851d81afb65b8ef59.png"><link rel="preload" href="/assets/css/0.styles.ddbb36ea.css" as="style"><link rel="preload" href="/assets/js/app.57e0f4bd.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.619d8641.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.77a6618c.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.dfbaccb8.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.37769e18.js"><link rel="stylesheet" href="/assets/css/0.styles.ddbb36ea.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app"><header class="py-2 text-center"><strong><a href="/" title="Accueil" class="active">Etienne ROUZEAUD - D√©veloppeur Web</a></strong></header><main><div class="title py-2 text-center" data-v-2084d89c><h1 class="display-5 pt-2" data-v-2084d89c>Cr√©er une librairie &quot;Database&quot;</h1><!----></div><div class="container"><div class="row"><div class="mt-4 col-lg-2"><p><em><span>23 novembre 2015</span></em></p><ul class="list-unstyled"><li>
            üè∑Ô∏è <a href="/tag/PHP/">PHP</a></li><li>
            üè∑Ô∏è <a href="/tag/MySQL/">MySQL</a></li></ul><!----></div><article class="mt-4 col-lg-10"><p>On va concevoir une librairie en POO (Programmation Orient√© Objet) pour pouvoir se connecter √† la base de donn√©es avec PDO (PHP Data Objects). En plus de concevoir cette librairie, on va √©galement cr√©er un mod√®le contenant des requ√™tes SQL de type CRUD (Create Read Update Delete). Vous pourrez par la suite, r√©utiliser cette librairie dans un "microframework" PHP tel que Slim, Silex ou Lumen et ainsi profiter du mod√®le MVC.</p>
<h2>Pr√©paration</h2>
<p>Pour faire ce tutoriel, il nous faut pour commencer, une base de donn√©e MySQL / MariaDB.</p>
<div class="gridsome-highlight" data-language="sql"><pre style="counter-reset: linenumber NaN" class="language-sql line-numbers"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> test<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8_unicode_ci<span class="token punctuation">;</span>


<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Macon'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'Kalia'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Damian'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Nash'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'Keefe'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'Octavius'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'Wendy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'Maggy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'Walter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'Cherokee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Classe "Database"</h2>
<p>Cr√©ez un fichier "Database.php" dans le dossier "config".</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">// config/Database.php</span>

<span class="token keyword">class</span> <span class="token class-name">Database</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Code √† venir</span>
<span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Cette classe va contenir la connexion √† PDO puis diff√©rents types de requ√™tes SQL possibles en PDO.</p>
<h3>Connexion √† PDO</h3>
<p>Pour se connecter √† notre serveur via PDO, on a besoin des 5 informations obligatoires ci-dessous.</p>
<ul>
<li>Le nom de la base ;</li>
<li>Le nom utilisateur ("root" par d√©faut) ;</li>
<li>Le mot de passe ;</li>
<li>L'adresse du serveur ;</li>
<li>Le port du serveur ("3306" par d√©faut).</li>
</ul>
<p>On cr√©√© donc ces 5 variables instanci√©es dans le constructeur de notre classe.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">// config/Database.php</span>

<span class="token keyword">class</span> <span class="token class-name">Database</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_name</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"test"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_user</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"root"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_pass</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_host</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"localhost"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_port</span> <span class="token operator">=</span> <span class="token number">3306</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Autres fonctions √† venir</span>
<span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Maintenant que l'on a ces donn√©es, on va pouvoir cr√©er notre fonction de connexion PDO, que l'on nomme <code class="language-text">getPDO()</code>.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">// config/Database.php</span>

<span class="token keyword">class</span> <span class="token class-name">Database</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_name</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"test"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_user</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"root"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_pass</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_host</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"localhost"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_port</span> <span class="token operator">=</span> <span class="token number">3306</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Connexion √† la BDD</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">getPDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">pdo</span> <span class="token operator">===</span> <span class="token constant">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// DSN</span>
                <span class="token variable">$pdo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"mysql:dbname="</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_name</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">";host="</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_host</span> <span class="token punctuation">.</span> <span class="token double-quoted-string string">";port="</span><span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_port</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_user</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db_pass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$pdo</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ATTR_ERRMODE</span><span class="token punctuation">,</span> <span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ERRMODE_EXCEPTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$pdo</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"SET CHARACTER SET utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">pdo</span> <span class="token operator">=</span> <span class="token variable">$pdo</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>PDOException <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">echo</span> <span class="token single-quoted-string string">'Pas de connexion avec la BDD : '</span> <span class="token punctuation">.</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">pdo</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Avec <code class="language-text">PDO::setAttribute</code>, on configure 2 attributs PDO :</p>
<ul>
<li><code class="language-text">PDO::ATTR_ERRMODE</code> : affiche les rapports d'erreur ;</li>
<li><code class="language-text">PDO::ERRMODE_EXCEPTION</code> : √©met une exception pour les erreurs.</li>
</ul>
<p>D√©sormais, la connexion √©tablie, on va pouvoir g√©rer 3 types de requ√™tes SQL dans 3 fonctions distinctes :</p>
<ul>
<li>Simple ("query") ;</li>
<li>Pr√©par√©√© ("prepare") ;</li>
<li>Une seule ligne ("row").</li>
</ul>
<h3>Requ√™te simple</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Requ√™te simple</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$req</span>  <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getPDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FETCH_OBJ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Avec <code class="language-text">PDOStatement::fetchAll</code>, on renvoi tous les r√©sultat sous la forme d'un tableau d'objet de type "stdClass" avec les noms de propri√©t√©s qui correspondent aux noms des colonnes retourn√©s dans le jeu de r√©sultats via <code class="language-text">PDO::FETCH_OBJ</code>. Exemple avec notre table :</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Macon <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Kalia <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">3</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Damian <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">4</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Nash <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Keefe <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">6</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Octavius <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">7</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Wendy <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">8</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Maggy <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">9</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Walter <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> stdClass Object <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">10</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Cherokee <span class="token punctuation">)</span> <span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>Si vous voulez un tableau de type "array", remplacez <code class="language-text">PDO::FETCH_OBJ</code> par <code class="language-text">PDO::FETCH_ASSOC</code>. Ce qui donne avec nos donn√©es :</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Macon <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Kalia <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">3</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Damian <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">4</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Nash <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Keefe <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">6</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Octavius <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">7</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Wendy <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">8</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Maggy <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">9</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Walter <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">10</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Cherokee <span class="token punctuation">)</span> <span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3>Requ√™te pr√©par√©e</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Requ√™te pr√©par√©e</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$query</span>  <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token double-quoted-string string">" "</span><span class="token punctuation">,</span> <span class="token variable">$statement</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// R√©cup√©ration du 1√®r mot</span>
    <span class="token variable">$option</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">array_shift</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$req</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getPDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"select"</span> <span class="token operator">||</span> <span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"show"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FETCH_CLASS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"insert"</span> <span class="token operator">||</span> <span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"update"</span> <span class="token operator">||</span> <span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"delete"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$option</span> <span class="token operator">==</span> <span class="token double-quoted-string string">"insert"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Valeur id ins√©r√©</span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getPDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">lastInsertId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">rowCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Si c'est une requ√™te de type <code class="language-text">SELECT</code> ou <code class="language-text">SHOW</code>, on affiche tous les objets. Si elle est du type <code class="language-text">INSERT</code>, on retourne l'id retourn√© via <code class="language-text">lastInsertId()</code>. Sinon pour celles du type <code class="language-text">UPDATE</code> ou <code class="language-text">DELETE</code>, on affiche le r√©sultat sous formes d'un entier via <code class="language-text">PDOStatement::rowCount</code> (0 = contenu non modifi√©, X = nombre de contenu modifi√©(s)).</p>
<h3>Une seule ligne</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Une seule ligne</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">row</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$req</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getPDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$statement</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">FETCH_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Avec <code class="language-text">fetch</code>, on retourne une seule ligne sous la forme d'un tableau index√© par le nom de la colonne comme retourn√© dans le jeu de r√©sultats. Dans notre cas pour la 1√®re ligne de notre table.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token keyword">Array</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> Macon <span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2>Le mod√®le</h2>
<p>Cr√©ez une nouveau fichier "Users.php" dans le dossier "models" dont la classe "Users" est h√©rit√©e de la classe "Database".</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">// models/Users.php</span>

<span class="token keyword">require_once</span> <span class="token double-quoted-string string">"./config/Database.php"</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Users</span> <span class="token keyword">extends</span> <span class="token class-name">Database</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$table</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$db</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$table</span> <span class="token operator">=</span> <span class="token double-quoted-string string">"users"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span> <span class="token operator">=</span> <span class="token variable">$table</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Ici la suite du code</span>
<span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On ajoute √† la suite, les 4 requ√®tes CRUD (Create Read Update Delete) g√©n√©riques.</p>
<h3>S√©lectionner tous les √©l√©ments</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// S√©lectionner tous les √©l√©ments</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"SELECT id, name
                                FROM <span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On utilise "query" car ce n'est pas une requ√®te sp√©cifique.</p>
<h3>S√©lectionner un √©l√©ment par son id</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// S√©lectionner un √©l√©ment par son id</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">row</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"SELECT id, name
                                FROM <span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span></span>
                                WHERE id = :id
                                LIMIT 1"</span><span class="token punctuation">,</span>
                                <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"id"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On utilise "row" car on attend une seule ligne.</p>
<h3>Ajouter un √©l√©ment</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Ajouter un √©l√©ment</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"INSERT INTO <span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span></span> (name)
                                    VALUES (:name)"</span><span class="token punctuation">,</span>
                                    <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"name"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On utilise "prepare" car on sp√©cifie la valeur du champ "name".</p>
<h3>Modifier un √©l√©ment</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Modifier un √©l√©ment</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">edit</span><span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">,</span> <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"UPDATE <span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span></span>
                                    SET name = :name
                                    WHERE id = :id"</span><span class="token punctuation">,</span>
                                    <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"name"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token double-quoted-string string">"id"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On utilise "prepare" car on sp√©cifie la valeur du champ "name" et de l'id.</p>
<h3>Supprimer un √©l√©ment</h3>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token comment">// Supprimer un √©l√©ment</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token double-quoted-string string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"DELETE FROM <span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span></span>
                                    WHERE id=:id"</span><span class="token punctuation">,</span>
                                    <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"id"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>On utilise "prepare" car on sp√©cifie la valeur du champ "id".</p>
<h2>Tester</h2>
<p>Depuis un fichier "index.php", on charge le fichier du mod√®le "Users" avec <code class="language-text">require_once</code> pour pouvoir l'instancier dans une variable avec <code class="language-text">new Nom_de_ma_classe()</code>.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Content-Type: text/html; charset=UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">require_once</span> <span class="token double-quoted-string string">"models/Users.php"</span><span class="token punctuation">;</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>De cette fa√ßon, on peut ex√©cuter nos requ√™tes √©crites dans notre mod√®le "Users".</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Content-Type: text/html; charset=UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">require_once</span> <span class="token double-quoted-string string">"models/Users.php"</span><span class="token punctuation">;</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$users</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Tous les utilisateurs</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$users</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Un seul utilisateur, celui avec l'id 1</span>
<span class="token comment">//print_r($users->add("toto"));   // Ajoute l'utilisateur "toto" et affiche l'id correspondant √† cette nouvelle entr√©e</span>
<span class="token comment">//print_r($users->edit("aa", 1)); // Modifie l'utilisateur avec l'id 1 (et affiche 1 pour signaler une vraie modification)</span>
<span class="token comment">//print_r($users->delete(1));     // Supprime l'utilsateur avec l'id 1 (et affiche 1)</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Pour afficher les "stdClass Object" proprement.</p>
<div class="gridsome-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Content-Type: text/html; charset=UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">require_once</span> <span class="token double-quoted-string string">"models/Users.php"</span><span class="token punctuation">;</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$rows</span> <span class="token operator">=</span> <span class="token variable">$users</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$rows</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token delimiter important">?></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">></span></span>Name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$rows</span> <span class="token keyword">as</span> <span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span>
    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endforeach</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span>

<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token delimiter important">?></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Pas d'utilisateurs dans la BDD :(<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">endif</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2>Conclusion</h2>
<p>En mettant en place une classe Database, on gagne du temps dans le d√©veloppement et sur la lisibilit√© du code. En effet, on instancie seulement une fois la connexion √† PDO puis on √©crit les requ√™tes dans le mod√®le concern√©.</p>
</article></div></div></main><footer class="text-white mt-4"><ul class="nav nav-pills justify-content-center"><li><a href="https://github.com/etienner" target="_blank" rel="noopener" class="nav-link">Github</a></li><li><a href="https://medium.com/@etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Medium</a></li><li><a href="https://twitter.com/etiennerouzeaud" target="_blank" rel="noopener" class="nav-link">Twitter</a></li></ul></footer></div>
    <script src="/assets/js/app.57e0f4bd.js" defer></script><script src="/assets/js/page--src--templates--post-vue.619d8641.js" defer></script>
  </body>
</html>
