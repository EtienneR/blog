<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="lang">
  <head>
    <title>Les structures en Go - https://etienner.github.io</title><meta name="gridsome:hash" content="a6a83eeab333c7bbcf47fff9751f8c5dda4260fc"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.2"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="description" content="Les structures font parties des fondamentaux de Golang notamment dans le développement Web où elles sont utilisées dans les modèles lors de développement d&#x27;applications en MVC. Elles permettent également"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffa.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffa.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffa.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffa.png"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript><link rel="preload" href="/assets/css/0.styles.2ee79837.css" as="style"><link rel="preload" href="/assets/js/app.b659722c.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.6a9fe53b.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.14b4f713.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.2907f5d3.js"><link rel="stylesheet" href="/assets/css/0.styles.2ee79837.css">
  </head>
  <body >
    <div data-server-rendered="true" id="app"><header><div class="container text-center"><strong><a href="/" title="Accueil" class="active">Etienne ROUZEAUD - Développeur Web</a></strong></div></header><div class="text-center title"><h1 class="display-5">Les structures en Go</h1><p><em>Posté le <span>12 avril 2015</span></em></p></div><div class="container"><article class="mt-4"><p>Les structures font parties des fondamentaux de Golang notamment dans le développement Web où elles sont utilisées dans les modèles lors de développement d'applications en MVC. Elles permettent également de travailler à partir de fichiers de type Json ou XML facilement. Une structure retournera des données sous formes de tableau de différent typages (entier, chaine de carcatères, décimal, etc...).</p>
<h2 id="déclaration-dune-structure"><a href="#d%C3%A9claration-dune-structure" aria-hidden="true"><span class="icon icon-link"></span></a>Déclaration d'une structure</h2>
<p>On déclare une structure de la manière suivante.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// Futur contenu de notre structure</span>
<span class="token punctuation">}</span></code></pre>
<p>Il ne reste plus qu'à compléter notre structure.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id <span class="token builtin">int64</span>
    Title <span class="token builtin">string</span>
    Content <span class="token builtin">string</span>
<span class="token punctuation">}</span></code></pre>
<p>En résumé, on a notre structure nommée "Post" qui contient un champ "Id" de type entier et 2 chaines de caractères "Title" et "Content".</p>
<p>Attention : le nom d'une structure et le nom des valeurs qui la compose commencent toujours par une lettre !</p>
<h2 id="lecture-de-notre-structure"><a href="#lecture-de-notre-structure" aria-hidden="true"><span class="icon icon-link"></span></a>Lecture de notre structure</h2>
<p>On va maintenant rendre notre structure "Post" opérationnelle. Autrement dit, on va l'appeler et y introduire les données ci-dessous.</p>
<pre class="language-go"><code class="language-go">post <span class="token operator">:=</span> Post<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Mon titre"</span><span class="token punctuation">,</span> <span class="token string">"Mon contenu"</span><span class="token punctuation">}</span></code></pre>
<p>Dans la variable "post", on importe le contenu de la structure "Post". Ce qui donne.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id             <span class="token builtin">int</span>
    Title<span class="token punctuation">,</span> Content <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    post <span class="token operator">:=</span> Post<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Mon titre"</span><span class="token punctuation">,</span> <span class="token string">"Mon contenu"</span><span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token comment">// {1 Mon titre Mon contenu}</span>
<span class="token punctuation">}</span></code></pre>
<p>On peut aussi appeler la structure en précisant chaque nom des champs.</p>
<pre class="language-go"><code class="language-go">post <span class="token operator">:=</span> Post<span class="token punctuation">{</span>
    Id<span class="token punctuation">:</span>      <span class="token number">1</span><span class="token punctuation">,</span>
    Title<span class="token punctuation">:</span>   <span class="token string">"Mon titre"</span><span class="token punctuation">,</span>
    Content<span class="token punctuation">:</span> <span class="token string">"Mon contenu"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<p>Ou encore.</p>
<pre class="language-go"><code class="language-go">post <span class="token operator">:=</span> Post<span class="token punctuation">{</span><span class="token punctuation">}</span>
post<span class="token punctuation">.</span>Id <span class="token operator">=</span> <span class="token number">1</span>
post<span class="token punctuation">.</span>Title <span class="token operator">=</span> <span class="token string">"Mon titre"</span>
post<span class="token punctuation">.</span>Content <span class="token operator">=</span> <span class="token string">"Mon contenu"</span></code></pre>
<p>Le résultat final sera toujours le même.</p>
<h2 id="cas-pratique-avec-du-json"><a href="#cas-pratique-avec-du-json" aria-hidden="true"><span class="icon icon-link"></span></a>Cas pratique avec du JSON</h2>
<h3 id="structure-simple"><a href="#structure-simple" aria-hidden="true"><span class="icon icon-link"></span></a>Structure simple</h3>
<p>On veut ouvrir un fichier "post.json" (présent dans le même dossier que le fichier Go) dont la structure est la suivante.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><span class="token string">"id: 1"</span><span class="token punctuation">,</span> <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Mon titre 1"</span><span class="token punctuation">,</span> <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"Mon contenu 1"</span><span class="token punctuation">}</span></code></pre>
<p>On édite notre code.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"io/ioutil"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id             <span class="token builtin">int</span>
    Title<span class="token punctuation">,</span> Content <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"post.json"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>On ouvre le fichier json via "ioutil.ReadFile" (fonction de la librairie <strong>io/ioutil</strong>). S'il n'y a pas d'erreur, on affiche le contenu de la variable "json". Sinon, on affiche une erreur. Normalement, notre code fonctionne mais renvoie des données non exploitables. On ré-édite notre code pour décoder ces données.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"encoding/json"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"io/ioutil"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id             <span class="token builtin">int</span>
    Title<span class="token punctuation">,</span> Content <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"post.json"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> post Post
        json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token operator">&amp;</span>post<span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Concrètement, on déclare une variable "post" accompagnée de la structure "Post". Puis, on utilise la fonction "json.Unmarshal" de la librairie <strong>encoding/json</strong> pour décoder le contenu au format Json présent dans le fichier "post.json" (via la variable "file") avec la structure "Post". Ensuite, on affiche le résultat.</p>
<p>On modifie le fichier Json en ajoutant des lignes supplémentaires.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Mon titre 1"</span><span class="token punctuation">,</span> <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"Mon contenu 1"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Mon titre 2"</span><span class="token punctuation">,</span> <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"Mon contenu 2"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Mon titre 3"</span><span class="token punctuation">,</span> <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"Mon contenu 3"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Mon titre 4"</span><span class="token punctuation">,</span> <span class="token property">"content"</span><span class="token operator">:</span> <span class="token string">"Mon contenu 4"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>Le résultat affichera <code class="language-text">{0  }</code> :(<br>
Remplacez <code class="language-text">var post Post</code> par <code class="language-text">var post []Post</code> car il s'agit d'un tableau de données.</p>
<p>Remarque : votre fichier Json ne doit pas comporter de code commenté !</p>
<p>On peut ainsi lui demander de n'afficher que la 1ère et 3ème ligne du fichier.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"encoding/json"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"io/ioutil"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id      <span class="token builtin">int</span>
    Title<span class="token punctuation">,</span> Content <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"post.json"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> post <span class="token punctuation">[</span><span class="token punctuation">]</span>Post
        json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token operator">&amp;</span>post<span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>post<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// {1 Mon titre 1 Mon contenu 1}</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>post<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// {3 Mon titre 3 Mon contenu 3}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Exercice :<br>
On va interagir avec l'utilisateur en lui proposant 2 options :</p>
<ul>
<li>Afficher toutes les lignes ;</li>
<li>Afficher une ligne en particulier.</li>
</ul>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"encoding/json"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"io/ioutil"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Post <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id             <span class="token builtin">int</span>
    Title<span class="token punctuation">,</span> Content <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> number <span class="token builtin">int</span>

    file<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token string">"post.json"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> post <span class="token punctuation">[</span><span class="token punctuation">]</span>Post
        json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token operator">&amp;</span>post<span class="token punctuation">)</span>

        max <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span>

        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Entrez un chiffre entre 1 et %d : "</span><span class="token punctuation">,</span> max<span class="token punctuation">)</span>
        <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>number<span class="token punctuation">)</span>

        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> number <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token comment">// Affiche toutes les données</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> number <span class="token operator">></span> max <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"Pas de données"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>post<span class="token punctuation">[</span>number<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 920 302' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-65'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-65)' width='920' height='302' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAVAEADASIAAhEBAxEB/8QAGwAAAgIDAQAAAAAAAAAAAAAAAAIDBAEFBgj/xAAzEAABAgQEAggEBwAAAAAAAAABAgMABAURBhMhMRLSBxdBU1SSk9EUIkJRUmFykaGxwf/EABcBAQEBAQAAAAAAAAAAAAAAAAABAwL/xAAfEQACAgEEAwAAAAAAAAAAAAAAAQIREgMTIVExYfD/2gAMAwEAAhEDEQA/AOGdxhXWlGXbqFmkkpSMlvYHSx4dd40ldqk7Uw38dMqPBcps2EnXsukD%2bYgULqCSSm/bsez3io/xtEcBmEja%2bigY5yaVIlIqOLWgkBxwi9rkkf7CZy%2b8X5z7xIt11Oyl2v8AULQofdGyzDJikLnL7xfmPvBnL7xfnPvGc5wbKP7RnPd/Gd7wyfYpEsvUJlhxK2nlJUNtbxvJPF1benJZp2oqLanEoPElNrEgHs%2b0c7nOa/Odd4dl5wvN3WdVp/uFt%2bSrjlHoOl9ENEm5Nl52fqoUtJVZDqABpfT5IsL6EsOLUVKnawVHc5zfJBBGulFSjbOG2L1IYa8ZV/Wb5IOo/DPi6v6zfJBBGu3HolsOo/DPi6v6zfJB1H4Z8XV/Wb5IIIbcehbIproTw20ypaZurEgjd5H3/RFKf6IMPyjDrzUzUytttbg4nUEXSCR9H5QQRm4K/vZFJ2z/2Q==' /%3e%3c/svg%3e" width="920" data-srcset="/assets/static/json.82a2fbd.661a731.jpg 480w, /assets/static/json.0ff29f4.661a731.jpg 920w" data-sizes="(max-width: 920px) 100vw, 920px" data-src="/assets/static/json.0ff29f4.661a731.jpg"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/json.0ff29f4.661a731.jpg" width="920"></noscript></p>
<h3 id="structure-avancée"><a href="#structure-avanc%C3%A9e" aria-hidden="true"><span class="icon icon-link"></span></a>Structure avancée</h3>
<p>Au lieu de créer un Json avec une structure avancée, on va piocher dans l'API du site de météorologie openweathermap.org, plus précisément sur
<a href="http://api.openweathermap.org/data/2.5/find?q=Washington&#x26;units=metric" target="_blank" rel="nofollow noopener noreferrer">http://api.openweathermap.org/data/2.5/find?q=Washington&#x26;units=metric</a> qui retourne ce genre de JSON.</p>
<pre class="language-json"><code class="language-json">  <span class="token punctuation">{</span>

    <span class="token property">"message"</span><span class="token operator">:</span><span class="token string">"accurate"</span><span class="token punctuation">,</span>
    <span class="token property">"cod"</span><span class="token operator">:</span><span class="token string">"200"</span><span class="token punctuation">,</span>
    <span class="token property">"count"</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token property">"list"</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"id"</span><span class="token operator">:</span><span class="token number">2634715</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Washington"</span><span class="token punctuation">,</span>
            <span class="token property">"coord"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"lon"</span><span class="token operator">:</span><span class="token number">-1.51667</span><span class="token punctuation">,</span>
                <span class="token property">"lat"</span><span class="token operator">:</span><span class="token number">54.900002</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"main"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"temp"</span><span class="token operator">:</span><span class="token number">7.98</span><span class="token punctuation">,</span>
                <span class="token property">"temp_min"</span><span class="token operator">:</span><span class="token number">7.98</span><span class="token punctuation">,</span>
                <span class="token property">"temp_max"</span><span class="token operator">:</span><span class="token number">7.98</span><span class="token punctuation">,</span>
                <span class="token property">"pressure"</span><span class="token operator">:</span><span class="token number">1020.08</span><span class="token punctuation">,</span>
                <span class="token property">"sea_level"</span><span class="token operator">:</span><span class="token number">1034.48</span><span class="token punctuation">,</span>
                <span class="token property">"grnd_level"</span><span class="token operator">:</span><span class="token number">1020.08</span><span class="token punctuation">,</span>
                <span class="token property">"humidity"</span><span class="token operator">:</span><span class="token number">74</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"dt"</span><span class="token operator">:</span><span class="token number">1427981672</span><span class="token punctuation">,</span>
            <span class="token property">"wind"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"speed"</span><span class="token operator">:</span><span class="token number">2.01</span><span class="token punctuation">,</span>
                <span class="token property">"deg"</span><span class="token operator">:</span><span class="token number">344</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"sys"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"country"</span><span class="token operator">:</span><span class="token string">"GB"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"clouds"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"all"</span><span class="token operator">:</span><span class="token number">80</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"weather"</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">"id"</span><span class="token operator">:</span><span class="token number">803</span><span class="token punctuation">,</span>
                    <span class="token property">"main"</span><span class="token operator">:</span><span class="token string">"Clouds"</span><span class="token punctuation">,</span>
                    <span class="token property">"description"</span><span class="token operator">:</span><span class="token string">"broken clouds"</span><span class="token punctuation">,</span>
                    <span class="token property">"icon"</span><span class="token operator">:</span><span class="token string">"04d"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">"id"</span><span class="token operator">:</span><span class="token number">4915545</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Washington"</span><span class="token punctuation">,</span>
            <span class="token property">"coord"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"lon"</span><span class="token operator">:</span><span class="token number">-89.40731</span><span class="token punctuation">,</span>
                <span class="token property">"lat"</span><span class="token operator">:</span><span class="token number">40.703651</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"main"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"temp"</span><span class="token operator">:</span><span class="token number">17.98</span><span class="token punctuation">,</span>
                <span class="token property">"temp_min"</span><span class="token operator">:</span><span class="token number">17.98</span><span class="token punctuation">,</span>
                <span class="token property">"temp_max"</span><span class="token operator">:</span><span class="token number">17.98</span><span class="token punctuation">,</span>
                <span class="token property">"pressure"</span><span class="token operator">:</span><span class="token number">994.79</span><span class="token punctuation">,</span>
                <span class="token property">"sea_level"</span><span class="token operator">:</span><span class="token number">1019.2</span><span class="token punctuation">,</span>
                <span class="token property">"grnd_level"</span><span class="token operator">:</span><span class="token number">994.79</span><span class="token punctuation">,</span>
                <span class="token property">"humidity"</span><span class="token operator">:</span><span class="token number">83</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"dt"</span><span class="token operator">:</span><span class="token number">1427981672</span><span class="token punctuation">,</span>
            <span class="token property">"wind"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"speed"</span><span class="token operator">:</span><span class="token number">7.76</span><span class="token punctuation">,</span>
                <span class="token property">"deg"</span><span class="token operator">:</span><span class="token number">223</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"sys"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"country"</span><span class="token operator">:</span><span class="token string">"US"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"rain"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"3h"</span><span class="token operator">:</span><span class="token number">1.73</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"clouds"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"all"</span><span class="token operator">:</span><span class="token number">92</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"weather"</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">"id"</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span>
                    <span class="token property">"main"</span><span class="token operator">:</span><span class="token string">"Rain"</span><span class="token punctuation">,</span>
                    <span class="token property">"description"</span><span class="token operator">:</span><span class="token string">"light rain"</span><span class="token punctuation">,</span>
                    <span class="token property">"icon"</span><span class="token operator">:</span><span class="token string">"10d"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">"id"</span><span class="token operator">:</span><span class="token number">5549222</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Washington"</span><span class="token punctuation">,</span>
            <span class="token property">"coord"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"lon"</span><span class="token operator">:</span><span class="token number">-113.508293</span><span class="token punctuation">,</span>
                <span class="token property">"lat"</span><span class="token operator">:</span><span class="token number">37.130539</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"main"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"temp"</span><span class="token operator">:</span><span class="token number">6.98</span><span class="token punctuation">,</span>
                <span class="token property">"temp_min"</span><span class="token operator">:</span><span class="token number">6.98</span><span class="token punctuation">,</span>
                <span class="token property">"temp_max"</span><span class="token operator">:</span><span class="token number">6.98</span><span class="token punctuation">,</span>
                <span class="token property">"pressure"</span><span class="token operator">:</span><span class="token number">859.02</span><span class="token punctuation">,</span>
                <span class="token property">"sea_level"</span><span class="token operator">:</span><span class="token number">1024.06</span><span class="token punctuation">,</span>
                <span class="token property">"grnd_level"</span><span class="token operator">:</span><span class="token number">859.02</span><span class="token punctuation">,</span>
                <span class="token property">"humidity"</span><span class="token operator">:</span><span class="token number">30</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"dt"</span><span class="token operator">:</span><span class="token number">1427981672</span><span class="token punctuation">,</span>
            <span class="token property">"wind"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"speed"</span><span class="token operator">:</span><span class="token number">1.01</span><span class="token punctuation">,</span>
                <span class="token property">"deg"</span><span class="token operator">:</span><span class="token number">304.5</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"sys"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"country"</span><span class="token operator">:</span><span class="token string">"US"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"clouds"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"all"</span><span class="token operator">:</span><span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"weather"</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">"id"</span><span class="token operator">:</span><span class="token number">800</span><span class="token punctuation">,</span>
                    <span class="token property">"main"</span><span class="token operator">:</span><span class="token string">"Clear"</span><span class="token punctuation">,</span>
                    <span class="token property">"description"</span><span class="token operator">:</span><span class="token string">"Sky is Clear"</span><span class="token punctuation">,</span>
                    <span class="token property">"icon"</span><span class="token operator">:</span><span class="token string">"01d"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token property">"id"</span><span class="token operator">:</span><span class="token number">5815135</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"Washington"</span><span class="token punctuation">,</span>
            <span class="token property">"coord"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"lon"</span><span class="token operator">:</span><span class="token number">-120.501472</span><span class="token punctuation">,</span>
                <span class="token property">"lat"</span><span class="token operator">:</span><span class="token number">47.500118</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"main"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"temp"</span><span class="token operator">:</span><span class="token number">-1.92</span><span class="token punctuation">,</span>
                <span class="token property">"temp_min"</span><span class="token operator">:</span><span class="token number">-1.92</span><span class="token punctuation">,</span>
                <span class="token property">"temp_max"</span><span class="token operator">:</span><span class="token number">-1.92</span><span class="token punctuation">,</span>
                <span class="token property">"pressure"</span><span class="token operator">:</span><span class="token number">916.98</span><span class="token punctuation">,</span>
                <span class="token property">"sea_level"</span><span class="token operator">:</span><span class="token number">1040.76</span><span class="token punctuation">,</span>
                <span class="token property">"grnd_level"</span><span class="token operator">:</span><span class="token number">916.98</span><span class="token punctuation">,</span>
                <span class="token property">"humidity"</span><span class="token operator">:</span><span class="token number">83</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"dt"</span><span class="token operator">:</span><span class="token number">1427981672</span><span class="token punctuation">,</span>
            <span class="token property">"wind"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"speed"</span><span class="token operator">:</span><span class="token number">0.86</span><span class="token punctuation">,</span>
                <span class="token property">"deg"</span><span class="token operator">:</span><span class="token number">287</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"sys"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"country"</span><span class="token operator">:</span><span class="token string">"US"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"clouds"</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token property">"all"</span><span class="token operator">:</span><span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"weather"</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">"id"</span><span class="token operator">:</span><span class="token number">800</span><span class="token punctuation">,</span>
                    <span class="token property">"main"</span><span class="token operator">:</span><span class="token string">"Clear"</span><span class="token punctuation">,</span>
                    <span class="token property">"description"</span><span class="token operator">:</span><span class="token string">"Sky is Clear"</span><span class="token punctuation">,</span>
                    <span class="token property">"icon"</span><span class="token operator">:</span><span class="token string">"01n"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>

<span class="token punctuation">}</span></code></pre>
<p>L'API nous renvoit 4 résultats de villes (<code class="language-text">&quot;count&quot;:4</code>) s'appelant "Washington" dans le tableau "list".</p>
<p>Vu la structure du fichier Json, cela nous oblige de créer des structures imbriquées en Go, le syndrome de la "structureception".</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"encoding/json"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"io/ioutil"</span>
    <span class="token string">"log"</span>
    <span class="token string">"net/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Location <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Message<span class="token punctuation">,</span> Cod <span class="token builtin">string</span>
    Count        <span class="token builtin">int</span>
    List         <span class="token punctuation">[</span><span class="token punctuation">]</span>List
<span class="token punctuation">}</span>

<span class="token keyword">type</span> List <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id      <span class="token builtin">int</span>
    Name    <span class="token builtin">string</span>
    Coord   Coord
    Main    Main
    Dt      <span class="token builtin">int</span>
    Wind    Wind
    Sys     Sys
    Clouds  Clouds
    Weather <span class="token punctuation">[</span><span class="token punctuation">]</span>Weather
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Main <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Temp<span class="token punctuation">,</span> Temp_min<span class="token punctuation">,</span> Pressure<span class="token punctuation">,</span> Sea_level<span class="token punctuation">,</span> Grnd_level<span class="token punctuation">,</span> Humidity <span class="token builtin">float32</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Coord <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Lon<span class="token punctuation">,</span> Lat <span class="token builtin">float32</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Wind <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Speed<span class="token punctuation">,</span> Deg <span class="token builtin">float32</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Rain <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Value <span class="token builtin">float32</span> <span class="token string">`json:"3h"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Sys <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Country <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Clouds <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    All <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Weather <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id                      <span class="token builtin">int32</span>
    Main<span class="token punctuation">,</span> Description<span class="token punctuation">,</span> Icon <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"http://api.openweathermap.org/data/2.5/find?q=Washington&amp;units=metric"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>

        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> location Location
            err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token operator">&amp;</span>location<span class="token punctuation">)</span>

            <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Quelques explications s'imposent :</p>
<ol>
<li>On déclare une structure "location" (vous pouvez l'appeler comme bon vous semble si ce terme ne vous semble pas explicite...).
Au sein de cette structure, on récupère les valeurs contenues dans les champs "Message", "Cod", "Count". Puis, on arrive sur un tableau qui va aller chercher dans la structure enfant "List". "List" étant un tableau, on préfixe avec crochet fermant / ouvrant "[]" lors de sa déclaration dans sa structure parente ("Location").</li>
<li>La struture "List" comporte des données comme "Id", "Name", "Dt" mais également des structures enfants.</li>
<li>On déclare les différentes structures enfants de "List".</li>
<li>Dans la function "main", on appel l'API du site via "http.Get" (fonction de la librairie <strong>net/http</strong>).</li>
<li>On lit le contenu de l'URL via "ioutil.ReadAll" (fonction de la librairie <strong>io/ioutil</strong>).</li>
<li>On décode le contenu en Json via "json.Unmarshal" (fonction de la librairie <strong>encoding/json</strong>) par rapport à la structure "location".</li>
<li>On affiche le contenu dans notre console via la structure "location" qui affiche toutes les données de son enfant ("List") et de ses petits enfants.</li>
</ol>
<p>Non mais attend, c'est quoi ce charabia dans la structure "Rain" ?</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">type</span> Rain <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Value <span class="token builtin">float32</span> <span class="token string">`json:"3h"`</span>
<span class="token punctuation">}</span></code></pre>
<p>Le nom de l'unique valeur présente dans "Rain" est "3h" dans le fichier Json. Hors Go, comme précisé plus haut dans cet article, n'accepte pas les noms de valeur dans les structures commencant par un chiffre. Pour cela, on attribue un nom de valeur quelconque et on précise avec le binding (liaison) <code class="language-text">json:&quot;3h&quot;</code> qu'il s'agit du nom de la valeur "3h" présente dans le Json.<br>
<code class="language-text">fmt.Println(location.List[1].Rain.Value)</code> affiche bien "1.73".</p>
<p>Remarque : si vous ne souhaitez pas afficher certaines informations, il n'est pas nécessaire de déclarer toutes les structures, seulement celles qui sont concernées (en faisant attention à l'héritage).</p>
<p>Petit exercice :<br>
On souhaite afficher uniquement la ou les villes dont le code vaut "GB".<br>
On a besoin de modifier uniquement la fonction <code class="language-text">main()</code> et d'y ajouter une condition concernant le code du pays.
Cela se passe dans la "sous sous" structure "Sys" et la valeur concernée est "Country".</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"http://api.openweathermap.org/data/2.5/find?q=Washington&amp;units=metric"</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>

        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> location Location
            err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token operator">&amp;</span>location<span class="token punctuation">)</span>

            <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> location<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> location<span class="token punctuation">.</span>List<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Sys<span class="token punctuation">.</span>Country <span class="token operator">==</span> <span class="token string">"GB"</span> <span class="token punctuation">{</span>
                        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>List<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Un dernier exercice avant de clore cet article :<br>
cette fois, on veut que l'utilisateur rentre lui-même le nom de la ville. On affiche un message d'erreur personnalisé si l'API ne trouve rien correspondant la ville saisie.</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> city <span class="token builtin">string</span>

    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"Entrez le nom de la ville "</span><span class="token punctuation">)</span>
    <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>city<span class="token punctuation">)</span>

    <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"http://api.openweathermap.org/data/2.5/find?q=+"</span> <span class="token operator">+</span> city <span class="token operator">+</span> <span class="token string">"&amp;units=metric"</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>

            <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> location Location
                err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token operator">&amp;</span>location<span class="token punctuation">)</span>

                <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>

                    <span class="token keyword">if</span> location<span class="token punctuation">.</span>Count <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span>
                        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Cette ville n'existe pas :("</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Explications :</p>
<ol>
<li>On déclare la variable "city".</li>
<li>On invite l'utilisateur à rentrer le nom de la ville.</li>
<li>On concatène la variable "city" contenant le nom de la ville rentrée par l'utilisateur dans l'URL de l'API.</li>
<li>On décode les données fournies par l'API en JSON.</li>
<li>On met en place une condition en se basant sur la valeur de "count" pour savoir si il y a des données à afficher ou non.</li>
</ol>
<p><img class="g-image g-image--lazy g-image--loading" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 920 158' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-67'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-67)' width='920' height='158' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAALAEADASIAAhEBAxEB/8QAGgABAAIDAQAAAAAAAAAAAAAACAAFAgMEBv/EACwQAAECBQEHAgcAAAAAAAAAAAECAwAEBQYREhYhMVaUodEVURMyMzVBYsH/xAAXAQADAQAAAAAAAAAAAAAAAAAAAgMB/8QAHREAAgEEAwAAAAAAAAAAAAAAAAIBAxEiURIhUv/aAAwDAQACEQMRAD8A8bN3rXm5x6XbqaUNIdUgJLbY0jVgfiKx26607hXqaQTncUIJPaExJ2lbrqSt2h0xxaluKUpcshRJ3%2b4jo2Qtvl%2bkdG34h0VpjqbE8dBbcuauAp0VNkgjOShAx2jWLnr5JHqLG44%2bRO/tCn2Qtvl%2bkdG34ibIW3y/SOjb8Q/Cp6DHQVV3XXEHCqiyDjOPhpP8jHa2tZ%2b5M8cfTHiFbshbfL9I6NvxE2Rtvl%2bkdG34g4VPQY6CG/V55%2bdM05PIL%2bQNQBA3DHDGItJa7KyuYl0u1RLiFLSlSNIzgkAjh7QmKha9voYc0UKkpIIwRJtg8R%2bsVdWt2iNyj6m6NTEKSy4pJTKNgghKiDwibI17TJqvaej/2Q==' /%3e%3c/svg%3e" width="920" data-srcset="/assets/static/openweathermap.82a2fbd.199f3c3.jpg 480w, /assets/static/openweathermap.0ff29f4.199f3c3.jpg 920w" data-sizes="(max-width: 920px) 100vw, 920px" data-src="/assets/static/openweathermap.0ff29f4.199f3c3.jpg"><noscript><img class="g-image g-image--lazy g-image--loaded" src="/assets/static/openweathermap.0ff29f4.199f3c3.jpg" width="920"></noscript></p>
<h2 id="conclusion"><a href="#conclusion" aria-hidden="true"><span class="icon icon-link"></span></a>Conclusion</h2>
<p>Avant de se jeter corps et âme dans le code, prenez soin d'analyser soigneusement la structure globale des données. Afin de gérer au mieux l'héritage des structures.</p>
</article></div><footer class="text-white mt-4"><ul class="nav nav-pills justify-content-center"><li><a href="https://github.com/etienner" target="_blank" class="nav-link">Github</a></li><li><a href="https://medium.com/@etiennerouzeaud" target="_blank" class="nav-link">Medium</a></li><li><a href="https://twitter.com/etiennerouzeaud" target="_blank" class="nav-link">Twitter</a></li></ul></footer></div>
    <script src="/assets/js/app.b659722c.js" defer></script><script src="/assets/js/page--src--templates--post-vue.6a9fe53b.js" defer></script>
  </body>
</html>
